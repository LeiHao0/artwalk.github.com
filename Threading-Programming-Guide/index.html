<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo-192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo-192.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="rbaH_zC-qBwXaawJ10Mno3FHzv9HRFHGFdXx2f1BwyI">







<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"leihao0.github.io","root":"/","scheme":"Pisces","version":"8.0.0","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="Threading Programming Guide æœ€è¿‘æ€»æ˜¯è¢«é—®åˆ° Runloopé‚£ä¹ˆä»€ä¹ˆæ˜¯ è¿è¡Œå¾ªçŽ¯ å‘¢ç›´æŽ¥çœ‹ ï£¿ 2014-07-15 å°±åœæ­¢ä¿®è®¢çš„æ–‡æ¡£å§ ðŸ‘† ï½žï½žï½ž å®˜æ–¹è§£è¯´ å¼‚å¸¸æ¸…æ™°å‘¢">
<meta property="og:type" content="article">
<meta property="og:title" content="Threading Programming Guide">
<meta property="og:url" content="https://leihao0.github.io/Threading-Programming-Guide/index.html">
<meta property="og:site_name" content="LeiHao's Blog">
<meta property="og:description" content="Threading Programming Guide æœ€è¿‘æ€»æ˜¯è¢«é—®åˆ° Runloopé‚£ä¹ˆä»€ä¹ˆæ˜¯ è¿è¡Œå¾ªçŽ¯ å‘¢ç›´æŽ¥çœ‹ ï£¿ 2014-07-15 å°±åœæ­¢ä¿®è®¢çš„æ–‡æ¡£å§ ðŸ‘† ï½žï½žï½ž å®˜æ–¹è§£è¯´ å¼‚å¸¸æ¸…æ™°å‘¢">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/Art/runloop.jpg">
<meta property="og:image" content="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/Art/custominputsource.jpg">
<meta property="article:published_time" content="2020-05-27T06:19:00.000Z">
<meta property="article:modified_time" content="2020-09-03T00:53:27.996Z">
<meta property="article:author" content="LeiHao">
<meta property="article:tag" content="iOS">
<meta property="article:tag" content="Interview">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/Art/runloop.jpg">


<link rel="canonical" href="https://leihao0.github.io/Threading-Programming-Guide/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Threading Programming Guide | LeiHao's Blog</title>
  
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-159363268-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-159363268-1');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?25f016f633270b8e0baf56c4fe6f2dc1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <style>:root {
  --body-bg-color: #f5f7f9;
  --content-bg-color: #fff;
  --card-bg-color: #f5f5f5;
  --text-color: #555;
  --blockquote-color: #666;
  --link-color: #555;
  --link-hover-color: #222;
  --brand-color: #fff;
  --brand-hover-color: #fff;
  --table-row-odd-bg-color: #f9f9f9;
  --table-row-hover-bg-color: #f5f5f5;
  --menu-item-bg-color: #f5f5f5;
  --btn-default-bg: #fff;
  --btn-default-color: #555;
  --btn-default-border-color: #555;
  --btn-default-hover-bg: #222;
  --btn-default-hover-color: #fff;
  --btn-default-hover-border-color: #222;
  --highlight-background: #f0f0f0;
  --highlight-foreground: #444;
  --highlight-gutter-background: #dedede;
  --highlight-gutter-foreground: #555;
}
@media (prefers-color-scheme: dark) {
  :root {
    --body-bg-color: #282828;
    --content-bg-color: #333;
    --card-bg-color: #555;
    --text-color: #ccc;
    --blockquote-color: #bbb;
    --link-color: #ccc;
    --link-hover-color: #eee;
    --brand-color: #ddd;
    --brand-hover-color: #ddd;
    --table-row-odd-bg-color: #282828;
    --table-row-hover-bg-color: #363636;
    --menu-item-bg-color: #555;
    --btn-default-bg: #222;
    --btn-default-color: #ccc;
    --btn-default-border-color: #555;
    --btn-default-hover-bg: #666;
    --btn-default-hover-color: #ccc;
    --btn-default-hover-border-color: #666;
    --highlight-background: #1d1f21;
    --highlight-foreground: #c5c8c6;
    --highlight-gutter-background: #2d2f31;
    --highlight-gutter-foreground: #b4b7b5;
  }
  img {
    opacity: 0.75;
  }
  img:hover {
    opacity: 0.9;
  }
}
html {
  line-height: 1.15; /* 1 */
  -webkit-text-size-adjust: 100%; /* 2 */
}
body {
  margin: 0;
}
main {
  display: block;
}
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}
hr {
  box-sizing: content-box; /* 1 */
  height: 0; /* 1 */
  overflow: visible; /* 2 */
}
pre {
  font-family: monospace, monospace; /* 1 */
  font-size: 1em; /* 2 */
}
a {
  background: transparent;
}
abbr[title] {
  border-bottom: none; /* 1 */
  text-decoration: underline; /* 2 */
  text-decoration: underline dotted; /* 2 */
}
b,
strong {
  font-weight: bolder;
}
code,
kbd,
samp {
  font-family: monospace, monospace; /* 1 */
  font-size: 1em; /* 2 */
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sub {
  bottom: -0.25em;
}
sup {
  top: -0.5em;
}
img {
  border-style: none;
}
button,
input,
optgroup,
select,
textarea {
  font-family: inherit; /* 1 */
  font-size: 100%; /* 1 */
  line-height: 1.15; /* 1 */
  margin: 0; /* 2 */
}
button,
input {
/* 1 */
  overflow: visible;
}
button,
select {
/* 1 */
  text-transform: none;
}
button,
[type='button'],
[type='reset'],
[type='submit'] {
  -webkit-appearance: button;
}
button::-moz-focus-inner,
[type='button']::-moz-focus-inner,
[type='reset']::-moz-focus-inner,
[type='submit']::-moz-focus-inner {
  border-style: none;
  padding: 0;
}
button:-moz-focusring,
[type='button']:-moz-focusring,
[type='reset']:-moz-focusring,
[type='submit']:-moz-focusring {
  outline: 1px dotted ButtonText;
}
fieldset {
  padding: 0.35em 0.75em 0.625em;
}
legend {
  box-sizing: border-box; /* 1 */
  color: inherit; /* 2 */
  display: table; /* 1 */
  max-width: 100%; /* 1 */
  padding: 0; /* 3 */
  white-space: normal; /* 1 */
}
progress {
  vertical-align: baseline;
}
textarea {
  overflow: auto;
}
[type='checkbox'],
[type='radio'] {
  box-sizing: border-box; /* 1 */
  padding: 0; /* 2 */
}
[type='number']::-webkit-inner-spin-button,
[type='number']::-webkit-outer-spin-button {
  height: auto;
}
[type='search'] {
  outline-offset: -2px; /* 2 */
  -webkit-appearance: textfield; /* 1 */
}
[type='search']::-webkit-search-decoration {
  -webkit-appearance: none;
}
::-webkit-file-upload-button {
  font: inherit; /* 2 */
  -webkit-appearance: button; /* 1 */
}
details {
  display: block;
}
summary {
  display: list-item;
}
template {
  display: none;
}
[hidden] {
  display: none;
}
::selection {
  background: #262a30;
  color: #eee;
}
html,
body {
  height: 100%;
}
body {
  background: var(--body-bg-color);
  color: var(--text-color);
  font-family: Lato, "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 1em;
  line-height: 2;
  min-height: 100%;
  position: relative;
  transition: all 0.2s ease-in-out;
}
h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: Lato, "PingFang SC", "Microsoft YaHei", sans-serif;
  font-weight: bold;
  line-height: 1.5;
  margin: 20px 0 15px;
}
h1 {
  font-size: 1.5em;
}
h2 {
  font-size: 1.375em;
}
h3 {
  font-size: 1.25em;
}
h4 {
  font-size: 1.125em;
}
h5 {
  font-size: 1em;
}
h6 {
  font-size: 0.875em;
}
p {
  margin: 0 0 20px 0;
}
a,
span.exturl {
  border-bottom: 1px solid #999;
  color: var(--link-color);
  outline: 0;
  text-decoration: none;
  overflow-wrap: break-word;
  cursor: pointer;
}
a:hover,
span.exturl:hover {
  border-bottom-color: var(--link-hover-color);
  color: var(--link-hover-color);
}
iframe,
img,
video,
embed {
  display: block;
  margin-left: auto;
  margin-right: auto;
  max-width: 100%;
}
hr {
  background-image: repeating-linear-gradient(-45deg, #ddd, #ddd 4px, transparent 4px, transparent 8px);
  border: 0;
  height: 3px;
  margin: 40px 0;
}
blockquote {
  border-left: 4px solid #ddd;
  color: var(--blockquote-color);
  margin: 0;
  padding: 0 15px;
}
blockquote cite::before {
  content: '-';
  padding: 0 5px;
}
dt {
  font-weight: bold;
}
dd {
  margin: 0;
  padding: 0;
}
.table-container {
  overflow: auto;
}
table {
  border-collapse: collapse;
  border-spacing: 0;
  font-size: 0.875em;
  margin: 0 0 20px 0;
  width: 100%;
}
tbody tr:nth-of-type(odd) {
  background: var(--table-row-odd-bg-color);
}
tbody tr:hover {
  background: var(--table-row-hover-bg-color);
}
caption,
th,
td {
  padding: 8px;
}
th,
td {
  border: 1px solid #ddd;
  border-bottom: 3px solid #ddd;
}
th {
  font-weight: 700;
  padding-bottom: 10px;
}
td {
  border-bottom-width: 1px;
}
.btn {
  background: var(--btn-default-bg);
  border: 2px solid var(--btn-default-border-color);
  border-radius: 2px;
  color: var(--btn-default-color);
  display: inline-block;
  font-size: 0.875em;
  line-height: 2;
  padding: 0 20px;
  transition: background-color 0.2s ease-in-out;
}
.btn:hover {
  background: var(--btn-default-hover-bg);
  border-color: var(--btn-default-hover-border-color);
  color: var(--btn-default-hover-color);
}
.btn + .btn {
  margin: 0 0 8px 8px;
}
.btn .fa-fw {
  text-align: left;
  width: 1.285714285714286em;
}
.toggle {
  line-height: 0;
}
.toggle .toggle-line {
  background: #fff;
  display: block;
  height: 2px;
  left: 0;
  position: relative;
  top: 0;
  transition: all 0.4s;
  width: 100%;
}
.toggle .toggle-line:not(:first-child) {
  margin-top: 3px;
}
.toggle.toggle-arrow .toggle-line:first-child {
  left: 50%;
  top: 2px;
  transform: rotate(45deg);
  width: 50%;
}
.toggle.toggle-arrow .toggle-line:last-child {
  left: 50%;
  top: -2px;
  transform: rotate(-45deg);
  width: 50%;
}
.toggle.toggle-close .toggle-line:nth-child(2) {
  opacity: 0;
}
.toggle.toggle-close .toggle-line:first-child {
  top: 5px;
  transform: rotate(45deg);
}
.toggle.toggle-close .toggle-line:last-child {
  top: -5px;
  transform: rotate(-45deg);
}
/*

Original highlight.js style (c) Ivan Sagalaev <maniac@softwaremaniacs.org>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  background: #F0F0F0;
}


/* Base color: saturation 0; */

.hljs,
.hljs-subst {
  color: #444;
}

.hljs-comment {
  color: #888888;
}

.hljs-keyword,
.hljs-attribute,
.hljs-selector-tag,
.hljs-meta-keyword,
.hljs-doctag,
.hljs-name {
  font-weight: bold;
}


/* User color: hue: 0 */

.hljs-type,
.hljs-string,
.hljs-number,
.hljs-selector-id,
.hljs-selector-class,
.hljs-quote,
.hljs-template-tag,
.hljs-deletion {
  color: #880000;
}

.hljs-title,
.hljs-section {
  color: #880000;
  font-weight: bold;
}

.hljs-regexp,
.hljs-symbol,
.hljs-variable,
.hljs-template-variable,
.hljs-link,
.hljs-selector-attr,
.hljs-selector-pseudo {
  color: #BC6060;
}


/* Language color: hue: 90; */

.hljs-literal {
  color: #78A960;
}

.hljs-built_in,
.hljs-bullet,
.hljs-code,
.hljs-addition {
  color: #397300;
}


/* Meta color: hue: 200 */

.hljs-meta {
  color: #1f7199;
}

.hljs-meta-string {
  color: #4d99bf;
}


/* Misc effects */

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}

@media (prefers-color-scheme: dark) {
/* Tomorrow Night Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
  color: #969896;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
  color: #cc6666;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
  color: #de935f;
}

/* Tomorrow Yellow */
.hljs-attribute {
  color: #f0c674;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
  color: #b5bd68;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
  color: #81a2be;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
  color: #b294bb;
}

.hljs {
  display: block;
  overflow-x: auto;
  background: #1d1f21;
  color: #c5c8c6;
  padding: 0.5em;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}

}
code,
kbd,
figure.highlight,
pre {
  background: var(--highlight-background);
  color: var(--highlight-foreground);
}
figure.highlight,
pre {
  line-height: 1.6;
  margin: 0 auto 20px;
}
pre,
code {
  font-family: consolas, Menlo, monospace, "PingFang SC", "Microsoft YaHei";
}
code {
  border-radius: 3px;
  font-size: 0.875em;
  padding: 2px 4px;
  overflow-wrap: break-word;
}
kbd {
  border: 2px solid #ccc;
  border-radius: 0.2em;
  box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1);
  font-family: inherit;
  padding: 0.1em 0.3em;
  white-space: nowrap;
}
figure.highlight {
  position: relative;
}
figure.highlight pre {
  border: 0;
  margin: 0;
  padding: 10px 0;
}
figure.highlight table {
  border: 0;
  margin: 0;
  width: auto;
}
figure.highlight td {
  border: 0;
  padding: 0;
}
figure.highlight figcaption,
pre .caption,
pre figcaption {
  background: var(--highlight-gutter-background);
  color: var(--highlight-foreground);
  display: flow-root;
  font-size: 0.875em;
  line-height: 1.2;
  padding: 0.5em;
}
figure.highlight figcaption a,
pre .caption a,
pre figcaption a {
  color: var(--highlight-foreground);
  float: right;
}
figure.highlight figcaption a:hover,
pre .caption a:hover,
pre figcaption a:hover {
  border-bottom-color: var(--highlight-foreground);
}
figure.highlight .gutter {
  -moz-user-select: none;
  -ms-user-select: none;
  -webkit-user-select: none;
  user-select: none;
}
figure.highlight .gutter pre {
  background: var(--highlight-gutter-background);
  color: var(--highlight-gutter-foreground);
  padding-left: 10px;
  padding-right: 10px;
  text-align: right;
}
figure.highlight .code pre {
  padding-left: 10px;
  width: 100%;
}
pre .caption,
pre figcaption {
  margin-bottom: 10px;
}
.gist table {
  width: auto;
}
.gist table td {
  border: 0;
}
pre {
  overflow: auto;
  padding: 10px;
  position: relative;
}
pre code {
  background: none;
  padding: 0;
  text-shadow: none;
}
.blockquote-center {
  border-left: none;
  margin: 40px 0;
  padding: 0;
  position: relative;
  text-align: center;
}
.blockquote-center::before,
.blockquote-center::after {
  left: 0;
  line-height: 1;
  opacity: 0.6;
  position: absolute;
  width: 100%;
}
.blockquote-center::before {
  border-top: 1px solid #ccc;
  text-align: left;
  top: -20px;
  content: '\f10d';
  font-family: 'Font Awesome 5 Free';
  font-weight: 900;
}
.blockquote-center::after {
  border-bottom: 1px solid #ccc;
  bottom: -20px;
  text-align: right;
  content: '\f10e';
  font-family: 'Font Awesome 5 Free';
  font-weight: 900;
}
.blockquote-center p,
.blockquote-center div {
  text-align: center;
}
.group-picture {
  margin-bottom: 20px;
}
.group-picture .group-picture-row {
  display: flex;
  gap: 3px;
  margin-bottom: 3px;
}
.group-picture .group-picture-column {
  flex: 1;
}
.group-picture .group-picture-column img {
  height: 100%;
  margin: 0;
  object-fit: cover;
  width: 100%;
}
.post-body .label {
  color: #555;
  padding: 0 2px;
}
.post-body .label.default {
  background: #f0f0f0;
}
.post-body .label.primary {
  background: #efe6f7;
}
.post-body .label.info {
  background: #e5f2f8;
}
.post-body .label.success {
  background: #e7f4e9;
}
.post-body .label.warning {
  background: #fcf6e1;
}
.post-body .label.danger {
  background: #fae8eb;
}
.post-body .link-grid {
  display: grid;
  gap: 1.5rem 1.5rem;
  grid-template-columns: 1fr 1fr;
  margin-bottom: 20px;
  padding: 1rem;
}
@media (max-width: 767px) {
  .post-body .link-grid {
    grid-template-columns: 1fr;
  }
}
.post-body .link-grid .link-grid-container {
  border: solid #ddd;
  box-shadow: 1rem 1rem 0.5rem rgba(0,0,0,0.5);
  min-height: 5rem;
  min-width: 0;
  padding: 0.5rem;
  position: relative;
  transition: background 0.3s;
}
.post-body .link-grid .link-grid-container:hover {
  animation: next-shake 0.5s;
  background: var(--card-bg-color);
}
.post-body .link-grid .link-grid-container:active {
  box-shadow: 0.5rem 0.5rem 0.25rem rgba(0,0,0,0.5);
  transform: translate(0.2rem, 0.2rem);
}
.post-body .link-grid .link-grid-container .link-grid-image {
  background-clip: content-box;
  background-origin: content-box;
  background-size: cover;
  border: 1px solid #ddd;
  border-radius: 50%;
  box-sizing: border-box;
  height: 5rem;
  padding: 3px;
  position: absolute;
  width: 5rem;
}
.post-body .link-grid .link-grid-container p {
  margin: 0 1rem 0 6rem;
}
.post-body .link-grid .link-grid-container p:first-of-type {
  font-size: 1.2em;
}
.post-body .link-grid .link-grid-container p:last-of-type {
  font-size: 0.8em;
  line-height: 1.3rem;
  opacity: 0.7;
}
.post-body .link-grid .link-grid-container a {
  border: 0;
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}
@-moz-keyframes next-shake {
  0% {
    transform: translate(1pt, 1pt) rotate(0deg);
  }
  10% {
    transform: translate(-1pt, -2pt) rotate(-1deg);
  }
  20% {
    transform: translate(-3pt, 0pt) rotate(1deg);
  }
  30% {
    transform: translate(3pt, 2pt) rotate(0deg);
  }
  40% {
    transform: translate(1pt, -1pt) rotate(1deg);
  }
  50% {
    transform: translate(-1pt, 2pt) rotate(-1deg);
  }
  60% {
    transform: translate(-3pt, 1pt) rotate(0deg);
  }
  70% {
    transform: translate(3pt, 1pt) rotate(-1deg);
  }
  80% {
    transform: translate(-1pt, -1pt) rotate(1deg);
  }
  90% {
    transform: translate(1pt, 2pt) rotate(0deg);
  }
  100% {
    transform: translate(1pt, -2pt) rotate(-1deg);
  }
}
@-webkit-keyframes next-shake {
  0% {
    transform: translate(1pt, 1pt) rotate(0deg);
  }
  10% {
    transform: translate(-1pt, -2pt) rotate(-1deg);
  }
  20% {
    transform: translate(-3pt, 0pt) rotate(1deg);
  }
  30% {
    transform: translate(3pt, 2pt) rotate(0deg);
  }
  40% {
    transform: translate(1pt, -1pt) rotate(1deg);
  }
  50% {
    transform: translate(-1pt, 2pt) rotate(-1deg);
  }
  60% {
    transform: translate(-3pt, 1pt) rotate(0deg);
  }
  70% {
    transform: translate(3pt, 1pt) rotate(-1deg);
  }
  80% {
    transform: translate(-1pt, -1pt) rotate(1deg);
  }
  90% {
    transform: translate(1pt, 2pt) rotate(0deg);
  }
  100% {
    transform: translate(1pt, -2pt) rotate(-1deg);
  }
}
@-o-keyframes next-shake {
  0% {
    transform: translate(1pt, 1pt) rotate(0deg);
  }
  10% {
    transform: translate(-1pt, -2pt) rotate(-1deg);
  }
  20% {
    transform: translate(-3pt, 0pt) rotate(1deg);
  }
  30% {
    transform: translate(3pt, 2pt) rotate(0deg);
  }
  40% {
    transform: translate(1pt, -1pt) rotate(1deg);
  }
  50% {
    transform: translate(-1pt, 2pt) rotate(-1deg);
  }
  60% {
    transform: translate(-3pt, 1pt) rotate(0deg);
  }
  70% {
    transform: translate(3pt, 1pt) rotate(-1deg);
  }
  80% {
    transform: translate(-1pt, -1pt) rotate(1deg);
  }
  90% {
    transform: translate(1pt, 2pt) rotate(0deg);
  }
  100% {
    transform: translate(1pt, -2pt) rotate(-1deg);
  }
}
@keyframes next-shake {
  0% {
    transform: translate(1pt, 1pt) rotate(0deg);
  }
  10% {
    transform: translate(-1pt, -2pt) rotate(-1deg);
  }
  20% {
    transform: translate(-3pt, 0pt) rotate(1deg);
  }
  30% {
    transform: translate(3pt, 2pt) rotate(0deg);
  }
  40% {
    transform: translate(1pt, -1pt) rotate(1deg);
  }
  50% {
    transform: translate(-1pt, 2pt) rotate(-1deg);
  }
  60% {
    transform: translate(-3pt, 1pt) rotate(0deg);
  }
  70% {
    transform: translate(3pt, 1pt) rotate(-1deg);
  }
  80% {
    transform: translate(-1pt, -1pt) rotate(1deg);
  }
  90% {
    transform: translate(1pt, 2pt) rotate(0deg);
  }
  100% {
    transform: translate(1pt, -2pt) rotate(-1deg);
  }
}
.post-body .tabs {
  margin-bottom: 20px;
}
.post-body .tabs,
.tabs-comment {
  padding-top: 10px;
}
.post-body .tabs ul.nav-tabs,
.tabs-comment ul.nav-tabs {
  display: flex;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  margin: 0;
  padding: 0;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs,
  .tabs-comment ul.nav-tabs {
    display: block;
    margin-bottom: 5px;
  }
}
.post-body .tabs ul.nav-tabs li.tab,
.tabs-comment ul.nav-tabs li.tab {
  border-bottom: 1px solid #ddd;
  border-left: 1px solid transparent;
  border-right: 1px solid transparent;
  border-top: 3px solid transparent;
  flex-grow: 1;
  list-style-type: none;
  border-radius: 0 0 0 0;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab,
  .tabs-comment ul.nav-tabs li.tab {
    border-bottom: 1px solid transparent;
    border-left: 3px solid transparent;
    border-right: 1px solid transparent;
    border-top: 1px solid transparent;
  }
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab,
  .tabs-comment ul.nav-tabs li.tab {
    border-radius: 0;
  }
}
.post-body .tabs ul.nav-tabs li.tab a,
.tabs-comment ul.nav-tabs li.tab a {
  border-bottom: initial;
  display: block;
  line-height: 1.8;
  padding: 0.25em 0.75em;
  text-align: center;
  transition: all 0.2s ease-out;
}
.post-body .tabs ul.nav-tabs li.tab a i,
.tabs-comment ul.nav-tabs li.tab a i {
  width: 1.285714285714286em;
}
.post-body .tabs ul.nav-tabs li.tab.active,
.tabs-comment ul.nav-tabs li.tab.active {
  border-bottom-color: transparent;
  border-left-color: #ddd;
  border-right-color: #ddd;
  border-top-color: #fc6423;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab.active,
  .tabs-comment ul.nav-tabs li.tab.active {
    border-bottom-color: #ddd;
    border-left-color: #fc6423;
    border-right-color: #ddd;
    border-top-color: #ddd;
  }
}
.post-body .tabs ul.nav-tabs li.tab.active a,
.tabs-comment ul.nav-tabs li.tab.active a {
  cursor: default;
}
.post-body .tabs .tab-content,
.tabs-comment .tab-content {
  border: 1px solid #ddd;
  border-top-color: transparent;
  border-radius: 0 0 0 0;
}
@media (max-width: 413px) {
  .post-body .tabs .tab-content,
  .tabs-comment .tab-content {
    border-radius: 0;
    border-top-color: #ddd;
  }
}
.post-body .tabs .tab-content .tab-pane,
.tabs-comment .tab-content .tab-pane {
  padding: 20px 20px 0 20px;
}
.post-body .tabs .tab-content .tab-pane:not(.active),
.tabs-comment .tab-content .tab-pane:not(.active) {
  display: none;
}
.post-body .note {
  border-radius: 3px;
  margin-bottom: 20px;
  padding: 1em;
  position: relative;
  border: 1px solid #eee;
  border-left-width: 5px;
}
.post-body .note summary {
  cursor: pointer;
  outline: 0;
}
.post-body .note summary p {
  display: inline;
}
.post-body .note h2,
.post-body .note h3,
.post-body .note h4,
.post-body .note h5,
.post-body .note h6 {
  border-bottom: initial;
  margin: 0;
  padding-top: 0;
}
.post-body .note p:first-child,
.post-body .note ul:first-child,
.post-body .note ol:first-child,
.post-body .note table:first-child,
.post-body .note pre:first-child,
.post-body .note blockquote:first-child,
.post-body .note img:first-child {
  margin-top: 0;
}
.post-body .note p:last-child,
.post-body .note ul:last-child,
.post-body .note ol:last-child,
.post-body .note table:last-child,
.post-body .note pre:last-child,
.post-body .note blockquote:last-child,
.post-body .note img:last-child {
  margin-bottom: 0;
}
.post-body .note.default {
  border-left-color: #777;
}
.post-body .note.default h2,
.post-body .note.default h3,
.post-body .note.default h4,
.post-body .note.default h5,
.post-body .note.default h6 {
  color: #777;
}
.post-body .note.primary {
  border-left-color: #6f42c1;
}
.post-body .note.primary h2,
.post-body .note.primary h3,
.post-body .note.primary h4,
.post-body .note.primary h5,
.post-body .note.primary h6 {
  color: #6f42c1;
}
.post-body .note.info {
  border-left-color: #428bca;
}
.post-body .note.info h2,
.post-body .note.info h3,
.post-body .note.info h4,
.post-body .note.info h5,
.post-body .note.info h6 {
  color: #428bca;
}
.post-body .note.success {
  border-left-color: #5cb85c;
}
.post-body .note.success h2,
.post-body .note.success h3,
.post-body .note.success h4,
.post-body .note.success h5,
.post-body .note.success h6 {
  color: #5cb85c;
}
.post-body .note.warning {
  border-left-color: #f0ad4e;
}
.post-body .note.warning h2,
.post-body .note.warning h3,
.post-body .note.warning h4,
.post-body .note.warning h5,
.post-body .note.warning h6 {
  color: #f0ad4e;
}
.post-body .note.danger {
  border-left-color: #d9534f;
}
.post-body .note.danger h2,
.post-body .note.danger h3,
.post-body .note.danger h4,
.post-body .note.danger h5,
.post-body .note.danger h6 {
  color: #d9534f;
}
.pagination .prev,
.pagination .next,
.pagination .page-number,
.pagination .space {
  display: inline-block;
  margin: -1px 10px 0 10px;
  padding: 0 10px;
}
@media (max-width: 767px) {
  .pagination .prev,
  .pagination .next,
  .pagination .page-number,
  .pagination .space {
    margin: 0 5px;
  }
}
.pagination {
  border-top: 1px solid #eee;
  margin: 120px 0 0;
  text-align: center;
}
.pagination .prev,
.pagination .next,
.pagination .page-number {
  border-bottom: 0;
  border-top: 1px solid #eee;
  transition: border-color 0.2s ease-in-out;
}
.pagination .prev:hover,
.pagination .next:hover,
.pagination .page-number:hover {
  border-top-color: var(--link-hover-color);
}
@media (max-width: 767px) {
  .pagination {
    border-top: 0;
  }
  .pagination .prev,
  .pagination .next,
  .pagination .page-number {
    border-bottom: 1px solid #eee;
    border-top: 0;
  }
  .pagination .prev:hover,
  .pagination .next:hover,
  .pagination .page-number:hover {
    border-bottom-color: var(--link-hover-color);
  }
}
.pagination .space {
  margin: 0;
  padding: 0;
}
.pagination .page-number.current {
  background: #ccc;
  border-color: #ccc;
  color: var(--content-bg-color);
}
.comments {
  margin-top: 60px;
  overflow: hidden;
}
.comment-button-group {
  display: flex;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  justify-content: center;
  margin: 1em 0;
}
.comment-button-group .comment-button {
  margin: 0.1em 0.2em;
}
.comment-button-group .comment-button.active {
  background: var(--btn-default-hover-bg);
  border-color: var(--btn-default-hover-border-color);
  color: var(--btn-default-hover-color);
}
.comment-position {
  display: none;
}
.comment-position.active {
  display: block;
}
.tabs-comment {
  margin-top: 4em;
  padding-top: 0;
}
.tabs-comment .comments {
  margin-top: 0;
  padding-top: 0;
}
.headband {
  background: #222;
  height: 3px;
}
@media (max-width: 991px) {
  .headband {
    display: none;
  }
}
.header {
  background: transparent;
}
.header-inner {
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .header-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .header-inner {
    width: 73%;
  }
}
.site-brand-container {
  display: flex;
  flex-shrink: 0;
  padding: 0 10px;
}
.use-motion .header,
.use-motion .site-brand-container .toggle {
  opacity: 0;
}
.site-meta {
  flex-grow: 1;
  text-align: center;
}
@media (max-width: 767px) {
  .site-meta {
    text-align: center;
  }
}
.custom-logo-image {
  margin-top: 20px;
}
@media (max-width: 991px) {
  .custom-logo-image {
    display: none;
  }
}
.brand {
  border-bottom: none;
  color: var(--brand-color);
  display: inline-block;
  padding: 0 40px;
}
.brand:hover {
  color: var(--brand-hover-color);
}
.site-title {
  font-family: Lato, "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 1.375em;
  font-weight: normal;
  margin: 0;
}
.site-subtitle {
  color: #ddd;
  font-size: 0.8125em;
  margin: 10px 0;
}
.use-motion .site-title,
.use-motion .site-subtitle,
.use-motion .custom-logo-image {
  opacity: 0;
  position: relative;
  top: -10px;
}
.site-nav-toggle,
.site-nav-right {
  display: none;
}
@media (max-width: 767px) {
  .site-nav-toggle,
  .site-nav-right {
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
}
.site-nav-toggle .toggle,
.site-nav-right .toggle {
  color: var(--text-color);
  padding: 10px;
  width: 22px;
}
.site-nav-toggle .toggle .toggle-line,
.site-nav-right .toggle .toggle-line {
  background: var(--text-color);
  border-radius: 1px;
}
@media (max-width: 767px) {
  .site-nav {
    display: none;
  }
}
.site-nav-on .site-nav {
  display: block;
}
.menu {
  margin: 0;
  padding: 1em 0;
  text-align: center;
}
.menu-item {
  display: inline-block;
  list-style: none;
  margin: 0 10px;
}
@media (max-width: 767px) {
  .menu-item {
    display: block;
    margin-top: 10px;
  }
  .menu-item.menu-item-search {
    display: none;
  }
}
.menu-item a,
.menu-item span.exturl {
  border-bottom: 0;
  display: block;
  font-size: 0.8125em;
  transition: border-color 0.2s ease-in-out;
}
.menu-item a:hover,
.menu-item span.exturl:hover,
.menu-item a.menu-item-active,
.menu-item span.exturl.menu-item-active {
  background: var(--menu-item-bg-color);
}
.menu-item .fa,
.menu-item .fab,
.menu-item .far,
.menu-item .fas {
  margin-right: 8px;
}
.menu-item .badge {
  display: inline-block;
  font-weight: bold;
  line-height: 1;
  margin-left: 0.35em;
  margin-top: 0.35em;
  text-align: center;
  white-space: nowrap;
}
@media (max-width: 767px) {
  .menu-item .badge {
    float: right;
    margin-left: 0;
  }
}
.use-motion .menu-item {
  visibility: hidden;
}
.sidebar-inner {
  color: #999;
  padding: 18px 10px;
  text-align: center;
}
.cc-license {
  margin-top: 10px;
}
.cc-license .cc-opacity {
  border-bottom: none;
  opacity: 0.7;
}
.cc-license .cc-opacity:hover {
  opacity: 0.9;
}
.cc-license img {
  display: inline-block;
}
.site-author-image {
  border: 1px solid #eee;
  max-width: 120px;
  padding: 2px;
}
.site-author-name {
  color: var(--text-color);
  font-weight: 600;
  margin: 0;
}
.site-description {
  color: #999;
  font-size: 0.8125em;
  margin-top: 0;
}
.links-of-author a,
.links-of-author span.exturl {
  font-size: 0.8125em;
}
.sidebar-button {
  margin-top: 15px;
}
.sidebar-button a {
  border: 1px solid #fc6423;
  border-radius: 4px;
  color: #fc6423;
  display: inline-block;
  padding: 0 15px;
}
.sidebar-button a .fa,
.sidebar-button a .fab,
.sidebar-button a .far,
.sidebar-button a .fas {
  margin-right: 5px;
}
.sidebar-button a:hover {
  background: #fc6423;
  border: 1px solid #fc6423;
  color: #fff;
}
.sidebar-button a:hover .fa,
.sidebar-button a:hover .fab,
.sidebar-button a:hover .far,
.sidebar-button a:hover .fas {
  color: #fff;
}
.links-of-blogroll {
  font-size: 0.8125em;
  margin-top: 10px;
}
.links-of-blogroll-title {
  font-size: 0.875em;
  font-weight: 600;
  margin-top: 0;
}
.links-of-blogroll-list {
  list-style: none;
  margin: 0;
  padding: 0;
}
.sidebar-dimmer {
  display: none;
}
@media (max-width: 767px) {
  .sidebar-dimmer {
    background: #000;
    display: block;
    height: 100%;
    left: 0;
    opacity: 0;
    position: fixed;
    top: 0;
    transition: visibility 0.4s, opacity 0.4s;
    visibility: hidden;
    width: 100%;
    z-index: 1100;
  }
  .sidebar-active .sidebar-dimmer {
    opacity: 0.7;
    visibility: visible;
  }
}
.sidebar-nav {
  display: none;
  margin: 0;
  padding-bottom: 20px;
  padding-left: 0;
}
.sidebar-nav-active .sidebar-nav {
  display: block;
}
.sidebar-nav li {
  border-bottom: 1px solid transparent;
  color: var(--text-color);
  cursor: pointer;
  display: inline-block;
  font-size: 0.875em;
}
.sidebar-nav li.sidebar-nav-overview {
  margin-left: 10px;
}
.sidebar-nav li:hover {
  color: #fc6423;
}
.sidebar-toc-active .sidebar-nav-toc,
.sidebar-overview-active .sidebar-nav-overview {
  border-bottom-color: #fc6423;
  color: #fc6423;
}
.sidebar-toc-active .sidebar-nav-toc:hover,
.sidebar-overview-active .sidebar-nav-overview:hover {
  color: #fc6423;
}
.sidebar-panel {
  display: none;
  max-height: var(--sidebar-wrapper-height);
  overflow-x: hidden;
  overflow-y: auto;
}
.sidebar-toc-active .post-toc-wrap,
.sidebar-overview-active .site-overview-wrap {
  display: block;
}
.sidebar-toggle {
  bottom: 45px;
  height: 12px;
  padding: 6px 5px;
  width: 14px;
  background: #222;
  cursor: pointer;
  opacity: 0.6;
  position: fixed;
  z-index: 1300;
  right: 30px;
}
@media (max-width: 991px) {
  .sidebar-toggle {
    right: 20px;
  }
}
.sidebar-toggle:hover {
  opacity: 0.8;
}
@media (max-width: 991px) {
  .sidebar-toggle {
    opacity: 0.8;
  }
}
.sidebar-toggle:hover .toggle-line {
  background: #fc6423;
}
@media (any-hover: hover) {
  body:not(.sidebar-active) .sidebar-toggle:hover .toggle-line:first-child {
    left: 50%;
    top: 2px;
    transform: rotate(45deg);
    width: 50%;
  }
  body:not(.sidebar-active) .sidebar-toggle:hover .toggle-line:last-child {
    left: 50%;
    top: -2px;
    transform: rotate(-45deg);
    width: 50%;
  }
}
.sidebar-active .sidebar-toggle .toggle-line:nth-child(2) {
  opacity: 0;
}
.sidebar-active .sidebar-toggle .toggle-line:first-child {
  top: 5px;
  transform: rotate(45deg);
}
.sidebar-active .sidebar-toggle .toggle-line:last-child {
  top: -5px;
  transform: rotate(-45deg);
}
.post-toc {
  font-size: 0.875em;
}
.post-toc ol {
  list-style: none;
  margin: 0;
  padding: 0 2px 5px 10px;
  text-align: left;
}
.post-toc ol > ol {
  padding-left: 0;
}
.post-toc ol a {
  transition: all 0.2s ease-in-out;
}
.post-toc .nav-item {
  line-height: 1.8;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.post-toc .nav .nav-child {
  display: none;
}
.post-toc .nav .active > .nav-child {
  display: block;
}
.post-toc .nav .active-current > .nav-child {
  display: block;
}
.post-toc .nav .active-current > .nav-child > .nav-item {
  display: block;
}
.post-toc .nav .active > a {
  border-bottom-color: #fc6423;
  color: #fc6423;
}
.post-toc .nav .active-current > a {
  color: #fc6423;
}
.post-toc .nav .active-current > a:hover {
  color: #fc6423;
}
.site-state {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  line-height: 1.4;
  margin-top: 10px;
}
.site-state-item a {
  border-bottom: none;
  display: block;
  padding: 0 15px;
}
.site-state-item-count {
  display: block;
  font-size: 1em;
  font-weight: 600;
}
.site-state-item-name {
  color: #999;
  font-size: 0.8125em;
}
.footer {
  color: #999;
  font-size: 0.875em;
  padding: 20px 0;
}
.footer.footer-fixed {
  bottom: 0;
  left: 0;
  position: absolute;
  right: 0;
}
.footer-inner {
  box-sizing: border-box;
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .footer-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .footer-inner {
    width: 73%;
  }
}
.use-motion .footer {
  opacity: 0;
}
.languages {
  display: inline-block;
  font-size: 1.125em;
  position: relative;
}
.languages .lang-select-label span {
  margin: 0 0.5em;
}
.languages .lang-select {
  height: 100%;
  left: 0;
  opacity: 0;
  position: absolute;
  top: 0;
  width: 100%;
}
.with-love {
  color: #CCCCCC;
  display: inline-block;
  margin: 0 5px;
  animation: icon-animate 1.33s ease-in-out infinite;
}
@-moz-keyframes icon-animate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@-webkit-keyframes icon-animate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@-o-keyframes icon-animate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@keyframes icon-animate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
.back-to-top {
  font-size: 12px;
}
.back-to-top span {
  display: none;
}
.back-to-top {
  bottom: -100px;
  box-sizing: border-box;
  color: #fff;
  padding: 0 6px;
  transition: bottom 0.2s ease-in-out;
  background: #222;
  cursor: pointer;
  opacity: 0.6;
  position: fixed;
  z-index: 1300;
  right: 30px;
  width: 24px;
}
@media (max-width: 991px) {
  .back-to-top {
    right: 20px;
  }
}
.back-to-top:hover {
  opacity: 0.8;
}
@media (max-width: 991px) {
  .back-to-top {
    opacity: 0.8;
  }
}
.back-to-top:hover {
  color: #fc6423;
}
.back-to-top.back-to-top-on {
  bottom: 30px;
}
.noscript-warning {
  background-color: #f55;
  color: #fff;
  font-family: sans-serif;
  font-size: 1rem;
  font-weight: bold;
  left: 0;
  position: fixed;
  text-align: center;
  top: 0;
  width: 100%;
  z-index: 1500;
}
.rtl.post-body p,
.rtl.post-body a,
.rtl.post-body h1,
.rtl.post-body h2,
.rtl.post-body h3,
.rtl.post-body h4,
.rtl.post-body h5,
.rtl.post-body h6,
.rtl.post-body li,
.rtl.post-body ul,
.rtl.post-body ol {
  direction: rtl;
  font-family: UKIJ Ekran;
}
.rtl.post-title {
  font-family: UKIJ Ekran;
}
.post-button {
  margin-top: 40px;
  text-align: center;
}
.use-motion .post-block,
.use-motion .pagination,
.use-motion .comments {
  visibility: hidden;
}
.use-motion .post-header {
  visibility: hidden;
}
.use-motion .post-body {
  visibility: hidden;
}
.use-motion .collection-header {
  visibility: hidden;
}
.posts-collapse .post-content {
  margin-bottom: 35px;
  margin-left: 35px;
  position: relative;
}
@media (max-width: 767px) {
  .posts-collapse .post-content {
    margin-left: 0;
    margin-right: 0;
  }
}
.posts-collapse .post-content .collection-title {
  font-size: 1.125em;
  position: relative;
}
.posts-collapse .post-content .collection-title::before {
  background: #999;
  border: 1px solid #fff;
  margin-left: -6px;
  margin-top: -4px;
  position: absolute;
  top: 50%;
  border-radius: 50%;
  content: ' ';
  height: 10px;
  width: 10px;
}
.posts-collapse .post-content .collection-year {
  font-size: 1.5em;
  font-weight: bold;
  margin: 60px 0;
  position: relative;
}
.posts-collapse .post-content .collection-year::before {
  background: #bbb;
  margin-left: -4px;
  margin-top: -4px;
  position: absolute;
  top: 50%;
  border-radius: 50%;
  content: ' ';
  height: 8px;
  width: 8px;
}
.posts-collapse .post-content .collection-header {
  display: block;
  margin-left: 20px;
}
.posts-collapse .post-content .collection-header small {
  color: #bbb;
  margin-left: 5px;
}
.posts-collapse .post-content .post-header {
  border-bottom: 1px dashed #ccc;
  margin: 30px 2px 0;
  padding-left: 15px;
  position: relative;
  transition: border 0.2s ease-in-out;
}
.posts-collapse .post-content .post-header::before {
  background: #bbb;
  border: 1px solid #fff;
  left: -6px;
  position: absolute;
  top: 0.75em;
  transition: background 0.2s ease-in-out;
  border-radius: 50%;
  content: ' ';
  height: 6px;
  width: 6px;
}
.posts-collapse .post-content .post-header:hover {
  border-bottom-color: #666;
}
.posts-collapse .post-content .post-header:hover::before {
  background: #222;
}
.posts-collapse .post-content .post-meta-container {
  display: inline;
  font-size: 0.75em;
  margin-right: 10px;
}
.posts-collapse .post-content .post-title {
  display: inline;
}
.posts-collapse .post-content .post-title a,
.posts-collapse .post-content .post-title span.exturl {
  border-bottom: none;
  color: var(--link-color);
}
.posts-collapse .post-content .post-title .fa-external-link-alt {
  font-size: 0.875em;
  margin-left: 5px;
}
.posts-collapse .post-content::before {
  background: #f5f5f5;
  content: ' ';
  height: 100%;
  margin-left: -2px;
  position: absolute;
  top: 1.25em;
  width: 4px;
}
.post-body {
  font-family: Lato, "PingFang SC", "Microsoft YaHei", sans-serif;
  overflow-wrap: break-word;
}
@media (min-width: 1200px) {
  .post-body {
    font-size: 1.125em;
  }
}
@media (min-width: 992px) {
  .post-body {
    text-align: justify;
  }
}
@media (max-width: 991px) {
  .post-body {
    text-align: justify;
  }
}
.post-body h1,
.post-body h2,
.post-body h3,
.post-body h4,
.post-body h5,
.post-body h6 {
  padding-top: 10px;
}
.post-body h1 .header-anchor,
.post-body h2 .header-anchor,
.post-body h3 .header-anchor,
.post-body h4 .header-anchor,
.post-body h5 .header-anchor,
.post-body h6 .header-anchor,
.post-body h1 .headerlink,
.post-body h2 .headerlink,
.post-body h3 .headerlink,
.post-body h4 .headerlink,
.post-body h5 .headerlink,
.post-body h6 .headerlink {
  border-bottom-style: none;
  color: inherit;
  float: right;
  font-size: 0.875em;
  margin-left: 10px;
  opacity: 0;
}
.post-body h1 .header-anchor::before,
.post-body h2 .header-anchor::before,
.post-body h3 .header-anchor::before,
.post-body h4 .header-anchor::before,
.post-body h5 .header-anchor::before,
.post-body h6 .header-anchor::before,
.post-body h1 .headerlink::before,
.post-body h2 .headerlink::before,
.post-body h3 .headerlink::before,
.post-body h4 .headerlink::before,
.post-body h5 .headerlink::before,
.post-body h6 .headerlink::before {
  content: '\f0c1';
  font-family: 'Font Awesome 5 Free';
  font-weight: 900;
}
.post-body h1:hover .header-anchor,
.post-body h2:hover .header-anchor,
.post-body h3:hover .header-anchor,
.post-body h4:hover .header-anchor,
.post-body h5:hover .header-anchor,
.post-body h6:hover .header-anchor,
.post-body h1:hover .headerlink,
.post-body h2:hover .headerlink,
.post-body h3:hover .headerlink,
.post-body h4:hover .headerlink,
.post-body h5:hover .headerlink,
.post-body h6:hover .headerlink {
  opacity: 0.5;
}
.post-body h1:hover .header-anchor:hover,
.post-body h2:hover .header-anchor:hover,
.post-body h3:hover .header-anchor:hover,
.post-body h4:hover .header-anchor:hover,
.post-body h5:hover .header-anchor:hover,
.post-body h6:hover .header-anchor:hover,
.post-body h1:hover .headerlink:hover,
.post-body h2:hover .headerlink:hover,
.post-body h3:hover .headerlink:hover,
.post-body h4:hover .headerlink:hover,
.post-body h5:hover .headerlink:hover,
.post-body h6:hover .headerlink:hover {
  opacity: 1;
}
.post-body .exturl .fa {
  font-size: 0.875em;
  margin-left: 4px;
}
.post-body .image-caption,
.post-body .figure .caption {
  color: #999;
  font-size: 0.875em;
  font-weight: bold;
  line-height: 1;
  margin: -20px auto 15px;
  text-align: center;
}
.post-body iframe,
.post-body img,
.post-body video,
.post-body embed {
  margin-bottom: 20px;
}
.post-body .video-container {
  height: 0;
  margin-bottom: 20px;
  overflow: hidden;
  padding-top: 75%;
  position: relative;
  width: 100%;
}
.post-body .video-container iframe,
.post-body .video-container object,
.post-body .video-container embed {
  height: 100%;
  left: 0;
  margin: 0;
  position: absolute;
  top: 0;
  width: 100%;
}
.post-gallery {
  display: flex;
  min-height: 200px;
}
.post-gallery .post-gallery-image {
  flex: 1;
}
.post-gallery .post-gallery-image:not(:first-child) {
  clip-path: polygon(40px 0, 100% 0, 100% 100%, 0 100%);
  margin-left: -20px;
}
.post-gallery .post-gallery-image:not(:last-child) {
  margin-right: -20px;
}
.post-gallery .post-gallery-image img {
  height: 100%;
  object-fit: cover;
  opacity: 1;
  width: 100%;
}
.posts-expand .post-gallery {
  margin-bottom: 60px;
}
.posts-collapse .post-gallery {
  margin: 15px 0;
}
.posts-expand .post-header {
  font-size: 1.125em;
  margin-bottom: 60px;
  text-align: center;
}
.posts-expand .post-title {
  font-size: 1.5em;
  font-weight: normal;
  margin: initial;
  overflow-wrap: break-word;
}
.posts-expand .post-title-link {
  border-bottom: none;
  color: var(--link-color);
  display: inline-block;
  position: relative;
}
.posts-expand .post-title-link::before {
  background: var(--link-color);
  bottom: 0;
  content: '';
  height: 2px;
  left: 0;
  position: absolute;
  transform: scaleX(0);
  transition: transform 0.2s ease-in-out;
  width: 100%;
}
.posts-expand .post-title-link:hover::before {
  transform: scaleX(1);
}
.posts-expand .post-title-link .fa-external-link-alt {
  font-size: 0.875em;
  margin-left: 5px;
}
.post-sticky-flag {
  display: inline-block;
  transform: rotate(30deg);
}
.posts-expand .post-meta-container {
  color: #999;
  font-family: Lato, "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 0.75em;
  margin-top: 3px;
}
.posts-expand .post-meta-container .post-description {
  font-size: 0.875em;
  margin-top: 2px;
}
.posts-expand .post-meta-container time {
  border-bottom: 1px dashed #999;
  cursor: pointer;
}
.post-meta {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}
.post-meta-item:not(:first-child)::before {
  content: '|';
  margin: 0 0.5em;
}
.post-meta-item-icon {
  margin-right: 3px;
}
@media (max-width: 991px) {
  .post-meta-item-text {
    display: none;
  }
}
.post-nav {
  border-top: 1px solid #eee;
  display: flex;
  gap: 30px;
  justify-content: space-between;
  margin-top: 1em;
  padding: 10px 5px 0;
}
.post-nav-item {
  flex: 1;
}
.post-nav-item a {
  border-bottom: none;
  display: block;
  font-size: 0.875em;
  line-height: 1.6;
}
.post-nav-item a:active {
  top: 2px;
}
.post-nav-item .fa {
  font-size: 0.75em;
}
.post-nav-item:first-child .fa {
  margin-right: 5px;
}
.post-nav-item:last-child {
  text-align: right;
}
.post-nav-item:last-child .fa {
  margin-left: 5px;
}
.post-footer {
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.post-eof {
  background: #ccc;
  height: 1px;
  margin: 80px auto 60px;
  width: 8%;
}
.post-block:last-of-type .post-eof {
  display: none;
}
.post-tags {
  margin-top: 40px;
  text-align: center;
}
.post-tags a {
  display: inline-block;
  font-size: 0.8125em;
}
.post-tags a:not(:last-child) {
  margin-right: 10px;
}
.post-widgets {
  border-top: 1px solid #eee;
  margin-top: 15px;
  text-align: center;
}
.wp_rating {
  height: 20px;
  line-height: 20px;
  margin-top: 10px;
  padding-top: 6px;
  text-align: center;
}
.social-like {
  display: flex;
  font-size: 0.875em;
  justify-content: center;
  text-align: center;
}
.reward-container {
  margin: 1em 0 0;
  padding: 1em 0;
  text-align: center;
}
.reward-container button {
  background: transparent;
  border: 2px solid #fc6423;
  border-radius: 2px;
  color: #fc6423;
  cursor: pointer;
  line-height: 2;
  outline: 0;
  padding: 0 15px;
  transition: all 0.2s ease-in-out;
  vertical-align: text-top;
}
.reward-container button:hover {
  background: #fc6423;
  border: 2px solid transparent;
  color: #fff;
}
.post-reward {
  display: none;
  padding-top: 20px;
}
.post-reward.active {
  display: block;
}
.post-reward div {
  display: inline-block;
}
.post-reward div span {
  display: block;
}
.post-reward div:hover span {
  animation: next-roll 0.1s infinite linear;
  pointer-events: none;
}
.post-reward img {
  display: inline-block;
  margin: 0.8em 2em 0 2em;
  max-width: 100%;
  width: 180px;
}
@-moz-keyframes next-roll {
  from {
    transform: rotateZ(30deg);
  }
  to {
    transform: rotateZ(-30deg);
  }
}
@-webkit-keyframes next-roll {
  from {
    transform: rotateZ(30deg);
  }
  to {
    transform: rotateZ(-30deg);
  }
}
@-o-keyframes next-roll {
  from {
    transform: rotateZ(30deg);
  }
  to {
    transform: rotateZ(-30deg);
  }
}
@keyframes next-roll {
  from {
    transform: rotateZ(30deg);
  }
  to {
    transform: rotateZ(-30deg);
  }
}
.category-all-page .category-all-title {
  text-align: center;
}
.category-all-page .category-all {
  margin-top: 20px;
}
.category-all-page .category-list {
  list-style: none;
  margin: 0;
  padding: 0;
}
.category-all-page .category-list-item {
  margin: 5px 10px;
}
.category-all-page .category-list-count {
  color: #bbb;
}
.category-all-page .category-list-count::before {
  content: ' (';
}
.category-all-page .category-list-count::after {
  content: ') ';
}
.category-all-page .category-list-child {
  padding-left: 10px;
}
.event-list hr {
  background: #222;
  margin: 20px 0 45px 0;
}
.event-list hr::after {
  background: #222;
  color: #fff;
  content: 'NOW';
  display: inline-block;
  font-weight: bold;
  padding: 0 5px;
}
.event-list .event {
  --event-background: #222;
  --event-foreground: #bbb;
  --event-title: #fff;
  background: var(--event-background);
  padding: 15px;
}
.event-list .event .event-summary {
  border-bottom: 0;
  color: var(--event-title);
  margin: 0;
  padding: 0 0 0 35px;
  position: relative;
}
.event-list .event .event-summary::before {
  animation: dot-flash 1s alternate infinite ease-in-out;
  background: var(--event-title);
  left: 0;
  margin-top: -6px;
  position: absolute;
  top: 50%;
  border-radius: 50%;
  content: ' ';
  height: 12px;
  width: 12px;
}
.event-list .event:nth-of-type(odd) .event-summary::before {
  animation-delay: 0.5s;
}
.event-list .event:not(:last-child) {
  margin-bottom: 20px;
}
.event-list .event .event-relative-time {
  color: var(--event-foreground);
  display: inline-block;
  font-size: 12px;
  font-weight: normal;
  padding-left: 12px;
}
.event-list .event .event-details {
  color: var(--event-foreground);
  display: block;
  line-height: 18px;
  padding: 6px 0 6px 35px;
}
.event-list .event .event-details::before {
  color: var(--event-foreground);
  display: inline-block;
  margin-right: 9px;
  width: 14px;
  font-family: 'Font Awesome 5 Free';
  font-weight: 900;
}
.event-list .event .event-details.event-location::before {
  content: '\f041';
}
.event-list .event .event-details.event-duration::before {
  content: '\f017';
}
.event-list .event .event-details.event-description::before {
  content: '\f024';
}
.event-list .event-past {
  --event-background: #f5f5f5;
  --event-foreground: #999;
  --event-title: #222;
}
@-moz-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
@-webkit-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
@-o-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
@keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
ul.breadcrumb {
  font-size: 0.75em;
  list-style: none;
  margin: 1em 0;
  padding: 0 2em;
  text-align: center;
}
ul.breadcrumb li {
  display: inline;
}
ul.breadcrumb li:not(:first-child)::before {
  content: '/\00a0';
  font-weight: normal;
  padding: 0.5em;
}
ul.breadcrumb li:last-child {
  font-weight: bold;
}
.tag-cloud {
  text-align: center;
}
.tag-cloud a {
  display: inline-block;
  margin: 10px;
}
.tag-cloud-0 {
  border-bottom-color: #aaa;
  color: #aaa;
}
.tag-cloud-1 {
  border-bottom-color: #9a9a9a;
  color: #9a9a9a;
}
.tag-cloud-2 {
  border-bottom-color: #8b8b8b;
  color: #8b8b8b;
}
.tag-cloud-3 {
  border-bottom-color: #7c7c7c;
  color: #7c7c7c;
}
.tag-cloud-4 {
  border-bottom-color: #6c6c6c;
  color: #6c6c6c;
}
.tag-cloud-5 {
  border-bottom-color: #5d5d5d;
  color: #5d5d5d;
}
.tag-cloud-6 {
  border-bottom-color: #4e4e4e;
  color: #4e4e4e;
}
.tag-cloud-7 {
  border-bottom-color: #3e3e3e;
  color: #3e3e3e;
}
.tag-cloud-8 {
  border-bottom-color: #2f2f2f;
  color: #2f2f2f;
}
.tag-cloud-9 {
  border-bottom-color: #202020;
  color: #202020;
}
.tag-cloud-10 {
  border-bottom-color: #111;
  color: #111;
}
@media (prefers-color-scheme: dark) {
  .tag-cloud-0 {
    border-bottom-color: #555;
    color: #555;
  }
  .tag-cloud-1 {
    border-bottom-color: #646464;
    color: #646464;
  }
  .tag-cloud-2 {
    border-bottom-color: #737373;
    color: #737373;
  }
  .tag-cloud-3 {
    border-bottom-color: #828282;
    color: #828282;
  }
  .tag-cloud-4 {
    border-bottom-color: #929292;
    color: #929292;
  }
  .tag-cloud-5 {
    border-bottom-color: #a1a1a1;
    color: #a1a1a1;
  }
  .tag-cloud-6 {
    border-bottom-color: #b0b0b0;
    color: #b0b0b0;
  }
  .tag-cloud-7 {
    border-bottom-color: #c0c0c0;
    color: #c0c0c0;
  }
  .tag-cloud-8 {
    border-bottom-color: #cfcfcf;
    color: #cfcfcf;
  }
  .tag-cloud-9 {
    border-bottom-color: #dedede;
    color: #dedede;
  }
  .tag-cloud-10 {
    border-bottom-color: #eee;
    color: #eee;
  }
}
.search-active {
  overflow: hidden;
}
.search-pop-overlay {
  background: rgba(0,0,0,0);
  display: flex;
  height: 100%;
  left: 0;
  position: fixed;
  top: 0;
  transition: visibility 0.4s, background 0.4s;
  visibility: hidden;
  width: 100%;
  z-index: 1400;
}
.search-active .search-pop-overlay {
  background: rgba(0,0,0,0.3);
  visibility: visible;
}
.search-popup {
  background: var(--card-bg-color);
  border-radius: 5px;
  height: 80%;
  margin: auto;
  transform: scale(0);
  transition: transform 0.4s;
  width: 700px;
}
.search-active .search-popup {
  transform: scale(1);
}
@media (max-width: 767px) {
  .search-popup {
    border-radius: 0;
    height: 100%;
    width: 100%;
  }
}
.search-popup .search-icon,
.search-popup .popup-btn-close {
  color: #999;
  font-size: 18px;
  padding: 0 10px;
}
.search-popup .popup-btn-close {
  cursor: pointer;
}
.search-popup .popup-btn-close:hover .fa {
  color: #222;
}
.search-popup .search-header {
  background: #eee;
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
  display: flex;
  padding: 5px;
}
.search-popup input.search-input {
  background: transparent;
  border: 0;
  outline: 0;
  width: 100%;
}
.search-popup input.search-input::-webkit-search-cancel-button {
  display: none;
}
.search-popup .search-result-container {
  height: calc(100% - 55px);
  overflow: auto;
  padding: 5px 25px;
}
.search-popup .search-result-container hr {
  margin: 5px 0 10px;
}
.search-popup .search-result-container hr:first-child {
  display: none;
}
.search-popup .search-result-list {
  margin: 0 5px;
  padding: 0;
}
.search-popup a.search-result-title {
  font-weight: bold;
}
.search-popup p.search-result {
  border-bottom: 1px dashed #ccc;
  padding: 5px 0;
}
.search-popup .search-input-container {
  flex-grow: 1;
  padding: 2px;
}
.search-popup .no-result {
  display: flex;
}
.search-popup .search-result-list {
  width: 100%;
}
.search-popup .search-result-icon {
  color: #ccc;
  margin: auto;
}
mark.search-keyword {
  background: transparent;
  border-bottom: 1px dashed #ff2a2a;
  color: #ff2a2a;
  font-weight: bold;
}
.popular-posts-header {
  border-bottom: 1px solid #eee;
  font-size: 1.125em;
  margin-bottom: 10px;
  margin-top: 60px;
}
.popular-posts {
  padding: 0;
}
.popular-posts .popular-posts-item {
  margin-left: 2em;
}
.popular-posts .popular-posts-item .popular-posts-title {
  font-size: 0.875em;
  font-weight: normal;
  line-height: 2.4;
  margin: 0;
}
mjx-container[jax="CHTML"][display="true"],
.has-jax {
  overflow: auto hidden;
}
mjx-container[display="true"] + br {
  display: none;
}
.use-motion .animated {
  animation-fill-mode: none;
  visibility: inherit;
}
.use-motion .sidebar .animated {
  animation-fill-mode: both;
}
.header-inner {
  background: var(--content-bg-color);
  border-radius: initial;
  box-shadow: initial;
  width: 240px;
}
@media (max-width: 991px) {
  .header-inner {
    border-radius: initial;
    width: auto;
  }
}
.main {
  align-items: stretch;
  display: flex;
  justify-content: space-between;
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .main {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .main {
    width: 73%;
  }
}
@media (max-width: 991px) {
  .main {
    display: block;
    width: auto;
  }
}
.main-inner {
  border-radius: initial;
  box-sizing: border-box;
  width: calc(100% - 252px);
}
@media (max-width: 991px) {
  .main-inner {
    border-radius: initial;
    width: 100%;
  }
}
.footer-inner {
  padding-left: 252px;
}
@media (max-width: 991px) {
  .footer-inner {
    padding-left: 0;
    padding-right: 0;
    width: auto;
  }
}
.site-brand-container {
  background: #222;
}
@media (max-width: 991px) {
  .site-nav-on .site-brand-container {
    box-shadow: 0 0 16px rgba(0,0,0,0.5);
  }
}
.site-meta {
  padding: 20px 0;
}
.brand {
  padding: 0;
}
.site-subtitle {
  margin: 10px 10px 0;
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav-toggle,
  .site-nav-right {
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
}
.site-nav-toggle .toggle,
.site-nav-right .toggle {
  color: #fff;
}
.site-nav-toggle .toggle .toggle-line,
.site-nav-right .toggle .toggle-line {
  background: #fff;
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav {
    display: none;
  }
}
.menu .menu-item {
  display: block;
  margin: 0;
}
.menu .menu-item a,
.menu .menu-item span.exturl {
  padding: 5px 20px;
  position: relative;
  text-align: left;
  transition-property: background-color;
}
@media (max-width: 991px) {
  .menu .menu-item.menu-item-search {
    display: none;
  }
}
.menu .menu-item .badge {
  background: #ccc;
  border-radius: 10px;
  color: var(--content-bg-color);
  float: right;
  padding: 2px 5px;
  text-shadow: 1px 1px 0 rgba(0,0,0,0.1);
}
.main-menu .menu-item-active::after {
  background: #bbb;
  border-radius: 50%;
  content: ' ';
  height: 6px;
  margin-top: -3px;
  position: absolute;
  right: 15px;
  top: 50%;
  width: 6px;
}
.sub-menu {
  margin: 0;
  padding: 6px 0;
}
.sub-menu .menu-item {
  display: inline-block;
}
.sub-menu .menu-item a,
.sub-menu .menu-item span.exturl {
  background: transparent;
  margin: 5px 10px;
  padding: initial;
}
.sub-menu .menu-item a:hover,
.sub-menu .menu-item span.exturl:hover {
  background: transparent;
  color: #fc6423;
}
.sub-menu .menu-item-active {
  border-bottom-color: #fc6423;
  color: #fc6423;
}
.sub-menu .menu-item-active:hover {
  border-bottom-color: #fc6423;
}
.sidebar {
  margin-top: 12px;
  position: -webkit-sticky;
  position: sticky;
  top: 12px;
  width: 240px;
}
@media (max-width: 991px) {
  .sidebar {
    display: none;
  }
}
.sidebar-toggle {
  display: none;
}
.sidebar-inner {
  background: var(--content-bg-color);
  border-radius: initial;
  box-shadow: initial;
  box-sizing: border-box;
  color: var(--text-color);
}
.site-state-item a {
  padding: 0 10px;
}
.sidebar-button {
  border-bottom: 1px dotted #ccc;
  border-top: 1px dotted #ccc;
  margin-top: 10px;
}
.sidebar-button a {
  border: 0;
  color: #fc6423;
  display: block;
}
.sidebar-button a:hover {
  background: none;
  border: 0;
  color: #e34603;
}
.sidebar-button a:hover .fa,
.sidebar-button a:hover .fab,
.sidebar-button a:hover .far,
.sidebar-button a:hover .fas {
  color: #e34603;
}
.links-of-author {
  margin-top: 10px;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}
.links-of-author-item {
  margin: 5px 0 0;
}
.links-of-author-item a,
.links-of-author-item span.exturl {
  box-sizing: border-box;
  display: inline-block;
  max-width: 100%;
  overflow: hidden;
  padding: 0 5px;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.links-of-author-item a,
.links-of-author-item span.exturl {
  border-bottom: none;
  border-radius: 4px;
  display: block;
}
.links-of-author-item a:hover,
.links-of-author-item span.exturl:hover {
  background: var(--body-bg-color);
}
.main-inner {
  background: var(--content-bg-color);
  box-shadow: initial;
  padding: 40px;
}
@media (max-width: 991px) {
  .main-inner {
    padding: 20px;
  }
}
.sub-menu {
  border-bottom: 1px solid #ddd;
}
.post-block:first-of-type {
  padding-top: 40px;
}
@media (max-width: 767px) {
  .pagination {
    margin-bottom: 10px;
  }
}
</style><noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="LeiHao's Blog" type="application/atom+xml">
<script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}</script><noscript><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"></noscript></head>

<body itemscope="" itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">LeiHao's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-rss">

    <a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">ä»‹ç»</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%AC%E6%96%87%E4%BB%B6%E7%9A%84%E7%BB%84%E7%BB%87"><span class="nav-number">1.0.1.</span> <span class="nav-text">æœ¬æ–‡ä»¶çš„ç»„ç»‡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%9C%8B%E7%9C%8B"><span class="nav-number">1.0.2.</span> <span class="nav-text">ä¹Ÿå¯ä»¥çœ‹çœ‹</span></a></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E7%AE%A1%E7%90%86"><span class="nav-number">2.</span> <span class="nav-text">çº¿ç¨‹ç®¡ç†</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E6%88%90%E6%9C%AC"><span class="nav-number">2.0.1.</span> <span class="nav-text">çº¿ç¨‹æˆæœ¬</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B"><span class="nav-number">2.0.2.</span> <span class="nav-text">åˆ›å»ºä¸€ä¸ªçº¿ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-NSThread"><span class="nav-number">2.0.2.0.1.</span> <span class="nav-text">ä½¿ç”¨ NSThread</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-POSIX-%E7%BA%BF%E7%A8%8B"><span class="nav-number">2.0.2.0.2.</span> <span class="nav-text">ä½¿ç”¨ POSIX çº¿ç¨‹</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-NSObject-%E7%94%9F%E6%88%90%E7%BA%BF%E7%A8%8B"><span class="nav-number">2.0.2.0.3.</span> <span class="nav-text">ä½¿ç”¨ NSObject ç”Ÿæˆçº¿ç¨‹</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%9C%A8-Cocoa-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%B8%AD%E4%BD%BF%E7%94%A8-POSIX-%E7%BA%BF%E7%A8%8B"><span class="nav-number">2.0.2.0.4.</span> <span class="nav-text">åœ¨ Cocoa åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ POSIX çº¿ç¨‹</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%BA%BF%E7%A8%8B%E5%B1%9E%E6%80%A7"><span class="nav-number">2.0.3.</span> <span class="nav-text">é…ç½®çº¿ç¨‹å±žæ€§</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%A0%86%E6%A0%88%E5%A4%A7%E5%B0%8F"><span class="nav-number">2.0.3.0.1.</span> <span class="nav-text">é…ç½®çº¿ç¨‹çš„å †æ ˆå¤§å°</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%BA%BF%E7%A8%8B%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8"><span class="nav-number">2.0.3.0.2.</span> <span class="nav-text">é…ç½®çº¿ç¨‹æœ¬åœ°å­˜å‚¨</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%88%86%E7%A6%BB%E7%8A%B6%E6%80%81"><span class="nav-number">2.0.3.0.3.</span> <span class="nav-text">è®¾ç½®çº¿ç¨‹çš„åˆ†ç¦»çŠ¶æ€</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E7%BA%BF%E7%A8%8B%E4%BC%98%E5%85%88%E7%BA%A7"><span class="nav-number">2.0.3.0.4.</span> <span class="nav-text">è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E7%BA%BF%E7%A8%8B%E8%BE%93%E5%85%A5%E4%BE%8B%E7%A8%8B"><span class="nav-number">2.0.4.</span> <span class="nav-text">ç¼–å†™çº¿ç¨‹è¾“å…¥ä¾‹ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%87%AA%E5%8A%A8%E9%87%8A%E6%94%BE%E6%B1%A0"><span class="nav-number">2.0.4.0.1.</span> <span class="nav-text">åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± </span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F"><span class="nav-number">2.0.4.0.2.</span> <span class="nav-text">è®¾ç½®å¼‚å¸¸å¤„ç†ç¨‹åº</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E8%BF%90%E8%A1%8C%E5%BE%AA%E7%8E%AF"><span class="nav-number">2.0.4.0.3.</span> <span class="nav-text">è®¾ç½®è¿è¡Œå¾ªçŽ¯</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%88%E6%AD%A2%E7%BA%BF%E7%A8%8B"><span class="nav-number">2.0.5.</span> <span class="nav-text">ç»ˆæ­¢çº¿ç¨‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E5%BE%AA%E7%8E%AF"><span class="nav-number">3.</span> <span class="nav-text">è¿è¡Œå¾ªçŽ¯</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E5%BE%AA%E7%8E%AF%E7%9A%84%E8%A7%A3%E5%89%96"><span class="nav-number">3.0.1.</span> <span class="nav-text">è¿è¡Œå¾ªçŽ¯çš„è§£å‰–</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E5%BE%AA%E7%8E%AF%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.0.1.0.1.</span> <span class="nav-text">è¿è¡Œå¾ªçŽ¯æ¨¡å¼</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%BE%93%E5%85%A5%E6%BA%90"><span class="nav-number">3.0.1.0.2.</span> <span class="nav-text">è¾“å…¥æº</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%AE%A1%E6%97%B6%E5%99%A8%E6%9D%A5%E6%BA%90"><span class="nav-number">3.0.1.0.3.</span> <span class="nav-text">è®¡æ—¶å™¨æ¥æº</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E5%BE%AA%E7%8E%AF%E8%A7%82%E5%AF%9F%E8%80%85"><span class="nav-number">3.0.1.0.4.</span> <span class="nav-text">è¿è¡Œå¾ªçŽ¯è§‚å¯Ÿè€…</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E7%9A%84%E8%BF%90%E8%A1%8C%E5%BE%AA%E7%8E%AF%E5%BA%8F%E5%88%97"><span class="nav-number">3.0.1.0.5.</span> <span class="nav-text">äº‹ä»¶çš„è¿è¡Œå¾ªçŽ¯åºåˆ—</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E4%BD%BF%E7%94%A8%E8%BF%90%E8%A1%8C%E5%BE%AA%E7%8E%AF%EF%BC%9F"><span class="nav-number">3.0.2.</span> <span class="nav-text">ä»€ä¹ˆæ—¶å€™ä½¿ç”¨è¿è¡Œå¾ªçŽ¯ï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%BF%90%E8%A1%8C%E5%BE%AA%E7%8E%AF%E5%AF%B9%E8%B1%A1"><span class="nav-number">3.0.3.</span> <span class="nav-text">ä½¿ç”¨è¿è¡Œå¾ªçŽ¯å¯¹è±¡</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E8%BF%90%E8%A1%8C%E5%BE%AA%E7%8E%AF%E5%AF%B9%E8%B1%A1"><span class="nav-number">3.0.3.0.1.</span> <span class="nav-text">èŽ·å–è¿è¡Œå¾ªçŽ¯å¯¹è±¡</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E8%BF%90%E8%A1%8C%E5%BE%AA%E7%8E%AF"><span class="nav-number">3.0.3.0.2.</span> <span class="nav-text">é…ç½®è¿è¡Œå¾ªçŽ¯</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E8%BF%90%E8%A1%8C%E5%BE%AA%E7%8E%AF"><span class="nav-number">3.0.3.0.3.</span> <span class="nav-text">å¯åŠ¨è¿è¡Œå¾ªçŽ¯</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%80%80%E5%87%BA%E8%BF%90%E8%A1%8C%E5%BE%AA%E7%8E%AF"><span class="nav-number">3.0.3.0.4.</span> <span class="nav-text">é€€å‡ºè¿è¡Œå¾ªçŽ¯</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E5%92%8C%E8%BF%90%E8%A1%8C%E5%BE%AA%E7%8E%AF%E5%AF%B9%E8%B1%A1"><span class="nav-number">3.0.3.0.5.</span> <span class="nav-text">çº¿ç¨‹å®‰å…¨å’Œè¿è¡Œå¾ªçŽ¯å¯¹è±¡</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E8%BF%90%E8%A1%8C%E5%BE%AA%E7%8E%AF%E6%BA%90"><span class="nav-number">3.0.4.</span> <span class="nav-text">é…ç½®è¿è¡Œå¾ªçŽ¯æº</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BE%93%E5%85%A5%E6%BA%90"><span class="nav-number">3.0.4.0.1.</span> <span class="nav-text">å®šä¹‰è‡ªå®šä¹‰è¾“å…¥æº</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E8%AE%A1%E6%97%B6%E5%99%A8%E6%BA%90"><span class="nav-number">3.0.4.0.2.</span> <span class="nav-text">é…ç½®è®¡æ—¶å™¨æº</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%9F%BA%E4%BA%8E%E7%AB%AF%E5%8F%A3%E7%9A%84%E8%BE%93%E5%85%A5%E6%BA%90"><span class="nav-number">3.0.4.0.3.</span> <span class="nav-text">é…ç½®åŸºäºŽç«¯å£çš„è¾“å…¥æº</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5%E5%8C%96"><span class="nav-number">4.</span> <span class="nav-text">åŒæ­¥åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7"><span class="nav-number">4.0.1.</span> <span class="nav-text">åŒæ­¥å·¥å…·</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C"><span class="nav-number">4.0.1.0.1.</span> <span class="nav-text">åŽŸå­æ“ä½œ</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E5%A3%81%E5%9E%92%E5%92%8C%E6%98%93%E5%A4%B1%E6%80%A7%E5%8F%98%E9%87%8F"><span class="nav-number">4.0.1.0.2.</span> <span class="nav-text">å†…å­˜å£åž’å’Œæ˜“å¤±æ€§å˜é‡</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%94%81%E5%85%B7"><span class="nav-number">4.0.1.0.3.</span> <span class="nav-text">é”å…·</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6"><span class="nav-number">4.0.1.0.4.</span> <span class="nav-text">æ¡ä»¶</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E9%80%89%E6%8B%A9%E5%99%A8%E4%BE%8B%E7%A8%8B"><span class="nav-number">4.0.1.0.5.</span> <span class="nav-text">æ‰§è¡Œé€‰æ‹©å™¨ä¾‹ç¨‹</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5%E6%88%90%E6%9C%AC%E5%92%8C%E6%80%A7%E8%83%BD"><span class="nav-number">4.0.2.</span> <span class="nav-text">åŒæ­¥æˆæœ¬å’Œæ€§èƒ½</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E5%92%8C%E4%BF%A1%E5%8F%B7"><span class="nav-number">4.0.3.</span> <span class="nav-text">çº¿ç¨‹å®‰å…¨å’Œä¿¡å·</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E8%AE%BE%E8%AE%A1%E7%9A%84%E6%8F%90%E7%A4%BA"><span class="nav-number">4.0.4.</span> <span class="nav-text">çº¿ç¨‹å®‰å…¨è®¾è®¡çš„æç¤º</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AE%8C%E5%85%A8%E9%81%BF%E5%85%8D%E5%90%8C%E6%AD%A5"><span class="nav-number">4.0.4.0.1.</span> <span class="nav-text">å®Œå…¨é¿å…åŒæ­¥</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BA%86%E8%A7%A3%E5%90%8C%E6%AD%A5%E7%9A%84%E5%B1%80%E9%99%90%E6%80%A7"><span class="nav-number">4.0.4.0.2.</span> <span class="nav-text">äº†è§£åŒæ­¥çš„å±€é™æ€§</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BB%A3%E7%A0%81%E6%AD%A3%E7%A1%AE%E6%80%A7%E7%9A%84%E5%A8%81%E8%83%81"><span class="nav-number">4.0.4.0.3.</span> <span class="nav-text">æ³¨æ„ä»£ç æ­£ç¡®æ€§çš„å¨èƒ</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%BD%93%E5%BF%83%E6%AD%BB%E9%94%81%E5%92%8C%E6%B4%BB%E9%94%81"><span class="nav-number">4.0.4.0.4.</span> <span class="nav-text">å½“å¿ƒæ­»é”å’Œæ´»é”</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8%E6%98%93%E5%A4%B1%E6%80%A7%E5%8F%98%E9%87%8F"><span class="nav-number">4.0.4.0.5.</span> <span class="nav-text">æ­£ç¡®ä½¿ç”¨æ˜“å¤±æ€§å˜é‡</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C"><span class="nav-number">4.0.5.</span> <span class="nav-text">ä½¿ç”¨åŽŸå­æ“ä½œ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E9%94%81"><span class="nav-number">4.0.6.</span> <span class="nav-text">ä½¿ç”¨é”</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-POSIX-%E4%BA%92%E6%96%A5%E9%94%81"><span class="nav-number">4.0.6.0.1.</span> <span class="nav-text">ä½¿ç”¨ POSIX äº’æ–¥é”</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-NSLock-%E7%B1%BB"><span class="nav-number">4.0.6.0.2.</span> <span class="nav-text">ä½¿ç”¨ NSLock ç±»</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-synchronized-%E6%8C%87%E4%BB%A4"><span class="nav-number">4.0.6.0.3.</span> <span class="nav-text">ä½¿ç”¨@synchronized æŒ‡ä»¤</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%85%B6%E4%BB%96%E5%8F%AF%E5%8F%AF%E9%94%81"><span class="nav-number">4.0.6.0.4.</span> <span class="nav-text">ä½¿ç”¨å…¶ä»–å¯å¯é”</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%9D%A1%E4%BB%B6"><span class="nav-number">4.0.7.</span> <span class="nav-text">ä½¿ç”¨æ¡ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-NSCondition-%E7%B1%BB"><span class="nav-number">4.0.7.0.1.</span> <span class="nav-text">ä½¿ç”¨ NSCondition ç±»</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-POSIX-%E6%9D%A1%E4%BB%B6"><span class="nav-number">4.0.7.0.2.</span> <span class="nav-text">ä½¿ç”¨ POSIX æ¡ä»¶</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E6%91%98%E8%A6%81"><span class="nav-number">5.</span> <span class="nav-text">çº¿ç¨‹å®‰å…¨æ‘˜è¦</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%AF%E5%8F%AF"><span class="nav-number">5.0.1.</span> <span class="nav-text">å¯å¯</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%A1%86%E6%9E%B6%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8"><span class="nav-number">5.0.1.0.1.</span> <span class="nav-text">åŸºç¡€æ¡†æž¶çº¿ç¨‹å®‰å…¨</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%A5%97%E4%BB%B6%E6%A1%86%E6%9E%B6%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8"><span class="nav-number">5.0.1.0.2.</span> <span class="nav-text">åº”ç”¨å¥—ä»¶æ¡†æž¶çº¿ç¨‹å®‰å…¨</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%95%B0%E6%8D%AE%E6%A1%86%E6%9E%B6"><span class="nav-number">5.0.1.0.3.</span> <span class="nav-text">æ ¸å¿ƒæ•°æ®æ¡†æž¶</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E5%9F%BA%E7%A1%80"><span class="nav-number">5.0.2.</span> <span class="nav-text">æ ¸å¿ƒåŸºç¡€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%8D%E6%B1%87%E8%A1%A8"><span class="nav-number">6.</span> <span class="nav-text">è¯æ±‡è¡¨</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E6%A1%A3%E4%BF%AE%E8%AE%A2%E5%8E%86%E5%8F%B2"><span class="nav-number">7.</span> <span class="nav-text">æ–‡æ¡£ä¿®è®¢åŽ†å²</span></a></li></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">LeiHao</p>
  <div class="site-description" itemprop="description">ðŸ˜ƒðŸ˜ƒðŸ˜ƒ</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">183</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">82</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/leihao0" title="GitHub â†’ https://github.com/leihao0" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/leihao0" title="Twitter â†’ https://twitter.com/leihao0" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.linkedin.com/in/leihao0" title="Linkedin â†’ https://www.linkedin.com/in/leihao0" rel="noopener" target="_blank"><i class="fab fa-linkedin-in fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

    
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leihao0.github.io/Threading-Programming-Guide/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LeiHao">
      <meta itemprop="description" content="ðŸ˜ƒðŸ˜ƒðŸ˜ƒ">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeiHao's Blog">
    </span>

    
    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Threading Programming Guide
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-27 14:19:00" itemprop="dateCreated datePublished" datetime="2020-05-27T14:19:00+08:00">2020-05-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-09-03 08:53:27" itemprop="dateModified" datetime="2020-09-03T08:53:27+08:00">2020-09-03</time>
      </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/Threading-Programming-Guide/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="Threading-Programming-Guide/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>56k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time â‰ˆ</span>
      <span>51 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/Introduction/Introduction.html#//apple_ref/doc/uid/10000057i-CH1-SW1">Threading Programming Guide</a></p>
<p>æœ€è¿‘æ€»æ˜¯è¢«é—®åˆ° Runloop<br>é‚£ä¹ˆä»€ä¹ˆæ˜¯ è¿è¡Œå¾ªçŽ¯ å‘¢<br>ç›´æŽ¥çœ‹ ï£¿ 2014-07-15 å°±åœæ­¢ä¿®è®¢çš„æ–‡æ¡£å§ ðŸ‘† ï½žï½žï½ž</p>
<p>å®˜æ–¹è§£è¯´ å¼‚å¸¸æ¸…æ™°å‘¢</p>
<a id="more"></a>

<p>ðŸ‘‡ æ˜¯ Google AI ç¿»è¯‘ (jifan)</p>
<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>çº¿ç¨‹æ˜¯ä½¿åœ¨å•ä¸ªåº”ç”¨ç¨‹åºä¸­åŒæ—¶æ‰§è¡Œå¤šä¸ªä»£ç è·¯å¾„æˆä¸ºå¯èƒ½çš„å‡ ç§æŠ€æœ¯ä¹‹ä¸€ã€‚å°½ç®¡è¯¸å¦‚æ“ä½œå¯¹è±¡å’Œ Grand Central Dispatchï¼ˆGCDï¼‰ä¹‹ç±»çš„è¾ƒæ–°æŠ€æœ¯ä¸ºå®žçŽ°å¹¶å‘æä¾›äº†æ›´çŽ°ä»£ï¼Œæ›´é«˜æ•ˆçš„åŸºç¡€æž¶æž„ï¼Œä½†æ˜¯ OS X å’Œ iOS è¿˜æä¾›äº†ç”¨äºŽåˆ›å»ºå’Œç®¡ç†çº¿ç¨‹çš„æŽ¥å£ã€‚</p>
<p>æœ¬æ–‡æ¡£ä»‹ç»äº† OS X ä¸­å¯ç”¨çš„çº¿ç¨‹åŒ…ï¼Œå¹¶å‘æ‚¨å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚æœ¬æ–‡æ¡£è¿˜æè¿°äº†ä¸ºæ”¯æŒåº”ç”¨ç¨‹åºå†…çš„çº¿ç¨‹åŒ–å’Œå¤šçº¿ç¨‹ä»£ç åŒæ­¥è€Œæä¾›çš„ç›¸å…³æŠ€æœ¯ã€‚</p>
<p><strong>é‡è¦è¯´æ˜Žï¼š</strong> å¦‚æžœè¦å¼€å‘æ–°çš„åº”ç”¨ç¨‹åºï¼Œå»ºè®®æ‚¨ç ”ç©¶ç”¨äºŽå®žçŽ°å¹¶å‘æ€§çš„æ›¿ä»£ OS X æŠ€æœ¯ã€‚å¦‚æžœæ‚¨è¿˜ä¸ç†Ÿæ‚‰å®žçŽ°çº¿ç¨‹åº”ç”¨ç¨‹åºæ‰€éœ€çš„è®¾è®¡æŠ€æœ¯ï¼Œåˆ™å°¤å…¶å¦‚æ­¤ã€‚è¿™äº›æ›¿ä»£æŠ€æœ¯å¯ç®€åŒ–å®žçŽ°å¹¶å‘æ‰§è¡Œè·¯å¾„çš„å·¥ä½œé‡ï¼Œå¹¶æä¾›æ¯”ä¼ ç»Ÿçº¿ç¨‹æ›´å¥½çš„æ€§èƒ½ã€‚æœ‰å…³è¿™äº›æŠ€æœ¯çš„ä¿¡æ¯ï¼Œè¯·å‚è§ã€Š_<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40008091">å¹¶å‘ç¼–ç¨‹æŒ‡å—ã€‹</a>_ã€‚</p>
<h4 id="æœ¬æ–‡ä»¶çš„ç»„ç»‡"><a href="#æœ¬æ–‡ä»¶çš„ç»„ç»‡" class="headerlink" title="æœ¬æ–‡ä»¶çš„ç»„ç»‡"></a>æœ¬æ–‡ä»¶çš„ç»„ç»‡</h4><p>æœ¬æ–‡æ¡£åŒ…å«ä»¥ä¸‹ç« èŠ‚å’Œé™„å½•ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/AboutThreads/AboutThreads.html#//apple_ref/doc/uid/10000057i-CH6-SW2">å…³äºŽçº¿ç¨‹ç¼–ç¨‹</a>ä»‹ç»äº†çº¿ç¨‹çš„æ¦‚å¿µåŠå…¶åœ¨åº”ç”¨ç¨‹åºè®¾è®¡ä¸­çš„ä½œç”¨ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/CreatingThreads/CreatingThreads.html#//apple_ref/doc/uid/10000057i-CH15-SW2">çº¿ç¨‹ç®¡ç†</a>æä¾›æœ‰å…³ OS X ä¸­çš„çº¿ç¨‹æŠ€æœ¯ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬çš„ä¿¡æ¯ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW1">è¿è¡Œå¾ªçŽ¯</a>æä¾›æœ‰å…³å¦‚ä½•åœ¨è¾…åŠ©çº¿ç¨‹ä¸­ç®¡ç†äº‹ä»¶å¤„ç†å¾ªçŽ¯çš„ä¿¡æ¯ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/ThreadSafety/ThreadSafety.html#//apple_ref/doc/uid/10000057i-CH8-SW1">åŒæ­¥</a>æè¿°äº†åŒæ­¥é—®é¢˜ä»¥åŠç”¨äºŽé˜²æ­¢å¤šä¸ªçº¿ç¨‹ç ´åæ•°æ®æˆ–ä½¿ç¨‹åºå´©æºƒçš„å·¥å…·ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/ThreadSafetySummary/ThreadSafetySummary.html#//apple_ref/doc/uid/10000057i-CH12-SW1">çº¿ç¨‹å®‰å…¨æ‘˜è¦</a>æä¾›äº† OS X å’Œ iOS åŠå…¶ä¸€äº›å…³é”®æ¡†æž¶çš„å›ºæœ‰çº¿ç¨‹å®‰å…¨çš„é«˜çº§æ‘˜è¦ã€‚</li>
</ul>
<h4 id="ä¹Ÿå¯ä»¥çœ‹çœ‹"><a href="#ä¹Ÿå¯ä»¥çœ‹çœ‹" class="headerlink" title="ä¹Ÿå¯ä»¥çœ‹çœ‹"></a>ä¹Ÿå¯ä»¥çœ‹çœ‹</h4><p>æœ‰å…³çº¿ç¨‹æ›¿ä»£æ–¹æ³•çš„ä¿¡æ¯ï¼Œè¯·å‚è§ã€Š_<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40008091">å¹¶å‘ç¼–ç¨‹æŒ‡å—ã€‹</a>_ã€‚</p>
<p>æœ¬æ–‡æ¡£ä»…ç®€è¦ä»‹ç» POSIX çº¿ç¨‹ API çš„ç”¨æ³•ã€‚æœ‰å…³å¯ç”¨çš„ POSIX çº¿ç¨‹ä¾‹ç¨‹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<code>pthread</code>æ‰‹å†Œé¡µã€‚æœ‰å…³ POSIX çº¿ç¨‹åŠå…¶ç”¨æ³•çš„æ›´æ·±å…¥è¯´æ˜Žï¼Œè¯·å‚é˜… David R. Butenhof æ’°å†™çš„â€œ <em>ä½¿ç”¨ POSIX çº¿ç¨‹ç¼–ç¨‹</em> â€ã€‚</p>
<h2 id="çº¿ç¨‹ç®¡ç†"><a href="#çº¿ç¨‹ç®¡ç†" class="headerlink" title="çº¿ç¨‹ç®¡ç†"></a>çº¿ç¨‹ç®¡ç†</h2><p>OS X æˆ– iOS ä¸­çš„æ¯ä¸ªè¿›ç¨‹ï¼ˆåº”ç”¨ç¨‹åºï¼‰éƒ½ç”±ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç»„æˆï¼Œæ¯ä¸ªçº¿ç¨‹ä»£è¡¨é€šè¿‡åº”ç”¨ç¨‹åºä»£ç æ‰§è¡Œçš„å•ä¸ªè·¯å¾„ã€‚æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½ä»Žä¸€ä¸ªçº¿ç¨‹å¼€å§‹ï¼Œè¯¥çº¿ç¨‹è¿è¡Œè¯¥åº”ç”¨ç¨‹åºçš„<code>main</code>åŠŸèƒ½ã€‚åº”ç”¨ç¨‹åºå¯ä»¥äº§ç”Ÿå…¶ä»–çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œç‰¹å®šåŠŸèƒ½çš„ä»£ç ã€‚</p>
<p>å½“åº”ç”¨ç¨‹åºäº§ç”Ÿæ–°çº¿ç¨‹æ—¶ï¼Œè¯¥çº¿ç¨‹å°†æˆä¸ºåº”ç”¨ç¨‹åºè¿›ç¨‹ç©ºé—´å†…çš„ä¸€ä¸ªç‹¬ç«‹å®žä½“ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å…¶è‡ªå·±çš„æ‰§è¡Œå †æ ˆï¼Œå¹¶ç”±å†…æ ¸åˆ†åˆ«è®¡åˆ’åœ¨è¿è¡Œæ—¶è¿è¡Œã€‚çº¿ç¨‹å¯ä»¥ä¸Žå…¶ä»–çº¿ç¨‹å’Œå…¶ä»–è¿›ç¨‹é€šä¿¡ï¼Œæ‰§è¡Œ I / O æ“ä½œä»¥åŠæ‰§è¡Œæ‚¨å¯èƒ½éœ€è¦æ‰§è¡Œçš„å…¶ä»–ä»»ä½•æ“ä½œã€‚ä½†æ˜¯ï¼Œç”±äºŽå®ƒä»¬ä½äºŽåŒä¸€è¿›ç¨‹ç©ºé—´å†…ï¼Œå› æ­¤å•ä¸ªåº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰çº¿ç¨‹å…±äº«åŒä¸€è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œå¹¶ä¸”ä¸Žè¿›ç¨‹æœ¬èº«å…·æœ‰ç›¸åŒçš„è®¿é—®æƒé™ã€‚</p>
<p>æœ¬ç« æ¦‚è¿°äº† OS X å’Œ iOS ä¸­å¯ç”¨çš„çº¿ç¨‹æŠ€æœ¯ä»¥åŠå¦‚ä½•åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¿™äº›æŠ€æœ¯çš„ç¤ºä¾‹ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong> æœ‰å…³ Mac OS çº¿ç¨‹ä½“ç³»ç»“æž„çš„åŽ†å²è®°å½•ä»¥åŠæœ‰å…³çº¿ç¨‹çš„å…¶ä»–èƒŒæ™¯ä¿¡æ¯ï¼Œè¯·å‚é˜…æŠ€æœ¯è¯´æ˜Ž TN2028ï¼Œâ€œçº¿ç¨‹ä½“ç³»ç»“æž„â€ã€‚</p>
<h4 id="çº¿ç¨‹æˆæœ¬"><a href="#çº¿ç¨‹æˆæœ¬" class="headerlink" title="çº¿ç¨‹æˆæœ¬"></a>çº¿ç¨‹æˆæœ¬</h4><p>å°±å†…å­˜ä½¿ç”¨å’Œæ€§èƒ½è€Œè¨€ï¼Œçº¿ç¨‹åŒ–ä¼šç»™æ‚¨çš„ç¨‹åºï¼ˆå’Œç³»ç»Ÿï¼‰å¸¦æ¥å®žé™…æˆæœ¬ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½éœ€è¦åœ¨å†…æ ¸å†…å­˜ç©ºé—´å’Œç¨‹åºçš„å†…å­˜ç©ºé—´ä¸­åˆ†é…å†…å­˜ã€‚ä½¿ç”¨æœ‰çº¿å†…å­˜å°†ç®¡ç†çº¿ç¨‹å’Œåè°ƒå…¶è°ƒåº¦æ‰€éœ€çš„æ ¸å¿ƒç»“æž„å­˜å‚¨åœ¨å†…æ ¸ä¸­ã€‚çº¿ç¨‹çš„å †æ ˆç©ºé—´å’Œæ¯ä¸ªçº¿ç¨‹çš„æ•°æ®å­˜å‚¨åœ¨ç¨‹åºçš„å†…å­˜ç©ºé—´ä¸­ã€‚è¿™äº›ç»“æž„ä¸­çš„å¤§å¤šæ•°æ˜¯åœ¨æ‚¨é¦–æ¬¡åˆ›å»ºçº¿ç¨‹æ—¶åˆ›å»ºå’Œåˆå§‹åŒ–çš„ï¼Œç”±äºŽä¸Žå†…æ ¸ä¹‹é—´çš„äº¤äº’ä½œç”¨ï¼Œè¯¥è¿‡ç¨‹å¯èƒ½ç›¸å¯¹æ˜‚è´µã€‚</p>
<p>è¡¨ 2-1 é‡åŒ–äº†ä¸Žåœ¨åº”ç”¨ç¨‹åºä¸­åˆ›å»ºæ–°çš„ç”¨æˆ·çº§çº¿ç¨‹ç›¸å…³çš„è¿‘ä¼¼æˆæœ¬ã€‚å…¶ä¸­ä¸€äº›æˆæœ¬æ˜¯å¯é…ç½®çš„ï¼Œä¾‹å¦‚åˆ†é…ç»™è¾…åŠ©çº¿ç¨‹çš„å †æ ˆç©ºé—´é‡ã€‚åˆ›å»ºçº¿ç¨‹çš„æ—¶é—´æˆæœ¬æ˜¯ä¸€ä¸ªè¿‘ä¼¼å€¼ï¼Œåº”ä»…ç”¨äºŽå½¼æ­¤ä¹‹é—´çš„ç›¸å¯¹æ¯”è¾ƒã€‚çº¿ç¨‹åˆ›å»ºæ—¶é—´ä¼šå› å¤„ç†å™¨è´Ÿè½½ï¼Œè®¡ç®—æœºé€Ÿåº¦ä»¥åŠå¯ç”¨ç³»ç»Ÿå’Œç¨‹åºå†…å­˜çš„æ•°é‡è€Œæœ‰å¾ˆå¤§ä¸åŒã€‚</p>
<table>
<thead>
<tr>
<th align="left">é¡¹ç›®</th>
<th align="left">å¤§æ¦‚è´¹ç”¨</th>
<th align="left">ç¬”è®°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å†…æ ¸æ•°æ®ç»“æž„</td>
<td align="left">å¤§çº¦ 1 KB</td>
<td align="left">è¯¥å†…å­˜ç”¨äºŽå­˜å‚¨çº¿ç¨‹æ•°æ®ç»“æž„å’Œå±žæ€§ï¼Œå…¶ä¸­è®¸å¤šæ•°æ®ç»“æž„å’Œå±žæ€§åˆ†é…ä¸ºæœ‰çº¿å†…å­˜ï¼Œå› æ­¤æ— æ³•åˆ†é¡µåˆ°ç£ç›˜ã€‚</td>
</tr>
<tr>
<td align="left">å †å ç©ºé—´</td>
<td align="left">512 KBï¼ˆè¾…åŠ©çº¿ç¨‹ï¼‰8 MBï¼ˆOS X ä¸»çº¿ç¨‹ï¼‰1 MBï¼ˆiOS ä¸»çº¿ç¨‹ï¼‰</td>
<td align="left">è¾…åŠ©çº¿ç¨‹å…è®¸çš„æœ€å°å †æ ˆå¤§å°ä¸º 16 KBï¼Œå¹¶ä¸”å †æ ˆå¤§å°å¿…é¡»ä¸º 4 KB çš„å€æ•°ã€‚åœ¨çº¿ç¨‹åˆ›å»ºæ—¶ä¼šåœ¨è¿›ç¨‹ç©ºé—´ä¸­é¢„ç•™æ­¤å†…å­˜çš„ç©ºé—´ï¼Œä½†æ˜¯ç›´åˆ°éœ€è¦å®ƒä»¬æ—¶ï¼Œæ‰ä¼šåˆ›å»ºä¸Žè¯¥å†…å­˜å…³è”çš„å®žé™…é¡µé¢ã€‚</td>
</tr>
<tr>
<td align="left">åˆ›ä½œæ—¶é—´</td>
<td align="left">å¤§çº¦ 90 å¾®ç§’</td>
<td align="left">è¯¥å€¼åæ˜ äº†ä»Žåˆ›å»ºçº¿ç¨‹çš„åˆå§‹è°ƒç”¨åˆ°çº¿ç¨‹çš„å…¥å£ç‚¹ä¾‹ç¨‹å¼€å§‹æ‰§è¡Œä¹‹é—´çš„æ—¶é—´ã€‚è¿™äº›æ•°å­—æ˜¯é€šè¿‡åˆ†æžåœ¨åŸºäºŽ Intel çš„ iMacï¼ˆå…·æœ‰ 2 GHz Core Duo å¤„ç†å™¨å’Œ 1 GB è¿è¡Œ OS X v10.5 çš„ RAMï¼‰ä¸Šçš„çº¿ç¨‹åˆ›å»ºè¿‡ç¨‹ä¸­ç”Ÿæˆçš„å¹³å‡å€¼å’Œä¸­å€¼ç¡®å®šçš„ã€‚</td>
</tr>
</tbody></table>
<p><strong>æ³¨æ„ï¼š</strong> ç”±äºŽå…·æœ‰åº•å±‚å†…æ ¸æ”¯æŒï¼Œå› æ­¤æ“ä½œå¯¹è±¡é€šå¸¸å¯ä»¥æ›´å¿«åœ°åˆ›å»ºçº¿ç¨‹ã€‚ä»–ä»¬ä¸æ˜¯æ¯æ¬¡éƒ½ä»Žå¤´å¼€å§‹åˆ›å»ºçº¿ç¨‹ï¼Œè€Œæ˜¯ä½¿ç”¨å†…æ ¸ä¸­å·²ç»å­˜åœ¨çš„çº¿ç¨‹æ± æ¥èŠ‚çœåˆ†é…æ—¶é—´ã€‚æœ‰å…³ä½¿ç”¨æ“ä½œå¯¹è±¡çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ã€Š_<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40008091">å¹¶å‘ç¼–ç¨‹æŒ‡å—ã€‹</a>_ã€‚</p>
<p>ç¼–å†™çº¿ç¨‹ä»£ç æ—¶è¦è€ƒè™‘çš„å¦ä¸€ä¸ªæˆæœ¬æ˜¯ç”Ÿäº§æˆæœ¬ã€‚è®¾è®¡çº¿ç¨‹åŒ–çš„åº”ç”¨ç¨‹åºæœ‰æ—¶å¯èƒ½éœ€è¦å¯¹ç»„ç»‡åº”ç”¨ç¨‹åºçš„æ•°æ®ç»“æž„çš„æ–¹å¼è¿›è¡Œæ ¹æœ¬æ€§çš„æ›´æ”¹ã€‚ä¸ºé¿å…ä½¿ç”¨åŒæ­¥ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œè¿™äº›æ›´æ”¹ï¼Œå¦åˆ™åŒæ­¥æœ¬èº«å¯èƒ½å¯¹è®¾è®¡ä¸è‰¯çš„åº”ç”¨ç¨‹åºé€ æˆå·¨å¤§çš„æ€§èƒ½æŸå¤±ã€‚è®¾è®¡è¿™äº›æ•°æ®ç»“æž„ä»¥åŠè°ƒè¯•çº¿ç¨‹ä»£ç ä¸­çš„é—®é¢˜å¯èƒ½ä¼šå¢žåŠ å¼€å‘çº¿ç¨‹åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ—¶é—´ã€‚ä½†æ˜¯ï¼Œå¦‚æžœçº¿ç¨‹èŠ±è´¹å¤ªå¤šæ—¶é—´ç­‰å¾…é”æˆ–ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼Œåˆ™é¿å…è¿™äº›å¼€é”€ä¼šåœ¨è¿è¡Œæ—¶äº§ç”Ÿæ›´å¤§çš„é—®é¢˜ã€‚</p>
<h4 id="åˆ›å»ºä¸€ä¸ªçº¿ç¨‹"><a href="#åˆ›å»ºä¸€ä¸ªçº¿ç¨‹" class="headerlink" title="åˆ›å»ºä¸€ä¸ªçº¿ç¨‹"></a>åˆ›å»ºä¸€ä¸ªçº¿ç¨‹</h4><p>åˆ›å»ºä½Žçº§çº¿ç¨‹ç›¸å¯¹ç®€å•ã€‚åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œæ‚¨éƒ½å¿…é¡»å…·æœ‰å……å½“çº¿ç¨‹çš„ä¸»è¦å…¥å£ç‚¹çš„å‡½æ•°æˆ–æ–¹æ³•ï¼Œå¹¶ä¸”å¿…é¡»ä½¿ç”¨å¯ç”¨çš„çº¿ç¨‹ä¾‹ç¨‹ä¹‹ä¸€æ¥å¯åŠ¨çº¿ç¨‹ã€‚ä»¥ä¸‹å„èŠ‚æ˜¾ç¤ºäº†æ›´å¸¸ç”¨çš„çº¿ç¨‹æŠ€æœ¯çš„åŸºæœ¬åˆ›å»ºè¿‡ç¨‹ã€‚ä½¿ç”¨è¿™äº›æŠ€æœ¯åˆ›å»ºçš„çº¿ç¨‹å°†ç»§æ‰¿ä¸€ç»„é»˜è®¤å±žæ€§ï¼Œè¿™äº›å±žæ€§ç”±æ‚¨ä½¿ç”¨çš„æŠ€æœ¯ç¡®å®šã€‚æœ‰å…³å¦‚ä½•é…ç½®çº¿ç¨‹çš„ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ <a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/CreatingThreads/CreatingThreads.html#//apple_ref/doc/uid/10000057i-CH15-SW8">é…ç½®çº¿ç¨‹å±žæ€§â€</a>ã€‚</p>
<h6 id="ä½¿ç”¨-NSThread"><a href="#ä½¿ç”¨-NSThread" class="headerlink" title="ä½¿ç”¨ NSThread"></a>ä½¿ç”¨ NSThread</h6><p>æœ‰ä¸¤ç§ä½¿ç”¨<code>NSThread</code>è¯¥ç±»åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•ï¼š</p>
<ul>
<li>ä½¿ç”¨<code>detachNewThreadSelector:toTarget:withObject:</code>class æ–¹æ³•äº§ç”Ÿæ–°çº¿ç¨‹ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªæ–°<code>NSThread</code>å¯¹è±¡å¹¶è°ƒç”¨å…¶<code>start</code>æ–¹æ³•ã€‚ï¼ˆä»…åœ¨ iOS å’Œ OS X v10.5 åŠæ›´é«˜ç‰ˆæœ¬ä¸­å—æ”¯æŒã€‚ï¼‰</li>
</ul>
<p>ä¸¤ç§æŠ€æœ¯éƒ½ä¼šåœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­åˆ›å»ºä¸€ä¸ªåˆ†ç¦»çº¿ç¨‹ã€‚åˆ†ç¦»çš„çº¿ç¨‹æ„å‘³ç€çº¿ç¨‹é€€å‡ºæ—¶ç³»ç»Ÿä¼šè‡ªåŠ¨å›žæ”¶çº¿ç¨‹çš„èµ„æºã€‚è¿™ä¹Ÿæ„å‘³ç€æ‚¨çš„ä»£ç ä»¥åŽä¸å¿…ä¸Žçº¿ç¨‹æ˜¾å¼è¿žæŽ¥ã€‚</p>
<p>ç”±äºŽè¯¥<code>detachNewThreadSelector:toTarget:withObject:</code>æ–¹æ³•åœ¨ OS X çš„æ‰€æœ‰ç‰ˆæœ¬ä¸­å‡å—æ”¯æŒï¼Œå› æ­¤ç»å¸¸åœ¨ä½¿ç”¨çº¿ç¨‹çš„çŽ°æœ‰ Cocoa åº”ç”¨ç¨‹åºä¸­æ‰¾åˆ°ã€‚è¦åˆ†ç¦»æ–°çº¿ç¨‹ï¼Œåªéœ€æä¾›è¦ç”¨ä½œçº¿ç¨‹å…¥å£ç‚¹çš„æ–¹æ³•åç§°ï¼ˆæŒ‡å®šä¸ºé€‰æ‹©å™¨ï¼‰ï¼Œå®šä¹‰è¯¥æ–¹æ³•çš„å¯¹è±¡ä»¥åŠè¦åœ¨å¯åŠ¨æ—¶ä¼ é€’ç»™çº¿ç¨‹çš„ä»»ä½•æ•°æ®ã€‚ ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†æ­¤æ–¹æ³•çš„åŸºæœ¬è°ƒç”¨ï¼Œè¯¥è°ƒç”¨ä½¿ç”¨å½“å‰å¯¹è±¡çš„è‡ªå®šä¹‰æ–¹æ³•ç”Ÿæˆä¸€ä¸ªçº¿ç¨‹ã€‚</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[NSThread detachNewThreadSelectorï¼š@selectorï¼ˆmyThreadMainMethod :) toTargetï¼šself withObjectï¼šnil];</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨ OS X v10.5 ä¹‹å‰ï¼Œæ‚¨<code>NSThread</code>ä¸»è¦ä½¿ç”¨è¯¥ç±»ç”Ÿæˆçº¿ç¨‹ã€‚å°½ç®¡æ‚¨å¯ä»¥èŽ·å–<code>NSThread</code>å¯¹è±¡å¹¶è®¿é—®æŸäº›çº¿ç¨‹å±žæ€§ï¼Œä½†æ˜¯åªèƒ½åœ¨çº¿ç¨‹è¿è¡Œä¹‹åŽä»Žçº¿ç¨‹æœ¬èº«è¿›è¡Œæ“ä½œã€‚åœ¨ OS X v10.5 ä¸­ï¼Œæ·»åŠ äº†å¯¹åˆ›å»º<code>NSThread</code>å¯¹è±¡çš„æ”¯æŒï¼Œè€Œæ— éœ€ç«‹å³äº§ç”Ÿç›¸åº”çš„æ–°çº¿ç¨‹ã€‚ï¼ˆæ­¤æ”¯æŒåœ¨ iOS ä¸­ä¹Ÿå¯ç”¨ã€‚ï¼‰æ­¤æ”¯æŒä½¿å¾—å¯ä»¥åœ¨å¯åŠ¨çº¿ç¨‹ä¹‹å‰èŽ·å–å’Œè®¾ç½®å„ç§çº¿ç¨‹å±žæ€§ã€‚è¿™ä¹Ÿä½¿å¾—ä»¥åŽå¯ä»¥ä½¿ç”¨è¯¥çº¿ç¨‹å¯¹è±¡æ¥å¼•ç”¨æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ã€‚</p>
<p><code>NSThread</code>åœ¨ OS X v10.5 åŠæ›´é«˜ç‰ˆæœ¬ä¸­åˆå§‹åŒ–å¯¹è±¡çš„ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨è¯¥<code>initWithTarget:selector:object:</code>æ–¹æ³•ã€‚æ­¤æ–¹æ³•<code>detachNewThreadSelector:toTarget:withObject:</code>ä½¿ç”¨ä¸Žè¯¥æ–¹æ³•å®Œå…¨ç›¸åŒçš„ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥åˆå§‹åŒ–æ–°<code>NSThread</code>å®žä¾‹ã€‚ä½†æ˜¯ï¼Œå®ƒä¸ä¼šå¯åŠ¨çº¿ç¨‹ã€‚è¦å¯åŠ¨çº¿ç¨‹ï¼Œè¯·<code>start</code>æ˜¾å¼è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„æ–¹æ³•ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th><code>NSThread * myThread = [[NSThreadåˆ†é…] initWithTargetï¼šself</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>é€‰æ‹©å™¨ï¼š@é€‰æ‹©å™¨ï¼ˆmyThreadMainMethod :)</code></td>
</tr>
<tr>
<td><code>å¯¹è±¡ï¼šæ— ]ï¼›</code></td>
</tr>
<tr>
<td><code>[myThreadå¼€å§‹]; //å®žé™…åˆ›å»ºçº¿ç¨‹</code></td>
</tr>
</tbody></table>
<p><strong>æ³¨æ„ï¼š</strong> ä½¿ç”¨è¯¥<code>initWithTarget:selector:object:</code>æ–¹æ³•çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ç»§æ‰¿<code>NSThread</code>å¹¶è¦†ç›–å…¶<code>main</code>æ–¹æ³•ã€‚æ‚¨å°†ä½¿ç”¨æ­¤æ–¹æ³•çš„é‡å†™ç‰ˆæœ¬æ¥å®žçŽ°çº¿ç¨‹çš„ä¸»å…¥å£ç‚¹ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ã€Š*<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/foundation/nsthread">NSThread ç±»å‚è€ƒã€‹ä¸­</a>*çš„å­ç±»æ³¨é‡Šã€‚</p>
<p>å¦‚æžœæ‚¨æœ‰ä¸€ä¸ª<code>NSThread</code>å¯¹è±¡çš„çº¿ç¨‹å½“å‰æ­£åœ¨è¿è¡Œï¼Œåˆ™å¯ä»¥å‘è¯¥çº¿ç¨‹å‘é€æ¶ˆæ¯çš„<code>performSelector:onThread:withObject:waitUntilDone:</code>ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨åº”ç”¨ç¨‹åºä¸­å‡ ä¹Žæ‰€æœ‰å¯¹è±¡çš„æ–¹æ³•ã€‚OS X v10.5 ä¸­å¼•å…¥äº†å¯¹åœ¨çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹é™¤å¤–ï¼‰ä¸Šæ‰§è¡Œé€‰æ‹©å™¨çš„æ”¯æŒï¼Œè¿™æ˜¯åœ¨çº¿ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡çš„ä¾¿æ·æ–¹å¼ã€‚ï¼ˆæ­¤æ”¯æŒåœ¨ iOS ä¸­ä¹Ÿå¯ç”¨ã€‚ï¼‰ä½¿ç”¨æ­¤æŠ€æœ¯å‘é€çš„æ¶ˆæ¯ç”±å¦ä¸€ä¸ªçº¿ç¨‹ç›´æŽ¥æ‰§è¡Œï¼Œä½œä¸ºå…¶æ­£å¸¸è¿è¡Œå¾ªçŽ¯å¤„ç†çš„ä¸€éƒ¨åˆ†ã€‚ï¼ˆå½“ç„¶ï¼Œè¿™ç¡®å®žæ„å‘³ç€ç›®æ ‡çº¿ç¨‹å¿…é¡»åœ¨å…¶è¿è¡Œå¾ªçŽ¯ä¸­è¿è¡Œï¼›è¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW1">â€œè¿è¡Œå¾ªçŽ¯â€</a>ã€‚ï¼‰ä»¥è¿™ç§æ–¹å¼è¿›è¡Œé€šä¿¡æ—¶ï¼Œæ‚¨å¯èƒ½ä»éœ€è¦æŸç§å½¢å¼çš„åŒæ­¥ï¼Œä½†æ˜¯æ¯”åœ¨çº¿ç¨‹ä¹‹é—´è®¾ç½®é€šä¿¡ç«¯å£æ›´ç®€å•ã€‚çº¿ç¨‹ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong> å°½ç®¡å¯¹äºŽçº¿ç¨‹é—´çš„å¶å°”é€šä¿¡å¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯æ‚¨ä¸åº”å°† <code>performSelector:onThread:withObject:waitUntilDone:</code>æ–¹æ³•ç”¨äºŽæ—¶é—´ç´§è¿«æˆ–çº¿ç¨‹é—´çš„é¢‘ç¹é€šä¿¡ã€‚</p>
<p>æœ‰å…³å…¶ä»–çº¿ç¨‹é€šä¿¡é€‰é¡¹çš„åˆ—è¡¨ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/CreatingThreads/CreatingThreads.html#//apple_ref/doc/uid/10000057i-CH15-SW3">è®¾ç½®</a>çº¿ç¨‹<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/CreatingThreads/CreatingThreads.html#//apple_ref/doc/uid/10000057i-CH15-SW3">çš„åˆ†ç¦»çŠ¶æ€</a>ã€‚</p>
<h6 id="ä½¿ç”¨-POSIX-çº¿ç¨‹"><a href="#ä½¿ç”¨-POSIX-çº¿ç¨‹" class="headerlink" title="ä½¿ç”¨ POSIX çº¿ç¨‹"></a>ä½¿ç”¨ POSIX çº¿ç¨‹</h6><p>OS X å’Œ iOS ä¸ºä½¿ç”¨ POSIX çº¿ç¨‹ API åˆ›å»ºçº¿ç¨‹æä¾›äº†åŸºäºŽ C çš„æ”¯æŒã€‚è¯¥æŠ€æœ¯å®žé™…ä¸Šå¯ä»¥åœ¨ä»»ä½•ç±»åž‹çš„åº”ç”¨ç¨‹åºï¼ˆåŒ…æ‹¬ Cocoa å’Œ Cocoa Touch åº”ç”¨ç¨‹åºï¼‰ä¸­ä½¿ç”¨ï¼Œå¦‚æžœæ‚¨è¦ä¸ºå¤šä¸ªå¹³å°ç¼–å†™è½¯ä»¶ï¼Œåˆ™å¯èƒ½ä¼šæ›´åŠ æ–¹ä¾¿ã€‚é€‚å½“åœ°è°ƒç”¨äº†ç”¨äºŽåˆ›å»ºçº¿ç¨‹çš„ POSIX ä¾‹ç¨‹<code>pthread_create</code>ã€‚</p>
<p>æ¸…å• 2-1 æ˜¾ç¤ºäº†ä¸¤ä¸ªä½¿ç”¨ POSIX è°ƒç”¨åˆ›å»ºçº¿ç¨‹çš„è‡ªå®šä¹‰å‡½æ•°ã€‚è¯¥<code>LaunchThread</code>å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå…¶ä¸»ä¾‹ç¨‹åœ¨è¯¥<code>PosixThreadMainRoutine</code>å‡½æ•°ä¸­å®žçŽ°ã€‚ç”±äºŽ POSIX é»˜è®¤å°†çº¿ç¨‹åˆ›å»ºä¸ºå¯è¿žæŽ¥çº¿ç¨‹ï¼Œå› æ­¤æœ¬ç¤ºä¾‹æ›´æ”¹äº†çº¿ç¨‹çš„å±žæ€§ä»¥åˆ›å»ºåˆ†ç¦»çš„çº¿ç¨‹ã€‚å°†çº¿ç¨‹æ ‡è®°ä¸ºå·²åˆ†ç¦»ä½¿ç³»ç»Ÿæœ‰æœºä¼šåœ¨é€€å‡ºæ—¶ç«‹å³å›žæ”¶è¯¥çº¿ç¨‹çš„èµ„æºã€‚</p>
<p><strong>æ¸…å• 2-1</strong> åœ¨ C ä¸­åˆ›å»ºçº¿ç¨‹</p>
<table>
<thead>
<tr>
<th><code>#include</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>#include</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>void * PosixThreadMainRoutineï¼ˆvoid *æ•°æ®ï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//åœ¨è¿™é‡Œåšä¸€äº›å·¥ä½œã€‚</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>è¿”å›žNULL;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>æ— æ•ˆLaunchThreadï¼ˆï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//ä½¿ç”¨POSIXä¾‹ç¨‹åˆ›å»ºçº¿ç¨‹ã€‚</code></td>
</tr>
<tr>
<td><code>pthread_attr_t attr;</code></td>
</tr>
<tr>
<td><code>pthread_t posixThreadID;</code></td>
</tr>
<tr>
<td><code>int returnVal;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>returnVal = pthread_attr_initï¼ˆï¼†attrï¼‰;</code></td>
</tr>
<tr>
<td><code>assertï¼ˆï¼returnValï¼‰;</code></td>
</tr>
<tr>
<td><code>returnVal = pthread_attr_setdetachstateï¼ˆï¼†attrï¼ŒPTHREAD_CREATE_DETACHEDï¼‰;</code></td>
</tr>
<tr>
<td><code>assertï¼ˆï¼returnValï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>int threadError = pthread_createï¼ˆï¼†posixThreadIDï¼Œï¼†attrï¼Œï¼†PosixThreadMainRoutineï¼ŒNULLï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>returnVal = pthread_attr_destroyï¼ˆï¼†attrï¼‰;</code></td>
</tr>
<tr>
<td><code>assertï¼ˆï¼returnValï¼‰;</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆthreadErrorï¼= 0ï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//æŠ¥å‘Šé”™è¯¯ã€‚</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>å¦‚æžœå°†ä¸Šè¿°æ¸…å•ä¸­çš„ä»£ç æ·»åŠ åˆ°ä¸€ä¸ªæºæ–‡ä»¶ä¸­å¹¶è°ƒç”¨è¯¥<code>LaunchThread</code>å‡½æ•°ï¼Œå®ƒå°†åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†ç¦»çº¿ç¨‹ã€‚å½“ç„¶ï¼Œä½¿ç”¨æ­¤ä»£ç åˆ›å»ºçš„æ–°çº¿ç¨‹å°†æ— ç”¨ã€‚çº¿ç¨‹å°†å¯åŠ¨ï¼Œå‡ ä¹Žç«‹å³é€€å‡ºã€‚ä¸ºäº†ä½¿äº‹æƒ…å˜å¾—æ›´æœ‰è¶£ï¼Œæ‚¨éœ€è¦å‘è¯¥<code>PosixThreadMainRoutine</code>å‡½æ•°æ·»åŠ ä»£ç ä»¥å®Œæˆä¸€äº›å®žé™…å·¥ä½œã€‚ä¸ºäº†ç¡®ä¿çº¿ç¨‹çŸ¥é“è¦æ‰§è¡Œçš„å·¥ä½œï¼Œå¯ä»¥åœ¨åˆ›å»ºæ—¶å°†å…¶ä¼ é€’ç»™ä¸€äº›æ•°æ®çš„æŒ‡é’ˆã€‚æ‚¨å°†æ­¤æŒ‡é’ˆä½œä¸º<code>pthread_create</code>å‡½æ•°çš„æœ€åŽä¸€ä¸ªå‚æ•°ä¼ é€’ã€‚</p>
<p>è¦å°†ä¿¡æ¯ä»Žæ–°åˆ›å»ºçš„çº¿ç¨‹ä¼ é€’å›žåº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ï¼Œæ‚¨éœ€è¦åœ¨ç›®æ ‡çº¿ç¨‹ä¹‹é—´å»ºç«‹é€šä¿¡è·¯å¾„ã€‚å¯¹äºŽåŸºäºŽ C çš„åº”ç”¨ç¨‹åºï¼Œæœ‰å¤šç§æ–¹æ³•å¯ä»¥åœ¨çº¿ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡ï¼ŒåŒ…æ‹¬ä½¿ç”¨ç«¯å£ï¼Œæ¡ä»¶æˆ–å…±äº«å†…å­˜ã€‚å¯¹äºŽå¯¿å‘½é•¿çš„çº¿ç¨‹ï¼Œå‡ ä¹Žåº”è¯¥å§‹ç»ˆè®¾ç½®æŸç§çº¿ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œä»¥ä¸ºåº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹æä¾›ä¸€ç§æ£€æŸ¥çº¿ç¨‹çŠ¶æ€æˆ–åœ¨åº”ç”¨ç¨‹åºé€€å‡ºæ—¶å°†å…¶å¹²å‡€å…³é—­çš„æ–¹æ³•ã€‚</p>
<p>æœ‰å…³ POSIX çº¿ç¨‹åŠŸèƒ½çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<code>pthread</code>æ‰‹å†Œé¡µã€‚</p>
<h6 id="ä½¿ç”¨-NSObject-ç”Ÿæˆçº¿ç¨‹"><a href="#ä½¿ç”¨-NSObject-ç”Ÿæˆçº¿ç¨‹" class="headerlink" title="ä½¿ç”¨ NSObject ç”Ÿæˆçº¿ç¨‹"></a>ä½¿ç”¨ NSObject ç”Ÿæˆçº¿ç¨‹</h6><p>åœ¨ iOS å’Œ OS X v10.5 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½å¯ä»¥ç”Ÿæˆæ–°çº¿ç¨‹å¹¶ä½¿ç”¨å®ƒæ‰§è¡Œå…¶æ–¹æ³•ä¹‹ä¸€ã€‚è¯¥<code>performSelectorInBackground:withObject:</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†ç¦»çº¿ç¨‹ï¼Œå¹¶ä½¿ç”¨æŒ‡å®šçš„æ–¹æ³•ä½œä¸ºæ–°çº¿ç¨‹çš„å…¥å£ç‚¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæ‚¨æœ‰æŸä¸ªå¯¹è±¡ï¼ˆç”±è¡¨ç¤º<code>myObj</code>ï¼‰ï¼Œå¹¶ä¸”è¯¥å¯¹è±¡å…·æœ‰ä¸€ä¸ª<code>doSomething</code>è¦åœ¨åŽå°çº¿ç¨‹ä¸­è¿è¡Œçš„æ–¹æ³•ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç æ¥æ‰§è¡Œè¯¥æ“ä½œï¼š</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[myObj performSelectorInBackgroundï¼š@selectorï¼ˆdoSomethingï¼‰withObjectï¼šnil];</span><br></pre></td></tr></tbody></table></figure>

<p>è°ƒç”¨æ­¤æ–¹æ³•çš„æ•ˆæžœæ˜¯ä¸€æ ·çš„ï¼Œå¦‚æžœä½ è°ƒç”¨<code>detachNewThreadSelector:toTarget:withObject:</code>çš„æ–¹æ³•<code>NSThread</code>ä¸Žå½“å‰å¯¹è±¡ï¼Œé€‰æ‹©å’Œå‚æ•°å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚ç«‹å³ä½¿ç”¨é»˜è®¤é…ç½®ç”Ÿæˆæ–°çº¿ç¨‹å¹¶å¼€å§‹è¿è¡Œã€‚åœ¨é€‰æ‹©å™¨å†…éƒ¨ï¼Œå¿…é¡»åƒé…ç½®ä»»ä½•çº¿ç¨‹ä¸€æ ·é…ç½®çº¿ç¨‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæ‚¨æ‰“ç®—ä½¿ç”¨è‡ªåŠ¨é‡Šæ”¾æ± ï¼ˆå¦‚æžœæ‚¨ä¸ä½¿ç”¨åžƒåœ¾å›žæ”¶ï¼‰ï¼Œåˆ™éœ€è¦è®¾ç½®å®ƒï¼Œå¹¶é…ç½®çº¿ç¨‹çš„è¿è¡Œå¾ªçŽ¯ã€‚æœ‰å…³å¦‚ä½•é…ç½®æ–°çº¿ç¨‹çš„ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ <a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/CreatingThreads/CreatingThreads.html#//apple_ref/doc/uid/10000057i-CH15-SW8">é…ç½®çº¿ç¨‹å±žæ€§â€</a>ã€‚</p>
<h6 id="åœ¨-Cocoa-åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨-POSIX-çº¿ç¨‹"><a href="#åœ¨-Cocoa-åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨-POSIX-çº¿ç¨‹" class="headerlink" title="åœ¨ Cocoa åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ POSIX çº¿ç¨‹"></a>åœ¨ Cocoa åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ POSIX çº¿ç¨‹</h6><p>å°½ç®¡<code>NSThread</code>è¯¥ç±»æ˜¯åœ¨ Cocoa åº”ç”¨ç¨‹åºä¸­åˆ›å»ºçº¿ç¨‹çš„ä¸»è¦æŽ¥å£ï¼Œä½†æ˜¯æ‚¨å¯ä»¥è‡ªç”±ä½¿ç”¨ POSIX çº¿ç¨‹ï¼Œå¦‚æžœè¿™æ ·åšå¯¹æ‚¨æ›´æ–¹ä¾¿ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæ‚¨å·²ç»æœ‰ä½¿ç”¨ POSIX çº¿ç¨‹çš„ä»£ç å¹¶ä¸”ä¸æƒ³é‡å†™å®ƒï¼Œåˆ™å¯ä»¥ä½¿ç”¨ã€‚å¦‚æžœç¡®å®žæ‰“ç®—åœ¨ Cocoa åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ POSIX çº¿ç¨‹ï¼Œåˆ™ä»åº”äº†è§£ Cocoa å’Œçº¿ç¨‹ä¹‹é—´çš„äº¤äº’ä½œç”¨ï¼Œå¹¶éµå®ˆä»¥ä¸‹å„èŠ‚ä¸­çš„å‡†åˆ™ã€‚</p>
<p>######## ä¿æŠ¤å¯å¯æ¡†æž¶</p>
<p>å¯¹äºŽå¤šçº¿ç¨‹åº”ç”¨ç¨‹åºï¼ŒCocoa æ¡†æž¶ä½¿ç”¨é”å’Œå…¶ä»–å½¢å¼çš„å†…éƒ¨åŒæ­¥æ¥ç¡®ä¿å®ƒä»¬çš„è¡Œä¸ºæ­£ç¡®ã€‚ä½†æ˜¯ï¼Œä¸ºäº†é˜²æ­¢è¿™äº›é”åœ¨å•çº¿ç¨‹æƒ…å†µä¸‹é™ä½Žæ€§èƒ½ï¼Œåœ¨åº”ç”¨ç¨‹åºä½¿ç”¨<code>NSThread</code>ç±»äº§ç”Ÿå…¶ç¬¬ä¸€ä¸ªæ–°çº¿ç¨‹ä¹‹å‰ï¼ŒCocoa ä¸ä¼šåˆ›å»ºå®ƒä»¬ã€‚å¦‚æžœä»…ä½¿ç”¨ POSIX çº¿ç¨‹ä¾‹ç¨‹ç”Ÿæˆçº¿ç¨‹ï¼Œåˆ™ Cocoa ä¸ä¼šæ”¶åˆ°éœ€è¦çŸ¥é“æ‚¨çš„åº”ç”¨ç¨‹åºçŽ°åœ¨æ˜¯å¤šçº¿ç¨‹çš„é€šçŸ¥ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œæ¶‰åŠ Cocoa æ¡†æž¶çš„æ“ä½œå¯èƒ½ä¼šä½¿æ‚¨çš„åº”ç”¨ç¨‹åºä¸ç¨³å®šæˆ–å´©æºƒã€‚</p>
<p>ä¸ºäº†è®© Cocoa çŸ¥é“æ‚¨æ‰“ç®—ä½¿ç”¨å¤šä¸ªçº¿ç¨‹ï¼Œæ‚¨æ‰€è¦åšçš„å°±æ˜¯ä½¿ç”¨<code>NSThread</code>ç±»äº§ç”Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œç„¶åŽç«‹å³é€€å‡ºè¯¥çº¿ç¨‹ã€‚æ‚¨çš„çº¿ç¨‹å…¥å£ç‚¹æ— éœ€æ‰§è¡Œä»»ä½•æ“ä½œã€‚ä»…ä½¿ç”¨ç”Ÿæˆä¸€ä¸ªçº¿ç¨‹çš„è¡Œä¸º<code>NSThread</code>å°±è¶³ä»¥ç¡®ä¿å°† Cocoa æ¡†æž¶æ‰€éœ€çš„é”æ”¾ç½®åˆ°ä½ã€‚</p>
<p>å¦‚æžœä¸ç¡®å®š Cocoa æ˜¯å¦è®¤ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæ˜¯å¤šçº¿ç¨‹çš„ï¼Œåˆ™å¯ä»¥ä½¿ç”¨çš„<code>isMultiThreaded</code>æ–¹æ³•<code>NSThread</code>è¿›è¡Œæ£€æŸ¥ã€‚</p>
<p>######## æ··åˆ POSIX å’Œå¯å¯é”</p>
<p>åœ¨åŒä¸€åº”ç”¨ç¨‹åºä¸­æ··åˆä½¿ç”¨ POSIX å’Œ Cocoa é”æ˜¯å®‰å…¨çš„ã€‚å¯å¯é”å’Œæ¡ä»¶å¯¹è±¡å®žé™…ä¸Šåªæ˜¯ POSIX äº’æ–¥å¯¹è±¡å’Œæ¡ä»¶çš„åŒ…è£…ã€‚ä½†æ˜¯ï¼Œå¯¹äºŽç»™å®šçš„é”ï¼Œå¿…é¡»å§‹ç»ˆä½¿ç”¨ç›¸åŒçš„æŽ¥å£æ¥åˆ›å»ºå’Œæ“ä½œè¯¥é”ã€‚æ¢å¥è¯è¯´ï¼Œæ‚¨ä¸èƒ½ä½¿ç”¨ Cocoa <code>NSLock</code>å¯¹è±¡æ¥æ“çºµä½¿ç”¨è¯¥<code>pthread_mutex_init</code>å‡½æ•°åˆ›å»ºçš„äº’æ–¥å¯¹è±¡ï¼Œåä¹‹äº¦ç„¶ã€‚</p>
<h4 id="é…ç½®çº¿ç¨‹å±žæ€§"><a href="#é…ç½®çº¿ç¨‹å±žæ€§" class="headerlink" title="é…ç½®çº¿ç¨‹å±žæ€§"></a>é…ç½®çº¿ç¨‹å±žæ€§</h4><p>åœ¨åˆ›å»ºçº¿ç¨‹ä¹‹åŽï¼Œæœ‰æ—¶ç”šè‡³åœ¨åˆ›å»ºçº¿ç¨‹ä¹‹å‰ï¼Œæ‚¨å¯èƒ½éœ€è¦é…ç½®çº¿ç¨‹çŽ¯å¢ƒçš„ä¸åŒéƒ¨åˆ†ã€‚ä»¥ä¸‹å„èŠ‚æè¿°äº†å¯ä»¥è¿›è¡Œçš„æŸäº›æ›´æ”¹ä»¥åŠä½•æ—¶è¿›è¡Œæ›´æ”¹ã€‚</p>
<h6 id="é…ç½®çº¿ç¨‹çš„å †æ ˆå¤§å°"><a href="#é…ç½®çº¿ç¨‹çš„å †æ ˆå¤§å°" class="headerlink" title="é…ç½®çº¿ç¨‹çš„å †æ ˆå¤§å°"></a>é…ç½®çº¿ç¨‹çš„å †æ ˆå¤§å°</h6><p>å¯¹äºŽæ‚¨åˆ›å»ºçš„æ¯ä¸ªæ–°çº¿ç¨‹ï¼Œç³»ç»Ÿéƒ½ä¼šåœ¨è¿›ç¨‹ç©ºé—´ä¸­åˆ†é…ç‰¹å®šæ•°é‡çš„å†…å­˜ï¼Œä»¥å……å½“è¯¥çº¿ç¨‹çš„å †æ ˆã€‚å †æ ˆç®¡ç†å †æ ˆå¸§ï¼Œä¹Ÿæ˜¯å£°æ˜Žçº¿ç¨‹çš„ä»»ä½•å±€éƒ¨å˜é‡çš„åœ°æ–¹ã€‚ä¸ºçº¿ç¨‹åˆ†é…çš„å†…å­˜é‡åœ¨â€œ <a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/CreatingThreads/CreatingThreads.html#//apple_ref/doc/uid/10000057i-CH15-SW7">çº¿ç¨‹æˆæœ¬â€ä¸­</a>åˆ—å‡ºã€‚</p>
<p>å¦‚æžœè¦æ›´æ”¹ç»™å®šçº¿ç¨‹çš„å †æ ˆå¤§å°ï¼Œåˆ™å¿…é¡»åœ¨åˆ›å»ºçº¿ç¨‹ä¹‹å‰è¿›è¡Œæ›´æ”¹ã€‚å°½ç®¡<code>NSThread</code>åªæœ‰ iOS å’Œ OS X v10.5 åŠæ›´é«˜ç‰ˆæœ¬æ‰æä¾›ä½¿ç”¨è®¾ç½®å †æ ˆå¤§å°çš„åŠŸèƒ½ï¼Œä½†æ˜¯æ‰€æœ‰çº¿ç¨‹æŠ€æœ¯éƒ½æä¾›äº†ä¸€äº›è®¾ç½®å †æ ˆå¤§å°çš„æ–¹æ³•ã€‚è¡¨ 2-2 åˆ—å‡ºäº†æ¯ç§æŠ€æœ¯çš„ä¸åŒé€‰é¡¹ã€‚</p>
<table>
<thead>
<tr>
<th align="left">æŠ€æœ¯</th>
<th align="left">é€‰é¡¹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å¯å¯</td>
<td align="left">åœ¨ iOS å’Œ OS X v10.5 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œåˆ†é…å’Œåˆå§‹åŒ–<code>NSThread</code>å¯¹è±¡ï¼ˆè¯·å‹¿ä½¿ç”¨<code>detachNewThreadSelector:toTarget:withObject:</code>æ–¹æ³•ï¼‰ã€‚åœ¨è°ƒç”¨<code>start</code>çº¿ç¨‹å¯¹è±¡çš„æ–¹æ³•ä¹‹å‰ï¼Œè¯·ä½¿ç”¨è¯¥<code>setStackSize:</code>æ–¹æ³•æŒ‡å®šæ–°çš„å †æ ˆå¤§å°ã€‚</td>
</tr>
<tr>
<td align="left">POSIX</td>
<td align="left">åˆ›å»ºä¸€ä¸ªæ–°<code>pthread_attr_t</code>ç»“æž„ï¼Œå¹¶ä½¿ç”¨è¯¥<code>pthread_attr_setstacksize</code>å‡½æ•°æ›´æ”¹é»˜è®¤å †æ ˆå¤§å°ã€‚<code>pthread_create</code>åˆ›å»ºçº¿ç¨‹æ—¶ï¼Œå°†å±žæ€§ä¼ é€’ç»™å‡½æ•°ã€‚</td>
</tr>
<tr>
<td align="left">å¤šå¤„ç†æœåŠ¡</td>
<td align="left"><code>MPCreateTask</code>åˆ›å»ºçº¿ç¨‹æ—¶ï¼Œå°†é€‚å½“çš„å †æ ˆå¤§å°å€¼ä¼ é€’ç»™å‡½æ•°ã€‚</td>
</tr>
</tbody></table>
<h6 id="é…ç½®çº¿ç¨‹æœ¬åœ°å­˜å‚¨"><a href="#é…ç½®çº¿ç¨‹æœ¬åœ°å­˜å‚¨" class="headerlink" title="é…ç½®çº¿ç¨‹æœ¬åœ°å­˜å‚¨"></a>é…ç½®çº¿ç¨‹æœ¬åœ°å­˜å‚¨</h6><p>æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªé”®-å€¼å¯¹çš„å­—å…¸ï¼Œå¯ä»¥ä»Žçº¿ç¨‹ä¸­çš„ä»»ä½•ä½ç½®è¿›è¡Œè®¿é—®ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ­¤è¯å…¸å­˜å‚¨è¦åœ¨æ•´ä¸ªçº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ä¿ç•™çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒå­˜å‚¨è¦åœ¨çº¿ç¨‹è¿è¡Œå¾ªçŽ¯çš„å¤šæ¬¡è¿­ä»£ä¸­ä¿ç•™çš„çŠ¶æ€ä¿¡æ¯ã€‚</p>
<p>Cocoa å’Œ POSIX ä»¥ä¸åŒçš„æ–¹å¼å­˜å‚¨çº¿ç¨‹å­—å…¸ï¼Œå› æ­¤æ‚¨ä¸èƒ½æ··åˆå’ŒåŒ¹é…å¯¹è¿™ä¸¤ç§æŠ€æœ¯çš„è°ƒç”¨ã€‚ä½†æ˜¯ï¼Œåªè¦æ‚¨åœ¨çº¿ç¨‹ä»£ç ä¸­åšæŒä½¿ç”¨ä¸€ç§æŠ€æœ¯ï¼Œæœ€ç»ˆç»“æžœåº”è¯¥æ˜¯ç›¸ä¼¼çš„ã€‚åœ¨ Cocoa ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¯¹è±¡çš„<code>threadDictionary</code>æ–¹æ³•<code>NSThread</code>æ¥æ£€ç´¢<code>NSMutableDictionary</code>å¯¹è±¡ï¼Œå¯ä»¥åœ¨è¯¥å¯¹è±¡ä¸­æ·»åŠ çº¿ç¨‹æ‰€éœ€çš„ä»»ä½•é”®ã€‚åœ¨ POSIX ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>pthread_setspecific</code>å’Œ<code>pthread_getspecific</code>å‡½æ•°æ¥è®¾ç½®å’ŒèŽ·å–çº¿ç¨‹çš„é”®å’Œå€¼ã€‚</p>
<h6 id="è®¾ç½®çº¿ç¨‹çš„åˆ†ç¦»çŠ¶æ€"><a href="#è®¾ç½®çº¿ç¨‹çš„åˆ†ç¦»çŠ¶æ€" class="headerlink" title="è®¾ç½®çº¿ç¨‹çš„åˆ†ç¦»çŠ¶æ€"></a>è®¾ç½®çº¿ç¨‹çš„åˆ†ç¦»çŠ¶æ€</h6><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¤§å¤šæ•°é«˜çº§çº¿ç¨‹æŠ€æœ¯éƒ½ä¼šåˆ›å»ºåˆ†ç¦»çš„çº¿ç¨‹ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæœ€å¥½ä½¿ç”¨åˆ†ç¦»çš„çº¿ç¨‹ï¼Œå› ä¸ºå®ƒä»¬å…è®¸ç³»ç»Ÿåœ¨çº¿ç¨‹å®ŒæˆåŽç«‹å³é‡Šæ”¾çº¿ç¨‹çš„æ•°æ®ç»“æž„ã€‚åˆ†ç¦»çš„çº¿ç¨‹ä¹Ÿä¸éœ€è¦ä¸Žç¨‹åºè¿›è¡Œæ˜¾å¼äº¤äº’ã€‚ä»Žçº¿ç¨‹ä¸­æ£€ç´¢ç»“æžœçš„æ–¹æ³•ç”±æ‚¨è‡ªè¡Œå†³å®šã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œç³»ç»Ÿä¸ä¼šä¸ºå¯è¿žæŽ¥çº¿ç¨‹å›žæ”¶èµ„æºï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ä¸Žè¯¥çº¿ç¨‹æ˜¾å¼è¿žæŽ¥ä¸ºæ­¢ï¼Œè¯¥è¿‡ç¨‹å¯èƒ½ä¼šé˜»å¡žæ‰§è¡Œè¯¥è¿žæŽ¥çš„çº¿ç¨‹ã€‚</p>
<p>æ‚¨å¯ä»¥å°†å¯è¿žæŽ¥çº¿ç¨‹è§†ä¸ºç±»ä¼¼äºŽå­çº¿ç¨‹ã€‚å°½ç®¡å®ƒä»¬ä»ç„¶ä½œä¸ºç‹¬ç«‹çº¿ç¨‹è¿è¡Œï¼Œä½†æ˜¯åœ¨ç³»ç»Ÿå¯ä»¥å›žæ”¶å…¶èµ„æºä¹‹å‰ï¼Œå¯è¿žæŽ¥çº¿ç¨‹å¿…é¡»ç”±å¦ä¸€ä¸ªçº¿ç¨‹è¿žæŽ¥ã€‚å¯è¿žæŽ¥çº¿ç¨‹è¿˜æä¾›äº†ä¸€ç§æ˜¾å¼çš„æ–¹æ³•ï¼Œå¯å°†æ•°æ®ä»Žé€€å‡ºçº¿ç¨‹ä¼ é€’åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ã€‚åœ¨è¿žæŽ¥é€€å‡ºä¹‹å‰ï¼Œå¯è¿žæŽ¥çº¿ç¨‹å¯ä»¥å°†æ•°æ®æŒ‡é’ˆæˆ–å…¶ä»–è¿”å›žå€¼ä¼ é€’ç»™è¯¥<code>pthread_exit</code>å‡½æ•°ã€‚ç„¶åŽå¦ä¸€ä¸ªçº¿ç¨‹å¯ä»¥é€šè¿‡è°ƒç”¨è¯¥<code>pthread_join</code>å‡½æ•°æ¥å£°æ˜Žæ­¤æ•°æ®ã€‚</p>
<p><strong>é‡è¦ï¼š</strong> åœ¨åº”ç”¨ç¨‹åºé€€å‡ºæ—¶ï¼Œåˆ†ç¦»çš„çº¿ç¨‹å¯ä»¥ç«‹å³ç»ˆæ­¢ï¼Œä½†å¯è¿žæŽ¥çš„çº¿ç¨‹ä¸èƒ½ç»ˆæ­¢ã€‚åœ¨å…è®¸è¿›ç¨‹é€€å‡ºä¹‹å‰ï¼Œå¿…é¡»å…ˆè¿žæŽ¥æ¯ä¸ªå¯è¿žæŽ¥çº¿ç¨‹ã€‚å› æ­¤ï¼Œåœ¨çº¿ç¨‹æ­£åœ¨æ‰§è¡Œä¸åº”ä¸­æ–­çš„å…³é”®å·¥ä½œï¼ˆä¾‹å¦‚å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ï¼‰çš„æƒ…å†µä¸‹ï¼Œå¯è¿žæŽ¥çº¿ç¨‹å¯èƒ½æ›´å¯å–ã€‚</p>
<p>å¦‚æžœç¡®å®žè¦åˆ›å»ºå¯è¿žæŽ¥çº¿ç¨‹ï¼Œåˆ™å”¯ä¸€çš„æ–¹æ³•æ˜¯ä½¿ç”¨ POSIX çº¿ç¨‹ã€‚POSIX é»˜è®¤å°†çº¿ç¨‹åˆ›å»ºä¸ºå¯è¿žæŽ¥çº¿ç¨‹ã€‚è¦å°†çº¿ç¨‹æ ‡è®°ä¸ºåˆ†ç¦»çš„æˆ–å¯è”æŽ¥çš„ï¼Œè¯·<code>pthread_attr_setdetachstate</code>åœ¨åˆ›å»ºçº¿ç¨‹ä¹‹å‰ä½¿ç”¨å‡½æ•°ä¿®æ”¹çº¿ç¨‹å±žæ€§ã€‚çº¿ç¨‹å¼€å§‹åŽï¼Œæ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨<code>pthread_detach</code>å‡½æ•°å°†å¯è¿žæŽ¥çº¿ç¨‹æ›´æ”¹ä¸ºåˆ†ç¦»çº¿ç¨‹ã€‚æœ‰å…³è¿™äº› POSIX çº¿ç¨‹åŠŸèƒ½çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<code>pthread</code>æ‰‹å†Œé¡µã€‚æœ‰å…³å¦‚ä½•åŠ å…¥çº¿ç¨‹çš„ä¿¡æ¯ï¼Œè¯·å‚è§<code>pthread_join</code>æ‰‹å†Œé¡µã€‚</p>
<h6 id="è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§"><a href="#è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§" class="headerlink" title="è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§"></a>è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§</h6><p>æ‚¨åˆ›å»ºçš„ä»»ä½•æ–°çº¿ç¨‹éƒ½å…·æœ‰ä¸Žä¹‹å…³è”çš„é»˜è®¤ä¼˜å…ˆçº§ã€‚å†…æ ¸çš„è°ƒåº¦ç®—æ³•åœ¨ç¡®å®šè¦è¿è¡Œçš„çº¿ç¨‹æ—¶ä¼šè€ƒè™‘çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œä¸Žä¼˜å…ˆçº§è¾ƒä½Žçš„çº¿ç¨‹ç›¸æ¯”ï¼Œä¼˜å…ˆçº§è¾ƒé«˜çš„çº¿ç¨‹æ›´æœ‰å¯èƒ½è¿è¡Œã€‚è¾ƒé«˜çš„ä¼˜å…ˆçº§å¹¶ä¸èƒ½ä¿è¯æ‚¨çš„çº¿ç¨‹æœ‰ç‰¹å®šçš„æ‰§è¡Œæ—¶é—´ï¼Œåªæ˜¯ä¸Žè¾ƒä½Žä¼˜å…ˆçº§çš„çº¿ç¨‹ç›¸æ¯”ï¼Œè°ƒåº¦ç¨‹åºæ›´å¯èƒ½é€‰æ‹©è¯¥æ—¶é—´ã€‚</p>
<p><strong>é‡è¦è¯´æ˜Žï¼š</strong> é€šå¸¸æœ€å¥½å°†çº¿ç¨‹çš„ä¼˜å…ˆçº§ä¿ç•™ä¸ºé»˜è®¤å€¼ã€‚å¢žåŠ æŸäº›çº¿ç¨‹çš„ä¼˜å…ˆçº§ä¹Ÿä¼šå¢žåŠ ä½Žä¼˜å…ˆçº§çº¿ç¨‹ä¹‹é—´å‡ºçŽ°é¥¥é¥¿çš„å¯èƒ½æ€§ã€‚å¦‚æžœæ‚¨çš„åº”ç”¨ç¨‹åºåŒ…å«å¿…é¡»å½¼æ­¤äº¤äº’çš„é«˜ä¼˜å…ˆçº§å’Œä½Žä¼˜å…ˆçº§çº¿ç¨‹ï¼Œåˆ™ä½Žä¼˜å…ˆçº§çº¿ç¨‹çš„é¥¥é¥¿å¯èƒ½ä¼šé˜»å¡žå…¶ä»–çº¿ç¨‹å¹¶é€ æˆæ€§èƒ½ç“¶é¢ˆã€‚</p>
<p>å¦‚æžœæ‚¨ç¡®å®žæƒ³ä¿®æ”¹çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œé‚£ä¹ˆ Cocoa å’Œ POSIX éƒ½æä¾›äº†ä¸€ç§æ–¹æ³•ã€‚å¯¹äºŽ Cocoa çº¿ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨çš„<code>setThreadPriority:</code>class æ–¹æ³•<code>NSThread</code>æ¥è®¾ç½®å½“å‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚å¯¹äºŽ POSIX çº¿ç¨‹ï¼Œè¯·ä½¿ç”¨<code>pthread_setschedparam</code>å‡½æ•°ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§*<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/foundation/nsthread">NSThread ç±»å‚è€ƒ</a>*æˆ–<code>pthread_setschedparam</code>æ‰‹å†Œé¡µã€‚</p>
<h4 id="ç¼–å†™çº¿ç¨‹è¾“å…¥ä¾‹ç¨‹"><a href="#ç¼–å†™çº¿ç¨‹è¾“å…¥ä¾‹ç¨‹" class="headerlink" title="ç¼–å†™çº¿ç¨‹è¾“å…¥ä¾‹ç¨‹"></a>ç¼–å†™çº¿ç¨‹è¾“å…¥ä¾‹ç¨‹</h4><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒOS X ä¸­çº¿ç¨‹å…¥å£ç‚¹ä¾‹ç¨‹çš„ç»“æž„ä¸Žå…¶ä»–å¹³å°ä¸Šçš„ç›¸åŒã€‚æ‚¨å¯ä»¥åˆå§‹åŒ–æ•°æ®ç»“æž„ï¼Œè¿›è¡Œä¸€äº›å·¥ä½œæˆ–æœ‰é€‰æ‹©åœ°è®¾ç½®è¿è¡Œå¾ªçŽ¯ï¼Œå¹¶åœ¨çº¿ç¨‹ä»£ç å®ŒæˆåŽè¿›è¡Œæ¸…ç†ã€‚æ ¹æ®æ‚¨çš„è®¾è®¡ï¼Œç¼–å†™è¾“å…¥ä¾‹ç¨‹æ—¶å¯èƒ½éœ€è¦æ‰§è¡Œä¸€äº›å…¶ä»–æ­¥éª¤ã€‚</p>
<h6 id="åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± "><a href="#åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± " class="headerlink" title="åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± "></a>åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± </h6><p>åœ¨ Objective-C æ¡†æž¶ä¸­é“¾æŽ¥çš„åº”ç”¨ç¨‹åºé€šå¸¸å¿…é¡»åœ¨å…¶æ¯ä¸ªçº¿ç¨‹ä¸­è‡³å°‘åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ã€‚å¦‚æžœåº”ç”¨ç¨‹åºä½¿ç”¨æ‰˜ç®¡æ¨¡åž‹ï¼ˆè¯¥åº”ç”¨ç¨‹åºè´Ÿè´£å¯¹è±¡çš„ä¿ç•™å’Œé‡Šæ”¾ï¼‰ï¼Œåˆ™è‡ªåŠ¨é‡Šæ”¾æ± å°†æ•èŽ·ä»Žè¯¥çº¿ç¨‹è‡ªåŠ¨é‡Šæ”¾çš„æ‰€æœ‰å¯¹è±¡ã€‚</p>
<p>å¦‚æžœåº”ç”¨ç¨‹åºä½¿ç”¨åžƒåœ¾å›žæ”¶è€Œä¸æ˜¯æ‰˜ç®¡å†…å­˜æ¨¡åž‹ï¼Œåˆ™ä¸ä¸€å®šå¿…é¡»åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ã€‚åžƒåœ¾æ”¶é›†åº”ç”¨ç¨‹åºä¸­è‡ªåŠ¨é‡Šæ”¾æ± çš„å­˜åœ¨æ— å®³ï¼Œå¹¶ä¸”åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½å°†è¢«å¿½ç•¥ã€‚åœ¨ä»£ç æ¨¡å—å¿…é¡»åŒæ—¶æ”¯æŒåžƒåœ¾å›žæ”¶å’Œæ‰˜ç®¡å†…å­˜æ¨¡åž‹çš„æƒ…å†µä¸‹ï¼Œå…è®¸ä½¿ç”¨æ­¤æ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¿…é¡»å­˜åœ¨è‡ªåŠ¨é‡Šæ”¾æ± ä»¥æ”¯æŒæ‰˜ç®¡å†…å­˜æ¨¡åž‹ä»£ç ï¼Œå¹¶ä¸”å¦‚æžœåœ¨å¯ç”¨åžƒåœ¾å›žæ”¶çš„æƒ…å†µä¸‹è¿è¡Œåº”ç”¨ç¨‹åºï¼Œåˆ™å°†è‡ªåŠ¨å¿½ç•¥è¯¥é‡Šæ”¾æ± ã€‚</p>
<p>å¦‚æžœæ‚¨çš„åº”ç”¨ç¨‹åºä½¿ç”¨æ‰˜ç®¡å†…å­˜æ¨¡åž‹ï¼Œåˆ™åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± åº”è¯¥æ˜¯æ‚¨åœ¨çº¿ç¨‹è¾“å…¥ä¾‹ç¨‹ä¸­è¦åšçš„ç¬¬ä¸€ä»¶äº‹ã€‚åŒæ ·ï¼Œé”€æ¯æ­¤è‡ªåŠ¨é‡Šæ”¾æ± åº”è¯¥æ˜¯çº¿ç¨‹ä¸­çš„æœ€åŽä¸€ä»¶äº‹ã€‚è¯¥æ± ç¡®ä¿æ•èŽ·è‡ªåŠ¨é‡Šæ”¾çš„å¯¹è±¡ï¼Œå°½ç®¡å®ƒç›´åˆ°çº¿ç¨‹æœ¬èº«é€€å‡ºæ‰é‡Šæ”¾å®ƒä»¬ã€‚æ¸…å• 2-2 æ˜¾ç¤ºäº†ä½¿ç”¨è‡ªåŠ¨é‡Šæ”¾æ± çš„åŸºæœ¬çº¿ç¨‹è¾“å…¥ä¾‹ç¨‹çš„ç»“æž„ã€‚</p>
<p><strong>æ¸…å• 2-2</strong> å®šä¹‰çº¿ç¨‹å…¥å£ç‚¹ä¾‹ç¨‹</p>
<table>
<thead>
<tr>
<th><code>-ï¼ˆæ— æ•ˆï¼‰myThreadMainRoutine</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>NSAutoreleasePool * pool = [[NSAutoreleasePool alloc] init]; //é¡¶çº§æ± </code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//åœ¨è¿™é‡Œåšçº¿ç¨‹å·¥ä½œã€‚</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>[æ± é‡Šæ”¾]; //é‡Šæ”¾æ± ä¸­çš„å¯¹è±¡ã€‚</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>ç”±äºŽé¡¶çº§è‡ªåŠ¨é‡Šæ”¾æ± åœ¨çº¿ç¨‹é€€å‡ºä¹‹å‰ä¸ä¼šé‡Šæ”¾å…¶å¯¹è±¡ï¼Œå› æ­¤é•¿å¯¿å‘½çš„çº¿ç¨‹åº”åˆ›å»ºå…¶ä»–è‡ªåŠ¨é‡Šæ”¾æ± ä»¥æ›´é¢‘ç¹åœ°é‡Šæ”¾å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨è¿è¡Œå¾ªçŽ¯çš„çº¿ç¨‹å¯èƒ½æ¯æ¬¡é€šè¿‡è¯¥è¿è¡Œå¾ªçŽ¯éƒ½ä¼šåˆ›å»ºå¹¶é‡Šæ”¾ä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ã€‚æ›´é¢‘ç¹åœ°é‡Šæ”¾å¯¹è±¡å¯ä»¥é˜²æ­¢åº”ç”¨ç¨‹åºçš„å†…å­˜å ç”¨é‡è¿‡å¤§ï¼Œä»Žè€Œå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚ä½†æ˜¯ï¼Œä¸Žä»»ä½•ä¸Žæ€§èƒ½ç›¸å…³çš„è¡Œä¸ºä¸€æ ·ï¼Œæ‚¨åº”è¯¥æµ‹é‡ä»£ç çš„å®žé™…æ€§èƒ½ï¼Œå¹¶é€‚å½“è°ƒæ•´è‡ªåŠ¨é‡Šæ”¾æ± çš„ä½¿ç”¨ã€‚</p>
<p>æœ‰å…³å†…å­˜ç®¡ç†å’Œè‡ªåŠ¨é‡Šæ”¾æ± çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ã€Š_<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/MemoryMgmt/Articles/MemoryMgmt.html#//apple_ref/doc/uid/10000011i">é«˜çº§å†…å­˜ç®¡ç†ç¼–ç¨‹æŒ‡å—ã€‹</a>_ã€‚</p>
<h6 id="è®¾ç½®å¼‚å¸¸å¤„ç†ç¨‹åº"><a href="#è®¾ç½®å¼‚å¸¸å¤„ç†ç¨‹åº" class="headerlink" title="è®¾ç½®å¼‚å¸¸å¤„ç†ç¨‹åº"></a>è®¾ç½®å¼‚å¸¸å¤„ç†ç¨‹åº</h6><p>å¦‚æžœæ‚¨çš„åº”ç”¨ç¨‹åºæ•èŽ·å¹¶å¤„ç†äº†å¼‚å¸¸ï¼Œåˆ™åº”å‡†å¤‡å¥½çº¿ç¨‹ä»£ç ä»¥æ•èŽ·å¯èƒ½å‘ç”Ÿçš„ä»»ä½•å¼‚å¸¸ã€‚å°½ç®¡æœ€å¥½åœ¨å¯èƒ½å‘ç”Ÿå¼‚å¸¸çš„åœ°æ–¹å¤„ç†å¼‚å¸¸ï¼Œä½†æ˜¯æœªèƒ½æ•èŽ·çº¿ç¨‹ä¸­å¼•å‘çš„å¼‚å¸¸ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºé€€å‡ºã€‚åœ¨çº¿ç¨‹è¾“å…¥ä¾‹ç¨‹ä¸­å®‰è£…æœ€ç»ˆçš„ try / catch å¯ä»¥æ•èŽ·ä»»ä½•æœªçŸ¥çš„å¼‚å¸¸å¹¶æä¾›é€‚å½“çš„å“åº”ã€‚</p>
<p>åœ¨ Xcode ä¸­æž„å»ºé¡¹ç›®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ C ++æˆ– Objective-C å¼‚å¸¸å¤„ç†æ ·å¼ã€‚æœ‰å…³åœ¨ Objective-C ä¸­è®¾ç½®å¦‚ä½•å¼•å‘å’Œæ•èŽ·å¼‚å¸¸çš„ä¿¡æ¯ï¼Œè¯·å‚è§*<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Exceptions/Exceptions.html#//apple_ref/doc/uid/10000012i">å¼‚å¸¸ç¼–ç¨‹ä¸»é¢˜</a>*ã€‚</p>
<h6 id="è®¾ç½®è¿è¡Œå¾ªçŽ¯"><a href="#è®¾ç½®è¿è¡Œå¾ªçŽ¯" class="headerlink" title="è®¾ç½®è¿è¡Œå¾ªçŽ¯"></a>è®¾ç½®è¿è¡Œå¾ªçŽ¯</h6><p>åœ¨ç¼–å†™è¦åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸Šè¿è¡Œçš„ä»£ç æ—¶ï¼Œæœ‰ä¸¤ä¸ªé€‰æ‹©ã€‚ç¬¬ä¸€ç§é€‰æ‹©æ˜¯å°†çº¿ç¨‹çš„ä»£ç ç¼–å†™ä¸ºä¸€ä¸ªå¾ˆé•¿çš„ä»»åŠ¡è€Œå‡ ä¹Žä¸ä¸­æ–­æ‰§è¡Œï¼Œä¹Ÿä¸ä¼šä¸­æ–­ï¼Œå¹¶åœ¨å®Œæˆæ—¶é€€å‡ºçº¿ç¨‹ã€‚ç¬¬äºŒç§é€‰æ‹©æ˜¯å°†æ‚¨çš„çº¿ç¨‹ç½®äºŽå¾ªçŽ¯ä¸­ï¼Œå¹¶ä½¿å…¶åœ¨åˆ°è¾¾è¯·æ±‚æ—¶åŠ¨æ€å¤„ç†è¯·æ±‚ã€‚ç¬¬ä¸€ä¸ªé€‰é¡¹ä¸éœ€è¦ä¸ºæ‚¨çš„ä»£ç è¿›è¡Œç‰¹æ®Šè®¾ç½®ã€‚æ‚¨åªéœ€å¼€å§‹åšæ‚¨æƒ³åšçš„å·¥ä½œã€‚ä½†æ˜¯ï¼Œç¬¬äºŒä¸ªé€‰é¡¹æ¶‰åŠè®¾ç½®çº¿ç¨‹çš„è¿è¡Œå¾ªçŽ¯ã€‚</p>
<p>OS X å’Œ iOS ä¸ºåœ¨æ¯ä¸ªçº¿ç¨‹ä¸­å®žçŽ°è¿è¡Œå¾ªçŽ¯æä¾›äº†å†…ç½®æ”¯æŒã€‚åº”ç”¨ç¨‹åºæ¡†æž¶ä¼šè‡ªåŠ¨å¯åŠ¨åº”ç”¨ç¨‹åºä¸»çº¿ç¨‹çš„è¿è¡Œå¾ªçŽ¯ã€‚å¦‚æžœåˆ›å»ºä»»ä½•è¾…åŠ©çº¿ç¨‹ï¼Œåˆ™å¿…é¡»é…ç½®è¿è¡Œå¾ªçŽ¯å¹¶æ‰‹åŠ¨å¯åŠ¨å®ƒã€‚</p>
<p>æœ‰å…³ä½¿ç”¨å’Œé…ç½®è¿è¡Œå¾ªçŽ¯çš„ä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW1">â€œè¿è¡Œå¾ªçŽ¯â€</a>ã€‚</p>
<h4 id="ç»ˆæ­¢çº¿ç¨‹"><a href="#ç»ˆæ­¢çº¿ç¨‹" class="headerlink" title="ç»ˆæ­¢çº¿ç¨‹"></a>ç»ˆæ­¢çº¿ç¨‹</h4><p>å»ºè®®çš„é€€å‡ºçº¿ç¨‹çš„æ–¹æ³•æ˜¯è®©å…¶æ­£å¸¸é€€å‡ºå…¶å…¥å£ç‚¹ä¾‹ç¨‹ã€‚å°½ç®¡ Cocoaï¼ŒPOSIX å’Œ Multiprocessing Services æä¾›äº†ç›´æŽ¥æ€æ­»çº¿ç¨‹çš„ä¾‹ç¨‹ï¼Œä½†å¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨æ­¤ç±»ä¾‹ç¨‹ã€‚æ€æ­»çº¿ç¨‹å¯é˜²æ­¢è¯¥çº¿ç¨‹åœ¨å…¶è‡ªèº«æ¸…é™¤åŽæ¸…ç†ã€‚çº¿ç¨‹åˆ†é…çš„å†…å­˜å¯èƒ½ä¼šæ³„æ¼ï¼Œçº¿ç¨‹å½“å‰æ­£åœ¨ä½¿ç”¨çš„ä»»ä½•å…¶ä»–èµ„æºå¯èƒ½æ— æ³•æ­£ç¡®æ¸…ç†ï¼Œä»Žè€Œåœ¨ä»¥åŽäº§ç”Ÿæ½œåœ¨çš„é—®é¢˜ã€‚</p>
<p>å¦‚æžœæ‚¨é¢„è®¡éœ€è¦åœ¨æ“ä½œè¿‡ç¨‹ä¸­ç»ˆæ­¢çº¿ç¨‹ï¼Œåˆ™åº”ä»Žä¸€å¼€å§‹å°±è®¾è®¡çº¿ç¨‹ä»¥å“åº”å–æ¶ˆæˆ–é€€å‡ºæ¶ˆæ¯ã€‚å¯¹äºŽé•¿æ—¶é—´è¿è¡Œçš„æ“ä½œï¼Œè¿™å¯èƒ½æ„å‘³ç€è¦å®šæœŸåœæ­¢å·¥ä½œå¹¶æ£€æŸ¥æ˜¯å¦æ”¶åˆ°æ­¤æ¶ˆæ¯ã€‚å¦‚æžœç¡®å®žæœ‰æ¶ˆæ¯è¦æ±‚çº¿ç¨‹é€€å‡ºï¼Œåˆ™è¯¥çº¿ç¨‹å°†æœ‰æœºä¼šæ‰§è¡Œæ‰€éœ€çš„æ¸…ç†å¹¶æ­£å¸¸é€€å‡ºï¼›å¦åˆ™ï¼Œå®ƒå¯ä»¥ç®€å•åœ°è¿”å›žå·¥ä½œå¹¶å¤„ç†ä¸‹ä¸€ä¸ªæ•°æ®å—ã€‚</p>
<p>å“åº”å–æ¶ˆæ¶ˆæ¯çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨è¿è¡Œå¾ªçŽ¯è¾“å…¥æºæŽ¥æ”¶æ­¤ç±»æ¶ˆæ¯ã€‚æ¸…å• 2-3 æ˜¾ç¤ºäº†è¯¥ä»£ç åœ¨çº¿ç¨‹çš„ä¸»å…¥å£ä¾‹ç¨‹ä¸­çš„å¤–è§‚ç»“æž„ã€‚ï¼ˆè¯¥ç¤ºä¾‹ä»…æ˜¾ç¤ºäº†ä¸»å¾ªçŽ¯éƒ¨åˆ†ï¼Œä¸åŒ…æ‹¬è®¾ç½®è‡ªåŠ¨é‡Šæ”¾æ± æˆ–é…ç½®è¦æ‰§è¡Œçš„å®žé™…å·¥ä½œçš„æ­¥éª¤ã€‚ï¼‰è¯¥ç¤ºä¾‹åœ¨è¿è¡Œå¾ªçŽ¯ä¸Šå®‰è£…äº†ä¸€ä¸ªè‡ªå®šä¹‰è¾“å…¥æºï¼Œè¯¥è¾“å…¥æºå¤§æ¦‚å¯ä»¥ä»Žå¦ä¸€ä¸ªæ‚¨çš„çº¿ç¨‹ï¼›æœ‰å…³è®¾ç½®è¾“å…¥æºçš„ä¿¡æ¯ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW7">é…ç½®è¿è¡Œå¾ªçŽ¯æº</a>ã€‚åœ¨å®Œæˆå…¨éƒ¨å·¥ä½œé‡çš„ä¸€éƒ¨åˆ†åŽï¼Œçº¿ç¨‹ä¼šçŸ­æš‚è¿è¡Œè¿è¡Œå¾ªçŽ¯ï¼Œä»¥æŸ¥çœ‹æ¶ˆæ¯æ˜¯å¦åˆ°è¾¾è¾“å…¥æºã€‚å¦‚æžœä¸æ˜¯ï¼Œåˆ™è¿è¡Œå¾ªçŽ¯ç«‹å³é€€å‡ºï¼Œå¹¶ä¸”å¾ªçŽ¯ç»§ç»­è¿›è¡Œä¸‹ä¸€ä¸ªå·¥ä½œå—ã€‚å› ä¸ºå¤„ç†ç¨‹åºæ— æ³•ç›´æŽ¥è®¿é—®<code>exitNow</code>å±€éƒ¨å˜é‡ï¼Œæ‰€ä»¥é€€å‡ºæ¡ä»¶é€šè¿‡çº¿ç¨‹å­—å…¸ä¸­çš„é”®å€¼å¯¹ä¼ è¾¾ã€‚</p>
<p><strong>æ¸…å• 2-3</strong> åœ¨é•¿æ—¶é—´å·¥ä½œæœŸé—´æ£€æŸ¥é€€å‡ºæ¡ä»¶</p>
<table>
<thead>
<tr>
<th><code>-ï¼ˆæ— æ•ˆï¼‰threadMainRoutine</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>BOOL moreWorkToDo = YES;</code></td>
</tr>
<tr>
<td><code>BOOL exitNow = NO;</code></td>
</tr>
<tr>
<td><code>NSRunLoop * runLoop = [NSRunLoop currentRunLoop];</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å°†exitNow BOOLæ·»åŠ åˆ°çº¿ç¨‹å­—å…¸ä¸­ã€‚</code></td>
</tr>
<tr>
<td><code>NSMutableDictionary * threadDict = [[[NSThread currentThread] threadDictionary];</code></td>
</tr>
<tr>
<td><code>[threadDict setValueï¼š[NSNumber numberWithBoolï¼šexitNow] forKeyï¼š@â€œ ThreadShouldExitNowâ€];</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å®‰è£…è¾“å…¥æºã€‚</code></td>
</tr>
<tr>
<td><code>[self myInstallCustomInputSource];</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>åŒæ—¶ï¼ˆmoreWorkToDo &amp;&amp;ï¼exitNowï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//åœ¨è¿™é‡Œåšä¸€å¤§å—å·¥ä½œã€‚</code></td>
</tr>
<tr>
<td><code>//å®ŒæˆåŽæ›´æ”¹moreWorkToDoå¸ƒå°”å€¼ã€‚</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//è¿è¡Œè¿è¡Œå¾ªçŽ¯ï¼Œä½†å¦‚æžœè¾“å…¥æºä¸ç­‰å¾…è§¦å‘ï¼Œåˆ™ç«‹å³è¶…æ—¶ã€‚</code></td>
</tr>
<tr>
<td><code>[runLoop runUntilDateï¼š[NSDate date]];</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//æ£€æŸ¥è¾“å…¥æºå¤„ç†ç¨‹åºæ˜¯å¦æ›´æ”¹äº†exitNowå€¼ã€‚</code></td>
</tr>
<tr>
<td><code>exitNow = [[threadDict valueForKeyï¼š@â€œ ThreadShouldExitNowâ€] boolValue];</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<h2 id="è¿è¡Œå¾ªçŽ¯"><a href="#è¿è¡Œå¾ªçŽ¯" class="headerlink" title="è¿è¡Œå¾ªçŽ¯"></a>è¿è¡Œå¾ªçŽ¯</h2><p>è¿è¡Œå¾ªçŽ¯æ˜¯ä¸Žçº¿ç¨‹å…³è”çš„åŸºç¡€æž¶æž„çš„ä¸€éƒ¨åˆ†ã€‚ä¸€ä¸ª<em>è¿è¡Œå¾ªçŽ¯</em>æ˜¯ä¸€ä¸ªäº‹ä»¶å¤„ç†å¾ªçŽ¯ï¼Œä½ ç”¨å®ƒæ¥å®‰æŽ’å·¥ä½œï¼Œå¹¶åè°ƒæŽ¥æ”¶ä¼ å…¥çš„äº‹ä»¶ã€‚è¿è¡Œå¾ªçŽ¯çš„ç›®çš„æ˜¯åœ¨æœ‰å·¥ä½œè¦åšæ—¶è®©çº¿ç¨‹å¿™ï¼Œè€Œåœ¨æ²¡æœ‰å·¥ä½œæ—¶è®©çº¿ç¨‹è¿›å…¥ç¡çœ çŠ¶æ€ã€‚</p>
<p>è¿è¡Œå¾ªçŽ¯ç®¡ç†ä¸æ˜¯å®Œå…¨è‡ªåŠ¨çš„ã€‚æ‚¨ä»ç„¶å¿…é¡»è®¾è®¡çº¿ç¨‹çš„ä»£ç ä»¥åœ¨é€‚å½“çš„æ—¶é—´å¯åŠ¨è¿è¡Œå¾ªçŽ¯å¹¶å“åº”ä¼ å…¥çš„äº‹ä»¶ã€‚Cocoa å’Œ Core Foundation éƒ½æä¾›äº†<em>è¿è¡Œå¾ªçŽ¯å¯¹è±¡ï¼Œ</em>ä»¥å¸®åŠ©æ‚¨é…ç½®å’Œç®¡ç†çº¿ç¨‹çš„è¿è¡Œå¾ªçŽ¯ã€‚æ‚¨çš„åº”ç”¨ç¨‹åºä¸éœ€è¦æ˜¾å¼åˆ›å»ºè¿™äº›å¯¹è±¡ã€‚æ¯ä¸ªçº¿ç¨‹ï¼ˆåŒ…æ‹¬åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ï¼‰éƒ½æœ‰ä¸€ä¸ªå…³è”çš„è¿è¡Œå¾ªçŽ¯å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œåªæœ‰è¾…åŠ©çº¿ç¨‹éœ€è¦æ˜¾å¼åœ°è¿è¡Œå…¶è¿è¡Œå¾ªçŽ¯ã€‚åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œåº”ç”¨ç¨‹åºæ¡†æž¶ä¼šè‡ªåŠ¨åœ¨ä¸»çº¿ç¨‹ä¸Šè®¾ç½®å¹¶è¿è¡Œè¿è¡Œå¾ªçŽ¯ã€‚</p>
<p>ä»¥ä¸‹å„èŠ‚æä¾›æœ‰å…³è¿è¡Œå¾ªçŽ¯ä»¥åŠå¦‚ä½•ä¸ºåº”ç”¨ç¨‹åºé…ç½®å¾ªçŽ¯çš„æ›´å¤šä¿¡æ¯ã€‚æœ‰å…³è¿è¡Œå¾ªçŽ¯å¯¹è±¡çš„å…¶ä»–ä¿¡æ¯ï¼Œè¯·å‚è§ã€Š*<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/foundation/nsrunloop">NSRunLoop ç±»å‚è€ƒã€‹</a>*å’Œã€Š_<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/corefoundation/cfrunloop">CFRunLoop å‚è€ƒã€‹</a>_ã€‚</p>
<h4 id="è¿è¡Œå¾ªçŽ¯çš„è§£å‰–"><a href="#è¿è¡Œå¾ªçŽ¯çš„è§£å‰–" class="headerlink" title="è¿è¡Œå¾ªçŽ¯çš„è§£å‰–"></a>è¿è¡Œå¾ªçŽ¯çš„è§£å‰–</h4><p>è¿è¡Œå¾ªçŽ¯éžå¸¸åƒå…¶åç§°å¬èµ·æ¥ã€‚è¿™æ˜¯æ‚¨çš„çº¿ç¨‹è¿›å…¥çš„ä¸€ä¸ªå¾ªçŽ¯ï¼Œç”¨äºŽå“åº”ä¼ å…¥äº‹ä»¶è€Œè¿è¡Œäº‹ä»¶å¤„ç†ç¨‹åºã€‚æ‚¨çš„ä»£ç æä¾›äº†ç”¨äºŽå®žçŽ°è¿è¡Œå¾ªçŽ¯çš„å®žé™…å¾ªçŽ¯éƒ¨åˆ†çš„æŽ§åˆ¶è¯­å¥-æ¢å¥è¯è¯´ï¼Œæ‚¨çš„ä»£ç æä¾›äº†é©±åŠ¨è¿è¡Œå¾ªçŽ¯çš„<code>while</code>or <code>for</code>å¾ªçŽ¯ã€‚åœ¨å¾ªçŽ¯å†…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¿è¡Œå¾ªçŽ¯å¯¹è±¡æ¥â€œè¿è¡Œâ€äº‹ä»¶å¤„ç†ä»£ç ï¼Œä»¥æŽ¥æ”¶äº‹ä»¶å¹¶è°ƒç”¨å·²å®‰è£…çš„å¤„ç†ç¨‹åºã€‚</p>
<p>è¿è¡Œå¾ªçŽ¯ä»Žä¸¤ç§ä¸åŒç±»åž‹çš„æºæŽ¥æ”¶äº‹ä»¶ã€‚<em>è¾“å…¥æº</em>ä¼ é€’å¼‚æ­¥äº‹ä»¶ï¼Œé€šå¸¸æ˜¯æ¥è‡ªå¦ä¸€ä¸ªçº¿ç¨‹æˆ–å…¶ä»–åº”ç”¨ç¨‹åºçš„æ¶ˆæ¯ã€‚<em>è®¡æ—¶å™¨æº</em>ä¼ é€’åŒæ­¥äº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶åœ¨è®¡åˆ’çš„æ—¶é—´æˆ–é‡å¤çš„é—´éš”å‘ç”Ÿã€‚ä¸¤ç§ç±»åž‹çš„æºéƒ½ä½¿ç”¨ç‰¹å®šäºŽåº”ç”¨ç¨‹åºçš„å¤„ç†ç¨‹åºä¾‹ç¨‹æ¥å¤„ç†äº‹ä»¶åˆ°è¾¾æ—¶çš„äº‹ä»¶ã€‚</p>
<p>å›¾ 3-1 æ˜¾ç¤ºäº†è¿è¡Œå¾ªçŽ¯å’Œå„ç§æ¥æºçš„æ¦‚å¿µç»“æž„ã€‚è¾“å…¥æºå°†å¼‚æ­¥äº‹ä»¶ä¼ é€’ç»™ç›¸åº”çš„å¤„ç†ç¨‹åºï¼Œå¹¶å¯¼è‡´<code>runUntilDate:</code>æ–¹æ³•ï¼ˆåœ¨çº¿ç¨‹çš„å…³è”<code>NSRunLoop</code>å¯¹è±¡ä¸Šè°ƒç”¨ï¼‰é€€å‡ºã€‚è®¡æ—¶å™¨æºå°†äº‹ä»¶ä¼ é€’åˆ°å…¶å¤„ç†ç¨‹åºä¾‹ç¨‹ï¼Œä½†ä¸ä¼šå¯¼è‡´è¿è¡Œå¾ªçŽ¯é€€å‡ºã€‚</p>
<p><strong>å›¾ 3-1</strong> è¿è¡Œå¾ªçŽ¯çš„ç»“æž„åŠå…¶æ¥æº<img src="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/Art/runloop.jpg" alt="è¿è¡Œå¾ªçŽ¯çš„ç»“æž„åŠå…¶æ¥æº"></p>
<p>é™¤äº†å¤„ç†è¾“å…¥æºä¹‹å¤–ï¼Œè¿è¡Œå¾ªçŽ¯è¿˜ç”Ÿæˆæœ‰å…³è¿è¡Œå¾ªçŽ¯è¡Œä¸ºçš„é€šçŸ¥ã€‚æ³¨å†Œçš„<em>è¿è¡Œå¾ªçŽ¯è§‚å¯Ÿè€…</em>å¯ä»¥æŽ¥æ”¶è¿™äº›é€šçŸ¥ï¼Œå¹¶ä½¿ç”¨å®ƒä»¬åœ¨çº¿ç¨‹ä¸Šè¿›è¡Œå…¶ä»–å¤„ç†ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Core Foundation åœ¨çº¿ç¨‹ä¸Šå®‰è£…è¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨ã€‚</p>
<p>ä»¥ä¸‹å„èŠ‚æä¾›æœ‰å…³è¿è¡Œå¾ªçŽ¯çš„ç»„ä»¶åŠå…¶è¿è¡Œæ–¹å¼çš„æ›´å¤šä¿¡æ¯ã€‚å®ƒä»¬è¿˜æè¿°äº†äº‹ä»¶å¤„ç†æœŸé—´åœ¨ä¸åŒæ—¶é—´ç”Ÿæˆçš„é€šçŸ¥ã€‚</p>
<h6 id="è¿è¡Œå¾ªçŽ¯æ¨¡å¼"><a href="#è¿è¡Œå¾ªçŽ¯æ¨¡å¼" class="headerlink" title="è¿è¡Œå¾ªçŽ¯æ¨¡å¼"></a>è¿è¡Œå¾ªçŽ¯æ¨¡å¼</h6><p>ä¸€ä¸ª<em>è¿è¡Œçš„å¾ªçŽ¯æ¨¡å¼</em>æ˜¯è¾“å…¥æºå’Œå®šæ—¶å™¨çš„é›†åˆè¿›è¡Œç›‘æµ‹å’Œè¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå‘˜é›†åˆé€šçŸ¥ã€‚æ¯æ¬¡è¿è¡Œè¿è¡Œå¾ªçŽ¯æ—¶ï¼Œéƒ½å¯ä»¥ï¼ˆæ˜¾å¼æˆ–éšå¼ï¼‰æŒ‡å®šè¿è¡Œçš„ç‰¹å®šâ€œæ¨¡å¼â€ã€‚åœ¨è¿è¡Œå¾ªçŽ¯çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä»…ç›‘è§†ä¸Žè¯¥æ¨¡å¼å…³è”çš„æºï¼Œå¹¶å…è®¸å…¶ä¼ é€’äº‹ä»¶ã€‚ï¼ˆç±»ä¼¼åœ°ï¼Œä»…å°†ä¸Žè¯¥æ¨¡å¼å…³è”çš„è§‚å¯Ÿè€…é€šçŸ¥è¿è¡Œå¾ªçŽ¯çš„è¿›åº¦ã€‚ï¼‰ä¸Žå…¶ä»–æ¨¡å¼å…³è”çš„æºå°†ä¿ç•™ä»»ä½•æ–°äº‹ä»¶ï¼Œç›´åˆ°éšåŽä»¥é€‚å½“çš„æ¨¡å¼é€šè¿‡å¾ªçŽ¯ã€‚</p>
<p>åœ¨ä»£ç ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡åç§°è¯†åˆ«æ¨¡å¼ã€‚Cocoa å’Œ Core Foundation éƒ½å®šä¹‰äº†é»˜è®¤æ¨¡å¼å’Œå‡ ç§å¸¸ç”¨æ¨¡å¼ï¼Œä»¥åŠç”¨äºŽåœ¨ä»£ç ä¸­æŒ‡å®šè¿™äº›æ¨¡å¼çš„å­—ç¬¦ä¸²ã€‚æ‚¨å¯ä»¥é€šè¿‡ç®€å•åœ°ä¸ºæ¨¡å¼åç§°æŒ‡å®šè‡ªå®šä¹‰å­—ç¬¦ä¸²æ¥å®šä¹‰è‡ªå®šä¹‰æ¨¡å¼ã€‚å°½ç®¡æ‚¨åˆ†é…ç»™è‡ªå®šä¹‰æ¨¡å¼çš„åç§°æ˜¯ä»»æ„çš„ï¼Œä½†æ˜¯è¿™äº›æ¨¡å¼çš„å†…å®¹ä¸æ˜¯ä»»æ„çš„ã€‚æ‚¨å¿…é¡»ç¡®ä¿å°†ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å…¥æºï¼Œè®¡æ—¶å™¨æˆ–è¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨æ·»åŠ åˆ°æ‚¨åˆ›å»ºçš„ä»»ä½•æ¨¡å¼ä¸­ï¼Œä»¥ä½¿å…¶æœ‰ç”¨ã€‚</p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨æ¨¡å¼ä»Žè¿è¡Œå¾ªçŽ¯çš„ç‰¹å®šéåŽ†ä¸­è¿‡æ»¤æŽ‰æœ‰å®³æ¥æºçš„äº‹ä»¶ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨å°†éœ€è¦åœ¨ç³»ç»Ÿå®šä¹‰çš„â€œé»˜è®¤â€æ¨¡å¼ä¸‹è¿è¡Œè¿è¡Œå¾ªçŽ¯ã€‚ä½†æ˜¯ï¼Œæ¨¡å¼é¢æ¿å¯ä»¥åœ¨â€œæ¨¡å¼â€æ¨¡å¼ä¸‹è¿è¡Œã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œåªæœ‰ä¸Žæ¨¡å¼é¢æ¿ç›¸å…³çš„æºæ‰å°†äº‹ä»¶ä¼ é€’ç»™çº¿ç¨‹ã€‚å¯¹äºŽè¾…åŠ©çº¿ç¨‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æ¨¡å¼æ¥é˜²æ­¢ä½Žä¼˜å…ˆçº§æºåœ¨æ—¶é—´ç´§è¿«çš„æ“ä½œæœŸé—´ä¼ é€’äº‹ä»¶ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong> æ¨¡å¼æ˜¯æ ¹æ®äº‹ä»¶çš„æ¥æºè€Œä¸æ˜¯äº‹ä»¶çš„ç±»åž‹æ¥åŒºåˆ†çš„ã€‚ä¾‹å¦‚ï¼Œæ‚¨ä¸ä¼šä½¿ç”¨ä»…åŒ¹é…é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶æˆ–ä»…åŒ¹é…é”®ç›˜äº‹ä»¶çš„æ¨¡å¼ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ¨¡å¼æ¥ä¾¦å¬å¦ä¸€ç»„ç«¯å£ï¼Œæš‚æ—¶æš‚åœè®¡æ—¶å™¨ï¼Œæˆ–è€…ä»¥å…¶ä»–æ–¹å¼æ›´æ”¹æºå¹¶è¿è¡Œå½“å‰æ­£åœ¨ç›‘è§†çš„å¾ªçŽ¯è§‚å¯Ÿå™¨ã€‚</p>
<p>è¡¨ 3-1 åˆ—å‡ºäº† Cocoa å’Œ Core Foundation å®šä¹‰çš„æ ‡å‡†æ¨¡å¼ï¼Œä»¥åŠä½•æ—¶ä½¿ç”¨è¯¥æ¨¡å¼çš„è¯´æ˜Žã€‚åç§°åˆ—åˆ—å‡ºäº†ç”¨äºŽåœ¨ä»£ç ä¸­æŒ‡å®šæ¨¡å¼çš„å®žé™…å¸¸é‡ã€‚</p>
<table>
<thead>
<tr>
<th align="left">æ¨¡å¼</th>
<th align="left">åç§°</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">é»˜è®¤</td>
<td align="left"><code>NSDefaultRunLoopMode</code> ï¼ˆå¯å¯ï¼‰<code>kCFRunLoopDefaultMode</code> ï¼ˆæ ¸å¿ƒåŸºé‡‘ä¼šï¼‰</td>
<td align="left">é»˜è®¤æ¨¡å¼æ˜¯ç”¨äºŽå¤§å¤šæ•°æ“ä½œçš„æ¨¡å¼ã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨æ­¤æ¨¡å¼æ¥å¯åŠ¨è¿è¡Œå¾ªçŽ¯å¹¶é…ç½®è¾“å…¥æºã€‚</td>
</tr>
<tr>
<td align="left">è¿žæŽ¥</td>
<td align="left"><code>NSConnectionReplyMode</code> ï¼ˆå¯å¯ï¼‰</td>
<td align="left">å¯å¯å°†æ­¤æ¨¡å¼ä¸Ž<code>NSConnection</code>å¯¹è±¡ç»“åˆä½¿ç”¨ä»¥ç›‘è§†ç­”å¤ã€‚æ‚¨å¾ˆå°‘éœ€è¦è‡ªå·±ä½¿ç”¨æ­¤æ¨¡å¼ã€‚</td>
</tr>
<tr>
<td align="left">æ¨¡æ€</td>
<td align="left"><code>NSModalPanelRunLoopMode</code> ï¼ˆå¯å¯ï¼‰</td>
<td align="left">å¯å¯ä½¿ç”¨æ­¤æ¨¡å¼æ¥è¯†åˆ«ç”¨äºŽæ¨¡å¼é¢æ¿çš„äº‹ä»¶ã€‚</td>
</tr>
<tr>
<td align="left">äº‹ä»¶è¿½è¸ª</td>
<td align="left"><code>NSEventTrackingRunLoopMode</code> ï¼ˆå¯å¯ï¼‰</td>
<td align="left">å¯å¯ä½¿ç”¨æ­¤æ¨¡å¼æ¥é™åˆ¶é¼ æ ‡æ‹–åŠ¨å¾ªçŽ¯å’Œå…¶ä»–ç±»åž‹çš„ç”¨æˆ·ç•Œé¢è·Ÿè¸ªå¾ªçŽ¯æœŸé—´çš„ä¼ å…¥äº‹ä»¶ã€‚</td>
</tr>
<tr>
<td align="left">æ™®é€šæ¨¡å¼</td>
<td align="left"><code>NSRunLoopCommonModes</code> ï¼ˆå¯å¯ï¼‰<code>kCFRunLoopCommonModes</code> ï¼ˆæ ¸å¿ƒåŸºé‡‘ä¼šï¼‰</td>
<td align="left">è¿™æ˜¯ä¸€ç»„å¯é…ç½®çš„å¸¸ç”¨æ¨¡å¼ã€‚å°†è¾“å…¥æºä¸Žæ­¤æ¨¡å¼ç›¸å…³è”è¿˜å°†å…¶ä¸Žç»„ä¸­çš„æ¯ä¸ªæ¨¡å¼ç›¸å…³è”ã€‚å¯¹äºŽ Cocoa åº”ç”¨ç¨‹åºï¼Œæ­¤é›†åˆé»˜è®¤åŒ…æ‹¬é»˜è®¤ï¼Œæ¨¡å¼å’Œäº‹ä»¶è·Ÿè¸ªæ¨¡å¼ã€‚æœ€åˆï¼ŒCore Foundation ä»…åŒ…æ‹¬é»˜è®¤æ¨¡å¼ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è¯¥<code>CFRunLoopAddCommonMode</code>åŠŸèƒ½å°†è‡ªå®šä¹‰æ¨¡å¼æ·»åŠ åˆ°é›†åˆä¸­ã€‚</td>
</tr>
</tbody></table>
<h6 id="è¾“å…¥æº"><a href="#è¾“å…¥æº" class="headerlink" title="è¾“å…¥æº"></a>è¾“å…¥æº</h6><p>è¾“å…¥æºå°†äº‹ä»¶å¼‚æ­¥ä¼ é€’åˆ°æ‚¨çš„çº¿ç¨‹ã€‚äº‹ä»¶çš„æ¥æºå–å†³äºŽè¾“å…¥æ¥æºçš„ç±»åž‹ï¼Œé€šå¸¸æ˜¯ä¸¤ä¸ªç±»åˆ«ä¹‹ä¸€ã€‚åŸºäºŽç«¯å£çš„è¾“å…¥æºç›‘è§†æ‚¨çš„åº”ç”¨ç¨‹åºçš„ Mach ç«¯å£ã€‚å®šåˆ¶è¾“å…¥æºç›‘è§†äº‹ä»¶çš„å®šåˆ¶æºã€‚å°±æ‚¨çš„è¿è¡Œå¾ªçŽ¯è€Œè¨€ï¼Œè¾“å…¥æºæ˜¯åŸºäºŽç«¯å£çš„è¿˜æ˜¯å®šåˆ¶çš„éƒ½æ— å…³ç´§è¦ã€‚ç³»ç»Ÿé€šå¸¸å®žçŽ°ä¸¤ç§ç±»åž‹çš„è¾“å…¥æºï¼Œæ‚¨å¯ä»¥æŒ‰åŽŸæ ·ä½¿ç”¨ã€‚ä¸¤ç§ä¿¡å·æºä¹‹é—´çš„å”¯ä¸€åŒºåˆ«æ˜¯ä¿¡å·çš„å‘é€æ–¹å¼ã€‚åŸºäºŽç«¯å£çš„æºç”±å†…æ ¸è‡ªåŠ¨å‘å‡ºä¿¡å·ï¼Œè€Œè‡ªå®šä¹‰æºå¿…é¡»ä»Žå¦ä¸€ä¸ªçº¿ç¨‹æ‰‹åŠ¨å‘å‡ºä¿¡å·ã€‚</p>
<p>åˆ›å»ºè¾“å…¥æºæ—¶ï¼Œå¯ä»¥å°†å…¶åˆ†é…ç»™è¿è¡Œå¾ªçŽ¯çš„ä¸€ç§æˆ–å¤šç§æ¨¡å¼ã€‚æ¨¡å¼ä¼šå½±å“åœ¨ä»»ä½•ç»™å®šæ—¶åˆ»ç›‘è§†å“ªäº›è¾“å…¥æºã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨ä¼šåœ¨é»˜è®¤æ¨¡å¼ä¸‹è¿è¡Œè¿è¡Œå¾ªçŽ¯ï¼Œä½†ä¹Ÿå¯ä»¥æŒ‡å®šè‡ªå®šä¹‰æ¨¡å¼ã€‚å¦‚æžœè¾“å…¥æºä¸åœ¨å½“å‰ç›‘è§†çš„æ¨¡å¼ä¸‹ï¼Œåˆ™å®ƒç”Ÿæˆçš„ä»»ä½•äº‹ä»¶éƒ½å°†ä¿ç•™ï¼Œç›´åˆ°è¿è¡Œå¾ªçŽ¯ä»¥æ­£ç¡®çš„æ¨¡å¼è¿è¡Œã€‚</p>
<p>ä»¥ä¸‹å„èŠ‚æè¿°äº†ä¸€äº›è¾“å…¥æºã€‚</p>
<p>######## åŸºäºŽç«¯å£çš„æº</p>
<p>Cocoa å’Œ Core Foundation æä¾›äº†å†…ç½®æ”¯æŒï¼Œç”¨äºŽä½¿ç”¨ä¸Žç«¯å£ç›¸å…³çš„å¯¹è±¡å’ŒåŠŸèƒ½åˆ›å»ºåŸºäºŽç«¯å£çš„è¾“å…¥æºã€‚ä¾‹å¦‚ï¼Œåœ¨å¯å¯ä¸­ï¼Œæ‚¨æ ¹æœ¬ä¸å¿…ç›´æŽ¥åˆ›å»ºè¾“å…¥æºã€‚æ‚¨åªéœ€åˆ›å»ºä¸€ä¸ªç«¯å£å¯¹è±¡ï¼Œç„¶åŽä½¿ç”¨çš„æ–¹æ³•<code>NSPort</code>å°†è¯¥ç«¯å£æ·»åŠ åˆ°è¿è¡Œå¾ªçŽ¯ä¸­ã€‚ç«¯å£å¯¹è±¡ä¸ºæ‚¨å¤„ç†æ‰€éœ€è¾“å…¥æºçš„åˆ›å»ºå’Œé…ç½®ã€‚</p>
<p>åœ¨ Core Foundation ä¸­ï¼Œæ‚¨å¿…é¡»æ‰‹åŠ¨åˆ›å»ºç«¯å£åŠå…¶è¿è¡Œå¾ªçŽ¯æºã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ‚¨ä½¿ç”¨çš„ç«¯å£ç±»åž‹ä¸é€æ˜Žï¼ˆç›¸å…³çš„åŠŸèƒ½<code>CFMachPortRef</code>ï¼Œ<code>CFMessagePortRef</code>æˆ–<code>CFSocketRef</code>ï¼‰åˆ›å»ºåˆé€‚çš„å¯¹è±¡ã€‚</p>
<p>æœ‰å…³å¦‚ä½•è®¾ç½®å’Œé…ç½®åŸºäºŽç«¯å£çš„è‡ªå®šä¹‰æºçš„ç¤ºä¾‹ï¼Œè¯·å‚é˜…â€œ <a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-131281">é…ç½®åŸºäºŽç«¯å£çš„è¾“å…¥æºâ€</a>ã€‚</p>
<p>######## è‡ªå®šä¹‰è¾“å…¥æº</p>
<p>è¦åˆ›å»ºè‡ªå®šä¹‰è¾“å…¥æºï¼Œå¿…é¡»ä½¿ç”¨ä¸Ž<code>CFRunLoopSourceRef</code>Core Foundation ä¸­çš„ä¸é€æ˜Žç±»åž‹å…³è”çš„åŠŸèƒ½ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å¤šä¸ªå›žè°ƒå‡½æ•°é…ç½®è‡ªå®šä¹‰è¾“å…¥æºã€‚å½“ä»Žè¿è¡Œå¾ªçŽ¯ä¸­åˆ é™¤æºæ—¶ï¼ŒCore Foundation ä¼šåœ¨ä¸åŒä½ç½®è°ƒç”¨è¿™äº›å‡½æ•°ä»¥é…ç½®æºï¼Œå¤„ç†æ‰€æœ‰ä¼ å…¥äº‹ä»¶å¹¶æ‹†é™¤æºã€‚</p>
<p>é™¤äº†å®šä¹‰äº‹ä»¶åˆ°è¾¾æ—¶è‡ªå®šä¹‰æºçš„è¡Œä¸ºå¤–ï¼Œè¿˜å¿…é¡»å®šä¹‰äº‹ä»¶ä¼ é€’æœºåˆ¶ã€‚æºä»£ç çš„è¿™ä¸€éƒ¨åˆ†åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸Šè¿è¡Œï¼Œè´Ÿè´£ä¸ºè¾“å…¥æºæä¾›å…¶æ•°æ®ï¼Œå¹¶åœ¨å‡†å¤‡å¥½å¤„ç†æ•°æ®æ—¶å‘å…¶å‘å‡ºä¿¡å·ã€‚äº‹ä»¶ä¼ é€’æœºåˆ¶å–å†³äºŽæ‚¨ï¼Œä½†ä¸å¿…è¿‡äºŽå¤æ‚ã€‚</p>
<p>æœ‰å…³å¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰è¾“å…¥æºçš„ç¤ºä¾‹ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW3">å®šä¹‰è‡ªå®šä¹‰è¾“å…¥æº</a>ã€‚æœ‰å…³è‡ªå®šä¹‰è¾“å…¥æºçš„å‚è€ƒä¿¡æ¯ï¼Œå¦è¯·å‚è§*<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/corefoundation/cfrunloopsource-rhr">CFRunLoopSource å‚è€ƒ</a>*ã€‚</p>
<p>######## å¯å¯æ‰§è¡Œé€‰æ‹©å™¨æ¥æº</p>
<p>é™¤äº†åŸºäºŽç«¯å£çš„æºä»£ç å¤–ï¼ŒCocoa è¿˜å®šä¹‰äº†ä¸€ä¸ªè‡ªå®šä¹‰è¾“å…¥æºï¼Œä½¿æ‚¨å¯ä»¥åœ¨ä»»ä½•çº¿ç¨‹ä¸Šæ‰§è¡Œé€‰æ‹©å™¨ã€‚åƒåŸºäºŽç«¯å£çš„æºä¸€æ ·ï¼Œæ‰§è¡Œé€‰æ‹©å™¨è¯·æ±‚åœ¨ç›®æ ‡çº¿ç¨‹ä¸Šè¢«åºåˆ—åŒ–ï¼Œä»Žè€Œå‡è½»äº†åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šè¿è¡Œå¤šä¸ªæ–¹æ³•æ—¶å¯èƒ½å‘ç”Ÿçš„è®¸å¤šåŒæ­¥é—®é¢˜ã€‚ä¸ŽåŸºäºŽç«¯å£çš„æºä¸åŒï¼Œæ‰§è¡Œé€‰æ‹©å™¨æºåœ¨æ‰§è¡Œé€‰æ‹©å™¨åŽå°†å…¶è‡ªèº«ä»Žè¿è¡Œå¾ªçŽ¯ä¸­åˆ é™¤ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong> åœ¨ OS X v10.5 ä¹‹å‰ï¼Œæ‰§è¡Œé€‰æ‹©å™¨æºä¸»è¦ç”¨äºŽå°†æ¶ˆæ¯å‘é€åˆ°ä¸»çº¿ç¨‹ï¼Œä½†æ˜¯åœ¨ OS X v10.5 å’Œæ›´é«˜ç‰ˆæœ¬ä»¥åŠ iOS ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å®ƒä»¬å°†æ¶ˆæ¯å‘é€åˆ°ä»»ä½•çº¿ç¨‹ã€‚</p>
<p>åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œé€‰æ‹©å™¨æ—¶ï¼Œç›®æ ‡çº¿ç¨‹å¿…é¡»å…·æœ‰æ´»åŠ¨çš„è¿è¡Œå¾ªçŽ¯ã€‚å¯¹äºŽæ‚¨åˆ›å»ºçš„çº¿ç¨‹ï¼Œè¿™æ„å‘³ç€ç­‰åˆ°æ‚¨çš„ä»£ç æ˜¾å¼å¯åŠ¨è¿è¡Œå¾ªçŽ¯ã€‚ä½†æ˜¯ï¼Œç”±äºŽä¸»çº¿ç¨‹å¯åŠ¨äº†è‡ªå·±çš„è¿è¡Œå¾ªçŽ¯ï¼Œå› æ­¤æ‚¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºè°ƒç”¨<code>applicationDidFinishLaunching:</code>åº”ç”¨ç¨‹åºå§”æ‰˜çš„æ–¹æ³•åŽç«‹å³å¼€å§‹åœ¨è¯¥çº¿ç¨‹ä¸Šå‘å‡ºè°ƒç”¨ ã€‚æ¯æ¬¡å¾ªçŽ¯æ—¶ï¼Œè¿è¡Œå¾ªçŽ¯éƒ½ä¼šå¤„ç†æ‰€æœ‰æŽ’é˜Ÿçš„æ‰§è¡Œé€‰æ‹©å™¨è°ƒç”¨ï¼Œè€Œä¸æ˜¯åœ¨æ¯æ¬¡å¾ªçŽ¯è¿­ä»£æ—¶éƒ½å¤„ç†ä¸€ä¸ªã€‚</p>
<p>è¡¨ 3-2 åˆ—å‡ºäº†<code>NSObject</code>å¯åœ¨å…¶ä»–çº¿ç¨‹ä¸Šæ‰§è¡Œé€‰æ‹©å™¨çš„æ–¹æ³•ã€‚ç”±äºŽè¿™äº›æ–¹æ³•æ˜¯åœ¨ä¸Šå£°æ˜Žçš„<code>NSObject</code>ï¼Œå› æ­¤å¯ä»¥åœ¨å¯ä»¥è®¿é—® Objective-C å¯¹è±¡çš„ä»»ä½•çº¿ç¨‹ï¼ˆåŒ…æ‹¬ POSIX çº¿ç¨‹ï¼‰ä¸­ä½¿ç”¨å®ƒä»¬ã€‚è¿™äº›æ–¹æ³•å®žé™…ä¸Šä¸ä¼šåˆ›å»ºæ–°çº¿ç¨‹æ¥æ‰§è¡Œé€‰æ‹©å™¨ã€‚</p>
<table>
<thead>
<tr>
<th align="left">æ–¹æ³•</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>performSelectorOnMainThread:withObject:waitUntilDone:``performSelectorOnMainThread:withObject:waitUntilDone:modes:</code></td>
<td align="left">åœ¨è¯¥çº¿ç¨‹çš„ä¸‹ä¸€ä¸ªè¿è¡Œå¾ªçŽ¯å‘¨æœŸå†…ï¼Œåœ¨è¯¥åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ä¸Šæ‰§è¡ŒæŒ‡å®šçš„é€‰æ‹©å™¨ã€‚è¿™äº›æ–¹æ³•ä½¿æ‚¨å¯ä»¥é€‰æ‹©é˜»å¡žå½“å‰çº¿ç¨‹ï¼Œç›´åˆ°æ‰§è¡Œé€‰æ‹©å™¨ä¸ºæ­¢ã€‚</td>
</tr>
<tr>
<td align="left"><code>performSelector:onThread:withObject:waitUntilDone:``performSelector:onThread:withObject:waitUntilDone:modes:</code></td>
<td align="left">åœ¨å…·æœ‰<code>NSThread</code>å¯¹è±¡çš„ä»»ä½•çº¿ç¨‹ä¸Šæ‰§è¡ŒæŒ‡å®šçš„é€‰æ‹©å™¨ã€‚è¿™äº›æ–¹æ³•ä½¿æ‚¨å¯ä»¥é€‰æ‹©é˜»å¡žå½“å‰çº¿ç¨‹ï¼Œç›´åˆ°æ‰§è¡Œé€‰æ‹©å™¨ä¸ºæ­¢ã€‚</td>
</tr>
<tr>
<td align="left"><code>performSelector:withObject:afterDelay:``performSelector:withObject:afterDelay:inModes:</code></td>
<td align="left">åœ¨ä¸‹ä¸€ä¸ªè¿è¡Œå¾ªçŽ¯å‘¨æœŸå’Œä¸€ä¸ªå¯é€‰çš„å»¶è¿Ÿæ—¶é—´ä¹‹åŽï¼Œåœ¨å½“å‰çº¿ç¨‹ä¸Šæ‰§è¡ŒæŒ‡å®šçš„é€‰æ‹©å™¨ã€‚å› ä¸ºå®ƒä¸€ç›´ç­‰åˆ°ä¸‹ä¸€ä¸ªè¿è¡Œå¾ªçŽ¯å‘¨æœŸæ‰§è¡Œé€‰æ‹©å™¨ï¼Œæ‰€ä»¥è¿™äº›æ–¹æ³•æä¾›äº†å½“å‰æ‰§è¡Œä»£ç çš„æœ€å°è‡ªåŠ¨å»¶è¿Ÿã€‚å¤šä¸ªæŽ’é˜Ÿçš„é€‰æ‹©å™¨æŒ‰ç…§æŽ’é˜Ÿçš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</td>
</tr>
<tr>
<td align="left"><code>cancelPreviousPerformRequestsWithTarget:``cancelPreviousPerformRequestsWithTarget:selector:object:</code></td>
<td align="left">ä½¿æ‚¨å¯ä»¥ä½¿ç”¨<code>performSelector:withObject:afterDelay:</code>or <code>performSelector:withObject:afterDelay:inModes:</code>æ–¹æ³•å–æ¶ˆå‘é€åˆ°å½“å‰çº¿ç¨‹çš„æ¶ˆæ¯ã€‚</td>
</tr>
</tbody></table>
<p>æœ‰å…³æ¯ç§æ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ã€Š_<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/objectivec/nsobject">NSObject ç±»å‚è€ƒã€‹</a>_ã€‚</p>
<h6 id="è®¡æ—¶å™¨æ¥æº"><a href="#è®¡æ—¶å™¨æ¥æº" class="headerlink" title="è®¡æ—¶å™¨æ¥æº"></a>è®¡æ—¶å™¨æ¥æº</h6><p>è®¡æ—¶å™¨æºåœ¨å°†æ¥çš„é¢„è®¾æ—¶é—´å°†äº‹ä»¶åŒæ­¥ä¼ é€’åˆ°æ‚¨çš„çº¿ç¨‹ã€‚è®¡æ—¶å™¨æ˜¯çº¿ç¨‹é€šçŸ¥è‡ªå·±æ‰§è¡ŒæŸäº‹çš„ä¸€ç§æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œä¸€æ—¦åœ¨æ¥è‡ªç”¨æˆ·çš„è¿žç»­å‡»é”®ä¹‹é—´ç»è¿‡äº†ä¸€å®šçš„æ—¶é—´é‡ï¼Œåˆ™æœç´¢å­—æ®µå¯ä»¥ä½¿ç”¨è®¡æ—¶å™¨æ¥å¯åŠ¨è‡ªåŠ¨æœç´¢ã€‚ä½¿ç”¨æ­¤å»¶è¿Ÿæ—¶é—´ä½¿ç”¨æˆ·æœ‰æœºä¼šåœ¨å¼€å§‹æœç´¢ä¹‹å‰é”®å…¥å°½å¯èƒ½å¤šçš„æ‰€éœ€æœç´¢å­—ç¬¦ä¸²ã€‚</p>
<p>å°½ç®¡è®¡æ—¶å™¨ç”ŸæˆåŸºäºŽæ—¶é—´çš„é€šçŸ¥ï¼Œä½†å®ƒä¸æ˜¯å®žæ—¶æœºåˆ¶ã€‚åƒè¾“å…¥æºä¸€æ ·ï¼Œè®¡æ—¶å™¨ä¸Žè¿è¡Œå¾ªçŽ¯çš„ç‰¹å®šæ¨¡å¼ç›¸å…³è”ã€‚å¦‚æžœè®¡æ—¶å™¨ä¸åœ¨è¿è¡Œå¾ªçŽ¯å½“å‰æ­£åœ¨ç›‘è§†çš„æ¨¡å¼ä¸‹ï¼Œåˆ™åœ¨æ‚¨ä»¥è®¡æ—¶å™¨æ”¯æŒçš„ä¸€ç§æ¨¡å¼è¿è¡Œè¿è¡Œå¾ªçŽ¯ä¹‹å‰ï¼Œå®ƒä¸ä¼šè§¦å‘ã€‚åŒæ ·ï¼Œå¦‚æžœè¿è¡Œå¾ªçŽ¯åœ¨æ‰§è¡Œå¤„ç†ç¨‹åºä¾‹ç¨‹çš„ä¸­é—´è§¦å‘è®¡æ—¶å™¨ï¼Œåˆ™è®¡æ—¶å™¨å°†ç­‰åˆ°ä¸‹ä¸€æ¬¡é€šè¿‡è¿è¡Œå¾ªçŽ¯è°ƒç”¨å…¶å¤„ç†ä¾‹ç¨‹ã€‚å¦‚æžœè¿è¡Œå¾ªçŽ¯æ ¹æœ¬æ²¡æœ‰è¿è¡Œï¼Œåˆ™è®¡æ—¶å™¨æ°¸è¿œä¸ä¼šè§¦å‘ã€‚</p>
<p>æ‚¨å¯ä»¥å°†è®¡æ—¶å™¨é…ç½®ä¸ºä»…ä¸€æ¬¡æˆ–é‡å¤ç”Ÿæˆäº‹ä»¶ã€‚é‡å¤è®¡æ—¶å™¨ä¼šæ ¹æ®è®¡åˆ’çš„è§¦å‘æ—¶é—´ï¼ˆè€Œä¸æ˜¯å®žé™…çš„è§¦å‘æ—¶é—´ï¼‰è‡ªåŠ¨é‡æ–°è®¡åˆ’è‡ªèº«ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœè®¡åˆ’å°†è®¡æ—¶å™¨åœ¨ç‰¹å®šæ—¶é—´è§¦å‘ï¼Œç„¶åŽæ¯ 5 ç§’è§¦å‘ä¸€æ¬¡ï¼Œåˆ™å³ä½¿å®žé™…è§¦å‘æ—¶é—´è¢«å»¶è¿Ÿï¼Œè®¡åˆ’çš„è§¦å‘æ—¶é—´ä¹Ÿå°†å§‹ç»ˆè½åœ¨åŽŸå§‹çš„ 5 ç§’æ—¶é—´é—´éš”ä¸Šã€‚å¦‚æžœè§¦å‘æ—¶é—´å»¶è¿Ÿå¾—å¤ªå¤šï¼Œä»¥è‡´é”™è¿‡äº†ä¸€ä¸ªæˆ–å¤šä¸ªè®¡åˆ’çš„è§¦å‘æ—¶é—´ï¼Œåˆ™è®¡æ—¶å™¨å°†åœ¨é”™è¿‡çš„æ—¶é—´æ®µå†…ä»…è§¦å‘ä¸€æ¬¡ã€‚åœ¨é”™è¿‡äº†ä¸€æ®µæ—¶é—´åŽè§¦å‘åŽï¼Œè®¡æ—¶å™¨å°†é‡æ–°å®‰æŽ’ä¸ºä¸‹ä¸€ä¸ªè®¡åˆ’çš„è§¦å‘æ—¶é—´ã€‚</p>
<p>æœ‰å…³é…ç½®è®¡æ—¶å™¨æºçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§â€œ <a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW6">é…ç½®è®¡æ—¶å™¨æºâ€</a>ã€‚æœ‰å…³å‚è€ƒä¿¡æ¯ï¼Œè¯·å‚è§ã€Š*<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/foundation/timer">NSTimer ç±»å‚è€ƒã€‹</a>*æˆ–ã€Š_<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/corefoundation/cfrunlooptimer-rhk">CFRunLoopTimer å‚è€ƒã€‹</a>_ã€‚</p>
<h6 id="è¿è¡Œå¾ªçŽ¯è§‚å¯Ÿè€…"><a href="#è¿è¡Œå¾ªçŽ¯è§‚å¯Ÿè€…" class="headerlink" title="è¿è¡Œå¾ªçŽ¯è§‚å¯Ÿè€…"></a>è¿è¡Œå¾ªçŽ¯è§‚å¯Ÿè€…</h6><p>ä¸Žåœ¨é€‚å½“çš„å¼‚æ­¥æˆ–åŒæ­¥äº‹ä»¶å‘ç”Ÿæ—¶è§¦å‘çš„æºç›¸åï¼Œè¿è¡Œå¾ªçŽ¯è§‚å¯Ÿè€…åœ¨è¿è¡Œå¾ªçŽ¯æœ¬èº«æ‰§è¡ŒæœŸé—´çš„ç‰¹å®šä½ç½®è§¦å‘ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨æ¥å‡†å¤‡çº¿ç¨‹ä»¥å¤„ç†ç»™å®šäº‹ä»¶ï¼Œæˆ–è€…åœ¨çº¿ç¨‹è¿›å…¥ç¡çœ ä¹‹å‰å‡†å¤‡çº¿ç¨‹ã€‚æ‚¨å¯ä»¥å°†è¿è¡Œå¾ªçŽ¯è§‚å¯Ÿè€…ä¸Žè¿è¡Œå¾ªçŽ¯ä¸­çš„ä»¥ä¸‹äº‹ä»¶ç›¸å…³è”ï¼š</p>
<ul>
<li>è¿è¡Œå¾ªçŽ¯çš„å…¥å£ã€‚</li>
<li>å½“è¿è¡Œå¾ªçŽ¯å°†è¦å¤„ç†è®¡æ—¶å™¨æ—¶ã€‚</li>
<li>å½“è¿è¡Œå¾ªçŽ¯å°†è¦å¤„ç†è¾“å…¥æºæ—¶ã€‚</li>
<li>å½“è¿è¡Œå¾ªçŽ¯å³å°†è¿›å…¥ç¡çœ çŠ¶æ€æ—¶ã€‚</li>
<li>å½“è¿è¡Œå¾ªçŽ¯é†’æ¥ä½†åœ¨å¤„ç†äº‹ä»¶ä¹‹å‰å°†å…¶å”¤é†’ã€‚</li>
<li>è¿è¡Œå¾ªçŽ¯çš„é€€å‡ºã€‚</li>
</ul>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ Core Foundation å°†è¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨æ·»åŠ åˆ°åº”ç”¨ç¨‹åºã€‚è¦åˆ›å»ºè¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨ï¼Œè¯·åˆ›å»º<code>CFRunLoopObserverRef</code>ä¸é€æ˜Žç±»åž‹çš„æ–°å®žä¾‹ã€‚æ­¤ç±»åž‹è·Ÿè¸ªæ‚¨çš„è‡ªå®šä¹‰å›žè°ƒå‡½æ•°åŠå…¶æ„Ÿå…´è¶£çš„æ´»åŠ¨ã€‚</p>
<p>ä¸Žè®¡æ—¶å™¨ç±»ä¼¼ï¼Œè¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨å¯ä»¥ä½¿ç”¨ä¸€æ¬¡æˆ–é‡å¤ä½¿ç”¨ã€‚ä¸€æ¬¡è§¦å‘çš„è§‚å¯Ÿè€…åœ¨è§¦å‘åŽå°†è‡ªå·±ä»Žè¿è¡Œå¾ªçŽ¯ä¸­åˆ é™¤ï¼Œè€Œé‡å¤çš„è§‚å¯Ÿè€…ä»ä¿æŒè¿žæŽ¥ã€‚æ‚¨å¯ä»¥æŒ‡å®šåˆ›å»ºè§‚å¯Ÿè€…æ—¶æ˜¯è¿è¡Œä¸€æ¬¡è¿˜æ˜¯é‡å¤è¿è¡Œã€‚</p>
<p>æœ‰å…³å¦‚ä½•åˆ›å»ºè¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨çš„ç¤ºä¾‹ï¼Œè¯·å‚è§â€œ <a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW18">é…ç½®è¿è¡Œå¾ªçŽ¯â€</a>ã€‚æœ‰å…³å‚è€ƒä¿¡æ¯ï¼Œè¯·å‚è§*<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/corefoundation/cfrunloopobserver">CFRunLoopObserver å‚è€ƒ</a>*ã€‚</p>
<h6 id="äº‹ä»¶çš„è¿è¡Œå¾ªçŽ¯åºåˆ—"><a href="#äº‹ä»¶çš„è¿è¡Œå¾ªçŽ¯åºåˆ—" class="headerlink" title="äº‹ä»¶çš„è¿è¡Œå¾ªçŽ¯åºåˆ—"></a>äº‹ä»¶çš„è¿è¡Œå¾ªçŽ¯åºåˆ—</h6><p>æ¯æ¬¡è¿è¡Œå®ƒæ—¶ï¼Œçº¿ç¨‹çš„è¿è¡Œå¾ªçŽ¯éƒ½ä¼šå¤„ç†æœªå†³äº‹ä»¶å¹¶ä¸ºä»»ä½•é™„åŠ çš„è§‚å¯Ÿè€…ç”Ÿæˆé€šçŸ¥ã€‚å®ƒæ‰§è¡Œæ­¤æ“ä½œçš„é¡ºåºéžå¸¸å…·ä½“ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ol>
<li>é€šçŸ¥è§‚å¯Ÿè€…å·²è¿›å…¥è¿è¡Œå¾ªçŽ¯ã€‚</li>
<li>é€šçŸ¥è§‚å¯Ÿè€…ä»»ä½•å‡†å¤‡å°±ç»ªçš„è®¡æ—¶å™¨å³å°†è§¦å‘ã€‚</li>
<li>é€šçŸ¥è§‚å¯Ÿè€…ä»»ä½•ä¸åŸºäºŽç«¯å£çš„è¾“å…¥æºéƒ½å°†è¢«è§¦å‘ã€‚</li>
<li>è§¦å‘æ‰€æœ‰å‡†å¤‡è§¦å‘çš„éžåŸºäºŽç«¯å£çš„è¾“å…¥æºã€‚</li>
<li>å¦‚æžœåŸºäºŽç«¯å£çš„è¾“å…¥æºå·²å‡†å¤‡å¥½å¹¶ç­‰å¾…å¯åŠ¨ï¼Œè¯·ç«‹å³å¤„ç†äº‹ä»¶ã€‚è½¬åˆ°æ­¥éª¤ 9ã€‚</li>
<li>é€šçŸ¥è§‚å¯Ÿè€…çº¿ç¨‹å³å°†è¿›å…¥ç¡çœ çŠ¶æ€ã€‚</li>
<li>ä½¿çº¿ç¨‹è¿›å…¥ç¡çœ çŠ¶æ€ï¼Œç›´åˆ°å‘ç”Ÿä»¥ä¸‹äº‹ä»¶ä¹‹ä¸€ï¼š<ul>
<li>äº‹ä»¶åˆ°è¾¾åŸºäºŽç«¯å£çš„è¾“å…¥æºã€‚</li>
<li>è®¡æ—¶å™¨è§¦å‘ã€‚</li>
<li>ä¸ºè¿è¡Œå¾ªçŽ¯è®¾ç½®çš„è¶…æ—¶å€¼åˆ°æœŸã€‚</li>
<li>è¿è¡Œå¾ªçŽ¯è¢«æ˜Žç¡®å”¤é†’ã€‚</li>
</ul>
</li>
<li>é€šçŸ¥è§‚å¯Ÿè€…çº¿ç¨‹åˆšåˆšé†’æ¥ã€‚</li>
<li>å¤„ç†æœªå†³äº‹ä»¶ã€‚<ul>
<li>å¦‚æžœè§¦å‘äº†ç”¨æˆ·å®šä¹‰çš„è®¡æ—¶å™¨ï¼Œè¯·å¤„ç†è®¡æ—¶å™¨äº‹ä»¶å¹¶é‡æ–°å¯åŠ¨å¾ªçŽ¯ã€‚è½¬åˆ°æ­¥éª¤ 2ã€‚</li>
<li>å¦‚æžœè§¦å‘äº†è¾“å…¥æºï¼Œåˆ™ä¼ é€’äº‹ä»¶ã€‚</li>
<li>å¦‚æžœè¿è¡Œå¾ªçŽ¯å·²æ˜¾å¼å”¤é†’ï¼Œä½†å°šæœªè¶…æ—¶ï¼Œè¯·é‡æ–°å¯åŠ¨å¾ªçŽ¯ã€‚è½¬åˆ°æ­¥éª¤ 2ã€‚</li>
</ul>
</li>
<li>é€šçŸ¥è§‚å¯Ÿè€…è¿è¡Œå¾ªçŽ¯å·²é€€å‡ºã€‚</li>
</ol>
<p>ç”±äºŽè®¡æ—¶å™¨å’Œè¾“å…¥æºçš„è§‚å¯Ÿè€…é€šçŸ¥æ˜¯åœ¨è¿™äº›äº‹ä»¶å®žé™…å‘ç”Ÿä¹‹å‰ä¼ é€’çš„ï¼Œå› æ­¤é€šçŸ¥æ—¶é—´å’Œå®žé™…äº‹ä»¶æ—¶é—´ä¹‹é—´å¯èƒ½ä¼šæœ‰å·®è·ã€‚å¦‚æžœè¿™äº›äº‹ä»¶ä¹‹é—´çš„æ—¶é—´å¾ˆå…³é”®ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ç¡çœ å’Œä»Žç¡çœ ä¸­å”¤é†’é€šçŸ¥æ¥å¸®åŠ©æ‚¨å…³è”å®žé™…äº‹ä»¶ä¹‹é—´çš„æ—¶é—´ã€‚</p>
<p>ç”±äºŽåœ¨è¿è¡Œè¿è¡Œå¾ªçŽ¯æ—¶ä¼šä¼ é€’è®¡æ—¶å™¨å’Œå…¶ä»–å®šæœŸäº‹ä»¶ï¼Œå› æ­¤è§„é¿è¯¥å¾ªçŽ¯ä¼šä¸­æ–­è¿™äº›äº‹ä»¶çš„ä¼ é€’ã€‚æ¯å½“æ‚¨é€šè¿‡è¿›å…¥å¾ªçŽ¯å¹¶é‡å¤ä»Žåº”ç”¨ç¨‹åºè¯·æ±‚äº‹ä»¶æ¥å®žçŽ°é¼ æ ‡è·Ÿè¸ªä¾‹ç¨‹æ—¶ï¼Œå°±ä¼šå‡ºçŽ°æ­¤è¡Œä¸ºçš„å…¸åž‹ç¤ºä¾‹ã€‚å› ä¸ºæ‚¨çš„ä»£ç ç›´æŽ¥æ•èŽ·äº‹ä»¶ï¼Œè€Œä¸æ˜¯è®©åº”ç”¨ç¨‹åºæ­£å¸¸åˆ†é…äº‹ä»¶ï¼Œæ‰€ä»¥æ´»åŠ¨è®¡æ—¶å™¨å°†æ— æ³•è§¦å‘ï¼Œç›´åˆ°æ‚¨çš„é¼ æ ‡è·Ÿè¸ªä¾‹ç¨‹é€€å‡ºå¹¶å°†æŽ§åˆ¶æƒè¿”å›žç»™åº”ç”¨ç¨‹åºä¸ºæ­¢ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨è¿è¡Œå¾ªçŽ¯å¯¹è±¡æ˜¾å¼å”¤é†’è¿è¡Œå¾ªçŽ¯ã€‚å…¶ä»–äº‹ä»¶ä¹Ÿå¯èƒ½å¯¼è‡´è¿è¡Œå¾ªçŽ¯è¢«å”¤é†’ã€‚ä¾‹å¦‚ï¼Œæ·»åŠ å¦ä¸€ä¸ªéžåŸºäºŽç«¯å£çš„è¾“å…¥æºå°†å”¤é†’è¿è¡Œå¾ªçŽ¯ï¼Œä»¥ä¾¿å¯ä»¥ç«‹å³å¤„ç†è¾“å…¥æºï¼Œè€Œä¸æ˜¯ç­‰åˆ°å‘ç”Ÿå…¶ä»–äº‹ä»¶ä¸ºæ­¢ã€‚</p>
<h4 id="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨è¿è¡Œå¾ªçŽ¯ï¼Ÿ"><a href="#ä»€ä¹ˆæ—¶å€™ä½¿ç”¨è¿è¡Œå¾ªçŽ¯ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨è¿è¡Œå¾ªçŽ¯ï¼Ÿ"></a>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨è¿è¡Œå¾ªçŽ¯ï¼Ÿ</h4><p>å”¯ä¸€éœ€è¦æ˜Žç¡®è¿è¡Œè¿è¡Œå¾ªçŽ¯çš„æ—¶é—´æ˜¯åœ¨ä¸ºåº”ç”¨ç¨‹åºåˆ›å»ºè¾…åŠ©çº¿ç¨‹æ—¶ã€‚åº”ç”¨ç¨‹åºä¸»çº¿ç¨‹çš„è¿è¡Œå¾ªçŽ¯æ˜¯åŸºç¡€æž¶æž„çš„å…³é”®éƒ¨åˆ†ã€‚ç»“æžœï¼Œåº”ç”¨ç¨‹åºæ¡†æž¶æä¾›äº†ç”¨äºŽè¿è¡Œä¸»åº”ç”¨ç¨‹åºå¾ªçŽ¯å¹¶è‡ªåŠ¨å¯åŠ¨è¯¥å¾ªçŽ¯çš„ä»£ç ã€‚åœ¨ iOSï¼ˆæˆ– OS Xï¼‰<code>run</code>ä¸­<code>UIApplication</code>ï¼Œçš„æ–¹æ³•<code>NSApplication</code>ä½œä¸ºæ­£å¸¸å¯åŠ¨é¡ºåºçš„ä¸€éƒ¨åˆ†å¯åŠ¨åº”ç”¨ç¨‹åºçš„ä¸»å¾ªçŽ¯ã€‚å¦‚æžœä½¿ç”¨ Xcode æ¨¡æ¿é¡¹ç›®åˆ›å»ºåº”ç”¨ç¨‹åºï¼Œåˆ™æ°¸è¿œä¸å¿…æ˜¾å¼è°ƒç”¨è¿™äº›ä¾‹ç¨‹ã€‚</p>
<p>å¯¹äºŽè¾…åŠ©çº¿ç¨‹ï¼Œæ‚¨éœ€è¦ç¡®å®šæ˜¯å¦éœ€è¦è¿è¡Œå¾ªçŽ¯ï¼Œå¦‚æžœéœ€è¦ï¼Œè¯·è‡ªè¡Œé…ç½®å¹¶å¯åŠ¨å®ƒã€‚æ‚¨æ— éœ€åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½å¯åŠ¨çº¿ç¨‹çš„è¿è¡Œå¾ªçŽ¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæ‚¨ä½¿ç”¨çº¿ç¨‹æ¥æ‰§è¡Œä¸€äº›é•¿æ—¶é—´è¿è¡Œä¸”é¢„å®šçš„ä»»åŠ¡ï¼Œåˆ™å¯ä»¥é¿å…å¯åŠ¨è¿è¡Œå¾ªçŽ¯ã€‚è¿è¡Œå¾ªçŽ¯ç”¨äºŽéœ€è¦ä¸Žçº¿ç¨‹æ›´å¤šäº¤äº’çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæ‚¨æ‰“ç®—æ‰§è¡Œä»¥ä¸‹ä»»ä¸€æ“ä½œï¼Œåˆ™éœ€è¦å¯åŠ¨è¿è¡Œå¾ªçŽ¯ï¼š</p>
<ul>
<li>ä½¿ç”¨ç«¯å£æˆ–è‡ªå®šä¹‰è¾“å…¥æºä¸Žå…¶ä»–çº¿ç¨‹è¿›è¡Œé€šä¿¡ã€‚</li>
<li>åœ¨çº¿ç¨‹ä¸Šä½¿ç”¨è®¡æ—¶å™¨ã€‚</li>
<li><code>performSelector</code>åœ¨ Cocoa åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ä»»ä½•â€¦æ–¹æ³•ã€‚</li>
<li>ä¿æŒçº¿ç¨‹æ‰§è¡Œå®šæœŸä»»åŠ¡ã€‚</li>
</ul>
<p>å¦‚æžœç¡®å®žé€‰æ‹©ä½¿ç”¨è¿è¡Œå¾ªçŽ¯ï¼Œåˆ™é…ç½®å’Œè®¾ç½®éžå¸¸ç®€å•ã€‚ä¸Žæ‰€æœ‰çº¿ç¨‹ç¼–ç¨‹ä¸€æ ·ï¼Œæ‚¨åº”è¯¥æœ‰ä¸€ä¸ªè®¡åˆ’ï¼Œåœ¨é€‚å½“çš„æƒ…å†µä¸‹é€€å‡ºè¾…åŠ©çº¿ç¨‹ã€‚æœ€å¥½é€šè¿‡è®©çº¿ç¨‹é€€å‡ºå¹²å‡€åœ°ç»“æŸçº¿ç¨‹ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶ç»ˆæ­¢çº¿ç¨‹ã€‚<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW5">ä½¿ç”¨è¿è¡Œå¾ªçŽ¯å¯¹è±¡ä¸­</a>ä»‹ç»äº†æœ‰å…³å¦‚ä½•é…ç½®å’Œé€€å‡º<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW5">è¿è¡Œå¾ªçŽ¯çš„ä¿¡æ¯</a>ã€‚</p>
<h4 id="ä½¿ç”¨è¿è¡Œå¾ªçŽ¯å¯¹è±¡"><a href="#ä½¿ç”¨è¿è¡Œå¾ªçŽ¯å¯¹è±¡" class="headerlink" title="ä½¿ç”¨è¿è¡Œå¾ªçŽ¯å¯¹è±¡"></a>ä½¿ç”¨è¿è¡Œå¾ªçŽ¯å¯¹è±¡</h4><p>è¿è¡Œå¾ªçŽ¯å¯¹è±¡æä¾›äº†ç”¨äºŽå°†è¾“å…¥æºï¼Œè®¡æ—¶å™¨å’Œè¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨æ·»åŠ åˆ°æ‚¨çš„è¿è¡Œå¾ªçŽ¯ç„¶åŽè¿è¡Œå®ƒçš„ä¸»ç•Œé¢ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªä¸Žä¹‹å…³è”çš„è¿è¡Œå¾ªçŽ¯å¯¹è±¡ã€‚åœ¨å¯å¯ä¸­ï¼Œæ­¤å¯¹è±¡æ˜¯<code>NSRunLoop</code>ç±»çš„å®žä¾‹ã€‚åœ¨ä½Žçº§åº”ç”¨ç¨‹åºä¸­ï¼Œå®ƒæ˜¯æŒ‡å‘<code>CFRunLoopRef</code>ä¸é€æ˜Žç±»åž‹çš„æŒ‡é’ˆã€‚</p>
<h6 id="èŽ·å–è¿è¡Œå¾ªçŽ¯å¯¹è±¡"><a href="#èŽ·å–è¿è¡Œå¾ªçŽ¯å¯¹è±¡" class="headerlink" title="èŽ·å–è¿è¡Œå¾ªçŽ¯å¯¹è±¡"></a>èŽ·å–è¿è¡Œå¾ªçŽ¯å¯¹è±¡</h6><p>è¦èŽ·å–å½“å‰çº¿ç¨‹çš„è¿è¡Œå¾ªçŽ¯ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä¹‹ä¸€ï¼š</p>
<ul>
<li>åœ¨ Cocoa åº”ç”¨ç¨‹åºä¸­ï¼Œä½¿ç”¨çš„<code>currentRunLoop</code>ç±»æ–¹æ³•<code>NSRunLoop</code>æ£€ç´¢<code>NSRunLoop</code>å¯¹è±¡ã€‚</li>
<li>ä½¿ç”¨<code>CFRunLoopGetCurrent</code>åŠŸèƒ½ã€‚</li>
</ul>
<p>å°½ç®¡å®ƒä»¬ä¸æ˜¯å…è´¹çš„æ¡¥æŽ¥ç±»åž‹ï¼Œä½†æ˜¯æ‚¨å¯ä»¥åœ¨éœ€è¦æ—¶<code>CFRunLoopRef</code>ä»Ž<code>NSRunLoop</code>å¯¹è±¡èŽ·å–ä¸é€æ˜Žç±»åž‹ã€‚æœ¬<code>NSRunLoop</code>ç±»å®šä¹‰äº†ä¸€ä¸ª<code>getCFRunLoop</code>è¿”å›žçš„æ–¹æ³•<code>CFRunLoopRef</code>ç±»åž‹ï¼Œä½ å¯ä»¥ä¼ é€’ç»™ Core Foundation çš„ä¾‹ç¨‹ã€‚ç”±äºŽä¸¤ä¸ªå¯¹è±¡éƒ½å¼•ç”¨ç›¸åŒçš„è¿è¡Œå¾ªçŽ¯ï¼Œå› æ­¤æ‚¨å¯ä»¥æ ¹æ®éœ€è¦æ··åˆå¯¹<code>NSRunLoop</code>å¯¹è±¡å’Œ<code>CFRunLoopRef</code>ä¸é€æ˜Žç±»åž‹çš„è°ƒç”¨ã€‚</p>
<h6 id="é…ç½®è¿è¡Œå¾ªçŽ¯"><a href="#é…ç½®è¿è¡Œå¾ªçŽ¯" class="headerlink" title="é…ç½®è¿è¡Œå¾ªçŽ¯"></a>é…ç½®è¿è¡Œå¾ªçŽ¯</h6><p>åœ¨è¾…åŠ©çº¿ç¨‹ä¸Šè¿è¡Œè¿è¡Œå¾ªçŽ¯ä¹‹å‰ï¼Œå¿…é¡»å‘å…¶æ·»åŠ è‡³å°‘ä¸€ä¸ªè¾“å…¥æºæˆ–è®¡æ—¶å™¨ã€‚å¦‚æžœè¿è¡Œå¾ªçŽ¯æ²¡æœ‰ä»»ä½•è¦ç›‘è§†çš„æºï¼Œåˆ™å½“æ‚¨å°è¯•è¿è¡Œå®ƒæ—¶ï¼Œå®ƒå°†ç«‹å³é€€å‡ºã€‚æœ‰å…³å¦‚ä½•å°†æºæ·»åŠ åˆ°è¿è¡Œå¾ªçŽ¯çš„ç¤ºä¾‹ï¼Œè¯·å‚è§ã€Š<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW7">é…ç½®è¿è¡Œå¾ªçŽ¯æºã€‹</a>ã€‚</p>
<p>é™¤äº†å®‰è£…æºä»£ç ï¼Œæ‚¨è¿˜å¯ä»¥å®‰è£…è¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨ï¼Œå¹¶ä½¿ç”¨å®ƒä»¬æ¥æ£€æµ‹è¿è¡Œå¾ªçŽ¯çš„ä¸åŒæ‰§è¡Œé˜¶æ®µã€‚è¦å®‰è£…è¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨ï¼Œè¯·åˆ›å»ºä¸€ä¸ª<code>CFRunLoopObserverRef</code>ä¸é€æ˜Žç±»åž‹ï¼Œç„¶åŽä½¿ç”¨è¯¥<code>CFRunLoopAddObserver</code>å‡½æ•°å°†å…¶æ·»åŠ åˆ°æ‚¨çš„è¿è¡Œå¾ªçŽ¯ä¸­ã€‚å³ä½¿ä½¿ç”¨ Cocoa åº”ç”¨ç¨‹åºï¼Œä¹Ÿå¿…é¡»ä½¿ç”¨ Core Foundation åˆ›å»ºè¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨ã€‚</p>
<p>æ¸…å• 3-1 æ˜¾ç¤ºäº†å°†è¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨é™„åŠ åˆ°å…¶è¿è¡Œå¾ªçŽ¯çš„çº¿ç¨‹çš„ä¸»ä¾‹ç¨‹ã€‚è¯¥ç¤ºä¾‹çš„ç›®çš„æ˜¯å‘æ‚¨å±•ç¤ºå¦‚ä½•åˆ›å»ºè¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨ï¼Œå› æ­¤ä»£ç ä»…è®¾ç½®äº†ä¸€ä¸ªè¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨ä»¥ç›‘è§†æ‰€æœ‰è¿è¡Œå¾ªçŽ¯æ´»åŠ¨ã€‚åŸºæœ¬å¤„ç†ç¨‹åºä¾‹ç¨‹ï¼ˆæœªæ˜¾ç¤ºï¼‰åœ¨å¤„ç†è®¡æ—¶å™¨è¯·æ±‚æ—¶ä»…è®°å½•è¿è¡Œå¾ªçŽ¯æ´»åŠ¨ã€‚</p>
<p><strong>æ¸…å• 3-1</strong> åˆ›å»ºä¸€ä¸ªè¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨</p>
<table>
<thead>
<tr>
<th><code>-ï¼ˆæ— æ•ˆï¼‰threadMain</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//è¯¥åº”ç”¨ç¨‹åºä½¿ç”¨åžƒåœ¾å›žæ”¶ï¼Œå› æ­¤ä¸éœ€è¦è‡ªåŠ¨é‡Šæ”¾æ± ã€‚</code></td>
</tr>
<tr>
<td><code>NSRunLoop * myRunLoop = [NSRunLoop currentRunLoop];</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//åˆ›å»ºä¸€ä¸ªè¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨ï¼Œå¹¶å°†å…¶é™„åŠ åˆ°è¿è¡Œå¾ªçŽ¯ã€‚</code></td>
</tr>
<tr>
<td><code>CFRunLoopObserverContext context = {0ï¼Œselfï¼ŒNULLï¼ŒNULLï¼ŒNULL};</code></td>
</tr>
<tr>
<td><code>CFRunLoopObserverRefè§‚å¯Ÿè€…= CFRunLoopObserverCreateï¼ˆkCFAllocatorDefaultï¼Œ</code></td>
</tr>
<tr>
<td><code>kCFRunLoopAllActivitiesï¼Œæ˜¯ï¼Œ0ï¼Œï¼†myRunLoopObserverï¼Œï¼†contextï¼‰ï¼›</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆè§‚å¯Ÿè€…ï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>CFRunLoopRef cfLoop = [myRunLoop getCFRunLoop];</code></td>
</tr>
<tr>
<td><code>CFRunLoopAddObserverï¼ˆcfLoopï¼Œè§‚å¯Ÿè€…ï¼ŒkCFRunLoopDefaultModeï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//åˆ›å»ºå¹¶å®‰æŽ’è®¡æ—¶å™¨ã€‚</code></td>
</tr>
<tr>
<td><code>[NSTimer ScheduledTimerWithTimeIntervalï¼š0.1ç›®æ ‡ï¼šè‡ªæˆ‘</code></td>
</tr>
<tr>
<td><code>é€‰æ‹©å™¨ï¼š@é€‰æ‹©å™¨ï¼ˆdoFireTimer ï¼šï¼‰ userInfoï¼šæ— é‡å¤ï¼šæ˜¯]ï¼›</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>NSInteger loopCount = 10;</code></td>
</tr>
<tr>
<td><code>åš</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//è¿è¡Œè¿è¡Œå¾ªçŽ¯10æ¬¡ä»¥ä½¿è®¡æ—¶å™¨å¯åŠ¨ã€‚</code></td>
</tr>
<tr>
<td><code>[myRunLoop runUntilDateï¼š[NSDate dateWithTimeIntervalSinceNowï¼š1]];</code></td>
</tr>
<tr>
<td><code>loopCount--;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>whileï¼ˆloopCountï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>ä¸ºé•¿å¯¿å‘½çº¿ç¨‹é…ç½®è¿è¡Œå¾ªçŽ¯æ—¶ï¼Œæœ€å¥½æ·»åŠ è‡³å°‘ä¸€ä¸ªè¾“å…¥æºä»¥æŽ¥æ”¶æ¶ˆæ¯ã€‚å°½ç®¡æ‚¨å¯ä»¥ä»…è¿žæŽ¥ä¸€ä¸ªè®¡æ—¶å™¨å³å¯è¿›å…¥è¿è¡Œå¾ªçŽ¯ï¼Œä½†æ˜¯ä¸€æ—¦è®¡æ—¶å™¨è§¦å‘ï¼Œå®ƒé€šå¸¸å°±ä¼šå¤±æ•ˆï¼Œè¿™å°†å¯¼è‡´è¿è¡Œå¾ªçŽ¯é€€å‡ºã€‚é™„åŠ é‡å¤è®¡æ—¶å™¨å¯ä»¥ä½¿è¿è¡Œå¾ªçŽ¯åœ¨æ›´é•¿çš„æ—¶é—´å†…è¿è¡Œï¼Œä½†æ˜¯ä¼šæ¶‰åŠå®šæœŸè§¦å‘è®¡æ—¶å™¨ä»¥å”¤é†’çº¿ç¨‹ï¼Œè¿™å®žé™…ä¸Šæ˜¯è½®è¯¢çš„å¦ä¸€ç§å½¢å¼ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œè¾“å…¥æºä¼šç­‰å¾…äº‹ä»¶å‘ç”Ÿï¼Œä½¿çº¿ç¨‹ä¿æŒç¡çœ çŠ¶æ€ç›´åˆ°äº‹ä»¶å‘ç”Ÿã€‚</p>
<h6 id="å¯åŠ¨è¿è¡Œå¾ªçŽ¯"><a href="#å¯åŠ¨è¿è¡Œå¾ªçŽ¯" class="headerlink" title="å¯åŠ¨è¿è¡Œå¾ªçŽ¯"></a>å¯åŠ¨è¿è¡Œå¾ªçŽ¯</h6><p>ä»…å¯¹äºŽåº”ç”¨ç¨‹åºä¸­çš„è¾…åŠ©çº¿ç¨‹ï¼Œæ‰éœ€è¦å¯åŠ¨è¿è¡Œå¾ªçŽ¯ã€‚ä¸€ä¸ªè¿è¡Œå¾ªçŽ¯å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªè¾“å…¥æºæˆ–è®¡æ—¶å™¨è¦ç›‘è§†ã€‚å¦‚æžœæœªè¿žæŽ¥ï¼Œè¿è¡Œå¾ªçŽ¯å°†ç«‹å³é€€å‡ºã€‚</p>
<p>æœ‰å‡ ç§å¯åŠ¨è¿è¡Œå¾ªçŽ¯çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>æ— æ¡ä»¶</li>
<li>è®¾å®šæ—¶é—´é™åˆ¶</li>
<li>åœ¨ç‰¹å®šæ¨¡å¼ä¸‹</li>
</ul>
<p>æ— æ¡ä»¶è¿›å…¥è¿è¡Œå¾ªçŽ¯æ˜¯æœ€ç®€å•çš„é€‰æ‹©ï¼Œä½†ä¹Ÿæ˜¯æœ€ä¸å¸Œæœ›çš„ã€‚æ— æ¡ä»¶è¿è¡Œè¿è¡Œå¾ªçŽ¯ä¼šå°†çº¿ç¨‹ç½®äºŽæ°¸ä¹…å¾ªçŽ¯ï¼Œè¿™ä½¿æ‚¨å‡ ä¹Žæ— æ³•æŽ§åˆ¶è¿è¡Œå¾ªçŽ¯æœ¬èº«ã€‚æ‚¨å¯ä»¥æ·»åŠ å’Œåˆ é™¤è¾“å…¥æºå’Œè®¡æ—¶å™¨ï¼Œä½†æ˜¯åœæ­¢è¿è¡Œå¾ªçŽ¯çš„å”¯ä¸€æ–¹æ³•æ˜¯ç»ˆæ­¢è¿è¡Œå¾ªçŽ¯ã€‚ä¹Ÿæ²¡æœ‰åŠžæ³•åœ¨è‡ªå®šä¹‰æ¨¡å¼ä¸‹è¿è¡Œè¿è¡Œå¾ªçŽ¯ã€‚</p>
<p>ä¸Žå…¶æ— æ¡ä»¶åœ°è¿è¡Œè¿è¡Œå¾ªçŽ¯ï¼Œä¸å¦‚ä½¿ç”¨è¶…æ—¶å€¼è¿è¡Œè¿è¡Œå¾ªçŽ¯ã€‚å½“æ‚¨ä½¿ç”¨è¶…æ—¶å€¼æ—¶ï¼Œè¿è¡Œå¾ªçŽ¯å°†è¿è¡Œç›´åˆ°äº‹ä»¶åˆ°è¾¾æˆ–æŒ‡å®šçš„æ—¶é—´åˆ°æœŸä¸ºæ­¢ã€‚å¦‚æžœäº‹ä»¶åˆ°è¾¾ï¼Œåˆ™å°†è¯¥äº‹ä»¶è°ƒåº¦åˆ°å¤„ç†ç¨‹åºè¿›è¡Œå¤„ç†ï¼Œç„¶åŽé€€å‡ºè¿è¡Œå¾ªçŽ¯ã€‚ç„¶åŽï¼Œæ‚¨çš„ä»£ç å¯ä»¥é‡æ–°å¯åŠ¨è¿è¡Œå¾ªçŽ¯ä»¥å¤„ç†ä¸‹ä¸€ä¸ªäº‹ä»¶ã€‚å¦‚æžœåˆ†é…çš„æ—¶é—´åˆ°æœŸäº†ï¼Œæ‚¨å¯ä»¥ç®€å•åœ°é‡æ–°å¯åŠ¨è¿è¡Œå¾ªçŽ¯æˆ–ä½¿ç”¨è¯¥æ—¶é—´è¿›è¡Œä»»ä½•å¿…è¦çš„å†…åŠ¡å¤„ç†ã€‚</p>
<p>é™¤äº†è¶…æ—¶å€¼ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨ç‰¹å®šæ¨¡å¼è¿è¡Œè¿è¡Œå¾ªçŽ¯ã€‚æ¨¡å¼å’Œè¶…æ—¶å€¼ä¸æ˜¯äº’æ–¥çš„ï¼Œå¹¶ä¸”åœ¨å¯åŠ¨è¿è¡Œå¾ªçŽ¯æ—¶éƒ½å¯ä»¥ä½¿ç”¨ã€‚æ¨¡å¼é™åˆ¶äº†å°†äº‹ä»¶ä¼ é€’åˆ°è¿è¡Œå¾ªçŽ¯çš„æºçš„ç±»åž‹ï¼Œ<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW12">è¿è¡Œå¾ªçŽ¯æ¨¡å¼ä¸­</a>å¯¹æ­¤è¿›è¡Œäº†è¯¦ç»†æè¿°ã€‚</p>
<p>æ¸…å• 3-2 æ˜¾ç¤ºäº†çº¿ç¨‹çš„ä¸»è¿›å…¥ä¾‹ç¨‹çš„æ¡†æž¶ç‰ˆæœ¬ã€‚æ­¤ç¤ºä¾‹çš„å…³é”®éƒ¨åˆ†æ˜¾ç¤ºäº†è¿è¡Œå¾ªçŽ¯çš„åŸºæœ¬ç»“æž„ã€‚æœ¬è´¨ä¸Šï¼Œæ‚¨å°†è¾“å…¥æºå’Œè®¡æ—¶å™¨æ·»åŠ åˆ°è¿è¡Œå¾ªçŽ¯ä¸­ï¼Œç„¶åŽé‡å¤è°ƒç”¨ä¾‹ç¨‹ä¹‹ä¸€ä»¥å¯åŠ¨è¿è¡Œå¾ªçŽ¯ã€‚æ¯æ¬¡è¿è¡Œå¾ªçŽ¯ä¾‹ç¨‹è¿”å›žæ—¶ï¼Œæ‚¨éƒ½è¦æ£€æŸ¥æ˜¯å¦å‡ºçŽ°äº†å¯èƒ½ä¿è¯é€€å‡ºçº¿ç¨‹çš„æ¡ä»¶ã€‚è¯¥ç¤ºä¾‹ä½¿ç”¨ Core Foundation è¿è¡Œå¾ªçŽ¯ä¾‹ç¨‹ï¼Œä»¥ä¾¿å®ƒå¯ä»¥æ£€æŸ¥è¿”å›žç»“æžœå¹¶ç¡®å®šä¸ºä»€ä¹ˆé€€å‡ºè¿è¡Œå¾ªçŽ¯ã€‚<code>NSRunLoop</code>å¦‚æžœæ‚¨ä½¿ç”¨çš„æ˜¯ Cocoaï¼Œå¹¶ä¸”ä¸éœ€è¦æ£€æŸ¥è¿”å›žå€¼ï¼Œåˆ™ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»çš„æ–¹æ³•ä»¥ç±»ä¼¼çš„æ–¹å¼è¿è¡Œè¿è¡Œå¾ªçŽ¯ã€‚ï¼ˆæœ‰å…³è°ƒç”¨<code>NSRunLoop</code>ç±»çš„æ–¹æ³•çš„è¿è¡Œå¾ªçŽ¯çš„ç¤ºä¾‹ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW9">æ¸…å• 3-14</a>ã€‚ï¼‰</p>
<p><strong>æ¸…å• 3-2</strong> è¿è¡Œä¸€ä¸ªè¿è¡Œå¾ªçŽ¯</p>
<table>
<thead>
<tr>
<th><code>-ï¼ˆvoidï¼‰skeletonThreadMain</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//å¦‚æžœä¸ä½¿ç”¨åžƒåœ¾å›žæ”¶ï¼Œè¯·åœ¨æ­¤å¤„è®¾ç½®ä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ã€‚</code></td>
</tr>
<tr>
<td><code>BOOLå®Œæˆ=å¦ï¼›</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å°†æ‚¨çš„æºä»£ç æˆ–è®¡æ—¶å™¨æ·»åŠ åˆ°è¿è¡Œå¾ªçŽ¯ä¸­ï¼Œç„¶åŽè¿›è¡Œå…¶ä»–ä»»ä½•è®¾ç½®ã€‚</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>åš</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//å¼€å§‹è¿è¡Œå¾ªçŽ¯ï¼Œä½†åœ¨å¤„ç†å®Œæ¯ä¸ªæºä¹‹åŽè¿”å›žã€‚</code></td>
</tr>
<tr>
<td><code>SInt32ç»“æžœ= CFRunLoopRunInModeï¼ˆkCFRunLoopDefaultModeï¼Œ10ï¼Œæ˜¯ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å¦‚æžœæºæ˜Žç¡®åœæ­¢äº†è¿è¡Œå¾ªçŽ¯ï¼Œæˆ–è€…æ²¡æœ‰</code></td>
</tr>
<tr>
<td><code>//æ¥æºæˆ–è®¡æ—¶å™¨ï¼Œè¯·ç»§ç»­å¹¶é€€å‡ºã€‚</code></td>
</tr>
<tr>
<td>`å¦‚æžœï¼ˆï¼ˆç»“æžœ== kCFRunLoopRunStoppedï¼‰</td>
</tr>
<tr>
<td><code>å®Œæˆ=æ˜¯;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//åœ¨æ­¤å¤„æ£€æŸ¥å…¶ä»–é€€å‡ºæ¡ä»¶ï¼Œå¹¶è®¾ç½®</code></td>
</tr>
<tr>
<td><code>//æ ¹æ®éœ€è¦å®Œæˆå˜é‡ã€‚</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>åŒæ—¶ï¼ˆï¼å®Œæˆï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//åœ¨æ­¤å¤„æ¸…ç†ä»£ç ã€‚ç¡®ä¿é‡Šæ”¾æ‰€æœ‰åˆ†é…çš„è‡ªåŠ¨é‡Šæ”¾æ± ã€‚</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>å¯ä»¥é€’å½’è¿è¡Œè¿è¡Œå¾ªçŽ¯ã€‚æ¢å¥è¯è¯´ï¼Œæ‚¨å¯ä»¥åœ¨è¾“å…¥æºæˆ–è®¡æ—¶å™¨çš„å¤„ç†ç¨‹åºä¾‹ç¨‹ä¸­è°ƒç”¨<code>CFRunLoopRun</code>ï¼Œ<code>CFRunLoopRunInMode</code>æˆ–ä»»ä½•<code>NSRunLoop</code>ç”¨äºŽå¯åŠ¨è¿è¡Œå¾ªçŽ¯çš„æ–¹æ³•ã€‚è¿™æ ·åšæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½•è¦è¿è¡ŒåµŒå¥—è¿è¡Œå¾ªçŽ¯çš„æ¨¡å¼ï¼ŒåŒ…æ‹¬å¤–éƒ¨è¿è¡Œå¾ªçŽ¯ä½¿ç”¨çš„æ¨¡å¼ã€‚</p>
<h6 id="é€€å‡ºè¿è¡Œå¾ªçŽ¯"><a href="#é€€å‡ºè¿è¡Œå¾ªçŽ¯" class="headerlink" title="é€€å‡ºè¿è¡Œå¾ªçŽ¯"></a>é€€å‡ºè¿è¡Œå¾ªçŽ¯</h6><p>åœ¨å¤„ç†äº‹ä»¶ä¹‹å‰ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ä½¿è¿è¡Œå¾ªçŽ¯é€€å‡ºï¼š</p>
<ul>
<li>é…ç½®è¿è¡Œå¾ªçŽ¯ä»¥ä½¿ç”¨è¶…æ—¶å€¼è¿è¡Œã€‚</li>
<li>å‘Šè¯‰è¿è¡Œå¾ªçŽ¯åœæ­¢ã€‚</li>
</ul>
<p>å¦‚æžœå¯ä»¥ç®¡ç†ï¼Œä½¿ç”¨è¶…æ—¶å€¼æ— ç–‘æ˜¯é¦–é€‰ã€‚æŒ‡å®šè¶…æ—¶å€¼å¯ä½¿è¿è¡Œå¾ªçŽ¯åœ¨é€€å‡ºä¹‹å‰å®Œæˆå…¶æ‰€æœ‰æ­£å¸¸å¤„ç†ï¼ŒåŒ…æ‹¬å°†é€šçŸ¥ä¼ é€’ç»™è¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨ã€‚</p>
<p>ä½¿ç”¨è¯¥<code>CFRunLoopStop</code>å‡½æ•°æ˜¾å¼åœæ­¢è¿è¡Œå¾ªçŽ¯ä¼šäº§ç”Ÿç±»ä¼¼äºŽè¶…æ—¶çš„ç»“æžœã€‚è¿è¡Œå¾ªçŽ¯å°†å‘å‡ºæ‰€æœ‰å‰©ä½™çš„è¿è¡Œå¾ªçŽ¯é€šçŸ¥ï¼Œç„¶åŽé€€å‡ºã€‚åŒºåˆ«åœ¨äºŽæ‚¨å¯ä»¥åœ¨æ— æ¡ä»¶å¯åŠ¨çš„è¿è¡Œå¾ªçŽ¯ä¸­ä½¿ç”¨æ­¤æŠ€æœ¯ã€‚</p>
<p>å°½ç®¡åˆ é™¤è¿è¡Œå¾ªçŽ¯çš„è¾“å…¥æºå’Œè®¡æ—¶å™¨ä¹Ÿå¯èƒ½å¯¼è‡´è¿è¡Œå¾ªçŽ¯é€€å‡ºï¼Œä½†è¿™ä¸æ˜¯åœæ­¢è¿è¡Œå¾ªçŽ¯çš„å¯é æ–¹æ³•ã€‚ä¸€äº›ç³»ç»Ÿä¾‹ç¨‹å°†è¾“å…¥æºæ·»åŠ åˆ°è¿è¡Œå¾ªçŽ¯ä¸­ä»¥å¤„ç†æ‰€éœ€çš„äº‹ä»¶ã€‚å› ä¸ºæ‚¨çš„ä»£ç å¯èƒ½ä¸çŸ¥é“è¿™äº›è¾“å…¥æºï¼Œæ‰€ä»¥å®ƒå°†æ— æ³•åˆ é™¤å®ƒä»¬ï¼Œè¿™å°†é˜»æ­¢è¿è¡Œå¾ªçŽ¯é€€å‡ºã€‚</p>
<h6 id="çº¿ç¨‹å®‰å…¨å’Œè¿è¡Œå¾ªçŽ¯å¯¹è±¡"><a href="#çº¿ç¨‹å®‰å…¨å’Œè¿è¡Œå¾ªçŽ¯å¯¹è±¡" class="headerlink" title="çº¿ç¨‹å®‰å…¨å’Œè¿è¡Œå¾ªçŽ¯å¯¹è±¡"></a>çº¿ç¨‹å®‰å…¨å’Œè¿è¡Œå¾ªçŽ¯å¯¹è±¡</h6><p>çº¿ç¨‹å®‰å…¨æ€§å–å†³äºŽæ‚¨ç”¨æ¥æ“çºµè¿è¡Œå¾ªçŽ¯çš„ APIã€‚Core Foundation ä¸­çš„å‡½æ•°é€šå¸¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥ä»Žä»»ä½•çº¿ç¨‹ä¸­è°ƒç”¨ã€‚ä½†æ˜¯ï¼Œå¦‚æžœæ‚¨æ‰§è¡Œçš„æ“ä½œä¼šæ›´æ”¹è¿è¡Œå¾ªçŽ¯çš„é…ç½®ï¼Œåˆ™ä»ç„¶æœ€å¥½ä»Žæ‹¥æœ‰è¿è¡Œå¾ªçŽ¯çš„çº¿ç¨‹ä¸­è¿›è¡Œæ›´æ”¹ã€‚</p>
<p>å¯å¯<code>NSRunLoop</code>ç±»åœ¨æœ¬è´¨ä¸Šä¸å¦‚å…¶ Core Foundation åŒç±»çº¿ç¨‹å®‰å…¨ã€‚å¦‚æžœè¦ä½¿ç”¨<code>NSRunLoop</code>è¯¥ç±»æ¥ä¿®æ”¹è¿è¡Œå¾ªçŽ¯ï¼Œåˆ™åªèƒ½ä»Žæ‹¥æœ‰è¯¥è¿è¡Œå¾ªçŽ¯çš„åŒä¸€çº¿ç¨‹è¿›è¡Œã€‚å°†è¾“å…¥æºæˆ–è®¡æ—¶å™¨æ·»åŠ åˆ°å±žäºŽä¸åŒçº¿ç¨‹çš„è¿è¡Œå¾ªçŽ¯ä¸­å¯èƒ½ä¼šå¯¼è‡´ä»£ç å´©æºƒæˆ–è¡Œä¸ºå¼‚å¸¸ã€‚</p>
<h4 id="é…ç½®è¿è¡Œå¾ªçŽ¯æº"><a href="#é…ç½®è¿è¡Œå¾ªçŽ¯æº" class="headerlink" title="é…ç½®è¿è¡Œå¾ªçŽ¯æº"></a>é…ç½®è¿è¡Œå¾ªçŽ¯æº</h4><p>ä»¥ä¸‹å„èŠ‚æ˜¾ç¤ºäº†å¦‚ä½•åœ¨ Cocoa å’Œ Core Foundation ä¸­è®¾ç½®ä¸åŒç±»åž‹çš„è¾“å…¥æºçš„ç¤ºä¾‹ã€‚</p>
<h6 id="å®šä¹‰è‡ªå®šä¹‰è¾“å…¥æº"><a href="#å®šä¹‰è‡ªå®šä¹‰è¾“å…¥æº" class="headerlink" title="å®šä¹‰è‡ªå®šä¹‰è¾“å…¥æº"></a>å®šä¹‰è‡ªå®šä¹‰è¾“å…¥æº</h6><p>åˆ›å»ºè‡ªå®šä¹‰è¾“å…¥æºæ¶‰åŠå®šä¹‰ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>æ‚¨å¸Œæœ›è¾“å…¥æºå¤„ç†çš„ä¿¡æ¯ã€‚</li>
<li>è°ƒåº¦ç¨‹åºï¼Œè®©æ„Ÿå…´è¶£çš„å®¢æˆ·çŸ¥é“å¦‚ä½•è”ç³»æ‚¨çš„è¾“å…¥æºã€‚</li>
<li>å¤„ç†ç¨‹åºä¾‹ç¨‹ï¼Œç”¨äºŽæ‰§è¡Œä»»ä½•å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ã€‚</li>
<li>å–æ¶ˆä¾‹ç¨‹ä½¿æ‚¨çš„è¾“å…¥æºæ— æ•ˆã€‚</li>
</ul>
<p>å› ä¸ºæ‚¨åˆ›å»ºäº†ä¸€ä¸ªå®šåˆ¶è¾“å…¥æºæ¥å¤„ç†å®šåˆ¶ä¿¡æ¯ï¼Œæ‰€ä»¥å®žé™…é…ç½®è¢«è®¾è®¡ä¸ºçµæ´»çš„ã€‚è°ƒåº¦ç¨‹åºï¼Œå¤„ç†ç¨‹åºå’Œå–æ¶ˆä¾‹ç¨‹æ˜¯è‡ªå®šä¹‰è¾“å…¥æºå‡ ä¹Žå§‹ç»ˆéœ€è¦çš„å…³é”®ä¾‹ç¨‹ã€‚ä½†æ˜¯ï¼Œå…¶ä½™å¤§å¤šæ•°è¾“å…¥æºè¡Œä¸ºéƒ½å‘ç”Ÿåœ¨é‚£äº›å¤„ç†ç¨‹åºä¾‹ç¨‹ä¹‹å¤–ã€‚ä¾‹å¦‚ï¼Œç”±æ‚¨å†³å®šå®šä¹‰ç”¨äºŽå°†æ•°æ®ä¼ é€’åˆ°è¾“å…¥æºä»¥åŠå°†è¾“å…¥æºçš„å­˜åœ¨ä¼ è¾¾ç»™å…¶ä»–çº¿ç¨‹çš„æœºåˆ¶ã€‚</p>
<p>å›¾ 3-2 æ˜¾ç¤ºäº†å®šåˆ¶è¾“å…¥æºçš„æ ·æœ¬é…ç½®ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œåº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ç»´æŠ¤å¯¹è¾“å…¥æºï¼Œè¯¥è¾“å…¥æºçš„å®šåˆ¶å‘½ä»¤ç¼“å†²åŒºä»¥åŠå®‰è£…è¯¥è¾“å…¥æºçš„è¿è¡Œå¾ªçŽ¯çš„å¼•ç”¨ã€‚å½“ä¸»çº¿ç¨‹æœ‰ä¸€ä¸ªè¦ç§»äº¤ç»™å·¥ä½œçº¿ç¨‹çš„ä»»åŠ¡æ—¶ï¼Œå®ƒå°†ä¸€ä¸ªå‘½ä»¤ä»¥åŠå·¥ä½œçº¿ç¨‹å¯åŠ¨è¯¥ä»»åŠ¡æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯å‘å¸ƒåˆ°å‘½ä»¤ç¼“å†²åŒºã€‚ï¼ˆç”±äºŽä¸»çº¿ç¨‹å’Œå·¥ä½œçº¿ç¨‹çš„è¾“å…¥æºéƒ½å¯ä»¥è®¿é—®å‘½ä»¤ç¼“å†²åŒºï¼Œå› æ­¤å¿…é¡»åŒæ­¥è¯¥è®¿é—®ã€‚ï¼‰ä¸€æ—¦å‘å¸ƒå‘½ä»¤ï¼Œä¸»çº¿ç¨‹å°†å‘è¾“å…¥æºå‘å‡ºä¿¡å·å¹¶å”¤é†’å·¥ä½œçº¿ç¨‹çš„è¿è¡Œå¾ªçŽ¯ã€‚æ”¶åˆ°å”¤é†’å‘½ä»¤åŽï¼Œè¿è¡Œå¾ªçŽ¯å°†è°ƒç”¨è¾“å…¥æºçš„å¤„ç†ç¨‹åºï¼Œè¯¥å¤„ç†ç¨‹åºå°†å¤„ç†åœ¨å‘½ä»¤ç¼“å†²åŒºä¸­æ‰¾åˆ°çš„å‘½ä»¤ã€‚</p>
<p><strong>å›¾ 3-2</strong> æ“ä½œè‡ªå®šä¹‰è¾“å…¥æº<img src="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/Art/custominputsource.jpg" alt="æ“ä½œè‡ªå®šä¹‰è¾“å…¥æº"></p>
<p>ä»¥ä¸‹å„èŠ‚è¯´æ˜Žäº†ä¸Šå›¾ä¸­è‡ªå®šä¹‰è¾“å…¥æºçš„å®žçŽ°ï¼Œå¹¶æ˜¾ç¤ºäº†æ‚¨éœ€è¦å®žçŽ°çš„å…³é”®ä»£ç ã€‚</p>
<p>######## å®šä¹‰è¾“å…¥æº</p>
<p>å®šä¹‰è‡ªå®šä¹‰è¾“å…¥æºéœ€è¦ä½¿ç”¨ Core Foundation ä¾‹ç¨‹æ¥é…ç½®æ‚¨çš„è¿è¡Œå¾ªçŽ¯æºå¹¶å°†å…¶é™„åŠ åˆ°è¿è¡Œå¾ªçŽ¯ã€‚å°½ç®¡åŸºæœ¬å¤„ç†ç¨‹åºæ˜¯åŸºäºŽ C çš„å‡½æ•°ï¼Œä½†è¿™å¹¶ä¸å¦¨ç¢æ‚¨ç¼–å†™è¿™äº›å‡½æ•°çš„åŒ…è£…ç¨‹åºå¹¶ä½¿ç”¨ Objective-C æˆ– C ++å®žçŽ°ä»£ç ä¸»ä½“ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW31">å›¾ 3-2 ä¸­</a>å¼•å…¥çš„è¾“å…¥æºä½¿ç”¨ä¸€ä¸ª Objective-C å¯¹è±¡æ¥ç®¡ç†å‘½ä»¤ç¼“å†²åŒºå¹¶ä¸Žè¿è¡Œå¾ªçŽ¯åè°ƒã€‚æ¸…å• 3-3 æ˜¾ç¤ºäº†æ­¤å¯¹è±¡çš„å®šä¹‰ã€‚è¯¥<code>RunLoopSource</code>å¯¹è±¡ç®¡ç†å‘½ä»¤ç¼“å†²åŒºï¼Œå¹¶ä½¿ç”¨è¯¥ç¼“å†²åŒºä»Žå…¶ä»–çº¿ç¨‹æŽ¥æ”¶æ¶ˆæ¯ã€‚æ­¤æ¸…å•è¿˜æ˜¾ç¤ºäº†<code>RunLoopContext</code>å¯¹è±¡çš„å®šä¹‰ï¼Œå®ƒå®žé™…ä¸Šåªæ˜¯ä¸€ä¸ªå®¹å™¨å¯¹è±¡ï¼Œç”¨äºŽä¼ é€’<code>RunLoopSource</code>å¯¹è±¡å’Œå¯¹åº”ç”¨ç¨‹åºä¸»çº¿ç¨‹çš„è¿è¡Œå¾ªçŽ¯å¼•ç”¨ã€‚</p>
<p><strong>æ¸…å• 3-3</strong> å®šåˆ¶è¾“å…¥æºå¯¹è±¡å®šä¹‰</p>
<table>
<thead>
<tr>
<th><code>@interface RunLoopSourceï¼šNSObject</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>CFRunLoopSourceRef runLoopSource;</code></td>
</tr>
<tr>
<td><code>NSMutableArray *å‘½ä»¤ï¼›</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>-ï¼ˆidï¼‰init;</code></td>
</tr>
<tr>
<td><code>-ï¼ˆvoidï¼‰addToCurrentRunLoop;</code></td>
</tr>
<tr>
<td><code>-ï¼ˆæ— æ•ˆï¼‰æ— æ•ˆï¼›</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å¤„ç†ç¨‹åºæ–¹æ³•</code></td>
</tr>
<tr>
<td><code>-ï¼ˆvoidï¼‰sourceFired;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å®¢æˆ·ç«¯æŽ¥å£ï¼Œç”¨äºŽæ³¨å†Œè¦å¤„ç†çš„å‘½ä»¤</code></td>
</tr>
<tr>
<td><code>-ï¼ˆvoidï¼‰addCommandï¼šï¼ˆNSIntegerï¼‰å‘½ä»¤withDataï¼šï¼ˆidï¼‰data;</code></td>
</tr>
<tr>
<td><code>-ï¼ˆvoidï¼‰fireAllCommandsOnRunLoopï¼šï¼ˆCFRunLoopRefï¼‰runloop;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>@ç»“æŸ</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//è¿™äº›æ˜¯CFRunLoopSourceRefå›žè°ƒå‡½æ•°ã€‚</code></td>
</tr>
<tr>
<td><code>void RunLoopSourceScheduleRoutineï¼ˆvoid * infoï¼ŒCFRunLoopRef rlï¼ŒCFStringRefæ¨¡å¼ï¼‰;</code></td>
</tr>
<tr>
<td><code>void RunLoopSourcePerformRoutineï¼ˆvoid * infoï¼‰;</code></td>
</tr>
<tr>
<td><code>void RunLoopSourceCancelRoutineï¼ˆvoid * infoï¼ŒCFRunLoopRef rlï¼ŒCFStringRefæ¨¡å¼ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>// RunLoopContextæ˜¯åœ¨è¾“å…¥æºæ³¨å†ŒæœŸé—´ä½¿ç”¨çš„å®¹å™¨å¯¹è±¡ã€‚</code></td>
</tr>
<tr>
<td><code>@interface RunLoopContextï¼šNSObject</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>CFRunLoopRef runLoop;</code></td>
</tr>
<tr>
<td><code>RunLoopSource *æºï¼›</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>@propertyï¼ˆåªè¯»ï¼‰CFRunLoopRef runLoop;</code></td>
</tr>
<tr>
<td><code>@propertyï¼ˆåªè¯»ï¼‰RunLoopSource *æºï¼›</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>-ï¼ˆidï¼‰initWithSourceï¼šï¼ˆRunLoopSource *ï¼‰srcå’ŒLoopï¼šï¼ˆCFRunLoopRefï¼‰loop;</code></td>
</tr>
<tr>
<td><code>@ç»“æŸ</code></td>
</tr>
</tbody></table>
<p>å°½ç®¡ Objective-C ä»£ç ç®¡ç†è¾“å…¥æºçš„è‡ªå®šä¹‰æ•°æ®ï¼Œä½†æ˜¯å°†è¾“å…¥æºé™„åŠ åˆ°è¿è¡Œå¾ªçŽ¯éœ€è¦åŸºäºŽ C çš„å›žè°ƒå‡½æ•°ã€‚å½“æ‚¨å°†è¿è¡Œå¾ªçŽ¯æºå®žé™…é™„åŠ åˆ°è¿è¡Œå¾ªçŽ¯æ—¶ï¼Œå°†è°ƒç”¨å…¶ä¸­çš„ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æ¸…å• 3-4 æ‰€ç¤ºã€‚å› ä¸ºæ­¤è¾“å…¥æºåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯ï¼ˆä¸»çº¿ç¨‹ï¼‰ï¼Œæ‰€ä»¥å®ƒä½¿ç”¨è°ƒåº¦ç¨‹åºåŠŸèƒ½å‘é€æ¶ˆæ¯ä»¥åœ¨è¯¥çº¿ç¨‹ä¸Šçš„åº”ç”¨ç¨‹åºå§”æ‰˜ä¸­æ³¨å†Œè‡ªå·±ã€‚å½“å§”æ‰˜äººæƒ³è¦ä¸Žè¾“å…¥æºè¿›è¡Œé€šä¿¡æ—¶ï¼Œå®ƒå°†ä½¿ç”¨<code>RunLoopContext</code>object ä¸­çš„ä¿¡æ¯è¿›è¡Œé€šä¿¡ã€‚</p>
<p><strong>æ¸…å• 3-4</strong> å®‰æŽ’è¿è¡Œå¾ªçŽ¯æº</p>
<table>
<thead>
<tr>
<th><code>void RunLoopSourceScheduleRoutineï¼ˆvoid * infoï¼ŒCFRunLoopRef rlï¼ŒCFStringRefæ¨¡å¼ï¼‰</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>RunLoopSource * obj =ï¼ˆRunLoopSource *ï¼‰info;</code></td>
</tr>
<tr>
<td><code>AppDelegate * del = [AppDelegate sharedAppDelegate];</code></td>
</tr>
<tr>
<td><code>RunLoopContext * theContext = [[[RunLoopContext alloc] initWithSourceï¼šobjå’ŒLoopï¼šrl];</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>[del performSelectorOnMainThreadï¼š@selectorï¼ˆregisterSource :)</code></td>
</tr>
<tr>
<td><code>withObjectï¼štheContext waitUntilDoneï¼šNO];</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>æœ€é‡è¦çš„å›žè°ƒä¾‹ç¨‹ä¹‹ä¸€æ˜¯å½“è¾“å…¥æºè¢«ä¿¡å·é€šçŸ¥æ—¶ç”¨äºŽå¤„ç†è‡ªå®šä¹‰æ•°æ®çš„ä¾‹ç¨‹ã€‚æ¸…å• 3-5 æ˜¾ç¤ºäº†ä¸Ž<code>RunLoopSource</code>å¯¹è±¡å…³è”çš„ perform å›žè°ƒä¾‹ç¨‹ã€‚è¯¥åŠŸèƒ½åªæ˜¯å°†å®Œæˆå·¥ä½œçš„è¯·æ±‚è½¬å‘ç»™<code>sourceFired</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç„¶åŽå¤„ç†å‘½ä»¤ç¼“å†²åŒºä¸­å­˜åœ¨çš„æ‰€æœ‰å‘½ä»¤ã€‚</p>
<p><strong>æ¸…å• 3-5</strong> åœ¨è¾“å…¥æºä¸­æ‰§è¡Œå·¥ä½œ</p>
<table>
<thead>
<tr>
<th><code>void RunLoopSourcePerformRoutineï¼ˆvoid * infoï¼‰</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>RunLoopSource * obj =ï¼ˆRunLoopSource *ï¼‰info;</code></td>
</tr>
<tr>
<td><code>[obj sourceFired];</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>å¦‚æžœä½¿ç”¨è¯¥<code>CFRunLoopSourceInvalidate</code>åŠŸèƒ½ä»Žè¿è¡Œå¾ªçŽ¯ä¸­åˆ é™¤è¾“å…¥æºï¼Œç³»ç»Ÿå°†è°ƒç”¨è¾“å…¥æºçš„å–æ¶ˆä¾‹ç¨‹ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ­¤ä¾‹ç¨‹æ¥é€šçŸ¥å®¢æˆ·ç«¯æ‚¨çš„è¾“å…¥æºä¸å†æœ‰æ•ˆï¼Œå¹¶ä¸”ä»–ä»¬åº”åˆ é™¤å¯¹å…¶çš„ä»»ä½•å¼•ç”¨ã€‚ æ¸…å• 3-6 æ˜¾ç¤ºäº†å‘è¯¥<code>RunLoopSource</code>å¯¹è±¡æ³¨å†Œçš„å–æ¶ˆå›žè°ƒä¾‹ç¨‹ã€‚æ­¤å‡½æ•°å°†å¦ä¸€ä¸ª<code>RunLoopContext</code>å¯¹è±¡å‘é€ç»™åº”ç”¨ç¨‹åºå§”æ‰˜ï¼Œä½†è¿™ä¸€æ¬¡è¦æ±‚å§”æ‰˜åˆ é™¤å¯¹è¿è¡Œå¾ªçŽ¯æºçš„å¼•ç”¨ã€‚</p>
<p><strong>æ¸…å• 3-6</strong> ä½¿è¾“å…¥æºæ— æ•ˆ</p>
<table>
<thead>
<tr>
<th><code>void RunLoopSourceCancelRoutineï¼ˆæ— æ•ˆ* infoï¼ŒCFRunLoopRef rlï¼ŒCFStringRefæ¨¡å¼ï¼‰</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>RunLoopSource * obj =ï¼ˆRunLoopSource *ï¼‰info;</code></td>
</tr>
<tr>
<td><code>AppDelegate * del = [AppDelegate sharedAppDelegate];</code></td>
</tr>
<tr>
<td><code>RunLoopContext * theContext = [[[RunLoopContext alloc] initWithSourceï¼šobjå’ŒLoopï¼šrl];</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>[del performSelectorOnMainThreadï¼š@selectorï¼ˆremoveSource :)</code></td>
</tr>
<tr>
<td><code>withObjectï¼štheContext waitUntilDoneï¼šYES];</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p><strong>æ³¨æ„ï¼š</strong><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW37">ä¸Žè¾“å…¥æºçš„å®¢æˆ·ç«¯åè°ƒä¸­</a>æ˜¾ç¤º äº†åº”ç”¨ç¨‹åºå§”æ‰˜<code>registerSource:</code>å’Œ<code>removeSource:</code>æ–¹æ³•<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW37">çš„ä»£ç </a>ã€‚</p>
<p>######## åœ¨è¿è¡Œå¾ªçŽ¯ä¸Šå®‰è£…è¾“å…¥æº</p>
<p>æ¸…å• 3-7 æ˜¾ç¤ºäº†è¯¥ç±»çš„<code>init</code>å’Œ<code>addToCurrentRunLoop</code>æ–¹æ³•<code>RunLoopSource</code>ã€‚è¯¥<code>init</code>æ–¹æ³•åˆ›å»º<code>CFRunLoopSourceRef</code>å®žé™…ä¸Šå¿…é¡»é™„åŠ åˆ°è¿è¡Œå¾ªçŽ¯çš„ä¸é€æ˜Žç±»åž‹ã€‚å®ƒå°†<code>RunLoopSource</code>å¯¹è±¡æœ¬èº«ä½œä¸ºä¸Šä¸‹æ–‡ä¿¡æ¯ä¼ é€’ï¼Œä»¥ä¾¿å›žè°ƒä¾‹ç¨‹å…·æœ‰æŒ‡å‘è¯¥å¯¹è±¡çš„æŒ‡é’ˆã€‚åœ¨å·¥ä½œçº¿ç¨‹è°ƒç”¨è¯¥<code>addToCurrentRunLoop</code>æ–¹æ³•ä¹‹å‰ï¼Œä¸ä¼šå®‰è£…è¾“å…¥æºï¼Œæ­¤æ—¶å°†<code>RunLoopSourceScheduleRoutine</code>è°ƒç”¨å›žè°ƒå‡½æ•°ã€‚å°†è¾“å…¥æºæ·»åŠ åˆ°è¿è¡Œå¾ªçŽ¯åŽï¼Œçº¿ç¨‹å¯ä»¥è¿è¡Œå…¶è¿è¡Œå¾ªçŽ¯ä»¥ç­‰å¾…å®ƒã€‚</p>
<p><strong>æ¸…å• 3-7</strong> å®‰è£…è¿è¡Œå¾ªçŽ¯æº</p>
<table>
<thead>
<tr>
<th><code>-ï¼ˆidï¼‰åˆå§‹åŒ–</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>CFRunLoopSourceContext context = {0ï¼Œselfï¼ŒNULLï¼ŒNULLï¼ŒNULLï¼ŒNULLï¼ŒNULLï¼Œ</code></td>
</tr>
<tr>
<td><code>ï¼†RunLoopSourceScheduleRoutineï¼Œ</code></td>
</tr>
<tr>
<td><code>RunLoopSourceCancelRoutineï¼Œ</code></td>
</tr>
<tr>
<td><code>RunLoopSourcePerformRoutine};</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>runLoopSource = CFRunLoopSourceCreateï¼ˆNULLï¼Œ0ï¼Œï¼†contextï¼‰;</code></td>
</tr>
<tr>
<td><code>å‘½ä»¤= [[[NSMutableArray alloc] init];</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>è¿”å›žè‡ªæˆ‘</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>-ï¼ˆvoidï¼‰addToCurrentRunLoop</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>CFRunLoopRef runLoop = CFRunLoopGetCurrentï¼ˆï¼‰;</code></td>
</tr>
<tr>
<td><code>CFRunLoopAddSourceï¼ˆrunLoopï¼ŒrunLoopSourceï¼ŒkCFRunLoopDefaultModeï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>######## ä¸Žè¾“å…¥æºçš„å®¢æˆ·åè°ƒ</p>
<p>ä¸ºäº†ä½¿æ‚¨çš„è¾“å…¥æºæœ‰ç”¨ï¼Œæ‚¨éœ€è¦å¯¹å…¶è¿›è¡Œæ“ä½œå¹¶ä»Žå¦ä¸€ä¸ªçº¿ç¨‹å‘å‡ºä¿¡å·ã€‚è¾“å…¥æºçš„å…¨éƒ¨ç›®çš„æ˜¯ä½¿å…¶å…³è”çº¿ç¨‹å¤„äºŽä¼‘çœ çŠ¶æ€ï¼Œç›´åˆ°æœ‰äº‹è¦åšã€‚è¿™ä¸ªäº‹å®žä½¿å¾—æ‚¨çš„åº”ç”¨ç¨‹åºä¸­çš„å…¶ä»–çº¿ç¨‹å¿…é¡»äº†è§£è¾“å…¥æºå¹¶æœ‰ä¸€ç§ä¸Žä¹‹é€šä¿¡çš„æ–¹æ³•ã€‚</p>
<p>é€šçŸ¥å®¢æˆ·æœ‰å…³æ‚¨çš„è¾“å…¥æºçš„ä¸€ç§æ–¹æ³•æ˜¯åœ¨æ‚¨çš„è¾“å…¥æºé¦–æ¬¡å®‰è£…åœ¨å…¶è¿è¡Œå¾ªçŽ¯ä¸­æ—¶å‘å‡ºæ³¨å†Œè¯·æ±‚ã€‚æ‚¨å¯ä»¥å‘ä»»æ„æ•°é‡çš„å®¢æˆ·æ³¨å†Œæ‚¨çš„è¾“å…¥æºï¼Œä¹Ÿå¯ä»¥ç®€å•åœ°å‘æŸä¸ªä¸­å¤®æœºæž„æ³¨å†Œå®ƒï¼Œç„¶åŽå°†æ‚¨çš„è¾“å…¥æºå‡ºå”®ç»™æ„Ÿå…´è¶£çš„å®¢æˆ·ã€‚æ¸…å• 3-8 æ˜¾ç¤ºäº†ç”±åº”ç”¨ç¨‹åºå§”æ‰˜å®šä¹‰çš„æ³¨å†Œæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨è°ƒç”¨<code>RunLoopSource</code>å¯¹è±¡çš„è°ƒåº¦ç¨‹åºå‡½æ•°æ—¶è°ƒç”¨ã€‚æ­¤æ–¹æ³•æŽ¥æ”¶è¯¥<code>RunLoopContext</code>å¯¹è±¡æä¾›çš„<code>RunLoopSource</code>å¯¹è±¡ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°å…¶æºåˆ—è¡¨ä¸­ã€‚æ­¤æ¸…å•è¿˜æ˜¾ç¤ºäº†ä»Žè¿è¡Œå¾ªçŽ¯ä¸­åˆ é™¤è¾“å…¥æºæ—¶ç”¨äºŽæ³¨é”€è¾“å…¥æºçš„ä¾‹ç¨‹ã€‚</p>
<p><strong>æ¸…å• 3-8</strong> ä½¿ç”¨åº”ç”¨ç¨‹åºå§”æ‰˜æ³¨å†Œå’Œåˆ é™¤è¾“å…¥æº</p>
<table>
<thead>
<tr>
<th><code>-ï¼ˆvoidï¼‰registerSourceï¼šï¼ˆRunLoopContext *ï¼‰sourceInfo;</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>[sourcesToPing addObjectï¼šsourceInfo];</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>-ï¼ˆæ— æ•ˆï¼‰removeSourceï¼šï¼ˆRunLoopContext *ï¼‰sourceInfo</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>id objToRemove = nil;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>ç”¨äºŽï¼ˆSourcesToPingä¸­çš„RunLoopContext *ä¸Šä¸‹æ–‡ï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆ[context isEqualï¼šsourceInfo]ï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>objToRemove =ä¸Šä¸‹æ–‡ï¼›</code></td>
</tr>
<tr>
<td><code>æ‰“ç ´;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆobjToRemoveï¼‰</code></td>
</tr>
<tr>
<td><code>[sourcesToPing removeObjectï¼šobjToRemove];</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p><strong>æ³¨æ„ï¼š</strong><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW32">æ¸…å• 3-4</a>å’Œ<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW34">æ¸…å• 3-6</a> ä¸­æ˜¾ç¤ºäº†è°ƒç”¨å‰é¢æ¸…å•ä¸­çš„æ–¹æ³•çš„å›žè°ƒå‡½æ•°ã€‚</p>
<p>######## ç”¨ä¿¡å·é€šçŸ¥è¾“å…¥æº</p>
<p>åœ¨å°†å…¶æ•°æ®äº¤ç»™è¾“å…¥æºåŽï¼Œå®¢æˆ·ç«¯å¿…é¡»å‘è¯¥æºå‘å‡ºä¿¡å·å¹¶å”¤é†’å…¶è¿è¡Œå¾ªçŽ¯ã€‚å‘æºå‘å‡ºä¿¡å·ä¼šä½¿è¿è¡Œå¾ªçŽ¯çŸ¥é“è¯¥æºå·²å‡†å¤‡å¥½è¿›è¡Œå¤„ç†ã€‚å¹¶ä¸”ç”±äºŽå½“ä¿¡å·å‡ºçŽ°æ—¶çº¿ç¨‹å¯èƒ½å¤„äºŽç¡çœ çŠ¶æ€ï¼Œå› æ­¤æ‚¨åº”è¯¥å§‹ç»ˆæ˜Žç¡®åœ°å”¤é†’è¿è¡Œå¾ªçŽ¯ã€‚å¦åˆ™ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¾“å…¥æºå¤„ç†å»¶è¿Ÿã€‚</p>
<p>æ¸…å• 3-9 æ˜¾ç¤ºäº†<code>fireCommandsOnRunLoop</code>è¯¥<code>RunLoopSource</code>å¯¹è±¡çš„æ–¹æ³•ã€‚å®¢æˆ·ç«¯å‡†å¤‡å¥½è®©æºå¤„ç†å®ƒä»¬æ·»åŠ åˆ°ç¼“å†²åŒºçš„å‘½ä»¤æ—¶ï¼Œå®¢æˆ·ç«¯å°†è°ƒç”¨æ­¤æ–¹æ³•ã€‚</p>
<p><strong>æ¸…å• 3-9</strong> å”¤é†’è¿è¡Œå¾ªçŽ¯</p>
<table>
<thead>
<tr>
<th><code>-ï¼ˆvoidï¼‰fireCommandsOnRunLoopï¼šï¼ˆCFRunLoopRefï¼‰runloop</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>CFRunLoopSourceSignalï¼ˆrunLoopSourceï¼‰;</code></td>
</tr>
<tr>
<td><code>CFRunLoopWakeUpï¼ˆrunloopï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p><strong>æ³¨æ„ï¼š</strong> æ°¸è¿œä¸è¦å°è¯•<code>SIGHUP</code>é€šè¿‡ä¼ é€’è‡ªå®šä¹‰è¾“å…¥æºæ¥å¤„ç†ä¸€ä¸ªæˆ–å…¶ä»–ç±»åž‹çš„è¿‡ç¨‹çº§ä¿¡å·ã€‚å”¤é†’è¿è¡Œå¾ªçŽ¯çš„ Core Foundation å‡½æ•°ä¸æ˜¯ä¿¡å·å®‰å…¨çš„ï¼Œä¸åº”åœ¨åº”ç”¨ç¨‹åºçš„ä¿¡å·å¤„ç†ç¨‹åºä¾‹ç¨‹ä¸­ä½¿ç”¨ã€‚æœ‰å…³ä¿¡å·å¤„ç†ç¨‹åºä¾‹ç¨‹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<code>sigaction</code>æ‰‹å†Œé¡µã€‚</p>
<h6 id="é…ç½®è®¡æ—¶å™¨æº"><a href="#é…ç½®è®¡æ—¶å™¨æº" class="headerlink" title="é…ç½®è®¡æ—¶å™¨æº"></a>é…ç½®è®¡æ—¶å™¨æº</h6><p>è¦åˆ›å»ºè®¡æ—¶å™¨æºï¼Œæ‚¨è¦åšçš„å°±æ˜¯åˆ›å»ºä¸€ä¸ªè®¡æ—¶å™¨å¯¹è±¡å¹¶å°†å…¶å®‰æŽ’åœ¨è¿è¡Œå¾ªçŽ¯ä¸­ã€‚åœ¨ Cocoa ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>NSTimer</code>è¯¥ç±»æ¥åˆ›å»ºæ–°çš„è®¡æ—¶å™¨å¯¹è±¡ï¼Œè€Œåœ¨ Core Foundation ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>CFRunLoopTimerRef</code>ä¸é€æ˜Žç±»åž‹ã€‚åœ¨å†…éƒ¨ï¼Œ<code>NSTimer</code>è¯¥ç±»åªæ˜¯ Core Foundation çš„æ‰©å±•ï¼Œæä¾›äº†ä¸€äº›ä¾¿åˆ©åŠŸèƒ½ï¼Œä¾‹å¦‚ä½¿ç”¨åŒä¸€æ–¹æ³•åˆ›å»ºå’Œå®‰æŽ’è®¡æ—¶å™¨çš„åŠŸèƒ½ã€‚</p>
<p>åœ¨ Cocoa ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ä¹‹ä¸€åŒæ—¶åˆ›å»ºå’Œå®‰æŽ’è®¡æ—¶å™¨ï¼š</p>
<ul>
<li><code>scheduledTimerWithTimeInterval:target:selector:userInfo:repeats:</code></li>
<li><code>scheduledTimerWithTimeInterval:invocation:repeats:</code></li>
</ul>
<p>è¿™äº›æ–¹æ³•åˆ›å»ºè®¡æ—¶å™¨å¹¶å°†å…¶ä»¥é»˜è®¤æ¨¡å¼ï¼ˆ<code>NSDefaultRunLoopMode</code>ï¼‰æ·»åŠ åˆ°å½“å‰çº¿ç¨‹çš„è¿è¡Œå¾ªçŽ¯ä¸­ã€‚å¦‚æžœéœ€è¦ï¼Œè¿˜å¯ä»¥é€šè¿‡åˆ›å»º<code>NSTimer</code>å¯¹è±¡ç„¶åŽä½¿ç”¨çš„<code>addTimer:forMode:</code>æ–¹æ³•å°†å…¶æ·»åŠ åˆ°è¿è¡Œå¾ªçŽ¯ä¸­æ¥æ‰‹åŠ¨å®‰æŽ’è®¡æ—¶å™¨<code>NSRunLoop</code>ã€‚ä¸¤ç§æŠ€æœ¯åŸºæœ¬ä¸Šéƒ½åšåŒæ ·çš„äº‹æƒ…ï¼Œä½†æ˜¯ç»™æ‚¨å¯¹è®¡æ—¶å™¨é…ç½®çš„ä¸åŒçº§åˆ«çš„æŽ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæ‚¨åˆ›å»ºè®¡æ—¶å™¨å¹¶å°†å…¶æ‰‹åŠ¨æ·»åŠ åˆ°è¿è¡Œå¾ªçŽ¯ä¸­ï¼Œåˆ™å¯ä»¥ä½¿ç”¨é»˜è®¤æ¨¡å¼ä»¥å¤–çš„å…¶ä»–æ¨¡å¼æ¥æ‰§è¡Œæ­¤æ“ä½œã€‚æ¸…å• 3-10 æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨è¿™ä¸¤ç§æŠ€æœ¯åˆ›å»ºè®¡æ—¶å™¨ã€‚ç¬¬ä¸€ä¸ªè®¡æ—¶å™¨çš„åˆå§‹å»¶è¿Ÿä¸º 1 ç§’ï¼Œä½†æ­¤åŽæ¯éš” 0.1 ç§’å®šæœŸè§¦å‘ä¸€æ¬¡ã€‚ç¬¬äºŒä¸ªè®¡æ—¶å™¨åœ¨æœ€åˆçš„ 0.2 ç§’å»¶è¿ŸåŽå¼€å§‹è§¦å‘ï¼Œç„¶åŽåœ¨æ­¤ä¹‹åŽæ¯ 0.2 ç§’è§¦å‘ä¸€æ¬¡ã€‚</p>
<p><strong>æ¸…å• 3-10</strong> ä½¿ç”¨ NSTimer åˆ›å»ºå’Œè°ƒåº¦è®¡æ—¶å™¨</p>
<table>
<thead>
<tr>
<th><code>NSRunLoop * myRunLoop = [NSRunLoop currentRunLoop];</code></th>
</tr>
</thead>
<tbody><tr>
<td>``</td>
</tr>
<tr>
<td><code>//åˆ›å»ºå¹¶å®‰æŽ’ç¬¬ä¸€ä¸ªè®¡æ—¶å™¨ã€‚</code></td>
</tr>
<tr>
<td><code>NSDate * futureDate = [NSDate dateWithTimeIntervalSinceNowï¼š1.0];</code></td>
</tr>
<tr>
<td><code>NSTimer * myTimer = [[NSTimeråˆ†é…] initWithFireDateï¼šfutureDate</code></td>
</tr>
<tr>
<td><code>é—´éš”ï¼š0.1</code></td>
</tr>
<tr>
<td><code>ç›®æ ‡ï¼šè‡ªæˆ‘</code></td>
</tr>
<tr>
<td><code>é€‰æ‹©å™¨ï¼š@é€‰æ‹©å™¨ï¼ˆmyDoFireTimer1 :)</code></td>
</tr>
<tr>
<td><code>userInfoï¼šæ— </code></td>
</tr>
<tr>
<td><code>é‡å¤ï¼šæ˜¯]ï¼›</code></td>
</tr>
<tr>
<td><code>[myRunLoop addTimerï¼šmyTimerçš„æ¨¡å¼ï¼šNSDefaultRunLoopMode]ï¼›</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//åˆ›å»ºå¹¶å®‰æŽ’ç¬¬äºŒä¸ªè®¡æ—¶å™¨ã€‚</code></td>
</tr>
<tr>
<td><code>[NSTimer ScheduledTimerWithTimeIntervalï¼š0.2</code></td>
</tr>
<tr>
<td><code>ç›®æ ‡ï¼šè‡ªæˆ‘</code></td>
</tr>
<tr>
<td><code>é€‰æ‹©å™¨ï¼š@é€‰æ‹©å™¨ï¼ˆmyDoFireTimer2 :)</code></td>
</tr>
<tr>
<td><code>userInfoï¼šæ— </code></td>
</tr>
<tr>
<td><code>é‡å¤ï¼šæ˜¯]ï¼›</code></td>
</tr>
</tbody></table>
<p>æ¸…å• 3-11 æ˜¾ç¤ºäº†ä½¿ç”¨ Core Foundation å‡½æ•°é…ç½®è®¡æ—¶å™¨æ‰€éœ€çš„ä»£ç ã€‚å°½ç®¡æ­¤ç¤ºä¾‹æœªåœ¨ä¸Šä¸‹æ–‡ç»“æž„ä¸­ä¼ é€’ä»»ä½•ç”¨æˆ·å®šä¹‰çš„ä¿¡æ¯ï¼Œä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨æ­¤ç»“æž„ä¼ é€’è®¡æ—¶å™¨æ‰€éœ€çš„ä»»ä½•è‡ªå®šä¹‰æ•°æ®ã€‚æœ‰å…³æ­¤ç»“æž„çš„å†…å®¹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§*<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/corefoundation/cfrunlooptimer-rhk">CFRunLoopTimer å‚è€ƒä¸­çš„</a>*æè¿°ã€‚</p>
<p><strong>æ¸…å• 3-11</strong> ä½¿ç”¨ Core Foundation åˆ›å»ºå’Œå®‰æŽ’è®¡æ—¶å™¨</p>
<table>
<thead>
<tr>
<th><code>CFRunLoopRef runLoop = CFRunLoopGetCurrentï¼ˆï¼‰;</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>CFRunLoopTimerContext context = {0ï¼ŒNULLï¼ŒNULLï¼ŒNULLï¼ŒNULL};</code></td>
</tr>
<tr>
<td><code>CFRunLoopTimerRef timer = CFRunLoopTimerCreateï¼ˆkCFAllocatorDefaultï¼Œ0.1ï¼Œ0.3ï¼Œ0ï¼Œ0ï¼Œ</code></td>
</tr>
<tr>
<td><code>ï¼†myCFTimerCallbackï¼Œï¼†contextï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>CFRunLoopAddTimerï¼ˆrunLoopï¼Œtimerï¼ŒkCFRunLoopCommonModesï¼‰;</code></td>
</tr>
</tbody></table>
<h6 id="é…ç½®åŸºäºŽç«¯å£çš„è¾“å…¥æº"><a href="#é…ç½®åŸºäºŽç«¯å£çš„è¾“å…¥æº" class="headerlink" title="é…ç½®åŸºäºŽç«¯å£çš„è¾“å…¥æº"></a>é…ç½®åŸºäºŽç«¯å£çš„è¾“å…¥æº</h6><p>Cocoa å’Œ Core Foundation éƒ½æä¾›äº†åŸºäºŽç«¯å£çš„å¯¹è±¡ï¼Œç”¨äºŽåœ¨çº¿ç¨‹ä¹‹é—´æˆ–è¿›ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚ä»¥ä¸‹å„èŠ‚è¯´æ˜Žå¦‚ä½•ä½¿ç”¨å‡ ç§ä¸åŒç±»åž‹çš„ç«¯å£æ¥è®¾ç½®ç«¯å£é€šä¿¡ã€‚</p>
<p>######## é…ç½® NSMachPort å¯¹è±¡</p>
<p>è¦ä¸Ž<code>NSMachPort</code>å¯¹è±¡å»ºç«‹æœ¬åœ°è¿žæŽ¥ï¼Œè¯·åˆ›å»ºç«¯å£å¯¹è±¡å¹¶å°†å…¶æ·»åŠ åˆ°ä¸»çº¿ç¨‹çš„è¿è¡Œå¾ªçŽ¯ä¸­ã€‚å¯åŠ¨è¾…åŠ©çº¿ç¨‹æ—¶ï¼Œå°†åŒä¸€å¯¹è±¡ä¼ é€’ç»™çº¿ç¨‹çš„å…¥å£ç‚¹å‡½æ•°ã€‚è¾…åŠ©çº¿ç¨‹å¯ä»¥ä½¿ç”¨åŒä¸€å¯¹è±¡å°†æ¶ˆæ¯å‘é€å›žæ‚¨çš„ä¸»çº¿ç¨‹ã€‚</p>
<p>########## å®žæ–½ä¸»çº¿ç¨‹ä»£ç </p>
<p>æ¸…å• 3-12 æ˜¾ç¤ºäº†ç”¨äºŽå¯åŠ¨è¾…åŠ©å·¥ä½œçº¿ç¨‹çš„ä¸»è¦çº¿ç¨‹ä»£ç ã€‚å› ä¸º Cocoa æ¡†æž¶æ‰§è¡Œäº†è®¸å¤šé…ç½®ç«¯å£å’Œè¿è¡Œå¾ªçŽ¯çš„å¹²é¢„æ­¥éª¤ï¼Œæ‰€ä»¥è¯¥<code>launchThread</code>æ–¹æ³•æ˜Žæ˜¾çŸ­äºŽå…¶ Core Foundation ç­‰æ•ˆæ–¹æ³•ï¼ˆ<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-139726-BAJBGHHB">æ¸…å• 3-17</a>ï¼‰ã€‚ä½†æ˜¯ï¼Œä¸¤è€…çš„è¡Œä¸ºå‡ ä¹Žç›¸åŒã€‚ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œæ­¤æ–¹æ³•ä¸æ˜¯å°†æœ¬åœ°ç«¯å£çš„åç§°å‘é€åˆ°å·¥ä½œçº¿ç¨‹ï¼Œè€Œæ˜¯<code>NSPort</code>ç›´æŽ¥å‘é€å¯¹è±¡ã€‚</p>
<p><strong>æ¸…å• 3-12</strong> ä¸»çº¿ç¨‹å¯åŠ¨æ–¹æ³•</p>
<table>
<thead>
<tr>
<th><code>-ï¼ˆæ— æ•ˆï¼‰launchThread</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>NSPort * myPort = [NSMachPortç«¯å£]ï¼›</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆmyPortï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//æ­¤ç±»å¤„ç†ä¼ å…¥çš„ç«¯å£æ¶ˆæ¯ã€‚</code></td>
</tr>
<tr>
<td><code>[myPort setDelegateï¼šself];</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å°†ç«¯å£å®‰è£…ä¸ºå½“å‰è¿è¡Œå¾ªçŽ¯ä¸Šçš„è¾“å…¥æºã€‚</code></td>
</tr>
<tr>
<td><code>[[NSRunLoop currentRunLoop] addPortï¼šmyPort forModeï¼šNSDefaultRunLoopMode];</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//åˆ†ç¦»çº¿ç¨‹ã€‚è®©å·¥ä½œäººå‘˜é‡Šæ”¾ç«¯å£ã€‚</code></td>
</tr>
<tr>
<td><code>[NSThread detachNewThreadSelectorï¼š@selectorï¼ˆLaunchThreadWithPort :)</code></td>
</tr>
<tr>
<td><code>toTargetï¼š[MyWorkerClass class] withObjectï¼šmyPort];</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>ä¸ºäº†åœ¨çº¿ç¨‹ä¹‹é—´å»ºç«‹åŒå‘é€šä¿¡é€šé“ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å·¥ä½œçº¿ç¨‹åœ¨ç­¾å…¥æ¶ˆæ¯ä¸­å°†å…¶è‡ªå·±çš„æœ¬åœ°ç«¯å£å‘é€åˆ°ä¸»çº¿ç¨‹ã€‚æŽ¥æ”¶åˆ°ç­¾å…¥æ¶ˆæ¯å¯ä»¥ä½¿æ‚¨çš„ä¸»çº¿ç¨‹çŸ¥é“åœ¨å¯åŠ¨ç¬¬äºŒä¸ªçº¿ç¨‹æ—¶ä¸€åˆ‡è¿›å±•é¡ºåˆ©ï¼Œè¿˜ä¸ºæ‚¨æä¾›äº†ä¸€ç§å‘è¯¥çº¿ç¨‹å‘é€æ›´å¤šæ¶ˆæ¯çš„æ–¹æ³•ã€‚</p>
<p>æ¸…å• 3-13 æ˜¾ç¤º<code>handlePortMessage:</code>äº†ä¸»çº¿ç¨‹çš„æ–¹æ³•ã€‚å½“æ•°æ®åˆ°è¾¾çº¿ç¨‹è‡ªå·±çš„æœ¬åœ°ç«¯å£æ—¶ï¼Œå°†è°ƒç”¨æ­¤æ–¹æ³•ã€‚å½“ç­¾å…¥æ¶ˆæ¯åˆ°è¾¾æ—¶ï¼Œè¯¥æ–¹æ³•ç›´æŽ¥ä»Žç«¯å£æ¶ˆæ¯ä¸­æ£€ç´¢è¾…åŠ©çº¿ç¨‹çš„ç«¯å£ï¼Œå¹¶å°†å…¶ä¿å­˜ä»¥ä¾›ä»¥åŽä½¿ç”¨ã€‚</p>
<p><strong>æ¸…å• 3-13</strong> å¤„ç† Mach ç«¯å£æ¶ˆæ¯</p>
<table>
<thead>
<tr>
<th><code>#define kCheckinMessage 100</code></th>
</tr>
</thead>
<tbody><tr>
<td>``</td>
</tr>
<tr>
<td><code>//å¤„ç†æ¥è‡ªè¾…åŠ©çº¿ç¨‹çš„å“åº”ã€‚</code></td>
</tr>
<tr>
<td><code>-ï¼ˆvoidï¼‰handlePortMessageï¼šï¼ˆNSPortMessage *ï¼‰portMessage</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>unsigned intæ¶ˆæ¯= [portMessage msgid];</code></td>
</tr>
<tr>
<td><code>NSPort * distantPort = nil;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆæ¶ˆæ¯== kCheckinMessageï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//èŽ·å–è¾…åŠ©çº¿ç¨‹çš„é€šä¿¡ç«¯å£ã€‚</code></td>
</tr>
<tr>
<td><code>distantPort = [portMessage sendPort];</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//ä¿ç•™å¹¶ä¿å­˜å·¥ä½œç«¯å£ï¼Œä»¥å¤‡åŽç”¨ã€‚</code></td>
</tr>
<tr>
<td><code>[self storeDistantPortï¼šdistantPort];</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>å…¶ä»–</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//å¤„ç†å…¶ä»–æ¶ˆæ¯ã€‚</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>########## å®žæ–½è¾…åŠ©çº¿ç¨‹ä»£ç </p>
<p>å¯¹äºŽè¾…åŠ©å·¥ä½œçº¿ç¨‹ï¼Œæ‚¨å¿…é¡»é…ç½®çº¿ç¨‹å¹¶ä½¿ç”¨æŒ‡å®šçš„ç«¯å£å°†ä¿¡æ¯ä¼ é€’å›žä¸»çº¿ç¨‹ã€‚</p>
<p>æ¸…å• 3-14 æ˜¾ç¤ºäº†è®¾ç½®å·¥ä½œçº¿ç¨‹çš„ä»£ç ã€‚åœ¨ä¸ºçº¿ç¨‹åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ä¹‹åŽï¼Œè¯¥æ–¹æ³•å°†åˆ›å»ºä¸€ä¸ªå·¥ä½œå™¨å¯¹è±¡ä»¥é©±åŠ¨çº¿ç¨‹æ‰§è¡Œã€‚worker å¯¹è±¡çš„<code>sendCheckinMessage:</code>æ–¹æ³•ï¼ˆå¦‚<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW10">æ¸…å• 3-15</a>æ‰€ç¤ºï¼‰ä¸º worker çº¿ç¨‹åˆ›å»ºä¸€ä¸ªæœ¬åœ°ç«¯å£ï¼Œå¹¶å°†ç­¾å…¥æ¶ˆæ¯å‘é€å›žä¸»çº¿ç¨‹ã€‚</p>
<p><strong>æ¸…å• 3-14</strong> ä½¿ç”¨ Mach ç«¯å£å¯åŠ¨å·¥ä½œçº¿ç¨‹</p>
<table>
<thead>
<tr>
<th><code>+ï¼ˆæ— æ•ˆï¼‰LaunchThreadWithPortï¼šï¼ˆidï¼‰inData</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>NSAutoreleasePool * pool = [[NSAutoreleasePool alloc] init];</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//è®¾ç½®æ­¤çº¿ç¨‹ä¸Žä¸»çº¿ç¨‹ä¹‹é—´çš„è¿žæŽ¥ã€‚</code></td>
</tr>
<tr>
<td><code>NSPort * distantPort =ï¼ˆNSPort *ï¼‰inData;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>MyWorkerClass * workerObj = [[self alloc] init];</code></td>
</tr>
<tr>
<td><code>[workerObj sendCheckinMessageï¼šdistantPort];</code></td>
</tr>
<tr>
<td><code>[distantPortç‰ˆæœ¬]ï¼›</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//è®©è¿è¡Œå¾ªçŽ¯å¤„ç†äº‹ç‰©ã€‚</code></td>
</tr>
<tr>
<td><code>åš</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>[[NSRunLoop currentRunLoop] runModeï¼šNSDefaultRunLoopMode</code></td>
</tr>
<tr>
<td><code>beforeDateï¼š[NSDate distantFuture]];</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>whileï¼ˆï¼[workerObj shouldExit]ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>[workerObjå‘å¸ƒ]ï¼›</code></td>
</tr>
<tr>
<td><code>[æ± é‡Šæ”¾];</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>ä½¿ç”¨æ—¶<code>NSMachPort</code>ï¼Œæœ¬åœ°çº¿ç¨‹å’Œè¿œç¨‹çº¿ç¨‹å¯ä»¥å°†ç›¸åŒçš„ç«¯å£å¯¹è±¡ç”¨äºŽçº¿ç¨‹ä¹‹é—´çš„å•å‘é€šä¿¡ã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªçº¿ç¨‹åˆ›å»ºçš„æœ¬åœ°ç«¯å£å¯¹è±¡æˆä¸ºå¦ä¸€çº¿ç¨‹çš„è¿œç¨‹ç«¯å£å¯¹è±¡ã€‚</p>
<p>æ¸…å• 3-15 æ˜¾ç¤ºäº†è¾…åŠ©çº¿ç¨‹çš„ç­¾å…¥ä¾‹ç¨‹ã€‚æ­¤æ–¹æ³•è®¾ç½®è‡ªå·±çš„æœ¬åœ°ç«¯å£ä»¥ç”¨äºŽå°†æ¥çš„é€šä¿¡ï¼Œç„¶åŽå°†ç­¾å…¥æ¶ˆæ¯å‘é€å›žä¸»çº¿ç¨‹ã€‚è¯¥æ–¹æ³•å°†æ–¹æ³•ä¸­æŽ¥æ”¶åˆ°çš„ç«¯å£å¯¹è±¡<code>LaunchThreadWithPort:</code>ç”¨ä½œæ¶ˆæ¯çš„ç›®æ ‡ã€‚</p>
<p><strong>æ¸…å• 3-15</strong> ä½¿ç”¨ Mach ç«¯å£å‘é€ç­¾å…¥æ¶ˆæ¯</p>
<table>
<thead>
<tr>
<th><code>//å·¥ä½œçº¿ç¨‹ç­¾å…¥æ–¹æ³•</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>-ï¼ˆvoidï¼‰sendCheckinMessageï¼šï¼ˆNSPort *ï¼‰outPort</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//ä¿ç•™å¹¶ä¿å­˜è¿œç¨‹ç«¯å£ä»¥å¤‡å°†æ¥ä½¿ç”¨ã€‚</code></td>
</tr>
<tr>
<td><code>[self setRemotePortï¼šoutPort];</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//åˆ›å»ºå¹¶é…ç½®å·¥ä½œçº¿ç¨‹ç«¯å£ã€‚</code></td>
</tr>
<tr>
<td><code>NSPort * myPort = [NSMachPortç«¯å£]ï¼›</code></td>
</tr>
<tr>
<td><code>[myPort setDelegateï¼šself];</code></td>
</tr>
<tr>
<td><code>[[NSRunLoop currentRunLoop] addPortï¼šmyPort forModeï¼šNSDefaultRunLoopMode];</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//åˆ›å»ºç­¾åˆ°æ¶ˆæ¯ã€‚</code></td>
</tr>
<tr>
<td><code>NSPortMessage * messageObj = [[NSPortMessage alloc] initWithSendPortï¼šoutPort</code></td>
</tr>
<tr>
<td><code>receivePortï¼šmyPortç»„ä»¶ï¼šæ— ]ï¼›</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆmessageObjï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//å®Œæˆæ¶ˆæ¯é…ç½®å¹¶ç«‹å³å‘é€ã€‚</code></td>
</tr>
<tr>
<td><code>[messageObj setMsgIdï¼šsetMsgidï¼škCheckinMessage]ï¼›</code></td>
</tr>
<tr>
<td><code>[messageObj sendBeforeDateï¼š[NSDate date]]ï¼›</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>######## é…ç½® NSMessagePort å¯¹è±¡</p>
<p>è¦ä¸Ž<code>NSMessagePort</code>å¯¹è±¡å»ºç«‹æœ¬åœ°è¿žæŽ¥ï¼Œä¸èƒ½ç®€å•åœ°åœ¨çº¿ç¨‹ä¹‹é—´ä¼ é€’ç«¯å£å¯¹è±¡ã€‚è¿œç¨‹æ¶ˆæ¯ç«¯å£å¿…é¡»æŒ‰åç§°èŽ·å–ã€‚è¦åœ¨ Cocoa ä¸­å®žçŽ°æ­¤åŠŸèƒ½ï¼Œéœ€è¦ä½¿ç”¨ç‰¹å®šåç§°æ³¨å†Œæ‚¨çš„æœ¬åœ°ç«¯å£ï¼Œç„¶åŽå°†è¯¥åç§°ä¼ é€’ç»™è¿œç¨‹çº¿ç¨‹ï¼Œä»¥ä¾¿å®ƒå¯ä»¥èŽ·å¾—ç”¨äºŽé€šä¿¡çš„é€‚å½“ç«¯å£å¯¹è±¡ã€‚æ¸…å• 3-16 æ˜¾ç¤ºäº†è¦ä½¿ç”¨æ¶ˆæ¯ç«¯å£çš„æƒ…å†µä¸‹çš„ç«¯å£åˆ›å»ºå’Œæ³¨å†Œè¿‡ç¨‹ã€‚</p>
<p><strong>æ¸…å• 3-16</strong> æ³¨å†Œæ¶ˆæ¯ç«¯å£</p>
<table>
<thead>
<tr>
<th><code>NSPort * localPort = [[NSMessagePort alloc] init];</code></th>
</tr>
</thead>
<tbody><tr>
<td>``</td>
</tr>
<tr>
<td><code>//é…ç½®å¯¹è±¡å¹¶å°†å…¶æ·»åŠ åˆ°å½“å‰è¿è¡Œå¾ªçŽ¯ä¸­ã€‚</code></td>
</tr>
<tr>
<td><code>[localPort setDelegateï¼šself];</code></td>
</tr>
<tr>
<td><code>[[NSRunLoop currentRunLoop] addPortï¼šlocalPort forModeï¼šNSDefaultRunLoopMode];</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//ä½¿ç”¨ç‰¹å®šåç§°æ³¨å†Œç«¯å£ã€‚åç§°å¿…é¡»å”¯ä¸€ã€‚</code></td>
</tr>
<tr>
<td><code>NSString * localPortName = [NSString stringWithFormatï¼š@â€œ MyPortNameâ€];</code></td>
</tr>
<tr>
<td><code>[[NSMessagePortNameServer sharedInstance] registerPortï¼šlocalPort</code></td>
</tr>
<tr>
<td><code>nameï¼šlocalPortName];</code></td>
</tr>
</tbody></table>
<p>######## åœ¨ Core Foundation ä¸­é…ç½®åŸºäºŽç«¯å£çš„è¾“å…¥æº</p>
<p>æœ¬èŠ‚è¯´æ˜Žå¦‚ä½•ä½¿ç”¨ Core Foundation åœ¨åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹å’Œè¾…åŠ©çº¿ç¨‹ä¹‹é—´å»ºç«‹åŒå‘é€šä¿¡é€šé“ã€‚</p>
<p>æ¸…å• 3-17 æ˜¾ç¤ºäº†ç”±åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹è°ƒç”¨ä»¥å¯åŠ¨å·¥ä½œçº¿ç¨‹çš„ä»£ç ã€‚ä»£ç è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å»ºç«‹ä¸€ä¸ª<code>CFMessagePortRef</code>ä¸é€æ˜Žç±»åž‹ï¼Œä»¥ä¾¦å¬æ¥è‡ªå·¥ä½œçº¿ç¨‹çš„æ¶ˆæ¯ã€‚å·¥ä½œçº¿ç¨‹éœ€è¦ä½¿ç”¨ç«¯å£åç§°è¿›è¡Œè¿žæŽ¥ï¼Œä»¥ä¾¿å°†å­—ç¬¦ä¸²å€¼ä¼ é€’åˆ°å·¥ä½œçº¿ç¨‹çš„å…¥å£ç‚¹å‡½æ•°ã€‚åœ¨å½“å‰ç”¨æˆ·ä¸Šä¸‹æ–‡ä¸­ï¼Œç«¯å£åç§°é€šå¸¸åº”è¯¥æ˜¯å”¯ä¸€çš„ï¼›å¦åˆ™ï¼Œæ‚¨å¯èƒ½ä¼šé‡åˆ°å†²çªã€‚</p>
<p><strong>æ¸…å• 3-17</strong> å°† Core Foundation æ¶ˆæ¯ç«¯å£é™„åŠ åˆ°æ–°çº¿ç¨‹</p>
<table>
<thead>
<tr>
<th><code>ï¼ƒå®šä¹‰kThreadStackSizeï¼ˆ8 * 4096ï¼‰</code></th>
</tr>
</thead>
<tbody><tr>
<td>``</td>
</tr>
<tr>
<td><code>OSStatus MySpawnThreadï¼ˆï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//åˆ›å»ºä¸€ä¸ªæœ¬åœ°ç«¯å£ä»¥æŽ¥æ”¶å“åº”ã€‚</code></td>
</tr>
<tr>
<td><code>CFStringRef myPortName;</code></td>
</tr>
<tr>
<td><code>CFMessagePortRef myPort;</code></td>
</tr>
<tr>
<td><code>CFRunLoopSourceRef rlSource;</code></td>
</tr>
<tr>
<td><code>CFMessagePortContext context = {0ï¼ŒNULLï¼ŒNULLï¼ŒNULLï¼ŒNULL};</code></td>
</tr>
<tr>
<td><code>å¸ƒå°”å€¼shouldFreeInfo;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//ç”¨ç«¯å£ååˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</code></td>
</tr>
<tr>
<td><code>myPortName = CFStringCreateWithFormatï¼ˆNULLï¼ŒNULLï¼ŒCFSTRï¼ˆâ€œ com.myapp.MainThreadâ€ï¼‰ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//åˆ›å»ºç«¯å£ã€‚</code></td>
</tr>
<tr>
<td><code>myPort = CFMessagePortCreateLocalï¼ˆNULLï¼Œ</code></td>
</tr>
<tr>
<td><code>myPortNameï¼Œ</code></td>
</tr>
<tr>
<td><code>ï¼†MainThreadResponseHandlerï¼Œ</code></td>
</tr>
<tr>
<td><code>ï¼†contextï¼Œ</code></td>
</tr>
<tr>
<td><code>ï¼†shouldFreeInfoï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆmyPortï¼= NULLï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//ç«¯å£å·²æˆåŠŸåˆ›å»ºã€‚</code></td>
</tr>
<tr>
<td><code>//çŽ°åœ¨ä¸ºå…¶åˆ›å»ºä¸€ä¸ªè¿è¡Œå¾ªçŽ¯æºã€‚</code></td>
</tr>
<tr>
<td><code>rlSource = CFMessagePortCreateRunLoopSourceï¼ˆNULLï¼ŒmyPortï¼Œ0ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆrlSourceï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//å°†æºæ·»åŠ åˆ°å½“å‰çš„è¿è¡Œå¾ªçŽ¯ä¸­ã€‚</code></td>
</tr>
<tr>
<td><code>CFRunLoopAddSourceï¼ˆCFRunLoopGetCurrentï¼ˆï¼‰ï¼ŒrlSourceï¼ŒkCFRunLoopDefaultModeï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//ä¸€æ—¦å®‰è£…ï¼Œå°±å¯ä»¥é‡Šæ”¾å®ƒä»¬ã€‚</code></td>
</tr>
<tr>
<td><code>CFReleaseï¼ˆmyPortï¼‰;</code></td>
</tr>
<tr>
<td><code>CFReleaseï¼ˆrlSourceï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//åˆ›å»ºçº¿ç¨‹å¹¶ç»§ç»­å¤„ç†ã€‚</code></td>
</tr>
<tr>
<td><code>MPTaskID taskID;</code></td>
</tr>
<tr>
<td><code>returnï¼ˆMPCreateTaskï¼ˆï¼†ServerThreadEntryPointï¼Œ</code></td>
</tr>
<tr>
<td><code>ï¼ˆvoid *ï¼‰myPortNameï¼Œ</code></td>
</tr>
<tr>
<td><code>kThreadStackSizeï¼Œ</code></td>
</tr>
<tr>
<td><code>ç©ºå€¼ï¼Œ</code></td>
</tr>
<tr>
<td><code>ç©ºå€¼ï¼Œ</code></td>
</tr>
<tr>
<td><code>ç©ºå€¼ï¼Œ</code></td>
</tr>
<tr>
<td><code>0ï¼Œ</code></td>
</tr>
<tr>
<td><code>ï¼†taskIDï¼‰ï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>å®‰è£…ç«¯å£å¹¶å¯åŠ¨çº¿ç¨‹åŽï¼Œä¸»çº¿ç¨‹å¯ä»¥åœ¨ç­‰å¾…çº¿ç¨‹æ£€å…¥çš„åŒæ—¶ç»§ç»­å…¶å¸¸è§„æ‰§è¡Œã€‚å½“æ£€å…¥æ¶ˆæ¯åˆ°è¾¾æ—¶ï¼Œå®ƒå°†åˆ†æ´¾ç»™ä¸»çº¿ç¨‹çš„<code>MainThreadResponseHandler</code>å‡½æ•°ï¼Œå¦‚æ¸…å• 3-18 æ‰€ç¤ºã€‚ã€‚æ­¤å‡½æ•°æå–å·¥ä½œçº¿ç¨‹çš„ç«¯å£åï¼Œå¹¶åˆ›å»ºç”¨äºŽå°†æ¥é€šä¿¡çš„ç®¡é“ã€‚</p>
<p><strong>æ¸…å• 3-18</strong> æŽ¥æ”¶ç­¾å…¥æ¶ˆæ¯</p>
<table>
<thead>
<tr>
<th><code>#define kCheckinMessage 100</code></th>
</tr>
</thead>
<tbody><tr>
<td>``</td>
</tr>
<tr>
<td><code>//ä¸»çº¿ç¨‹ç«¯å£æ¶ˆæ¯å¤„ç†ç¨‹åº</code></td>
</tr>
<tr>
<td><code>CFDataRef MainThreadResponseHandlerï¼ˆCFMessagePortRef localï¼Œ</code></td>
</tr>
<tr>
<td><code>SInt32 msgidï¼Œ</code></td>
</tr>
<tr>
<td><code>CFDataRefæ•°æ®ï¼Œ</code></td>
</tr>
<tr>
<td><code>æ— æ•ˆ*ä¿¡æ¯ï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆmsgid == kCheckinMessageï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>CFMessagePortRef messagePort;</code></td>
</tr>
<tr>
<td><code>CFStringRef threadPortName;</code></td>
</tr>
<tr>
<td><code>CFIndex bufferLength = CFDataGetLengthï¼ˆdataï¼‰;</code></td>
</tr>
<tr>
<td><code>UInt8 * buffer = CFAllocatorAllocateï¼ˆNULLï¼ŒbufferLengthï¼Œ0ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>CFDataGetBytesï¼ˆdataï¼ŒCFRangeMakeï¼ˆ0ï¼ŒbufferLengthï¼‰ï¼Œbufferï¼‰;</code></td>
</tr>
<tr>
<td><code>threadPortName = CFStringCreateWithBytesï¼ˆNULLï¼Œbufferï¼ŒbufferLengthï¼ŒkCFStringEncodingASCIIï¼ŒFALSEï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//æ‚¨å¿…é¡»æŒ‰åç§°èŽ·å–è¿œç¨‹æ¶ˆæ¯ç«¯å£ã€‚</code></td>
</tr>
<tr>
<td><code>messagePort = CFMessagePortCreateRemoteï¼ˆNULLï¼Œï¼ˆCFStringRefï¼‰threadPortNameï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆmessagePortï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//ä¿ç•™å¹¶ä¿å­˜çº¿ç¨‹çš„é€šè®¯ç«¯å£ï¼Œä»¥å¤‡å°†æ¥å‚è€ƒã€‚</code></td>
</tr>
<tr>
<td><code>AddPortToListOfActiveThreadsï¼ˆmessagePortï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//ç”±äºŽè¯¥ç«¯å£ç”±ä¸Šä¸€ä¸ªå‡½æ•°ä¿ç•™ï¼Œå› æ­¤é‡Šæ”¾</code></td>
</tr>
<tr>
<td><code>// åœ¨è¿™é‡Œã€‚</code></td>
</tr>
<tr>
<td><code>CFReleaseï¼ˆmessagePortï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>// æ¸…ç†ã€‚</code></td>
</tr>
<tr>
<td><code>CFReleaseï¼ˆthreadPortNameï¼‰;</code></td>
</tr>
<tr>
<td><code>CFAllocatorDeallocateï¼ˆNULLï¼Œbufferï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>å…¶ä»–</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//å¤„ç†å…¶ä»–æ¶ˆæ¯ã€‚</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>è¿”å›žNULL;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>é…ç½®äº†ä¸»çº¿ç¨‹åŽï¼Œå‰©ä¸‹çš„å”¯ä¸€äº‹æƒ…å°±æ˜¯æ–°åˆ›å»ºçš„å·¥ä½œçº¿ç¨‹åˆ›å»ºè‡ªå·±çš„ç«¯å£å¹¶ç­¾å…¥ã€‚æ¸…å• 3-19 æ˜¾ç¤ºäº†å·¥ä½œçº¿ç¨‹çš„å…¥å£ç‚¹å‡½æ•°ã€‚è¯¥å‡½æ•°æå–ä¸»çº¿ç¨‹çš„ç«¯å£åï¼Œå¹¶ä½¿ç”¨å®ƒæ¥åˆ›å»ºè¿”å›žåˆ°ä¸»çº¿ç¨‹çš„è¿œç¨‹è¿žæŽ¥ã€‚ç„¶åŽï¼Œè¯¥å‡½æ•°ä¸ºå…¶è‡ªèº«åˆ›å»ºä¸€ä¸ªæœ¬åœ°ç«¯å£ï¼Œå°†è¯¥ç«¯å£å®‰è£…åœ¨çº¿ç¨‹çš„è¿è¡Œå¾ªçŽ¯ä¸Šï¼Œå¹¶å‘ä¸»çº¿ç¨‹å‘é€åŒ…å«æœ¬åœ°ç«¯å£åç§°çš„ç­¾å…¥æ¶ˆæ¯ã€‚</p>
<p><strong>æ¸…å• 3-19</strong> è®¾ç½®çº¿ç¨‹ç»“æž„</p>
<table>
<thead>
<tr>
<th><code>OSStatus ServerThreadEntryPointï¼ˆvoid *å‚æ•°ï¼‰</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//åˆ›å»ºåˆ°ä¸»çº¿ç¨‹çš„è¿œç¨‹ç«¯å£ã€‚</code></td>
</tr>
<tr>
<td><code>CFMessagePortRef mainThreadPort;</code></td>
</tr>
<tr>
<td><code>CFStringRef portName =ï¼ˆCFStringRefï¼‰param;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>mainThreadPort = CFMessagePortCreateRemoteï¼ˆNULLï¼ŒportNameï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//é‡Šæ”¾åœ¨å‚æ•°ä¸­ä¼ é€’çš„å­—ç¬¦ä¸²ã€‚</code></td>
</tr>
<tr>
<td><code>CFReleaseï¼ˆç«¯å£åï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//ä¸ºå·¥ä½œçº¿ç¨‹åˆ›å»ºä¸€ä¸ªç«¯å£ã€‚</code></td>
</tr>
<tr>
<td><code>CFStringRef myPortName = CFStringCreateWithFormatï¼ˆNULLï¼ŒNULLï¼ŒCFSTRï¼ˆâ€œ com.MyApp.Thread-ï¼…dâ€ï¼‰ï¼ŒMPCurrentTaskIDï¼ˆï¼‰ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å°†ç«¯å£å­˜å‚¨åœ¨æ­¤çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ä¸­ï¼Œä»¥ä¾›ä»¥åŽå‚è€ƒã€‚</code></td>
</tr>
<tr>
<td><code>CFMessagePortContext context = {0ï¼ŒmainThreadPortï¼ŒNULLï¼ŒNULLï¼ŒNULL};</code></td>
</tr>
<tr>
<td><code>å¸ƒå°”å€¼shouldFreeInfo;</code></td>
</tr>
<tr>
<td><code>å¸ƒå°”å€¼shouldAbort = TRUE;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>CFMessagePortRef myPort = CFMessagePortCreateLocalï¼ˆNULLï¼Œ</code></td>
</tr>
<tr>
<td><code>myPortNameï¼Œ</code></td>
</tr>
<tr>
<td><code>ï¼†ProcessClientRequestï¼Œ</code></td>
</tr>
<tr>
<td><code>ï¼†contextï¼Œ</code></td>
</tr>
<tr>
<td><code>ï¼†shouldFreeInfoï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆshouldFreeInfoï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//æ— æ³•åˆ›å»ºæœ¬åœ°ç«¯å£ï¼Œå› æ­¤è¯·ç»ˆæ­¢çº¿ç¨‹ã€‚</code></td>
</tr>
<tr>
<td><code>MPExitï¼ˆ0ï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>CFRunLoopSourceRef rlSource = CFMessagePortCreateRunLoopSourceï¼ˆNULLï¼ŒmyPortï¼Œ0ï¼‰;</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆï¼rlSourceï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//æ— æ³•åˆ›å»ºæœ¬åœ°ç«¯å£ï¼Œå› æ­¤è¯·ç»ˆæ­¢çº¿ç¨‹ã€‚</code></td>
</tr>
<tr>
<td><code>MPExitï¼ˆ0ï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å°†æºæ·»åŠ åˆ°å½“å‰çš„è¿è¡Œå¾ªçŽ¯ä¸­ã€‚</code></td>
</tr>
<tr>
<td><code>CFRunLoopAddSourceï¼ˆCFRunLoopGetCurrentï¼ˆï¼‰ï¼ŒrlSourceï¼ŒkCFRunLoopDefaultModeï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//ä¸€æ—¦å®‰è£…ï¼Œå°±å¯ä»¥é‡Šæ”¾å®ƒä»¬ã€‚</code></td>
</tr>
<tr>
<td><code>CFReleaseï¼ˆmyPortï¼‰;</code></td>
</tr>
<tr>
<td><code>CFReleaseï¼ˆrlSourceï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//æ‰“åŒ…ç«¯å£åç§°å¹¶å‘é€ç­¾å…¥æ¶ˆæ¯ã€‚</code></td>
</tr>
<tr>
<td><code>CFDataRef returnData = nil;</code></td>
</tr>
<tr>
<td><code>CFDataRef outData;</code></td>
</tr>
<tr>
<td><code>CFIndex stringLength = CFStringGetLengthï¼ˆmyPortNameï¼‰;</code></td>
</tr>
<tr>
<td><code>UInt8 * buffer = CFAllocatorAllocateï¼ˆNULLï¼ŒstringLengthï¼Œ0ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>CFStringGetBytesï¼ˆmyPortNameï¼Œ</code></td>
</tr>
<tr>
<td><code>CFRangeMakeï¼ˆ0ï¼ŒstringLengthï¼‰ï¼Œ</code></td>
</tr>
<tr>
<td><code>kCFStringEncodingASCIIï¼Œ</code></td>
</tr>
<tr>
<td><code>0ï¼Œ</code></td>
</tr>
<tr>
<td><code>å‡ï¼Œ</code></td>
</tr>
<tr>
<td><code>ç¼“å†²ï¼Œ</code></td>
</tr>
<tr>
<td><code>stringLengthï¼Œ</code></td>
</tr>
<tr>
<td><code>ç©ºå€¼ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>outData = CFDataCreateï¼ˆNULLï¼Œbufferï¼ŒstringLengthï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>CFMessagePortSendRequestï¼ˆmainThreadPortï¼ŒkCheckinMessageï¼ŒoutDataï¼Œ0.1ï¼Œ0.0ï¼ŒNULLï¼ŒNULLï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//æ¸…ç†çº¿ç¨‹æ•°æ®ç»“æž„ã€‚</code></td>
</tr>
<tr>
<td><code>CFReleaseï¼ˆoutDataï¼‰;</code></td>
</tr>
<tr>
<td><code>CFAllocatorDeallocateï¼ˆNULLï¼Œbufferï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//è¿›å…¥è¿è¡Œå¾ªçŽ¯ã€‚</code></td>
</tr>
<tr>
<td><code>CFRunLoopRunï¼ˆï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>ä¸€æ—¦è¿›å…¥è¿è¡Œå¾ªçŽ¯ï¼Œè¯¥<code>ProcessClientRequest</code>å‡½æ•°å°†å¤„ç†æ‰€æœ‰å°†æ¥å‘é€åˆ°çº¿ç¨‹ç«¯å£çš„äº‹ä»¶ã€‚è¯¥å‡½æ•°çš„å®žçŽ°å–å†³äºŽçº¿ç¨‹æ‰§è¡Œçš„å·¥ä½œç±»åž‹ï¼Œæ­¤å¤„æœªæ˜¾ç¤ºã€‚</p>
<h2 id="åŒæ­¥åŒ–"><a href="#åŒæ­¥åŒ–" class="headerlink" title="åŒæ­¥åŒ–"></a>åŒæ­¥åŒ–</h2><p>åº”ç”¨ç¨‹åºä¸­å­˜åœ¨å¤šä¸ªçº¿ç¨‹å¸¦æ¥äº†ä¸Žä»Žå¤šä¸ªæ‰§è¡Œçº¿ç¨‹å®‰å…¨è®¿é—®èµ„æºæœ‰å…³çš„æ½œåœ¨é—®é¢˜ã€‚ä¿®æ”¹åŒä¸€èµ„æºçš„ä¸¤ä¸ªçº¿ç¨‹å¯èƒ½ä¼šä»¥æ„æƒ³ä¸åˆ°çš„æ–¹å¼ç›¸äº’å¹²æ‰°ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªçº¿ç¨‹å¯èƒ½ä¼šè¦†ç›–å¦ä¸€ä¸ªçº¿ç¨‹çš„æ›´æ”¹ï¼Œæˆ–è€…å°†åº”ç”¨ç¨‹åºç½®äºŽæœªçŸ¥ä¸”å¯èƒ½æ— æ•ˆçš„çŠ¶æ€ã€‚å¦‚æžœå¹¸è¿çš„è¯ï¼ŒæŸåçš„èµ„æºå¯èƒ½ä¼šå¯¼è‡´æ˜Žæ˜¾çš„æ€§èƒ½é—®é¢˜æˆ–å´©æºƒï¼Œè¿™äº›é—®é¢˜ç›¸å¯¹å®¹æ˜“è·Ÿè¸ªå’Œä¿®å¤ã€‚ä½†æ˜¯ï¼Œå¦‚æžœæ‚¨ä¸èµ°è¿ï¼ŒæŸåå¯èƒ½ä¼šå¯¼è‡´ç»†å¾®çš„é”™è¯¯ï¼Œç›´åˆ°å¾ˆä¹…ä»¥åŽæ‰ä¼šæ˜¾çŽ°å‡ºæ¥ï¼Œæˆ–è€…è¿™äº›é”™è¯¯å¯èƒ½éœ€è¦å¯¹åŸºç¡€çš„ç¼–ç å‡è®¾è¿›è¡Œé‡å¤§æ£€æŸ¥ã€‚</p>
<p>åœ¨çº¿ç¨‹å®‰å…¨æ–¹é¢ï¼Œå¥½çš„è®¾è®¡æ˜¯æ‚¨æ‹¥æœ‰çš„æœ€ä½³ä¿æŠ¤ã€‚é¿å…å…±äº«èµ„æºå¹¶æœ€å°åŒ–çº¿ç¨‹ä¹‹é—´çš„äº¤äº’ï¼Œä½¿è¿™äº›çº¿ç¨‹ç›¸äº’å¹²æ‰°çš„å¯èƒ½æ€§é™ä½Žã€‚ä½†æ˜¯ï¼Œå¹¶éžæ€»æ˜¯å¯ä»¥å®žçŽ°å®Œå…¨æ— å¹²æ‰°çš„è®¾è®¡ã€‚å¦‚æžœæ‚¨çš„çº¿ç¨‹å¿…é¡»è¿›è¡Œäº¤äº’ï¼Œåˆ™éœ€è¦ä½¿ç”¨åŒæ­¥å·¥å…·æ¥ç¡®ä¿å®ƒä»¬åœ¨äº¤äº’æ—¶å®‰å…¨åœ°è¿›è¡Œäº¤äº’ã€‚</p>
<p>OS X å’Œ iOS æä¾›äº†è®¸å¤šåŒæ­¥å·¥å…·ä¾›æ‚¨ä½¿ç”¨ï¼Œä»Žæä¾›äº’æ–¥è®¿é—®çš„å·¥å…·åˆ°åœ¨åº”ç”¨ç¨‹åºä¸­æ­£ç¡®æŽ’åºäº‹ä»¶çš„å·¥å…·ã€‚ä»¥ä¸‹å„èŠ‚æè¿°äº†è¿™äº›å·¥å…·ä»¥åŠå¦‚ä½•åœ¨ä»£ç ä¸­ä½¿ç”¨å®ƒä»¬ä»¥å½±å“å¯¹ç¨‹åºèµ„æºçš„å®‰å…¨è®¿é—®ã€‚</p>
<h4 id="åŒæ­¥å·¥å…·"><a href="#åŒæ­¥å·¥å…·" class="headerlink" title="åŒæ­¥å·¥å…·"></a>åŒæ­¥å·¥å…·</h4><p>ä¸ºäº†é˜²æ­¢ä¸åŒçš„çº¿ç¨‹æ„å¤–æ›´æ”¹æ•°æ®ï¼Œå¯ä»¥å°†åº”ç”¨ç¨‹åºè®¾è®¡ä¸ºä¸å­˜åœ¨åŒæ­¥é—®é¢˜ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŒæ­¥å·¥å…·ã€‚å°½ç®¡æœ€å¥½å®Œå…¨é¿å…åŒæ­¥é—®é¢˜ï¼Œä½†è¿™å¹¶ä¸æ€»æ˜¯å¯èƒ½çš„ã€‚ä»¥ä¸‹å„èŠ‚ä»‹ç»äº†å¯ä¾›æ‚¨ä½¿ç”¨çš„åŒæ­¥å·¥å…·çš„åŸºæœ¬ç±»åˆ«ã€‚</p>
<h6 id="åŽŸå­æ“ä½œ"><a href="#åŽŸå­æ“ä½œ" class="headerlink" title="åŽŸå­æ“ä½œ"></a>åŽŸå­æ“ä½œ</h6><p>åŽŸå­æ“ä½œæ˜¯ä¸€ç§ç®€å•çš„åŒæ­¥å½¢å¼ï¼Œé€‚ç”¨äºŽç®€å•çš„æ•°æ®ç±»åž‹ã€‚åŽŸå­æ“ä½œçš„ä¼˜ç‚¹æ˜¯å®ƒä»¬ä¸ä¼šé˜»å¡žç«žäº‰çº¿ç¨‹ã€‚å¯¹äºŽç®€å•çš„æ“ä½œï¼ˆä¾‹å¦‚å¢žåŠ è®¡æ•°å™¨å˜é‡ï¼‰ï¼Œè¿™æ¯”ä½¿ç”¨é”å¯ä»¥å¸¦æ¥æ›´å¥½çš„æ€§èƒ½ã€‚</p>
<p>OS X å’Œ iOS åŒ…å«è®¸å¤šæ“ä½œï¼Œå¯ä»¥å¯¹ 32 ä½å’Œ 64 ä½å€¼æ‰§è¡ŒåŸºæœ¬çš„æ•°å­¦å’Œé€»è¾‘è¿ç®—ã€‚è¿™äº›æ“ä½œåŒ…æ‹¬æ¯”è¾ƒå’Œäº¤æ¢ï¼Œæµ‹è¯•å’Œè®¾ç½®ä»¥åŠæµ‹è¯•å’Œæ¸…é™¤æ“ä½œçš„åŽŸå­ç‰ˆæœ¬ã€‚æœ‰å…³å—æ”¯æŒçš„åŽŸå­æ“ä½œçš„åˆ—è¡¨ï¼Œè¯·å‚è§<code>/usr/include/libkern/OSAtomic.h</code>å¤´æ–‡ä»¶æˆ–<code>atomic</code>æ‰‹å†Œé¡µã€‚</p>
<h6 id="å†…å­˜å£åž’å’Œæ˜“å¤±æ€§å˜é‡"><a href="#å†…å­˜å£åž’å’Œæ˜“å¤±æ€§å˜é‡" class="headerlink" title="å†…å­˜å£åž’å’Œæ˜“å¤±æ€§å˜é‡"></a>å†…å­˜å£åž’å’Œæ˜“å¤±æ€§å˜é‡</h6><p>ä¸ºäº†èŽ·å¾—æœ€ä½³æ€§èƒ½ï¼Œç¼–è¯‘å™¨ç»å¸¸å¯¹æ±‡ç¼–çº§æŒ‡ä»¤è¿›è¡Œé‡æ–°æŽ’åºï¼Œä»¥ä½¿å¤„ç†å™¨çš„æŒ‡ä»¤æµæ°´çº¿å°½å¯èƒ½å®Œæ•´ã€‚ä½œä¸ºæ­¤ä¼˜åŒ–çš„ä¸€éƒ¨åˆ†ï¼Œå½“ç¼–è¯‘å™¨è®¤ä¸ºè¿™æ ·åšä¸ä¼šäº§ç”Ÿä¸æ­£ç¡®çš„æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šå¯¹è®¿é—®ä¸»å†…å­˜çš„æŒ‡ä»¤è¿›è¡Œé‡æ–°æŽ’åºã€‚ä¸å¹¸çš„æ˜¯ï¼Œç¼–è¯‘å™¨å¹¶éžæ€»æ˜¯èƒ½å¤Ÿæ£€æµ‹åˆ°æ‰€æœ‰ä¸Žå†…å­˜ç›¸å…³çš„æ“ä½œã€‚å¦‚æžœçœ‹ä¼¼ç‹¬ç«‹çš„å˜é‡å®žé™…ä¸Šç›¸äº’å½±å“ï¼Œåˆ™ç¼–è¯‘å™¨ä¼˜åŒ–å¯èƒ½ä¼šä»¥é”™è¯¯çš„é¡ºåºæ›´æ–°è¿™äº›å˜é‡ï¼Œä»Žè€Œäº§ç”Ÿå¯èƒ½ä¸æ­£ç¡®çš„ç»“æžœã€‚</p>
<p>å†…å­˜å±éšœæ˜¯ä¸€ç§éžé˜»å¡žåŒæ­¥å·¥å…·ï¼Œç”¨äºŽç¡®ä¿å†…å­˜æ“ä½œä»¥æ­£ç¡®çš„é¡ºåºå‘ç”Ÿã€‚å†…å­˜å±éšœçš„ä½œç”¨ç±»ä¼¼äºŽå›´æ ï¼Œè¿«ä½¿å¤„ç†å™¨åœ¨å…è®¸æ‰§è¡Œä½äºŽå±éšœä¹‹åŽçš„åŠ è½½å’Œå­˜å‚¨æ“ä½œä¹‹å‰ï¼Œå®Œæˆä½äºŽå±éšœå‰é¢çš„æ‰€æœ‰åŠ è½½å’Œå­˜å‚¨æ“ä½œã€‚å†…å­˜å±éšœé€šå¸¸ç”¨äºŽç¡®ä¿ä¸€ä¸ªçº¿ç¨‹ï¼ˆä½†å¦ä¸€çº¿ç¨‹å¯è§ï¼‰çš„å†…å­˜æ“ä½œå§‹ç»ˆæŒ‰é¢„æœŸçš„é¡ºåºå‘ç”Ÿã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ç¼ºå°‘å†…å­˜å±éšœå¯èƒ½ä¼šä½¿å…¶ä»–çº¿ç¨‹çœ‹åˆ°çœ‹ä¼¼ä¸å¯èƒ½çš„ç»“æžœã€‚ï¼ˆæœ‰å…³ç¤ºä¾‹ï¼Œè¯·å‚é˜… Wikipedia æ¡ç›®ä¸­çš„<a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Memory_barrier">å†…å­˜éšœç¢</a>ã€‚ï¼‰è¦ä½¿ç”¨å†…å­˜éšœç¢ï¼Œåªéœ€<code>OSMemoryBarrier</code>åœ¨ä»£ç ä¸­çš„é€‚å½“ä½ç½®è°ƒç”¨è¯¥å‡½æ•°ã€‚</p>
<p>æ˜“å¤±æ€§å˜é‡å°†å¦ä¸€ç§ç±»åž‹çš„å†…å­˜çº¦æŸåº”ç”¨äºŽå•ä¸ªå˜é‡ã€‚ç¼–è¯‘å™¨é€šå¸¸é€šè¿‡å°†å˜é‡çš„å€¼åŠ è½½åˆ°å¯„å­˜å™¨ä¸­æ¥ä¼˜åŒ–ä»£ç ã€‚å¯¹äºŽå±€éƒ¨å˜é‡ï¼Œè¿™é€šå¸¸ä¸æ˜¯é—®é¢˜ã€‚ä½†æ˜¯ï¼Œå¦‚æžœä»Žå¦ä¸€ä¸ªçº¿ç¨‹å¯è§è¯¥å˜é‡ï¼Œåˆ™è¿™ç§ä¼˜åŒ–å¯èƒ½ä¼šé˜»æ­¢å¦ä¸€ä¸ªçº¿ç¨‹æ³¨æ„åˆ°å¯¹è¯¥å˜é‡çš„ä»»ä½•æ›´æ”¹ã€‚å°†<code>volatile</code>å…³é”®å­—åº”ç”¨äºŽå˜é‡ä¼šå¼ºåˆ¶ç¼–è¯‘å™¨æ¯æ¬¡ä½¿ç”¨æ—¶ä»Žå†…å­˜ä¸­åŠ è½½è¯¥å˜é‡ã€‚æ‚¨å¯ä»¥å£°æ˜Žä¸€ä¸ªå˜é‡ï¼Œ<code>volatile</code>å¥½åƒå®ƒçš„å€¼å¯ä»¥éšæ—¶è¢«ç¼–è¯‘å™¨å¯èƒ½æ— æ³•æ£€æµ‹åˆ°çš„å¤–éƒ¨æºæ›´æ”¹ä¸€æ ·ã€‚</p>
<p>ç”±äºŽå†…å­˜å±éšœå’Œæ˜“å¤±æ€§å˜é‡éƒ½å‡å°‘äº†ç¼–è¯‘å™¨å¯æ‰§è¡Œçš„ä¼˜åŒ–æ¬¡æ•°ï¼Œå› æ­¤åº”è°¨æ…Žä½¿ç”¨å®ƒä»¬ï¼Œå¹¶ä¸”ä»…åœ¨éœ€è¦ç¡®ä¿æ­£ç¡®æ€§çš„åœ°æ–¹ä½¿ç”¨å®ƒä»¬ã€‚æœ‰å…³ä½¿ç”¨å†…å­˜å±éšœçš„ä¿¡æ¯ï¼Œè¯·å‚è§ <code>OSMemoryBarrier</code>æ‰‹å†Œé¡µã€‚</p>
<h6 id="é”å…·"><a href="#é”å…·" class="headerlink" title="é”å…·"></a>é”å…·</h6><p>é”æ˜¯æœ€å¸¸ç”¨çš„åŒæ­¥å·¥å…·ä¹‹ä¸€ã€‚æ‚¨å¯ä»¥ä½¿ç”¨é”æ¥ä¿æŠ¤ä»£ç çš„<em>å…³é”®éƒ¨åˆ†</em>ï¼Œè¿™æ˜¯ä¸€æ®µä»£ç ï¼Œä¸€æ¬¡åªèƒ½å…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå…³é”®éƒ¨åˆ†å¯èƒ½æ“çºµç‰¹å®šçš„æ•°æ®ç»“æž„æˆ–ä¸€æ¬¡ä½¿ç”¨æœ€å¤šæ”¯æŒä¸€ä¸ªå®¢æˆ·ç«¯çš„æŸäº›èµ„æºã€‚é€šè¿‡åœ¨æ­¤éƒ¨åˆ†å‘¨å›´åŠ é”ï¼Œå¯ä»¥æŽ’é™¤å…¶ä»–çº¿ç¨‹è¿›è¡Œå¯èƒ½å½±å“ä»£ç æ­£ç¡®æ€§çš„æ›´æ”¹ã€‚</p>
<p>è¡¨ 4-1 åˆ—å‡ºäº†ç¨‹åºå‘˜å¸¸ç”¨çš„ä¸€äº›é”ã€‚OS X å’Œ iOS æä¾›äº†å¤§å¤šæ•°æ­¤ç±»é”ç±»åž‹çš„å®žçŽ°ï¼Œä½†å¹¶éžå…¨éƒ¨ã€‚å¯¹äºŽä¸å—æ”¯æŒçš„é”ç±»åž‹ï¼Œæè¿°åˆ—è¯´æ˜Žäº†æœªåœ¨å¹³å°ä¸Šç›´æŽ¥å®žçŽ°è¿™äº›é”çš„åŽŸå› ã€‚</p>
<table>
<thead>
<tr>
<th align="left">é”</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">äº’æ–¥ä½“</td>
<td align="left">äº’æ–¥ï¼ˆæˆ–<em>äº’æ–¥</em>ï¼‰é”å……å½“èµ„æºå‘¨å›´çš„ä¿æŠ¤æ€§å±éšœã€‚äº’æ–¥é”æ˜¯ä¸€ç§ä¿¡å·é‡ï¼Œå®ƒä¸€æ¬¡åªèƒ½æŽˆäºˆå¯¹ä¸€ä¸ªçº¿ç¨‹çš„è®¿é—®æƒé™ã€‚å¦‚æžœæ­£åœ¨ä½¿ç”¨äº’æ–¥é”ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹è¯•å›¾èŽ·å–è¯¥äº’æ–¥é”ï¼Œåˆ™è¯¥çº¿ç¨‹å°†é˜»å¡žï¼Œç›´åˆ°è¯¥äº’æ–¥é”è¢«å…¶åŽŸå§‹æŒæœ‰è€…é‡Šæ”¾ä¸ºæ­¢ã€‚å¦‚æžœå¤šä¸ªçº¿ç¨‹ç«žäº‰åŒä¸€ä¸ªäº’æ–¥é”ï¼Œåˆ™ä¸€æ¬¡åªèƒ½è®¿é—®ä¸€ä¸ªã€‚</td>
</tr>
<tr>
<td align="left">é€’å½’é”</td>
<td align="left">é€’å½’é”æ˜¯äº’æ–¥é”çš„ä¸€ç§å˜ä½“ã€‚é€’å½’é”å…è®¸å•ä¸ªçº¿ç¨‹åœ¨é‡Šæ”¾å®ƒä¹‹å‰å¤šæ¬¡èŽ·å–è¯¥é”ã€‚å…¶ä»–çº¿ç¨‹å°†ä¿æŒé˜»å¡žçŠ¶æ€ï¼Œç›´åˆ°é”çš„æ‰€æœ‰è€…ä»¥ä¸ŽèŽ·å–é”ç›¸åŒçš„æ¬¡æ•°é‡Šæ”¾é”ã€‚é€’å½’é”ä¸»è¦åœ¨é€’å½’è¿­ä»£æœŸé—´ä½¿ç”¨ï¼Œä½†ä¹Ÿå¯ä»¥åœ¨å¤šä¸ªæ–¹æ³•å„è‡ªéœ€è¦åˆ†åˆ«èŽ·å–é”çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚</td>
</tr>
<tr>
<td align="left">è¯»å†™é”</td>
<td align="left">è¯»å†™é”ä¹Ÿç§°ä¸ºå…±äº«ç‹¬å é”ã€‚è¿™ç§ç±»åž‹çš„é”é€šå¸¸ç”¨äºŽè¾ƒå¤§è§„æ¨¡çš„æ“ä½œï¼Œå¦‚æžœç»å¸¸è¯»å–å—ä¿æŠ¤çš„æ•°æ®ç»“æž„å¹¶ä»…å¶å°”è¿›è¡Œä¿®æ”¹ï¼Œåˆ™å¯ä»¥æ˜¾ç€æé«˜æ€§èƒ½ã€‚åœ¨æ­£å¸¸æ“ä½œæœŸé—´ï¼Œå¤šä¸ªè¯»å–å™¨å¯ä»¥åŒæ—¶è®¿é—®æ•°æ®ç»“æž„ã€‚ä½†æ˜¯ï¼Œå½“çº¿ç¨‹è¦å†™å…¥ç»“æž„æ—¶ï¼Œå®ƒå°†é˜»å¡žï¼Œç›´åˆ°æ‰€æœ‰è¯»å–å™¨éƒ½é‡Šæ”¾é”ä¸ºæ­¢ï¼Œæ­¤æ—¶ï¼Œå®ƒèŽ·å–äº†é”å¹¶å¯ä»¥æ›´æ–°ç»“æž„ã€‚å½“å†™å…¥çº¿ç¨‹æ­£åœ¨ç­‰å¾…é”å®šæ—¶ï¼Œæ–°çš„è¯»å–å™¨çº¿ç¨‹å°†é˜»å¡žï¼Œç›´åˆ°å†™å…¥çº¿ç¨‹å®Œæˆã€‚ç³»ç»Ÿä»…æ”¯æŒä½¿ç”¨ POSIX çº¿ç¨‹çš„è¯»å†™é”ã€‚æœ‰å…³å¦‚ä½•ä½¿ç”¨è¿™äº›é”çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<code>pthread</code>æ‰‹å†Œé¡µã€‚</td>
</tr>
<tr>
<td align="left">åˆ†å¸ƒå¼é”</td>
<td align="left">åˆ†å¸ƒå¼é”åœ¨è¿›ç¨‹çº§åˆ«æä¾›äº’æ–¥è®¿é—®ã€‚ä¸ŽçœŸæ­£çš„äº’æ–¥é”ä¸åŒï¼Œåˆ†å¸ƒå¼é”ä¸ä¼šé˜»æ­¢è¿›ç¨‹æˆ–é˜»æ­¢å…¶è¿è¡Œã€‚å®ƒä»…æŠ¥å‘Šé”ä½•æ—¶ç¹å¿™ï¼Œå¹¶è®©è¿›ç¨‹å†³å®šå¦‚ä½•è¿›è¡Œã€‚</td>
</tr>
<tr>
<td align="left">è‡ªæ—‹é”</td>
<td align="left">è‡ªæ—‹é”åå¤è½®è¯¢å…¶é”å®šæ¡ä»¶ï¼Œç›´åˆ°è¯¥æ¡ä»¶å˜ä¸º trueã€‚è‡ªæ—‹é”æœ€å¸¸ç”¨äºŽå¤šå¤„ç†å™¨ç³»ç»Ÿï¼Œå…¶ä¸­é”çš„é¢„æœŸç­‰å¾…æ—¶é—´å¾ˆå°ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œè½®è¯¢é€šå¸¸æ¯”é˜»å¡žçº¿ç¨‹æ›´æœ‰æ•ˆï¼Œè¿™éœ€è¦ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œçº¿ç¨‹æ•°æ®ç»“æž„çš„æ›´æ–°ã€‚ç”±äºŽå®ƒä»¬å…·æœ‰è½®è¯¢æ€§è´¨ï¼Œå› æ­¤ç³»ç»Ÿä¸æä¾›è‡ªæ—‹é”çš„ä»»ä½•å®žçŽ°ï¼Œä½†æ˜¯æ‚¨å¯ä»¥åœ¨ç‰¹å®šæƒ…å†µä¸‹è½»æ¾åœ°å®žçŽ°å®ƒä»¬ã€‚æœ‰å…³åœ¨å†…æ ¸ä¸­å®žçŽ°è‡ªæ—‹é”çš„ä¿¡æ¯ï¼Œè¯·å‚è§ã€Š_<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Darwin/Conceptual/KernelProgramming/About/About.html#//apple_ref/doc/uid/TP30000905">å†…æ ¸ç¼–ç¨‹æŒ‡å—ã€‹</a>_ã€‚</td>
</tr>
<tr>
<td align="left">åŒé‡æ£€æŸ¥é”</td>
<td align="left">åŒé‡æ£€æŸ¥é”æ˜¯é€šè¿‡åœ¨èŽ·å–é”ä¹‹å‰æµ‹è¯•é”å®šæ¡ä»¶æ¥å‡å°‘èŽ·å–é”çš„å¼€é”€çš„å°è¯•ã€‚ç”±äºŽåŒé‡æ£€æŸ¥çš„é”å¯èƒ½ä¸å®‰å…¨ï¼Œå› æ­¤ç³»ç»Ÿä¸ä¼šä¸ºå®ƒä»¬æä¾›æ˜Žç¡®çš„æ”¯æŒï¼Œå› æ­¤ä¸å»ºè®®ä½¿ç”¨å®ƒä»¬ã€‚</td>
</tr>
</tbody></table>
<p><strong>æ³¨æ„ï¼š</strong> å¤§å¤šæ•°ç±»åž‹çš„é”è¿˜åŒ…å«ä¸€ä¸ªå†…å­˜å±éšœï¼Œä»¥ç¡®ä¿åœ¨è¿›å…¥å…³é”®éƒ¨åˆ†ä¹‹å‰å®Œæˆæ‰€æœ‰å…ˆå‰çš„è£…è½½å’Œå­˜å‚¨æŒ‡ä»¤ã€‚</p>
<p>æœ‰å…³å¦‚ä½•ä½¿ç”¨é”çš„ä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/ThreadSafety/ThreadSafety.html#//apple_ref/doc/uid/10000057i-CH8-SW16">ä½¿ç”¨é”</a>ã€‚</p>
<h6 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h6><p>æ¡ä»¶æ˜¯ä¿¡å·é‡çš„å¦ä¸€ç§ç±»åž‹ï¼Œå½“æŸä¸ªæ¡ä»¶ä¸ºçœŸæ—¶ï¼Œå®ƒå…è®¸çº¿ç¨‹å½¼æ­¤å‘ä¿¡å·ã€‚æ¡ä»¶é€šå¸¸ç”¨äºŽæŒ‡ç¤ºèµ„æºçš„å¯ç”¨æ€§æˆ–ç¡®ä¿ä»»åŠ¡ä»¥ç‰¹å®šé¡ºåºæ‰§è¡Œã€‚å½“çº¿ç¨‹æµ‹è¯•æ¡ä»¶æ—¶ï¼Œé™¤éžè¯¥æ¡ä»¶å·²ç»ä¸ºçœŸï¼Œå¦åˆ™å®ƒå°†é˜»å¡žã€‚å®ƒä¿æŒé˜»å¡žçŠ¶æ€ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹æ˜¾å¼æ›´æ”¹å¹¶å‘å‡ºæ¡ä»¶ä¿¡å·ä¸ºæ­¢ã€‚æ¡ä»¶å’Œäº’æ–¥é”ä¹‹é—´çš„åŒºåˆ«åœ¨äºŽï¼Œå¯ä»¥å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®è¯¥æ¡ä»¶ã€‚æ¡ä»¶æ›´å¤šæ˜¯çœ‹é—¨äººï¼Œå®ƒæ ¹æ®æŸäº›æŒ‡å®šçš„æ ‡å‡†è®©ä¸åŒçš„çº¿ç¨‹é€šè¿‡é—¨ã€‚</p>
<p>ä½¿ç”¨æ¡ä»¶çš„ä¸€ç§æ–¹æ³•æ˜¯ç®¡ç†æœªå†³äº‹ä»¶æ± ã€‚å½“äº‹ä»¶é˜Ÿåˆ—ä¸­æœ‰äº‹ä»¶æ—¶ï¼Œäº‹ä»¶é˜Ÿåˆ—å°†ä½¿ç”¨æ¡ä»¶å˜é‡æ¥é€šçŸ¥ç­‰å¾…çº¿ç¨‹ã€‚å¦‚æžœä¸€ä¸ªäº‹ä»¶åˆ°è¾¾ï¼Œåˆ™é˜Ÿåˆ—å°†é€‚å½“åœ°å‘å‡ºæ¡ä»¶ä¿¡å·ã€‚å¦‚æžœä¸€ä¸ªçº¿ç¨‹å·²ç»åœ¨ç­‰å¾…ï¼Œå®ƒå°†è¢«å”¤é†’ï¼ŒéšåŽå®ƒå°†æŠŠäº‹ä»¶ä»Žé˜Ÿåˆ—ä¸­æ‹‰å‡ºå¹¶è¿›è¡Œå¤„ç†ã€‚å¦‚æžœä¸¤ä¸ªäº‹ä»¶å‡ ä¹ŽåŒæ—¶è¿›å…¥é˜Ÿåˆ—ï¼Œåˆ™é˜Ÿåˆ—å°†ä¸¤æ¬¡å‘å‡ºä¿¡å·é€šçŸ¥çŠ¶æ€ä»¥å”¤é†’ä¸¤ä¸ªçº¿ç¨‹ã€‚</p>
<p>è¯¥ç³»ç»Ÿä¸ºå‡ ç§ä¸åŒæŠ€æœ¯çš„æ¡ä»¶æä¾›æ”¯æŒã€‚æ¡ä»¶çš„æ­£ç¡®å®žçŽ°éœ€è¦ä»”ç»†çš„ç¼–ç ï¼Œå› æ­¤ï¼Œåœ¨å°†å…¶ç”¨äºŽè‡ªå·±çš„ä»£ç ä¹‹å‰ï¼Œåº”å…ˆæŸ¥çœ‹â€œ <a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/ThreadSafety/ThreadSafety.html#//apple_ref/doc/uid/10000057i-CH8-SW4">ä½¿ç”¨æ¡ä»¶â€</a>ä¸­çš„ç¤ºä¾‹ã€‚</p>
<h6 id="æ‰§è¡Œé€‰æ‹©å™¨ä¾‹ç¨‹"><a href="#æ‰§è¡Œé€‰æ‹©å™¨ä¾‹ç¨‹" class="headerlink" title="æ‰§è¡Œé€‰æ‹©å™¨ä¾‹ç¨‹"></a>æ‰§è¡Œé€‰æ‹©å™¨ä¾‹ç¨‹</h6><p>å¯å¯åº”ç”¨ç¨‹åºå…·æœ‰ä¸€ç§ä»¥åŒæ­¥æ–¹å¼å°†æ¶ˆæ¯ä¼ é€’åˆ°å•ä¸ªçº¿ç¨‹çš„ä¾¿æ·æ–¹æ³•ã€‚åœ¨<code>NSObject</code>ç±»å£°æ˜Žå¯¹åº”ç”¨ç¨‹åºçš„æ´»åŠ¨çº¿ç¨‹çš„ä¸€ä¸ªè¿›è¡Œé€‰æ‹©çš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•ä½¿æ‚¨çš„çº¿ç¨‹å¯ä»¥å¼‚æ­¥ä¼ é€’æ¶ˆæ¯ï¼Œå¹¶ç¡®ä¿å®ƒä»¬å°†ç”±ç›®æ ‡çº¿ç¨‹åŒæ­¥æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ‰§è¡Œé€‰æ‹©å™¨æ¶ˆæ¯å°†ç»“æžœä»Žåˆ†å¸ƒå¼è®¡ç®—ä¼ é€’åˆ°åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹æˆ–æŒ‡å®šçš„åè°ƒå™¨çº¿ç¨‹ã€‚æ¯ä¸ªæ‰§è¡Œé€‰æ‹©å™¨çš„è¯·æ±‚éƒ½åœ¨ç›®æ ‡çº¿ç¨‹çš„è¿è¡Œå¾ªçŽ¯ä¸­æŽ’é˜Ÿï¼Œç„¶åŽæŒ‰ç…§æŽ¥æ”¶é¡ºåºå¯¹è¯·æ±‚è¿›è¡Œé¡ºåºå¤„ç†ã€‚</p>
<p>æœ‰å…³æ‰§è¡Œé€‰æ‹©å™¨ä¾‹ç¨‹çš„æ‘˜è¦ä»¥åŠæœ‰å…³å¦‚ä½•ä½¿ç”¨å®ƒä»¬çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW44">Cocoa Perform Selector Sources</a>ã€‚</p>
<h4 id="åŒæ­¥æˆæœ¬å’Œæ€§èƒ½"><a href="#åŒæ­¥æˆæœ¬å’Œæ€§èƒ½" class="headerlink" title="åŒæ­¥æˆæœ¬å’Œæ€§èƒ½"></a>åŒæ­¥æˆæœ¬å’Œæ€§èƒ½</h4><p>åŒæ­¥æœ‰åŠ©äºŽç¡®ä¿ä»£ç çš„æ­£ç¡®æ€§ï¼Œä½†è¿™æ ·åšä¼šç‰ºç‰²æ€§èƒ½ã€‚å³ä½¿åœ¨æ— äº‰è®®çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨åŒæ­¥å·¥å…·ä¹Ÿä¼šå¸¦æ¥å»¶è¿Ÿã€‚é”å’ŒåŽŸå­æ“ä½œé€šå¸¸æ¶‰åŠå†…å­˜å±éšœå’Œå†…æ ¸çº§åŒæ­¥çš„ä½¿ç”¨ï¼Œä»¥ç¡®ä¿ä»£ç å¾—åˆ°é€‚å½“çš„ä¿æŠ¤ã€‚å¦‚æžœå­˜åœ¨äº‰ç”¨é”çš„æƒ…å†µï¼Œæ‚¨çš„çº¿ç¨‹å¯èƒ½ä¼šé˜»å¡žå¹¶ç»åŽ†æ›´å¤§çš„å»¶è¿Ÿã€‚</p>
<p>è¡¨ 4-2 åˆ—å‡ºäº†åœ¨æ— äº‰è®®çš„æƒ…å†µä¸‹ä¸Žäº’æ–¥é”å’ŒåŽŸå­æ“ä½œç›¸å…³çš„ä¸€äº›è¿‘ä¼¼æˆæœ¬ã€‚è¿™äº›æµ‹é‡å€¼ä»£è¡¨äº†æ•°åƒä¸ªæ ·æœ¬çš„å¹³å‡æ—¶é—´ã€‚ä½†æ˜¯ï¼Œä¸Žçº¿ç¨‹åˆ›å»ºæ—¶é—´ä¸€æ ·ï¼Œäº’æ–¥é”èŽ·å–æ—¶é—´ï¼ˆå³ä½¿åœ¨æ— äº‰è®®çš„æƒ…å†µä¸‹ï¼‰ä¹Ÿå¯èƒ½å› å¤„ç†å™¨è´Ÿè½½ï¼Œè®¡ç®—æœºé€Ÿåº¦ä»¥åŠå¯ç”¨ç³»ç»Ÿå’Œç¨‹åºå†…å­˜é‡çš„ä¸åŒè€Œæœ‰å¾ˆå¤§å·®å¼‚ã€‚</p>
<table>
<thead>
<tr>
<th align="left">é¡¹ç›®</th>
<th align="left">å¤§æ¦‚è´¹ç”¨</th>
<th align="left">ç¬”è®°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">äº’æ–¥ä½“èŽ·å–æ—¶é—´</td>
<td align="left">çº¦ 0.2 å¾®ç§’</td>
<td align="left">è¿™æ˜¯æ— äº‰è®®æƒ…å†µä¸‹çš„é”èŽ·å–æ—¶é—´ã€‚å¦‚æžœè¯¥é”ç”±å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ï¼Œåˆ™èŽ·å–æ—¶é—´å¯èƒ½ä¼šæ›´é•¿ã€‚è¿™äº›æ•°å­—æ˜¯é€šè¿‡åˆ†æžåœ¨åŸºäºŽ Intel çš„ iMacï¼ˆå…·æœ‰ 2 GHz Core Duo å¤„ç†å™¨å’Œ 1 GB è¿è¡Œ OS X v10.5 çš„ RAMï¼‰ä¸Šçš„äº’æ–¥é”èŽ·å–æœŸé—´ç”Ÿæˆçš„å¹³å‡å€¼å’Œä¸­å€¼ç¡®å®šçš„ã€‚</td>
</tr>
<tr>
<td align="left">åŽŸå­æ¯”è¾ƒå’Œäº¤æ¢</td>
<td align="left">çº¦ 0.05 å¾®ç§’</td>
<td align="left">è¿™æ˜¯æ— äº‰è®®æƒ…å†µä¸‹çš„æ¯”è¾ƒå’Œäº¤æ¢æ—¶é—´ã€‚è¿™äº›æ•°å­—æ˜¯é€šè¿‡åˆ†æžæ“ä½œçš„å¹³å‡å€¼å’Œä¸­å€¼ç¡®å®šçš„ï¼Œæ˜¯åœ¨åŸºäºŽ Intel çš„ iMac ä¸Šç”Ÿæˆçš„ï¼Œè¯¥ iMac å…·æœ‰ 2 GHz Core Duo å¤„ç†å™¨å’Œ 1 GB è¿è¡Œ OS X v10.5 çš„ RAMã€‚</td>
</tr>
</tbody></table>
<p>åœ¨è®¾è®¡å¹¶å‘ä»»åŠ¡æ—¶ï¼Œæ­£ç¡®æ€§å§‹ç»ˆæ˜¯æœ€é‡è¦çš„å› ç´ ï¼Œä½†æ˜¯æ‚¨ä¹Ÿåº”è¯¥è€ƒè™‘æ€§èƒ½å› ç´ ã€‚åœ¨å¤šä¸ªçº¿ç¨‹ä¸‹å¯ä»¥æ­£ç¡®æ‰§è¡Œçš„ä»£ç ï¼Œä½†æ˜¯æ¯”åœ¨å•ä¸ªçº¿ç¨‹ä¸Šè¿è¡Œçš„ç›¸åŒä»£ç æ…¢çš„ä»£ç ï¼Œå‡ ä¹Žæ²¡æœ‰æ”¹è¿›ã€‚</p>
<p>å¦‚æžœè¦ç¿»æ–°çŽ°æœ‰çš„å•çº¿ç¨‹åº”ç”¨ç¨‹åºï¼Œåˆ™åº”å§‹ç»ˆå¯¹å…³é”®ä»»åŠ¡çš„æ€§èƒ½è¿›è¡Œä¸€ç»„åŸºå‡†æµ‹é‡ã€‚æ·»åŠ å…¶ä»–çº¿ç¨‹åŽï¼Œæ‚¨åº”è¯¥å¯¹è¿™äº›ç›¸åŒçš„ä»»åŠ¡è¿›è¡Œæ–°çš„æµ‹é‡ï¼Œå¹¶å°†å¤šçº¿ç¨‹æ¡ˆä¾‹ä¸Žå•çº¿ç¨‹æ¡ˆä¾‹çš„æ€§èƒ½è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æžœåœ¨è°ƒæ•´ä»£ç åŽï¼Œçº¿ç¨‹æ— æ³•æé«˜æ€§èƒ½ï¼Œåˆ™æ‚¨å¯èƒ½éœ€è¦é‡æ–°è€ƒè™‘æ‚¨çš„ç‰¹å®šå®žçŽ°æˆ–çº¿ç¨‹çš„ä½¿ç”¨ã€‚</p>
<p>æœ‰å…³æ€§èƒ½å’Œç”¨äºŽæ”¶é›†æŒ‡æ ‡çš„å·¥å…·çš„ä¿¡æ¯ï¼Œè¯·å‚é˜…*<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Performance/Conceptual/PerformanceOverview/Introduction/Introduction.html#//apple_ref/doc/uid/TP40001410">æ€§èƒ½æ¦‚è¿°</a>*ã€‚æœ‰å…³é”å’ŒåŽŸå­æ“ä½œæˆæœ¬çš„ç‰¹å®šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/CreatingThreads/CreatingThreads.html#//apple_ref/doc/uid/10000057i-CH15-SW7">çº¿ç¨‹æˆæœ¬</a>ã€‚</p>
<h4 id="çº¿ç¨‹å®‰å…¨å’Œä¿¡å·"><a href="#çº¿ç¨‹å®‰å…¨å’Œä¿¡å·" class="headerlink" title="çº¿ç¨‹å®‰å…¨å’Œä¿¡å·"></a>çº¿ç¨‹å®‰å…¨å’Œä¿¡å·</h4><p>å¯¹äºŽçº¿ç¨‹åŒ–åº”ç”¨ç¨‹åºï¼Œæ²¡æœ‰ä»€ä¹ˆæ¯”å¤„ç†ä¿¡å·é—®é¢˜å¼•èµ·æ›´å¤šçš„ææƒ§æˆ–å›°æƒ‘äº†ã€‚ä¿¡å·æ˜¯ä¸€ç§ä½Žçº§ BSD æœºåˆ¶ï¼Œå¯ç”¨äºŽå°†ä¿¡æ¯ä¼ é€’ç»™æµç¨‹æˆ–ä»¥æŸç§æ–¹å¼æ“çºµå®ƒã€‚ä¸€äº›ç¨‹åºä½¿ç”¨ä¿¡å·æ¥æ£€æµ‹æŸäº›äº‹ä»¶ï¼Œä¾‹å¦‚å­è¿›ç¨‹çš„æ­»äº¡ã€‚ç³»ç»Ÿä½¿ç”¨ä¿¡å·ç»ˆæ­¢å¤±æŽ§è¿‡ç¨‹å¹¶ä¼ è¾¾å…¶ä»–ç±»åž‹çš„ä¿¡æ¯ã€‚</p>
<p>ä¿¡å·çš„é—®é¢˜ä¸æ˜¯å®ƒä»¬çš„ä½œç”¨ï¼Œè€Œæ˜¯åº”ç”¨ç¨‹åºå…·æœ‰å¤šä¸ªçº¿ç¨‹æ—¶çš„è¡Œä¸ºã€‚åœ¨å•çº¿ç¨‹åº”ç”¨ç¨‹åºä¸­ï¼Œæ‰€æœ‰ä¿¡å·å¤„ç†ç¨‹åºéƒ½åœ¨ä¸»çº¿ç¨‹ä¸Šè¿è¡Œã€‚åœ¨å¤šçº¿ç¨‹åº”ç”¨ç¨‹åºä¸­ï¼Œä¸Žç‰¹å®šç¡¬ä»¶é”™è¯¯ï¼ˆä¾‹å¦‚éžæ³•æŒ‡ä»¤ï¼‰æ— å…³çš„ä¿¡å·ä¼šä¼ é€’åˆ°å½“æ—¶æ­£åœ¨è¿è¡Œçš„ä»»ä½•çº¿ç¨‹ã€‚å¦‚æžœåŒæ—¶è¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œåˆ™å°†ä¿¡å·ä¼ é€’ç»™ç³»ç»Ÿç¢°å·§çš„ä»»ä½•ä¸€ä¸ªã€‚æ¢å¥è¯è¯´ï¼Œä¿¡å·å¯ä»¥ä¼ é€’åˆ°åº”ç”¨ç¨‹åºçš„ä»»ä½•çº¿ç¨‹ã€‚</p>
<p>åœ¨åº”ç”¨ç¨‹åºä¸­å®žçŽ°ä¿¡å·å¤„ç†ç¨‹åºçš„ç¬¬ä¸€æ¡è§„åˆ™æ˜¯é¿å…å‡è®¾å“ªä¸ªçº¿ç¨‹æ­£åœ¨å¤„ç†ä¿¡å·ã€‚å¦‚æžœç‰¹å®šçº¿ç¨‹è¦å¤„ç†ç»™å®šçš„ä¿¡å·ï¼Œåˆ™éœ€è¦åˆ¶å®šæŸç§æ–¹æ³•åœ¨ä¿¡å·åˆ°è¾¾æ—¶é€šçŸ¥è¯¥çº¿ç¨‹ã€‚æ‚¨ä¸èƒ½ä»…ä»…å‡è®¾ä»Žè¯¥çº¿ç¨‹å®‰è£…ä¿¡å·å¤„ç†ç¨‹åºå°†å¯¼è‡´ä¿¡å·ä¼ é€’åˆ°åŒä¸€çº¿ç¨‹ã€‚</p>
<p>æœ‰å…³ä¿¡å·å’Œå®‰è£…ä¿¡å·å¤„ç†ç¨‹åºçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<code>signal</code>å’Œ<code>sigaction</code>æ‰‹å†Œé¡µã€‚</p>
<h4 id="çº¿ç¨‹å®‰å…¨è®¾è®¡çš„æç¤º"><a href="#çº¿ç¨‹å®‰å…¨è®¾è®¡çš„æç¤º" class="headerlink" title="çº¿ç¨‹å®‰å…¨è®¾è®¡çš„æç¤º"></a>çº¿ç¨‹å®‰å…¨è®¾è®¡çš„æç¤º</h4><p>åŒæ­¥å·¥å…·æ˜¯ä½¿ä»£ç çº¿ç¨‹å®‰å…¨çš„ä¸€ç§æœ‰ç”¨æ–¹æ³•ï¼Œä½†ä¸æ˜¯ä¸‡èƒ½è¯ã€‚ä¸Žéžçº¿ç¨‹æ€§èƒ½ç›¸æ¯”ï¼Œä½¿ç”¨è¿‡å¤šçš„é”å’Œå…¶ä»–ç±»åž‹çš„åŒæ­¥åŽŸè¯­å®žé™…ä¸Šä¼šé™ä½Žåº”ç”¨ç¨‹åºçš„çº¿ç¨‹æ€§èƒ½ã€‚åœ¨å®‰å…¨å’Œæ€§èƒ½ä¹‹é—´æ‰¾åˆ°åˆé€‚çš„å¹³è¡¡æ˜¯ä¸€é—¨éœ€è¦ç»éªŒçš„è‰ºæœ¯ã€‚ä»¥ä¸‹å„èŠ‚æä¾›äº†ä¸€äº›æŠ€å·§ï¼Œä»¥å¸®åŠ©æ‚¨ä¸ºåº”ç”¨ç¨‹åºé€‰æ‹©é€‚å½“çš„åŒæ­¥çº§åˆ«ã€‚</p>
<h6 id="å®Œå…¨é¿å…åŒæ­¥"><a href="#å®Œå…¨é¿å…åŒæ­¥" class="headerlink" title="å®Œå…¨é¿å…åŒæ­¥"></a>å®Œå…¨é¿å…åŒæ­¥</h6><p>å¯¹äºŽæ‚¨æ­£åœ¨ä»Žäº‹çš„ä»»ä½•æ–°é¡¹ç›®ï¼Œç”šè‡³å¯¹äºŽçŽ°æœ‰é¡¹ç›®ï¼Œè®¾è®¡ä»£ç å’Œæ•°æ®ç»“æž„æ¥é¿å…éœ€è¦åŒæ­¥éƒ½æ˜¯æœ€ä½³çš„è§£å†³æ–¹æ¡ˆã€‚å°½ç®¡é”å’Œå…¶ä»–åŒæ­¥å·¥å…·å¾ˆæœ‰ç”¨ï¼Œä½†å®ƒä»¬ç¡®å®žä¼šå½±å“ä»»ä½•åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚è€Œä¸”ï¼Œå¦‚æžœæ€»ä½“è®¾è®¡å¯¼è‡´ç‰¹å®šèµ„æºä¹‹é—´çš„äº‰ç”¨è¾ƒé«˜ï¼Œåˆ™æ‚¨çš„çº¿ç¨‹å¯èƒ½ä¼šç­‰å¾…æ›´é•¿çš„æ—¶é—´ã€‚</p>
<p>å®žæ–½å¹¶å‘çš„æœ€ä½³æ–¹æ³•æ˜¯å‡å°‘å¹¶å‘ä»»åŠ¡ä¹‹é—´çš„äº¤äº’å’Œç›¸äº’ä¾èµ–æ€§ã€‚å¦‚æžœæ¯ä¸ªä»»åŠ¡éƒ½åœ¨å…¶è‡ªå·±çš„ç§æœ‰æ•°æ®é›†ä¸Šè¿è¡Œï¼Œåˆ™æ— éœ€ä½¿ç”¨é”æ¥ä¿æŠ¤è¯¥æ•°æ®ã€‚å³ä½¿åœ¨ä¸¤ä¸ªä»»åŠ¡ç¡®å®žå…±äº«ä¸€ä¸ªå…¬å…±æ•°æ®é›†çš„æƒ…å†µä¸‹ï¼Œæ‚¨ä¹Ÿå¯ä»¥æŸ¥çœ‹å¯¹è¯¥é›†è¿›è¡Œåˆ†åŒºçš„æ–¹å¼æˆ–ä¸ºæ¯ä¸ªä»»åŠ¡æä¾›è‡ªå·±çš„å‰¯æœ¬ã€‚å½“ç„¶ï¼Œå¤åˆ¶æ•°æ®é›†ä¹Ÿæœ‰å…¶æˆæœ¬ï¼Œå› æ­¤åœ¨åšå‡ºå†³å®šä¹‹å‰ï¼Œæ‚¨å¿…é¡»æƒè¡¡è¿™äº›æˆæœ¬å’ŒåŒæ­¥æˆæœ¬ã€‚</p>
<h6 id="äº†è§£åŒæ­¥çš„å±€é™æ€§"><a href="#äº†è§£åŒæ­¥çš„å±€é™æ€§" class="headerlink" title="äº†è§£åŒæ­¥çš„å±€é™æ€§"></a>äº†è§£åŒæ­¥çš„å±€é™æ€§</h6><p>åŒæ­¥å·¥å…·ä»…åœ¨åº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰çº¿ç¨‹ä¸€è‡´ä½¿ç”¨æ—¶æ‰æœ‰æ•ˆã€‚å¦‚æžœåˆ›å»ºäº’æ–¥é‡ä»¥é™åˆ¶å¯¹ç‰¹å®šèµ„æºçš„è®¿é—®ï¼Œåˆ™æ‰€æœ‰çº¿ç¨‹åœ¨å°è¯•æ“ä½œè¯¥èµ„æºä¹‹å‰å¿…é¡»èŽ·å–ç›¸åŒçš„äº’æ–¥é‡ã€‚å¦åˆ™ä¼šç ´åäº’æ–¥é”æä¾›çš„ä¿æŠ¤ï¼Œè¿™æ˜¯ç¨‹åºå‘˜çš„é”™è¯¯ã€‚</p>
<h6 id="æ³¨æ„ä»£ç æ­£ç¡®æ€§çš„å¨èƒ"><a href="#æ³¨æ„ä»£ç æ­£ç¡®æ€§çš„å¨èƒ" class="headerlink" title="æ³¨æ„ä»£ç æ­£ç¡®æ€§çš„å¨èƒ"></a>æ³¨æ„ä»£ç æ­£ç¡®æ€§çš„å¨èƒ</h6><p>ä½¿ç”¨é”å’Œå†…å­˜å±éšœæ—¶ï¼Œåº”å§‹ç»ˆä»”ç»†è€ƒè™‘å®ƒä»¬åœ¨ä»£ç ä¸­çš„ä½ç½®ã€‚å³ä½¿æ˜¯çœ‹ä¼¼ä½ç½®æ­£ç¡®çš„é”ï¼Œå®žé™…ä¸Šä¹Ÿä¼šä½¿æ‚¨é™·å…¥ä¸€ç§é”™è¯¯çš„å®‰å…¨æ„Ÿã€‚ä»¥ä¸‹ä¸€ç³»åˆ—ç¤ºä¾‹è¯•å›¾é€šè¿‡æŒ‡å‡ºçœ‹ä¼¼æ— å®³çš„ä»£ç ä¸­çš„ç¼ºé™·æ¥è¯´æ˜Žè¿™ä¸ªé—®é¢˜ã€‚åŸºæœ¬å‰ææ˜¯æ‚¨å…·æœ‰ä¸€ä¸ªåŒ…å«ä¸€ç»„ä¸å¯å˜å¯¹è±¡çš„å¯å˜æ•°ç»„ã€‚å‡è®¾æ‚¨è¦è°ƒç”¨æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç è¿›è¡Œæ“ä½œï¼š</p>
<table>
<thead>
<tr>
<th><code>NSLock * arrayLock = GetArrayLockï¼ˆï¼‰;</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>NSMutableArray * myArray = GetSharedArrayï¼ˆï¼‰;</code></td>
</tr>
<tr>
<td><code>id anObject;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>[arrayLocké”];</code></td>
</tr>
<tr>
<td><code>anObject = [myArray objectAtIndexï¼š0];</code></td>
</tr>
<tr>
<td><code>[arrayLockè§£é”]ï¼›</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>[anObject doSomething];</code></td>
</tr>
</tbody></table>
<p>ç”±äºŽæ•°ç»„æ˜¯å¯å˜çš„ï¼Œå› æ­¤æ•°ç»„å‘¨å›´çš„é”å¯é˜²æ­¢å…¶ä»–çº¿ç¨‹ä¿®æ”¹æ•°ç»„ï¼Œç›´åˆ°èŽ·å¾—æ‰€éœ€çš„å¯¹è±¡ä¸ºæ­¢ã€‚å¹¶ä¸”ç”±äºŽæ‚¨æ£€ç´¢çš„å¯¹è±¡æœ¬èº«æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤åœ¨<code>doSomething</code>æ–¹æ³•è°ƒç”¨å‘¨å›´ä¸éœ€è¦é”å®šã€‚</p>
<p>ä½†æ˜¯ï¼Œå‰é¢çš„ç¤ºä¾‹å­˜åœ¨é—®é¢˜ã€‚å¦‚æžœé‡Šæ”¾é”å¹¶æœ‰å¦ä¸€ä¸ªçº¿ç¨‹è¿›å…¥å¹¶ä»Žæ•°ç»„ä¸­åˆ é™¤æ‰€æœ‰å¯¹è±¡ï¼Œç„¶åŽæ‰æœ‰å¯èƒ½æ‰§è¡Œè¯¥<code>doSomething</code>æ–¹æ³•ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿåœ¨æ²¡æœ‰åžƒåœ¾å›žæ”¶çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¯ä»¥é‡Šæ”¾ä»£ç æ‰€æŒæœ‰çš„å¯¹è±¡ï¼Œè€Œ<code>anObject</code>æŒ‡å‘æ— æ•ˆçš„å†…å­˜åœ°å€ã€‚è¦è§£å†³æ­¤é—®é¢˜ï¼Œæ‚¨å¯ä»¥å†³å®šç®€å•åœ°é‡æ–°æŽ’åˆ—çŽ°æœ‰ä»£ç ï¼Œå¹¶åœ¨è°ƒç”¨åŽé‡Šæ”¾é”<code>doSomething</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th><code>NSLock * arrayLock = GetArrayLockï¼ˆï¼‰;</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>NSMutableArray * myArray = GetSharedArrayï¼ˆï¼‰;</code></td>
</tr>
<tr>
<td><code>id anObject;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>[arrayLocké”];</code></td>
</tr>
<tr>
<td><code>anObject = [myArray objectAtIndexï¼š0];</code></td>
</tr>
<tr>
<td><code>[anObject doSomething];</code></td>
</tr>
<tr>
<td><code>[arrayLockè§£é”]ï¼›</code></td>
</tr>
</tbody></table>
<p>é€šè¿‡<code>doSomething</code>åœ¨é”å†…ç§»åŠ¨è°ƒç”¨ï¼Œæ‚¨çš„ä»£ç å¯ç¡®ä¿åœ¨è°ƒç”¨è¯¥æ–¹æ³•æ—¶è¯¥å¯¹è±¡ä»ç„¶æœ‰æ•ˆã€‚ä¸å¹¸çš„æ˜¯ï¼Œå¦‚æžœè¯¥<code>doSomething</code>æ–¹æ³•éœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½æ‰§è¡Œï¼Œåˆ™å¯èƒ½å¯¼è‡´æ‚¨çš„ä»£ç é•¿æ—¶é—´ä¿æŒé”å®šï¼Œä»Žè€Œå¯èƒ½å¯¼è‡´æ€§èƒ½ç“¶é¢ˆã€‚</p>
<p>ä»£ç çš„é—®é¢˜ä¸æ˜¯å…³é”®åŒºåŸŸå®šä¹‰ä¸æ­£ç¡®ï¼Œè€Œæ˜¯å®žé™…é—®é¢˜æœªè¢«ç†è§£ã€‚çœŸæ­£çš„é—®é¢˜æ˜¯ä»…ç”±å…¶ä»–çº¿ç¨‹çš„å­˜åœ¨è§¦å‘çš„å†…å­˜ç®¡ç†é—®é¢˜ã€‚å› ä¸ºå®ƒå¯ä»¥è¢«å¦ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾ï¼Œæ‰€ä»¥æ›´å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯<code>anObject</code>åœ¨é‡Šæ”¾é”ä¹‹å‰ä¿ç•™å®ƒã€‚è¯¥è§£å†³æ–¹æ¡ˆè§£å†³äº†å¯¹è±¡è¢«é‡Šæ”¾çš„å®žé™…é—®é¢˜ï¼Œå¹¶ä¸”è¿™æ ·åšä¸ä¼šé€ æˆæ½œåœ¨çš„æ€§èƒ½æŸå¤±ã€‚</p>
<table>
<thead>
<tr>
<th><code>NSLock * arrayLock = GetArrayLockï¼ˆï¼‰;</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>NSMutableArray * myArray = GetSharedArrayï¼ˆï¼‰;</code></td>
</tr>
<tr>
<td><code>id anObject;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>[arrayLocké”];</code></td>
</tr>
<tr>
<td><code>anObject = [myArray objectAtIndexï¼š0];</code></td>
</tr>
<tr>
<td><code>[anObjectä¿ç•™]ï¼›</code></td>
</tr>
<tr>
<td><code>[arrayLockè§£é”]ï¼›</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>[anObject doSomething];</code></td>
</tr>
<tr>
<td><code>[anObjectç‰ˆæœ¬]ï¼›</code></td>
</tr>
</tbody></table>
<p>å°½ç®¡ä»¥ä¸Šç¤ºä¾‹æœ¬è´¨ä¸Šéžå¸¸ç®€å•ï¼Œä½†æ˜¯å®ƒä»¬ç¡®å®žè¯´æ˜Žäº†éžå¸¸é‡è¦çš„ä¸€ç‚¹ã€‚å½“æ¶‰åŠåˆ°æ­£ç¡®æ€§æ—¶ï¼Œæ‚¨å¿…é¡»è¶…è¶Šæ˜Žæ˜¾çš„é—®é¢˜è¿›è¡Œæ€è€ƒã€‚å†…å­˜ç®¡ç†å’Œè®¾è®¡çš„å…¶ä»–æ–¹é¢ä¹Ÿå¯èƒ½ä¼šå—åˆ°å¤šä¸ªçº¿ç¨‹çš„å½±å“ï¼Œå› æ­¤æ‚¨å¿…é¡»é¢„å…ˆè€ƒè™‘è¿™äº›é—®é¢˜ã€‚å¦å¤–ï¼Œæ‚¨åº”è¯¥å§‹ç»ˆå‡è®¾ç¼–è¯‘å™¨åœ¨å®‰å…¨æ–¹é¢ä¼šåšæœ€åçš„äº‹æƒ…ã€‚è¿™ç§äº†è§£å’Œè­¦æƒ•åº”æœ‰åŠ©äºŽæ‚¨é¿å…æ½œåœ¨çš„é—®é¢˜ï¼Œå¹¶ç¡®ä¿æ‚¨çš„ä»£ç æ­£å¸¸è¿è¡Œã€‚</p>
<p>æœ‰å…³å¦‚ä½•ä½¿ç¨‹åºå…·æœ‰çº¿ç¨‹å®‰å…¨æ€§çš„å…¶ä»–ç¤ºä¾‹ï¼Œè¯·å‚è§â€œ <a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/ThreadSafetySummary/ThreadSafetySummary.html#//apple_ref/doc/uid/10000057i-CH12-SW1">çº¿ç¨‹å®‰å…¨æ€§æ‘˜è¦â€</a>ã€‚</p>
<h6 id="å½“å¿ƒæ­»é”å’Œæ´»é”"><a href="#å½“å¿ƒæ­»é”å’Œæ´»é”" class="headerlink" title="å½“å¿ƒæ­»é”å’Œæ´»é”"></a>å½“å¿ƒæ­»é”å’Œæ´»é”</h6><p>æ¯å½“çº¿ç¨‹å°è¯•åŒæ—¶èŽ·å–å¤šä¸ªé”æ—¶ï¼Œéƒ½æœ‰å¯èƒ½å‘ç”Ÿæ­»é”ã€‚å½“ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹æŒæœ‰å¦ä¸€ä¸ªçº¿ç¨‹éœ€è¦çš„é”ï¼Œç„¶åŽå°è¯•èŽ·å–å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰çš„é”æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­»é”ã€‚ç»“æžœæ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½æ°¸ä¹…é˜»å¡žï¼Œå› ä¸ºå®ƒæ°¸è¿œæ— æ³•èŽ·å–å¦ä¸€ä¸ªé”ã€‚</p>
<p>æ´»åŠ¨é”ç±»ä¼¼äºŽæ­»é”ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹ç«žäº‰åŒä¸€ç»„èµ„æºæ—¶å‘ç”Ÿã€‚åœ¨æ´»åŠ¨é”æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ”¾å¼ƒå…¶ç¬¬ä¸€æŠŠé”ï¼Œä»¥å°è¯•èŽ·å–å…¶ç¬¬äºŒæŠŠé”ã€‚ä¸€æ—¦èŽ·å¾—ç¬¬äºŒä¸ªé”ï¼Œå®ƒå°†è¿”å›žå¹¶å°è¯•å†æ¬¡èŽ·å–ç¬¬ä¸€ä¸ªé”ã€‚å®ƒä¹‹æ‰€ä»¥é”å®šï¼Œæ˜¯å› ä¸ºå®ƒèŠ±è´¹äº†æ‰€æœ‰æ—¶é—´é‡Šæ”¾ä¸€ä¸ªé”å¹¶è¯•å›¾èŽ·å–å¦ä¸€ä¸ªé”ï¼Œè€Œä¸æ˜¯è¿›è¡Œä»»ä½•å®žé™…å·¥ä½œã€‚</p>
<p>é¿å…å‡ºçŽ°æ­»é”å’Œæ´»é”æƒ…å†µçš„æœ€ä½³æ–¹æ³•æ˜¯ä¸€æ¬¡åªé”å®šä¸€ä¸ªã€‚å¦‚æžœä¸€æ¬¡å¿…é¡»èŽ·å–å¤šä¸ªé”ï¼Œåˆ™åº”ç¡®ä¿å…¶ä»–çº¿ç¨‹ä¸è¦å°è¯•æ‰§è¡Œç±»ä¼¼çš„æ“ä½œã€‚</p>
<h6 id="æ­£ç¡®ä½¿ç”¨æ˜“å¤±æ€§å˜é‡"><a href="#æ­£ç¡®ä½¿ç”¨æ˜“å¤±æ€§å˜é‡" class="headerlink" title="æ­£ç¡®ä½¿ç”¨æ˜“å¤±æ€§å˜é‡"></a>æ­£ç¡®ä½¿ç”¨æ˜“å¤±æ€§å˜é‡</h6><p>å¦‚æžœæ‚¨å·²ç»åœ¨ä½¿ç”¨äº’æ–¥é”æ¥ä¿æŠ¤ä»£ç éƒ¨åˆ†ï¼Œåˆ™ä¸è¦è‡ªåŠ¨å‡å®šæ‚¨éœ€è¦ä½¿ç”¨<code>volatile</code>å…³é”®å­—æ¥ä¿æŠ¤è¯¥éƒ¨åˆ†ä¸­çš„é‡è¦å˜é‡ã€‚äº’æ–¥é”åŒ…æ‹¬ä¸€ä¸ªå†…å­˜å±éšœï¼Œä»¥ç¡®ä¿æ­£ç¡®åœ°æŽ’åºè£…å…¥å’Œå­˜å‚¨æ“ä½œã€‚å°†<code>volatile</code>å…³é”®å­—æ·»åŠ åˆ°å…³é”®éƒ¨åˆ†ä¸­çš„å˜é‡åŽï¼Œæ¯æ¬¡è®¿é—®è¯¥å€¼æ—¶éƒ½ä¼šå¼ºåˆ¶å°†å…¶ä»Žå†…å­˜ä¸­åŠ è½½ã€‚ä¸¤ç§åŒæ­¥æŠ€æœ¯çš„ç»„åˆåœ¨ç‰¹å®šæƒ…å†µä¸‹å¯èƒ½æ˜¯å¿…éœ€çš„ï¼Œä½†ä¹Ÿä¼šå¯¼è‡´æ˜Žæ˜¾çš„æ€§èƒ½æŸå¤±ã€‚å¦‚æžœä»…äº’æ–¥é‡è¶³ä»¥ä¿æŠ¤å˜é‡ï¼Œè¯·çœç•¥<code>volatile</code>å…³é”®å­—ã€‚</p>
<p>åŒæ ·é‡è¦çš„æ˜¯ï¼Œä¸è¦ä½¿ç”¨æ˜“å¤±æ€§å˜é‡æ¥é¿å…ä½¿ç”¨äº’æ–¥ä½“ã€‚é€šå¸¸ï¼Œäº’æ–¥é”å’Œå…¶ä»–åŒæ­¥æœºåˆ¶æ˜¯æ¯”æ˜“å¤±æ€§å˜é‡æ›´å¥½çš„æ–¹æ³•æ¥ä¿æŠ¤æ•°æ®ç»“æž„çš„å®Œæ•´æ€§ã€‚çš„<code>volatile</code>å…³é”®å­—ä»…ç¡®ä¿ä¸€ä¸ªå˜é‡è¢«ä»Žå­˜å‚¨å™¨åŠ è½½ï¼Œè€Œä¸æ˜¯å­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­ã€‚å®ƒä¸èƒ½ç¡®ä¿æ‚¨çš„ä»£ç æ­£ç¡®è®¿é—®è¯¥å˜é‡ã€‚</p>
<h4 id="ä½¿ç”¨åŽŸå­æ“ä½œ"><a href="#ä½¿ç”¨åŽŸå­æ“ä½œ" class="headerlink" title="ä½¿ç”¨åŽŸå­æ“ä½œ"></a>ä½¿ç”¨åŽŸå­æ“ä½œ</h4><p>éžé˜»å¡žåŒæ­¥æ˜¯ä¸€ç§æ‰§è¡ŒæŸäº›ç±»åž‹çš„æ“ä½œå¹¶é¿å…é”å®šè´¹ç”¨çš„æ–¹å¼ã€‚å°½ç®¡é”æ˜¯åŒæ­¥ä¸¤ä¸ªçº¿ç¨‹çš„æœ‰æ•ˆæ–¹æ³•ï¼Œä½†æ˜¯å³ä½¿åœ¨æ— äº‰è®®çš„æƒ…å†µä¸‹ï¼ŒèŽ·å–é”ä¹Ÿæ˜¯ç›¸å¯¹æ˜‚è´µçš„æ“ä½œã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œè®¸å¤šåŽŸå­æ“ä½œä»…éœ€èŠ±è´¹ä¸€å°éƒ¨åˆ†æ—¶é—´å³å¯å®Œæˆï¼Œå¹¶ä¸”ä¸Žé”ä¸€æ ·æœ‰æ•ˆã€‚</p>
<p>åŽŸå­è¿ç®—ä½¿æ‚¨å¯ä»¥å¯¹ 32 ä½æˆ– 64 ä½å€¼æ‰§è¡Œç®€å•çš„æ•°å­¦å’Œé€»è¾‘è¿ç®—ã€‚è¿™äº›æ“ä½œä¾é ç‰¹æ®Šçš„ç¡¬ä»¶æŒ‡ä»¤ï¼ˆå’Œå¯é€‰çš„å†…å­˜å±éšœï¼‰æ¥ç¡®ä¿ç»™å®šçš„æ“ä½œåœ¨å†æ¬¡è®¿é—®å—å½±å“çš„å†…å­˜ä¹‹å‰å®Œæˆã€‚åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œåº”å§‹ç»ˆä½¿ç”¨åŒ…å«å†…å­˜å±éšœçš„åŽŸå­æ“ä½œæ¥ç¡®ä¿å†…å­˜åœ¨çº¿ç¨‹ä¹‹é—´æ­£ç¡®åŒæ­¥ã€‚</p>
<p>è¡¨ 4-3 åˆ—å‡ºäº†å¯ç”¨çš„åŽŸå­æ•°å­¦å’Œé€»è¾‘è¿ç®—ä»¥åŠç›¸åº”çš„å‡½æ•°åç§°ã€‚è¿™äº›å‡½æ•°éƒ½åœ¨<code>/usr/include/libkern/OSAtomic.h</code>å¤´æ–‡ä»¶ä¸­å£°æ˜Žï¼Œæ‚¨è¿˜å¯ä»¥åœ¨å…¶ä¸­æ‰¾åˆ°å®Œæ•´çš„è¯­æ³•ã€‚è¿™äº›åŠŸèƒ½çš„ 64 ä½ç‰ˆæœ¬ä»…åœ¨ 64 ä½è¿›ç¨‹ä¸­å¯ç”¨ã€‚</p>
<table>
<thead>
<tr>
<th align="left">è¿ä½œæ–¹å¼</th>
<th align="left">åŠŸèƒ½åç§°</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">åŠ </td>
<td align="left"><code>OSAtomicAdd32``OSAtomicAdd32Barrier``OSAtomicAdd64``OSAtomicAdd64Barrier</code></td>
<td align="left">å°†ä¸¤ä¸ªæ•´æ•°å€¼ç›¸åŠ å¹¶å°†ç»“æžœå­˜å‚¨åœ¨æŒ‡å®šçš„å˜é‡ä¹‹ä¸€ä¸­ã€‚</td>
</tr>
<tr>
<td align="left">å¢žé‡</td>
<td align="left"><code>OSAtomicIncrement32``OSAtomicIncrement32Barrier``OSAtomicIncrement64``OSAtomicIncrement64Barrier</code></td>
<td align="left">å°†æŒ‡å®šçš„æ•´æ•°å€¼å¢žåŠ  1ã€‚</td>
</tr>
<tr>
<td align="left">å‡é‡</td>
<td align="left"><code>OSAtomicDecrement32``OSAtomicDecrement32Barrier``OSAtomicDecrement64``OSAtomicDecrement64Barrier</code></td>
<td align="left">å°†æŒ‡å®šçš„æ•´æ•°å€¼å‡ 1ã€‚</td>
</tr>
<tr>
<td align="left">é€»è¾‘æˆ–</td>
<td align="left"><code>OSAtomicOr32``OSAtomicOr32Barrier</code></td>
<td align="left">åœ¨æŒ‡å®šçš„ 32 ä½å€¼å’Œ 32 ä½æŽ©ç ä¹‹é—´æ‰§è¡Œé€»è¾‘æˆ–ã€‚</td>
</tr>
<tr>
<td align="left">é€»è¾‘ä¸Ž</td>
<td align="left"><code>OSAtomicAnd32``OSAtomicAnd32Barrier</code></td>
<td align="left">åœ¨æŒ‡å®šçš„ 32 ä½å€¼å’Œ 32 ä½æŽ©ç ä¹‹é—´æ‰§è¡Œé€»è¾‘ä¸Žã€‚</td>
</tr>
<tr>
<td align="left">é€»è¾‘å¼‚æˆ–</td>
<td align="left"><code>OSAtomicXor32``OSAtomicXor32Barrier</code></td>
<td align="left">åœ¨æŒ‡å®šçš„ 32 ä½å€¼å’Œ 32 ä½æŽ©ç ä¹‹é—´æ‰§è¡Œé€»è¾‘ XORã€‚</td>
</tr>
<tr>
<td align="left">æ¯”è¾ƒå¹¶äº¤æ¢</td>
<td align="left"><code>OSAtomicCompareAndSwap32``OSAtomicCompareAndSwap32Barrier``OSAtomicCompareAndSwap64``OSAtomicCompareAndSwap64Barrier``OSAtomicCompareAndSwapPtr``OSAtomicCompareAndSwapPtrBarrier``OSAtomicCompareAndSwapInt``OSAtomicCompareAndSwapIntBarrier``OSAtomicCompareAndSwapLong``OSAtomicCompareAndSwapLongBarrier</code></td>
<td align="left">å°†å˜é‡ä¸ŽæŒ‡å®šçš„æ—§å€¼è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æžœä¸¤ä¸ªå€¼ç›¸ç­‰ï¼Œåˆ™æ­¤å‡½æ•°å°†æŒ‡å®šçš„æ–°å€¼åˆ†é…ç»™å˜é‡ï¼›å¦åˆ™ï¼Œå®ƒä»€ä¹ˆéƒ½ä¸åšã€‚æ¯”è¾ƒå’Œèµ‹å€¼ä½œä¸ºä¸€ä¸ªåŽŸå­æ“ä½œå®Œæˆï¼Œå¹¶ä¸”è¯¥å‡½æ•°è¿”å›žä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¯¥å¸ƒå°”å€¼æŒ‡ç¤ºæ˜¯å¦å®žé™…å‘ç”Ÿäº†äº¤æ¢ã€‚</td>
</tr>
<tr>
<td align="left">æµ‹è¯•å¹¶è®¾å®š</td>
<td align="left"><code>OSAtomicTestAndSet``OSAtomicTestAndSetBarrier</code></td>
<td align="left">æµ‹è¯•æŒ‡å®šå˜é‡ä¸­çš„æŸä¸ªä½ï¼Œå°†è¯¥ä½è®¾ç½®ä¸º 1ï¼Œç„¶åŽå°†æ—§ä½çš„å€¼ä½œä¸ºå¸ƒå°”å€¼è¿”å›žã€‚æ ¹æ®<code>(0x80 &gt;&gt; (n &amp; 7))</code>å­—èŠ‚çš„å…¬å¼æµ‹è¯•ä½ï¼Œ<code>((char*)address + (n &gt;&gt; 3))</code>å…¶ä¸­<code>n</code>æ˜¯ä½å·ï¼Œ<code>address</code>æ˜¯æŒ‡å‘å˜é‡çš„æŒ‡é’ˆã€‚è¯¥å…¬å¼æœ‰æ•ˆåœ°å°†å˜é‡åˆ†è§£ä¸º 8 ä½å¤§å°çš„å—ï¼Œå¹¶æŒ‰ç›¸åçš„é¡ºåºå¯¹æ¯ä¸ªå—ä¸­çš„ä½è¿›è¡ŒæŽ’åºã€‚ä¾‹å¦‚ï¼Œè¦æµ‹è¯• 32 ä½æ•´æ•°çš„æœ€ä½Žä½ï¼ˆä½ 0ï¼‰ï¼Œæ‚¨å®žé™…ä¸Šåº”å°†ä½æ•°æŒ‡å®šä¸º 7ï¼›åŒæ ·ï¼Œè¦æµ‹è¯•æœ€é«˜é˜¶ä½ï¼ˆä½ 32ï¼‰ï¼Œè¯·ä¸ºä½å·æŒ‡å®š 24ã€‚</td>
</tr>
<tr>
<td align="left">æµ‹è¯•å¹¶æ¸…é™¤</td>
<td align="left"><code>OSAtomicTestAndClear``OSAtomicTestAndClearBarrier</code></td>
<td align="left">æµ‹è¯•æŒ‡å®šå˜é‡ä¸­çš„æŸä¸ªä½ï¼Œå°†è¯¥ä½è®¾ç½®ä¸º 0ï¼Œç„¶åŽå°†æ—§ä½çš„å€¼ä½œä¸ºå¸ƒå°”å€¼è¿”å›žã€‚æ ¹æ®<code>(0x80 &gt;&gt; (n &amp; 7))</code>å­—èŠ‚çš„å…¬å¼æµ‹è¯•ä½ï¼Œ<code>((char*)address + (n &gt;&gt; 3))</code>å…¶ä¸­<code>n</code>æ˜¯ä½å·ï¼Œ<code>address</code>æ˜¯æŒ‡å‘å˜é‡çš„æŒ‡é’ˆã€‚è¯¥å…¬å¼æœ‰æ•ˆåœ°å°†å˜é‡åˆ†è§£ä¸º 8 ä½å¤§å°çš„å—ï¼Œå¹¶æŒ‰ç›¸åçš„é¡ºåºå¯¹æ¯ä¸ªå—ä¸­çš„ä½è¿›è¡ŒæŽ’åºã€‚ä¾‹å¦‚ï¼Œè¦æµ‹è¯• 32 ä½æ•´æ•°çš„æœ€ä½Žä½ï¼ˆä½ 0ï¼‰ï¼Œæ‚¨å®žé™…ä¸Šåº”å°†ä½æ•°æŒ‡å®šä¸º 7ï¼›åŒæ ·ï¼Œè¦æµ‹è¯•æœ€é«˜é˜¶ä½ï¼ˆä½ 32ï¼‰ï¼Œè¯·ä¸ºä½å·æŒ‡å®š 24ã€‚</td>
</tr>
</tbody></table>
<p>å¤§å¤šæ•°åŽŸå­å‡½æ•°çš„è¡Œä¸ºåº”ç›¸å¯¹ç®€å•æ˜Žäº†ï¼Œå¹¶å…·æœ‰æ‚¨æ‰€æœŸæœ›çš„ã€‚ä½†æ˜¯ï¼Œæ¸…å• 4-1 æ˜¾ç¤ºäº†åŽŸå­æµ‹è¯•è®¾ç½®å’Œæ¯”è¾ƒäº¤æ¢æ“ä½œçš„è¡Œä¸ºï¼Œè¿™äº›æ“ä½œç¨å¾®å¤æ‚ä¸€äº›ã€‚å¯¹<code>OSAtomicTestAndSet</code>å‡½æ•°çš„å‰ä¸‰ä¸ªè°ƒç”¨è¯´æ˜Žäº†å¯¹æ•´æ•°å€¼ä½¿ç”¨çš„ä½æ“ä½œå…¬å¼åŠå…¶ç»“æžœå¯èƒ½ä¸Žæ‚¨æœŸæœ›çš„ä¸åŒã€‚æœ€åŽä¸¤ä¸ªè°ƒç”¨æ˜¾ç¤ºäº†è¯¥<code>OSAtomicCompareAndSwap32</code>å‡½æ•°çš„è¡Œä¸ºã€‚åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œå½“æ²¡æœ‰å…¶ä»–çº¿ç¨‹åœ¨æ“çºµè¿™äº›å€¼æ—¶ï¼Œå°†åœ¨æ— äº‰è®®çš„æƒ…å†µä¸‹è°ƒç”¨è¿™äº›å‡½æ•°ã€‚</p>
<p><strong>æ¸…å• 4-1</strong> æ‰§è¡ŒåŽŸå­æ“ä½œ</p>
<table>
<thead>
<tr>
<th><code>int32_t theValue = 0;</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>OSAtomicTestAndSetï¼ˆ0ï¼Œï¼†theValueï¼‰;</code></td>
</tr>
<tr>
<td><code>// theValueçŽ°åœ¨ä¸º128ã€‚</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>theValue = 0;</code></td>
</tr>
<tr>
<td><code>OSAtomicTestAndSetï¼ˆ7ï¼Œï¼†theValueï¼‰;</code></td>
</tr>
<tr>
<td><code>// theValueçŽ°åœ¨ä¸º1ã€‚</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>theValue = 0;</code></td>
</tr>
<tr>
<td><code>OSAtomicTestAndSetï¼ˆ15ï¼Œï¼†theValueï¼‰</code></td>
</tr>
<tr>
<td><code>// theValueçŽ°åœ¨ä¸º256ã€‚</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>OSAtomicCompareAndSwap32ï¼ˆ256ï¼Œ512ï¼Œï¼†theValueï¼‰;</code></td>
</tr>
<tr>
<td><code>// theValueçŽ°åœ¨ä¸º512ã€‚</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>OSAtomicCompareAndSwap32ï¼ˆ256ï¼Œ1024ï¼Œï¼†theValueï¼‰;</code></td>
</tr>
<tr>
<td><code>// theValueä»ç„¶æ˜¯512ã€‚</code></td>
</tr>
</tbody></table>
<p>æœ‰å…³åŽŸå­æ“ä½œçš„ä¿¡æ¯ï¼Œè¯·å‚è§<code>atomic</code>æ‰‹å†Œé¡µå’Œ<code>/usr/include/libkern/OSAtomic.h</code>å¤´æ–‡ä»¶ã€‚</p>
<h4 id="ä½¿ç”¨é”"><a href="#ä½¿ç”¨é”" class="headerlink" title="ä½¿ç”¨é”"></a>ä½¿ç”¨é”</h4><p>é”æ˜¯ç”¨äºŽçº¿ç¨‹ç¼–ç¨‹çš„åŸºæœ¬åŒæ­¥å·¥å…·ã€‚é”ä½¿æ‚¨å¯ä»¥è½»æ¾ä¿æŠ¤å¤§éƒ¨åˆ†ä»£ç ï¼Œä»Žè€Œå¯ä»¥ç¡®ä¿è¯¥ä»£ç çš„æ­£ç¡®æ€§ã€‚OS X å’Œ iOS ä¸ºæ‰€æœ‰åº”ç”¨ç¨‹åºç±»åž‹æä¾›åŸºæœ¬äº’æ–¥é”ï¼Œå¹¶ä¸” Foundation æ¡†æž¶ä¸ºç‰¹æ®Šæƒ…å†µå®šä¹‰äº†äº’æ–¥é”çš„ä¸€äº›å…¶ä»–å˜ä½“ã€‚ä»¥ä¸‹å„èŠ‚è¯´æ˜Žå¦‚ä½•ä½¿ç”¨è¿™äº›é”ç±»åž‹ä¸­çš„å‡ ç§ã€‚</p>
<h6 id="ä½¿ç”¨-POSIX-äº’æ–¥é”"><a href="#ä½¿ç”¨-POSIX-äº’æ–¥é”" class="headerlink" title="ä½¿ç”¨ POSIX äº’æ–¥é”"></a>ä½¿ç”¨ POSIX äº’æ–¥é”</h6><p>POSIX äº’æ–¥é”åœ¨ä»»ä½•åº”ç”¨ç¨‹åºä¸­éƒ½éžå¸¸æ˜“äºŽä½¿ç”¨ã€‚è¦åˆ›å»ºäº’æ–¥é”ï¼Œæ‚¨éœ€è¦å£°æ˜Žå¹¶åˆå§‹åŒ–ä¸€ä¸ª<code>pthread_mutex_t</code>ç»“æž„ã€‚è¦é”å®šå’Œè§£é”äº’æ–¥é”ï¼Œè¯·ä½¿ç”¨<code>pthread_mutex_lock</code> å’Œ <code>pthread_mutex_unlock</code>åŠŸèƒ½ã€‚æ¸…å• 4-2 æ˜¾ç¤ºäº†åˆå§‹åŒ–å’Œä½¿ç”¨ POSIX çº¿ç¨‹äº’æ–¥é”æ‰€éœ€çš„åŸºæœ¬ä»£ç ã€‚å®Œæˆé”åŽï¼Œåªéœ€è‡´ç”µ<code>pthread_mutex_destroy</code> é‡Šæ”¾é”æ•°æ®ç»“æž„ã€‚</p>
<p><strong>æ¸…å• 4-2</strong> ä½¿ç”¨äº’æ–¥é”</p>
<table>
<thead>
<tr>
<th><code>pthread_mutex_täº’æ–¥ä½“;</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>void MyInitFunctionï¼ˆï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>pthread_mutex_initï¼ˆï¼†mutexï¼ŒNULLï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>void MyLockingFunctionï¼ˆï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>pthread_mutex_lockï¼ˆï¼†mutexï¼‰;</code></td>
</tr>
<tr>
<td><code>// åšå·¥ä½œã€‚</code></td>
</tr>
<tr>
<td><code>pthread_mutex_unlockï¼ˆï¼†mutexï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p><strong>æ³¨æ„ï¼š</strong> å‰é¢çš„ä»£ç æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç¤ºä¾‹ï¼Œæ—¨åœ¨æ˜¾ç¤º POSIX çº¿ç¨‹äº’æ–¥å‡½æ•°çš„åŸºæœ¬ç”¨æ³•ã€‚æ‚¨è‡ªå·±çš„ä»£ç åº”æ£€æŸ¥è¿™äº›å‡½æ•°è¿”å›žçš„é”™è¯¯ä»£ç å¹¶è¿›è¡Œé€‚å½“å¤„ç†ã€‚</p>
<h6 id="ä½¿ç”¨-NSLock-ç±»"><a href="#ä½¿ç”¨-NSLock-ç±»" class="headerlink" title="ä½¿ç”¨ NSLock ç±»"></a>ä½¿ç”¨ NSLock ç±»</h6><p>ä¸€ä¸ª <code>NSLock</code>å¯¹è±¡ä¸º Cocoa åº”ç”¨ç¨‹åºå®žçŽ°åŸºæœ¬äº’æ–¥é‡ã€‚æ‰€æœ‰é”ï¼ˆåŒ…æ‹¬<code>NSLock</code>ï¼‰çš„æŽ¥å£å®žé™…ä¸Šéƒ½æ˜¯ç”±<code>NSLocking</code>åè®®å®šä¹‰çš„ï¼Œåè®®å®šä¹‰äº†<code>lock</code>å’Œ<code>unlock</code>æ–¹æ³•ã€‚æ‚¨å¯ä»¥åƒä½¿ç”¨ä»»ä½•äº’æ–¥é”ä¸€æ ·ä½¿ç”¨è¿™äº›æ–¹æ³•æ¥èŽ·å–å’Œé‡Šæ”¾é”ã€‚</p>
<p>é™¤äº†æ ‡å‡†çš„é”å®šè¡Œä¸ºå¤–ï¼Œ<code>NSLock</code>è¯¥ç±»è¿˜æ·»åŠ äº†<code>tryLock</code> å’Œ <code>lockBeforeDate:</code>æ–¹æ³•ã€‚è¯¥<code>tryLock</code>æ–¹æ³•å°è¯•èŽ·å–é”ï¼Œä½†æ˜¯å¦‚æžœé”ä¸å¯ç”¨åˆ™ä¸ä¼šé˜»å¡žï¼›ç›¸åï¼Œè¯¥æ–¹æ³•ä»…è¿”å›ž<code>NO</code>ã€‚å¦‚æžœæœªåœ¨æŒ‡å®šçš„æ—¶é—´é™åˆ¶å†…èŽ·å–é”ï¼Œåˆ™è¯¥<code>lockBeforeDate:</code>æ–¹æ³•å°è¯•èŽ·å–é”ï¼Œä½†å–æ¶ˆé˜»å¡žçº¿ç¨‹ï¼ˆå¹¶è¿”å›ž<code>NO</code>ï¼‰ã€‚</p>
<p>ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨<code>NSLock</code>å¯¹è±¡æ¥åè°ƒè§†è§‰æ˜¾ç¤ºçš„æ›´æ–°ï¼Œè¯¥è§†è§‰æ˜¾ç¤ºçš„æ•°æ®æ˜¯ç”±å¤šä¸ªçº¿ç¨‹è®¡ç®—çš„ã€‚å¦‚æžœçº¿ç¨‹æ— æ³•ç«‹å³èŽ·å–é”ï¼Œåˆ™ä»…ç»§ç»­æ‰§è¡Œè®¡ç®—ï¼Œç›´åˆ°å¯ä»¥èŽ·å–é”å¹¶æ›´æ–°æ˜¾ç¤ºã€‚</p>
<table>
<thead>
<tr>
<th><code>BOOL moreToDo = YES;</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>NSLock * theLock = [[NSLock alloc] init];</code></td>
</tr>
<tr>
<td><code>...</code></td>
</tr>
<tr>
<td><code>è€Œï¼ˆmoreToDoï¼‰{</code></td>
</tr>
<tr>
<td><code>/ *å†è¿›è¡Œä¸€æ¬¡è®¡ç®—* /</code></td>
</tr>
<tr>
<td><code>/ *ï¼Œç›´åˆ°æ²¡æœ‰å…¶ä»–äº‹æƒ…å¯åšä¸ºæ­¢ã€‚* /</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆ[theLock tryLock]ï¼‰{</code></td>
</tr>
<tr>
<td><code>/ *æ›´æ–°æ‰€æœ‰çº¿ç¨‹ä½¿ç”¨çš„æ˜¾ç¤ºã€‚* /</code></td>
</tr>
<tr>
<td><code>[theLockè§£é”]ï¼›</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<h6 id="ä½¿ç”¨-synchronized-æŒ‡ä»¤"><a href="#ä½¿ç”¨-synchronized-æŒ‡ä»¤" class="headerlink" title="ä½¿ç”¨@synchronized æŒ‡ä»¤"></a>ä½¿ç”¨@synchronized æŒ‡ä»¤</h6><p>è¯¥<code>@synchronized</code>æŒ‡ä»¤æ˜¯åœ¨ Objective-C ä»£ç ä¸­åŠ¨æ€åˆ›å»ºäº’æ–¥é”çš„ä¾¿æ·æ–¹æ³•ã€‚è¯¥<code>@synchronized</code>æŒ‡ä»¤æ‰§è¡Œä»»ä½•å…¶ä»–äº’æ–¥é”å°†æ‰§è¡Œçš„æ“ä½œ-é˜²æ­¢ä¸åŒçš„çº¿ç¨‹åŒæ—¶èŽ·å–åŒä¸€é”ã€‚ä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨ä¸å¿…ç›´æŽ¥åˆ›å»ºäº’æ–¥é‡æˆ–é”å®šå¯¹è±¡ã€‚ç›¸åï¼Œæ‚¨åªéœ€å°†ä»»ä½• Objective-C å¯¹è±¡ç”¨ä½œé”å®šä»¤ç‰Œï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th><code>-ï¼ˆvoidï¼‰myMethodï¼šï¼ˆidï¼‰anObj</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>@synchronizedï¼ˆanObjï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//å¤§æ‹¬å·ä¹‹é—´çš„æ‰€æœ‰å†…å®¹å‡å—@synchronizedæŒ‡ä»¤ä¿æŠ¤ã€‚</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>ä¼ é€’ç»™<code>@synchronized</code>æŒ‡ä»¤çš„å¯¹è±¡æ˜¯ç”¨äºŽåŒºåˆ†å—ä¿æŠ¤å—çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚å¦‚æžœåœ¨ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œä¸Šè¿°æ–¹æ³•ï¼Œå¹¶<code>anObj</code>åœ¨æ¯ä¸ªçº¿ç¨‹ä¸Šä¸ºå‚æ•°ä¼ é€’ä¸€ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œåˆ™æ¯ä¸ªçº¿ç¨‹å°†èŽ·å¾—å…¶é”å¹¶ç»§ç»­è¿›è¡Œå¤„ç†è€Œä¸ä¼šè¢«å¦ä¸€ä¸ªçº¿ç¨‹é˜»å¡žã€‚ä½†æ˜¯ï¼Œå¦‚æžœåœ¨ä¸¤ç§æƒ…å†µä¸‹éƒ½ä¼ é€’ç›¸åŒçš„å¯¹è±¡ï¼Œåˆ™å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹å°†é¦–å…ˆèŽ·å–é”ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹å°†é˜»å¡žï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªçº¿ç¨‹å®Œæˆå…³é”®éƒ¨åˆ†ã€‚</p>
<p>ä½œä¸ºä¸€ç§é¢„é˜²æŽªæ–½ï¼Œè¯¥<code>@synchronized</code>å—ä¼šå‘å—ä¿æŠ¤çš„ä»£ç éšå¼æ·»åŠ ä¸€ä¸ªå¼‚å¸¸å¤„ç†ç¨‹åºã€‚å¦‚æžœæŠ›å‡ºå¼‚å¸¸ï¼Œæ­¤å¤„ç†ç¨‹åºå°†è‡ªåŠ¨é‡Šæ”¾äº’æ–¥é‡ã€‚è¿™æ„å‘³ç€ï¼Œä¸ºäº†ä½¿ç”¨è¯¥<code>@synchronized</code>æŒ‡ä»¤ï¼Œè¿˜å¿…é¡»åœ¨ä»£ç ä¸­å¯ç”¨ Objective-C å¼‚å¸¸å¤„ç†ã€‚å¦‚æžœæ‚¨ä¸å¸Œæœ›ç”±éšå¼å¼‚å¸¸å¤„ç†ç¨‹åºå¼•èµ·çš„é¢å¤–å¼€é”€ï¼Œåˆ™åº”è€ƒè™‘ä½¿ç”¨é”ç±»ã€‚</p>
<p>æœ‰å…³<code>@synchronized</code>æŒ‡ä»¤çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§*<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/ObjectiveC/Introduction/introObjectiveC.html#//apple_ref/doc/uid/TP30001163">Objective-C ç¼–ç¨‹è¯­è¨€</a>*ã€‚</p>
<h6 id="ä½¿ç”¨å…¶ä»–å¯å¯é”"><a href="#ä½¿ç”¨å…¶ä»–å¯å¯é”" class="headerlink" title="ä½¿ç”¨å…¶ä»–å¯å¯é”"></a>ä½¿ç”¨å…¶ä»–å¯å¯é”</h6><p>ä»¥ä¸‹å„èŠ‚æè¿°äº†ä½¿ç”¨å…¶ä»–å‡ ç§ç±»åž‹çš„å¯å¯é”çš„è¿‡ç¨‹ã€‚</p>
<p>######## ä½¿ç”¨ NSRecursiveLock å¯¹è±¡</p>
<p>è¯¥<code>NSRecursiveLock</code>ç­å®šä¹‰ä¸€ä¸ªé”ï¼ŒåŒä¸€çº¿ç¨‹å¯ä»¥å¤šæ¬¡èŽ·å–è¯¥é”ï¼Œè€Œä¸ä¼šå¯¼è‡´çº¿ç¨‹æ­»é”ã€‚é€’å½’é”è·Ÿè¸ªæˆåŠŸèŽ·å–äº†å¤šå°‘æ¬¡ã€‚æ¯æ¬¡æˆåŠŸèŽ·å–é”ï¼Œå¿…é¡»é€šè¿‡ç›¸åº”çš„è°ƒç”¨æ¥å¹³è¡¡ä»¥è§£é”è¯¥é”ã€‚ä»…å½“æ‰€æœ‰é”å®šå’Œè§£é”è°ƒç”¨å‡è¾¾åˆ°å¹³è¡¡æ—¶ï¼Œæ‰å®žé™…é‡Šæ”¾è¯¥é”å®šï¼Œä»¥ä¾¿å…¶ä»–çº¿ç¨‹å¯ä»¥èŽ·å–å®ƒã€‚</p>
<p>é¡¾åæ€ä¹‰ï¼Œè¿™ç§ç±»åž‹çš„é”é€šå¸¸åœ¨é€’å½’å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼Œä»¥é˜²æ­¢é€’å½’é˜»å¡žçº¿ç¨‹ã€‚åœ¨éžé€’å½’æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ç±»ä¼¼åœ°ä½¿ç”¨å®ƒæ¥è°ƒç”¨å‡½æ•°ï¼Œè¿™äº›å‡½æ•°çš„è¯­ä¹‰è¦æ±‚å®ƒä»¬ä¹Ÿå…·æœ‰é”å®šåŠŸèƒ½ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„é€’å½’å‡½æ•°ç¤ºä¾‹ï¼Œè¯¥å‡½æ•°é€šè¿‡é€’å½’èŽ·å–é”ã€‚å¦‚æžœæ‚¨æ²¡æœ‰<code>NSRecursiveLock</code>ä¸ºæ­¤ä»£ç ä½¿ç”¨å¯¹è±¡ï¼Œåˆ™å½“å†æ¬¡è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œçº¿ç¨‹å°†æ­»é”ã€‚</p>
<table>
<thead>
<tr>
<th><code>NSRecursiveLock * theLock = [[NSRecursiveLock alloc] init];</code></th>
</tr>
</thead>
<tbody><tr>
<td>``</td>
</tr>
<tr>
<td><code>void MyRecursiveFunctionï¼ˆint valueï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>[theLocké”];</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆå€¼ï¼= 0ï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>- å€¼;</code></td>
</tr>
<tr>
<td><code>MyRecursiveFunctionï¼ˆvalueï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>[theLockè§£é”]ï¼›</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>MyRecursiveFunctionï¼ˆ5ï¼‰;</code></td>
</tr>
</tbody></table>
<p><strong>æ³¨æ„ï¼š</strong> ç”±äºŽåœ¨æ‰€æœ‰é”è°ƒç”¨ä¸Žè§£é”è°ƒç”¨å¹³è¡¡ä¹‹å‰ä¸ä¼šé‡Šæ”¾é€’å½’é”ï¼Œå› æ­¤æ‚¨åº”ä»”ç»†æƒè¡¡ä½¿ç”¨æ€§èƒ½é”çš„å†³å®šä¸Žæ½œåœ¨çš„æ€§èƒ½å½±å“ã€‚é•¿æ—¶é—´æŒæœ‰ä»»ä½•é”éƒ½å¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹é˜»å¡žï¼Œç›´åˆ°é€’å½’å®Œæˆä¸ºæ­¢ã€‚å¦‚æžœæ‚¨å¯ä»¥é‡å†™ä»£ç ä»¥æ¶ˆé™¤é€’å½’æˆ–ä¸éœ€è¦ä½¿ç”¨é€’å½’é”ï¼Œåˆ™å¯èƒ½ä¼šèŽ·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚</p>
<p>######## ä½¿ç”¨ NSConditionLock å¯¹è±¡</p>
<p>ä¸€ä¸ª<code>NSConditionLock</code>å¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªäº’æ–¥é”ï¼Œè¯¥äº’æ–¥é”å¯ä»¥ä½¿ç”¨ç‰¹å®šçš„å€¼è¿›è¡Œé”å®šå’Œè§£é”ã€‚æ‚¨ä¸åº”å°†è¿™ç§ç±»åž‹çš„é”ä¸Žæ¡ä»¶æ··æ·†ï¼ˆè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/ThreadSafety/ThreadSafety.html#//apple_ref/doc/uid/10000057i-CH8-126424">æ¡ä»¶</a>ï¼‰ã€‚è¯¥è¡Œä¸ºåœ¨æŸç§ç¨‹åº¦ä¸Šç±»ä¼¼äºŽæ¡ä»¶ï¼Œä½†å®žçŽ°æ–¹å¼å´å¤§ä¸ç›¸åŒã€‚</p>
<p>é€šå¸¸ï¼Œ<code>NSConditionLock</code>å½“çº¿ç¨‹éœ€è¦æŒ‰ç‰¹å®šé¡ºåºæ‰§è¡Œä»»åŠ¡æ—¶ï¼ˆä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹äº§ç”Ÿå¦ä¸€ä¸ªçº¿ç¨‹æ¶ˆè€—çš„æ•°æ®æ—¶ï¼‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡ã€‚ç”Ÿäº§è€…æ‰§è¡Œæ—¶ï¼Œæ¶ˆè´¹è€…ä½¿ç”¨ç‰¹å®šäºŽæ‚¨çš„ç¨‹åºçš„æ¡ä»¶æ¥èŽ·å–é”ã€‚ï¼ˆæ¡ä»¶æœ¬èº«åªæ˜¯æ‚¨å®šä¹‰çš„æ•´æ•°å€¼ã€‚ï¼‰ç”Ÿäº§è€…å®Œæˆæ—¶ï¼Œå®ƒå°†è§£é”é”ï¼Œå¹¶å°†é”å®šæ¡ä»¶è®¾ç½®ä¸ºé€‚å½“çš„æ•´æ•°å€¼ä»¥å”¤é†’ä½¿ç”¨è€…çº¿ç¨‹ï¼Œç„¶åŽæ¶ˆè´¹è€…çº¿ç¨‹ç»§ç»­å¤„ç†æ•°æ®ã€‚</p>
<p><code>NSConditionLock</code>å¯¹è±¡å“åº”çš„é”å®šå’Œè§£é”æ–¹æ³•å¯ä»¥ä»»æ„ç»„åˆä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°†ä¸€æ¡<code>lock</code>æ¶ˆæ¯ä¸Ž<code>unlockWithCondition:</code>æˆ– <code>lockWhenCondition:</code>çš„æ¶ˆæ¯<code>unlock</code>ã€‚å½“ç„¶ï¼ŒåŽä¸€ç§ç»„åˆå¯ä»¥è§£é”è¯¥é”ï¼Œä½†å¯èƒ½ä¸ä¼šé‡Šæ”¾ç­‰å¾…ç‰¹å®šæ¡ä»¶å€¼çš„ä»»ä½•çº¿ç¨‹ã€‚</p>
<p>ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•ä½¿ç”¨æ¡ä»¶é”æ¥å¤„ç†ç”Ÿäº§è€…ï¼æ¶ˆè´¹è€…é—®é¢˜ã€‚æƒ³è±¡ä¸€ä¸ªåº”ç”¨ç¨‹åºåŒ…å«ä¸€ä¸ªæ•°æ®é˜Ÿåˆ—ã€‚ç”Ÿäº§è€…çº¿ç¨‹å°†æ•°æ®æ·»åŠ åˆ°é˜Ÿåˆ—ï¼Œè€Œæ¶ˆè´¹è€…çº¿ç¨‹ä»Žé˜Ÿåˆ—ä¸­æå–æ•°æ®ã€‚ç”Ÿäº§è€…ä¸å¿…ç­‰å¾…ç‰¹å®šçš„æ¡ä»¶ï¼Œä½†æ˜¯å¿…é¡»ç­‰å¾…é”å¯ç”¨ï¼Œä»¥ä¾¿å¯ä»¥å®‰å…¨åœ°å°†æ•°æ®æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚</p>
<table>
<thead>
<tr>
<th><code>id condLock = [[NSConditionLock alloc] initWithConditionï¼šNO_DATA];</code></th>
</tr>
</thead>
<tbody><tr>
<td>``</td>
</tr>
<tr>
<td><code>è€Œï¼ˆçœŸï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>[condLocké”å®š]ï¼›</code></td>
</tr>
<tr>
<td><code>/ *å°†æ•°æ®æ·»åŠ åˆ°é˜Ÿåˆ—ã€‚* /</code></td>
</tr>
<tr>
<td><code>[condLock unlockWithConditionï¼šHAS_DATA];</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>å› ä¸ºé”çš„åˆå§‹æ¡ä»¶è®¾ç½®ä¸º<code>NO_DATA</code>ï¼Œæ‰€ä»¥ç”Ÿäº§è€…çº¿ç¨‹åº”è¯¥åœ¨æœ€åˆèŽ·å–é”æ—¶æ²¡æœ‰ä»»ä½•éº»çƒ¦ã€‚å®ƒç”¨æ•°æ®å¡«å……é˜Ÿåˆ—ï¼Œå¹¶å°†æ¡ä»¶è®¾ç½®ä¸º<code>HAS_DATA</code>ã€‚åœ¨åŽç»­è¿­ä»£æœŸé—´ï¼Œç”Ÿäº§è€…çº¿ç¨‹å¯ä»¥åœ¨åˆ°è¾¾æ—¶æ·»åŠ æ–°æ•°æ®ï¼Œè€Œä¸ç®¡é˜Ÿåˆ—æ˜¯ç©ºè¿˜æ˜¯ä»æœ‰ä¸€äº›æ•°æ®ã€‚å®ƒå”¯ä¸€é˜»æ­¢çš„æ—¶é—´æ˜¯ä½¿ç”¨è€…çº¿ç¨‹ä»Žé˜Ÿåˆ—ä¸­æå–æ•°æ®ã€‚</p>
<p>å› ä¸ºä½¿ç”¨è€…çº¿ç¨‹å¿…é¡»è¦å¤„ç†æ•°æ®ï¼Œæ‰€ä»¥å®ƒä½¿ç”¨ç‰¹å®šæ¡ä»¶åœ¨é˜Ÿåˆ—ä¸Šç­‰å¾…ã€‚å½“ç”Ÿäº§è€…å°†æ•°æ®æ”¾å…¥é˜Ÿåˆ—æ—¶ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹å°†å”¤é†’å¹¶èŽ·å–å…¶é”ã€‚ç„¶åŽï¼Œå®ƒå¯ä»¥ä»Žé˜Ÿåˆ—ä¸­æå–ä¸€äº›æ•°æ®å¹¶æ›´æ–°é˜Ÿåˆ—çŠ¶æ€ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä½¿ç”¨è€…çº¿ç¨‹å¤„ç†å¾ªçŽ¯çš„åŸºæœ¬ç»“æž„ã€‚</p>
<table>
<thead>
<tr>
<th><code>è€Œï¼ˆçœŸï¼‰</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>[condLock lockWhenConditionï¼šHAS_DATA];</code></td>
</tr>
<tr>
<td><code>/ *ä»Žé˜Ÿåˆ—ä¸­åˆ é™¤æ•°æ®ã€‚* /</code></td>
</tr>
<tr>
<td><code>[condLock unlockWithConditionï¼šï¼ˆisEmptyï¼ŸNO_DATAï¼šHAS_DATAï¼‰]ï¼›</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//åœ¨æœ¬åœ°å¤„ç†æ•°æ®ã€‚</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>######## ä½¿ç”¨ NSDistributedLock å¯¹è±¡</p>
<p>è¯¥<code>NSDistributedLock</code>ç­ å¯ä»¥è¢«å¤šä¸ªä¸»æœºä¸Šçš„å¤šä¸ªåº”ç”¨ç¨‹åºç”¨æ¥é™åˆ¶å¯¹æŸäº›å…±äº«èµ„æºï¼ˆä¾‹å¦‚æ–‡ä»¶ï¼‰çš„è®¿é—®ã€‚è¯¥é”æœ¬èº«å®žé™…ä¸Šæ˜¯ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿé¡¹ï¼ˆå¦‚æ–‡ä»¶æˆ–ç›®å½•ï¼‰å®žçŽ°çš„äº’æ–¥é”ã€‚ä¸ºäº†ä½¿<code>NSDistributedLock</code>å¯¹è±¡å¯ç”¨ï¼Œè¯¥é”å¿…é¡»å¯ç”±ä½¿ç”¨å®ƒçš„æ‰€æœ‰åº”ç”¨ç¨‹åºå†™å…¥ã€‚è¿™é€šå¸¸æ„å‘³ç€å°†å…¶æ”¾ç½®åœ¨è¿è¡Œè¯¥åº”ç”¨ç¨‹åºçš„æ‰€æœ‰è®¡ç®—æœºéƒ½å¯ä»¥è®¿é—®çš„æ–‡ä»¶ç³»ç»Ÿä¸Šã€‚</p>
<p>ä¸Žå…¶ä»–ç±»åž‹çš„é”ä¸åŒï¼Œ<code>NSDistributedLock</code>å®ƒä¸ç¬¦åˆ<code>NSLocking</code>åè®®ï¼Œå› æ­¤æ²¡æœ‰<code>lock</code>æ–¹æ³•ã€‚ä¸€ç§<code>lock</code>æ–¹æ³•å°†é˜»æ­¢çº¿ç¨‹çš„æ‰§è¡Œï¼Œå¹¶è¦æ±‚ç³»ç»Ÿä»¥é¢„å®šé€ŸçŽ‡è½®è¯¢é”ã€‚ä¸Žå…¶å¯¹æ‚¨çš„ä»£ç å¼ºåŠ æƒ©ç½šï¼Œä¸å¦‚<code>NSDistributedLock</code>æä¾›<code>tryLock</code> æ–¹æ³•ï¼Œè®©æ‚¨å†³å®šæ˜¯å¦è¦è½®è¯¢ã€‚</p>
<p>å› ä¸ºå®ƒæ˜¯ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿå®žçŽ°çš„ï¼Œæ‰€ä»¥<code>NSDistributedLock</code>é™¤éžæ‰€æœ‰è€…æ˜Žç¡®é‡Šæ”¾å¯¹è±¡ï¼Œå¦åˆ™ä¸ä¼šé‡Šæ”¾å¯¹è±¡ã€‚å¦‚æžœæ‚¨çš„åº”ç”¨ç¨‹åºåœ¨æŒæœ‰åˆ†å¸ƒå¼é”çš„åŒæ—¶å´©æºƒï¼Œåˆ™å…¶ä»–å®¢æˆ·ç«¯å°†æ— æ³•è®¿é—®å—ä¿æŠ¤çš„èµ„æºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>breakLock</code>æ‰“ç ´çŽ°æœ‰é”çš„æ–¹æ³•ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥èŽ·å–å®ƒã€‚ä½†æ˜¯ï¼Œé€šå¸¸åº”è¯¥é¿å…ç ´åé”ï¼Œé™¤éžæ‚¨ç¡®å®šæ‹¥æœ‰è¿›ç¨‹å·²æ­»å¹¶ä¸”æ— æ³•é‡Šæ”¾é”ã€‚</p>
<p>ä¸Žå…¶ä»–ç±»åž‹çš„é”ä¸€æ ·ï¼Œä½¿ç”¨<code>NSDistributedLock</code>å®Œå¯¹è±¡åŽï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨<code>unlock</code>æ–¹æ³•æ¥é‡Šæ”¾å®ƒã€‚</p>
<h4 id="ä½¿ç”¨æ¡ä»¶"><a href="#ä½¿ç”¨æ¡ä»¶" class="headerlink" title="ä½¿ç”¨æ¡ä»¶"></a>ä½¿ç”¨æ¡ä»¶</h4><p>æ¡ä»¶æ˜¯ä¸€ç§ç‰¹æ®Šç±»åž‹çš„é”ï¼Œå¯ç”¨äºŽåŒæ­¥æ“ä½œå¿…é¡»æ‰§è¡Œçš„é¡ºåºã€‚å®ƒä»¬ä¸Žäº’æ–¥é”æœ‰ä¸€ä¸ªå¾®å¦™çš„åŒºåˆ«ã€‚ç­‰å¾…æŸä¸ªæ¡ä»¶çš„çº¿ç¨‹ä¿æŒé˜»å¡žçŠ¶æ€ï¼Œç›´åˆ°è¯¥æ¡ä»¶è¢«å¦ä¸€ä¸ªçº¿ç¨‹æ˜¾å¼å‘å‡ºä¿¡å·ä¸ºæ­¢ã€‚</p>
<p>ç”±äºŽå®žçŽ°æ“ä½œç³»ç»Ÿæ‰€æ¶‰åŠçš„å¾®å¦™ä¹‹å¤„ï¼Œå³ä½¿ä»£ç æœªçœŸæ­£å‘å‡ºæ¡ä»¶é”ï¼Œä¹Ÿå…è®¸ä¼ªé€ æˆåŠŸè¿”å›žæ¡ä»¶é”ã€‚ä¸ºäº†é¿å…ç”±è¿™äº›è™šå‡ä¿¡å·å¼•èµ·çš„é—®é¢˜ï¼Œæ‚¨åº”å§‹ç»ˆå°†è°“è¯ä¸Žæ¡ä»¶é”ç»“åˆä½¿ç”¨ã€‚è°“è¯æ˜¯ç¡®å®šçº¿ç¨‹ç»§ç»­æ‰§è¡Œæ˜¯å¦å®‰å…¨çš„æ›´å…·ä½“æ–¹æ³•ã€‚è¯¥æ¡ä»¶åªæ˜¯è®©æ‚¨çš„çº¿ç¨‹å¤„äºŽç¡çœ çŠ¶æ€ï¼Œç›´åˆ°å¯ä»¥ç”±ä¿¡ä»¤çº¿ç¨‹è®¾ç½®è°“è¯ä¸ºæ­¢ã€‚</p>
<p>ä»¥ä¸‹å„èŠ‚è¯´æ˜Žå¦‚ä½•åœ¨ä»£ç ä¸­ä½¿ç”¨æ¡ä»¶ã€‚</p>
<h6 id="ä½¿ç”¨-NSCondition-ç±»"><a href="#ä½¿ç”¨-NSCondition-ç±»" class="headerlink" title="ä½¿ç”¨ NSCondition ç±»"></a>ä½¿ç”¨ NSCondition ç±»</h6><p>çš„<code>NSCondition</code>ç±»æä¾›ç›¸åŒçš„è¯­ä¹‰ POSIX çš„æ¡ä»¶ï¼Œä½†åœ¨å•ä¸ªå¯¹è±¡åŒ…è£…äºŒè€…æ‰€éœ€çš„é”å’Œæ¡ä»¶æ•°æ®ç»“æž„ã€‚ç»“æžœæ˜¯å¯ä»¥åƒäº’æ–¥é”ä¸€æ ·é”å®šå¯¹è±¡ï¼Œç„¶åŽåƒæ¡ä»¶ä¸€æ ·ç­‰å¾…ã€‚</p>
<p>æ¸…å• 4-3 æ˜¾ç¤ºäº†ä¸€ä¸ªä»£ç ç‰‡æ®µï¼Œæ¼”ç¤ºäº†ç­‰å¾…<code>NSCondition</code>å¯¹è±¡çš„äº‹ä»¶åºåˆ—ã€‚è¯¥<code>cocoaCondition</code>å˜é‡åŒ…å«ä¸€ä¸ª<code>NSCondition</code>å¯¹è±¡ï¼Œå¹¶ä¸”è¯¥<code>timeToDoWork</code>å˜é‡æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œåœ¨å‘å‡ºè¯¥ä¿¡å·ä¹‹å‰ç«‹å³ä»Žå¦ä¸€ä¸ªçº¿ç¨‹é€’å¢žã€‚</p>
<p><strong>æ¸…å• 4-3</strong> ä½¿ç”¨å¯å¯æ¡ä»¶</p>
<table>
<thead>
<tr>
<th><code>[cocoaConditioné”];</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>ä¸€ä¼šå„¿ï¼ˆtimeToDoWork &lt;= 0ï¼‰</code></td>
</tr>
<tr>
<td><code>[cocoaConditionç­‰å¾…]ï¼›</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>timeToDoWork--;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//åœ¨è¿™é‡ŒåšçœŸå®žçš„å·¥ä½œã€‚</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>[cocoaConditionè§£é”]ï¼›</code></td>
</tr>
</tbody></table>
<p>æ¸…å• 4-4 æ˜¾ç¤ºäº†ç”¨äºŽå‘å‡ºå¯å¯æ¡ä»¶ä¿¡å·å¹¶å¢žåŠ è°“è¯å˜é‡çš„ä»£ç ã€‚æ‚¨åº”è¯¥å§‹ç»ˆåœ¨å‘å‡ºä¿¡å·ä¹‹å‰é”å®šè¯¥æ¡ä»¶ã€‚</p>
<p><strong>æ¸…å• 4-4</strong> å‘å‡ºå¯å¯çŠ¶å†µä¿¡å·</p>
<table>
<thead>
<tr>
<th><code>[cocoaConditioné”];</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>timeToDoWork ++;</code></td>
</tr>
<tr>
<td><code>[å¯å¯çŠ¶æ€ä¿¡å·]ï¼›</code></td>
</tr>
<tr>
<td><code>[cocoaConditionè§£é”]ï¼›</code></td>
</tr>
</tbody></table>
<h6 id="ä½¿ç”¨-POSIX-æ¡ä»¶"><a href="#ä½¿ç”¨-POSIX-æ¡ä»¶" class="headerlink" title="ä½¿ç”¨ POSIX æ¡ä»¶"></a>ä½¿ç”¨ POSIX æ¡ä»¶</h6><p>POSIX çº¿ç¨‹æ¡ä»¶é”éœ€è¦åŒæ—¶ä½¿ç”¨æ¡ä»¶æ•°æ®ç»“æž„å’Œäº’æ–¥é‡ã€‚å°½ç®¡ä¸¤ä¸ªé”ç»“æž„æ˜¯åˆ†å¼€çš„ï¼Œä½†äº’æ–¥é”åœ¨è¿è¡Œæ—¶ä¸Žæ¡ä»¶ç»“æž„å¯†åˆ‡ç›¸å…³ã€‚ç­‰å¾…ä¿¡å·çš„çº¿ç¨‹åº”å§‹ç»ˆä¸€èµ·ä½¿ç”¨ç›¸åŒçš„äº’æ–¥é”å’Œæ¡ä»¶ç»“æž„ã€‚æ›´æ”¹é…å¯¹ä¼šå¯¼è‡´é”™è¯¯ã€‚</p>
<p>æ¸…å• 4-5 æ˜¾ç¤ºäº†æ¡ä»¶å’Œè°“è¯çš„åŸºæœ¬åˆå§‹åŒ–å’Œç”¨æ³•ã€‚åœ¨åˆå§‹åŒ–æ¡ä»¶å’Œäº’æ–¥é”ä¹‹åŽï¼Œç­‰å¾…çº¿ç¨‹ä½¿ç”¨è¯¥<code>ready_to_go</code>å˜é‡ä½œä¸ºå…¶è°“è¯è¿›å…¥ while å¾ªçŽ¯ã€‚ä»…å½“è°“è¯å·²è®¾ç½®ä¸”éšåŽå‘å‡ºæ¡ä»¶é€šçŸ¥æ—¶ï¼Œç­‰å¾…çº¿ç¨‹æ‰ä¼šå”¤é†’å¹¶å¼€å§‹æ‰§è¡Œå…¶å·¥ä½œã€‚</p>
<p><strong>æ¸…å• 4-5</strong> ä½¿ç”¨ POSIX æ¡ä»¶</p>
<table>
<thead>
<tr>
<th><code>pthread_mutex_täº’æ–¥ä½“;</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>pthread_cond_tæ¡ä»¶;</code></td>
</tr>
<tr>
<td><code>å¸ƒå°”å€¼ready_to_go = true;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>void MyCondInitFunctionï¼ˆï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>pthread_mutex_initï¼ˆï¼†mutexï¼‰;</code></td>
</tr>
<tr>
<td><code>pthread_cond_initï¼ˆï¼†conditionï¼ŒNULLï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>void MyWaitOnConditionFunctionï¼ˆï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//é”å®šäº’æ–¥é”ã€‚</code></td>
</tr>
<tr>
<td><code>pthread_mutex_lockï¼ˆï¼†mutexï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å¦‚æžœè°“è¯å·²ç»è®¾ç½®ï¼Œåˆ™whileå¾ªçŽ¯è¢«ç»•è¿‡ï¼›</code></td>
</tr>
<tr>
<td><code>//å¦åˆ™ï¼Œçº¿ç¨‹å°†ä¼‘çœ ç›´åˆ°è°“è¯è¢«è®¾ç½®ã€‚</code></td>
</tr>
<tr>
<td><code>whileï¼ˆready_to_go == falseï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>pthread_cond_waitï¼ˆï¼†conditionï¼Œï¼†mutexï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>// åšå·¥ä½œã€‚ï¼ˆäº’æ–¥é”åº”ä¿æŒé”å®šçŠ¶æ€ã€‚ï¼‰</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//é‡ç½®è°“è¯å¹¶é‡Šæ”¾äº’æ–¥é‡ã€‚</code></td>
</tr>
<tr>
<td><code>ready_to_go = false;</code></td>
</tr>
<tr>
<td><code>pthread_mutex_unlockï¼ˆï¼†mutexï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>ä¿¡ä»¤çº¿ç¨‹æ—¢è´Ÿè´£è®¾ç½®è°“è¯ï¼Œä¹Ÿè´Ÿè´£å°†ä¿¡å·å‘é€åˆ°æ¡ä»¶é”ã€‚ æ¸…å• 4-6 æ˜¾ç¤ºäº†å®žçŽ°æ­¤è¡Œä¸ºçš„ä»£ç ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ¡ä»¶åœ¨äº’æ–¥é”å†…éƒ¨å‘å‡ºä¿¡å·ï¼Œä»¥é˜²æ­¢åœ¨ç­‰å¾…æ¡ä»¶çš„çº¿ç¨‹ä¹‹é—´å‘ç”Ÿç«žäº‰æ¡ä»¶ã€‚</p>
<p><strong>æ¸…å• 4-6 å‘</strong> ä¿¡å·é€šçŸ¥æ¡ä»¶é”å®š</p>
<table>
<thead>
<tr>
<th><code>void SignalThreadUsingConditionï¼ˆï¼‰</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//æ­¤æ—¶ï¼Œåº”è¯¥æœ‰å¦ä¸€ä¸ªçº¿ç¨‹è¦åšçš„å·¥ä½œã€‚</code></td>
</tr>
<tr>
<td><code>pthread_mutex_lockï¼ˆï¼†mutexï¼‰;</code></td>
</tr>
<tr>
<td><code>ready_to_go = true;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//é€šçŸ¥å¦ä¸€ä¸ªçº¿ç¨‹å¼€å§‹å·¥ä½œã€‚</code></td>
</tr>
<tr>
<td><code>pthread_cond_signalï¼ˆï¼†conditionï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>pthread_mutex_unlockï¼ˆï¼†mutexï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p><strong>æ³¨æ„ï¼š</strong> å‰é¢çš„ä»£ç æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç¤ºä¾‹ï¼Œæ—¨åœ¨æ˜¾ç¤º POSIX çº¿ç¨‹æ¡ä»¶å‡½æ•°çš„åŸºæœ¬ç”¨æ³•ã€‚æ‚¨è‡ªå·±çš„ä»£ç åº”æ£€æŸ¥è¿™äº›å‡½æ•°è¿”å›žçš„é”™è¯¯ä»£ç å¹¶è¿›è¡Œé€‚å½“å¤„ç†ã€‚</p>
<h2 id="çº¿ç¨‹å®‰å…¨æ‘˜è¦"><a href="#çº¿ç¨‹å®‰å…¨æ‘˜è¦" class="headerlink" title="çº¿ç¨‹å®‰å…¨æ‘˜è¦"></a>çº¿ç¨‹å®‰å…¨æ‘˜è¦</h2><p>æœ¬é™„å½•æè¿°äº† OS X å’Œ iOS ä¸­æŸäº›å…³é”®æ¡†æž¶çš„é«˜çº§çº¿ç¨‹å®‰å…¨æ€§ã€‚æœ¬é™„å½•ä¸­çš„ä¿¡æ¯å¯èƒ½ä¼šæ›´æ”¹ã€‚</p>
<h4 id="å¯å¯"><a href="#å¯å¯" class="headerlink" title="å¯å¯"></a>å¯å¯</h4><p>ä»Žå¤šä¸ªçº¿ç¨‹ä½¿ç”¨å¯å¯çš„å‡†åˆ™åŒ…æ‹¬ï¼š</p>
<ul>
<li>ä¸å¯å˜å¯¹è±¡é€šå¸¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åˆ›å»ºå®ƒä»¬ä¹‹åŽï¼Œå°±å¯ä»¥å®‰å…¨åœ°åœ¨çº¿ç¨‹ä¹‹é—´ä¼ é€’è¿™äº›å¯¹è±¡ã€‚å¦ä¸€æ–¹é¢ï¼Œå¯å˜å¯¹è±¡é€šå¸¸ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚è¦åœ¨çº¿ç¨‹åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å¯å˜å¯¹è±¡ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»é€‚å½“åœ°åŒæ­¥ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/ThreadSafetySummary/ThreadSafetySummary.html#//apple_ref/doc/uid/20000736-126010">å¯å˜ä¸Žä¸å¯å˜</a>ã€‚</li>
<li>è®¸å¤šè¢«è®¤ä¸ºâ€œçº¿ç¨‹ä¸å®‰å…¨â€çš„å¯¹è±¡ä»…åœ¨å¤šä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨æ˜¯ä¸å®‰å…¨çš„ã€‚åªè¦ä¸€æ¬¡ä»…ä¸€ä¸ªçº¿ç¨‹ï¼Œå°±å¯ä»¥ä»Žä»»ä½•çº¿ç¨‹ä½¿ç”¨è®¸å¤šè¿™äº›å¯¹è±¡ã€‚ä¸“é—¨è°ƒå‡ºåº”ç”¨ç¨‹åºä¸»çº¿ç¨‹çš„å¯¹è±¡å°±è¿™æ ·è¢«è°ƒå‡ºã€‚</li>
<li>åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹è´Ÿè´£å¤„ç†äº‹ä»¶ã€‚å°½ç®¡å¦‚æžœäº‹ä»¶è·¯å¾„ä¸­åŒ…å«å…¶ä»–çº¿ç¨‹ï¼ŒApplication Kit ä»å¯ä»¥ç»§ç»­å·¥ä½œï¼Œä½†æ˜¯æ“ä½œå¯èƒ½ä¼šä¸æŒ‰é¡ºåºè¿›è¡Œã€‚</li>
<li>å¦‚æžœè¦ä½¿ç”¨çº¿ç¨‹ç»˜åˆ¶è§†å›¾ï¼Œè¯·åœ¨çš„<code>lockFocusIfCanDraw</code>å’Œ<code>unlockFocus</code>æ–¹æ³•ä¹‹é—´å°†æ‰€æœ‰ç»˜åˆ¶ä»£ç æ‹¬åœ¨æ‹¬å·ä¸­<code>NSView</code>ã€‚</li>
<li>è¦å°† POSIX çº¿ç¨‹ä¸Ž Cocoa ä¸€èµ·ä½¿ç”¨ï¼Œå¿…é¡»é¦–å…ˆå°† Cocoa ç½®äºŽå¤šçº¿ç¨‹æ¨¡å¼ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/CreatingThreads/CreatingThreads.html#//apple_ref/doc/uid/20000738-125024">åœ¨ Cocoa åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ POSIX çº¿ç¨‹</a>ã€‚</li>
</ul>
<h6 id="åŸºç¡€æ¡†æž¶çº¿ç¨‹å®‰å…¨"><a href="#åŸºç¡€æ¡†æž¶çº¿ç¨‹å®‰å…¨" class="headerlink" title="åŸºç¡€æ¡†æž¶çº¿ç¨‹å®‰å…¨"></a>åŸºç¡€æ¡†æž¶çº¿ç¨‹å®‰å…¨</h6><p>æœ‰ä¸€ä¸ªè¯¯è§£ï¼Œè®¤ä¸º Foundation æ¡†æž¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œ Application Kit æ¡†æž¶ä¸æ˜¯ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªç²—ç•¥çš„æ¦‚æ‹¬å¹¶ä¸”æœ‰äº›è¯¯å¯¼ã€‚æ¯ä¸ªæ¡†æž¶éƒ½æœ‰çº¿ç¨‹å®‰å…¨çš„åŒºåŸŸå’Œä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„åŒºåŸŸã€‚ä»¥ä¸‹å„èŠ‚æè¿°äº† Foundation æ¡†æž¶çš„ä¸€èˆ¬çº¿ç¨‹å®‰å…¨æ€§ã€‚</p>
<p>######## çº¿ç¨‹å®‰å…¨çš„ç±»å’Œå‡½æ•°</p>
<p>ä»¥ä¸‹ç±»å’Œå‡½æ•°é€šå¸¸è¢«è®¤ä¸ºæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ‚¨å¯ä»¥ä»Žå¤šä¸ªçº¿ç¨‹ä½¿ç”¨åŒä¸€å®žä¾‹ï¼Œè€Œæ— éœ€å…ˆèŽ·å–é”ã€‚</p>
<ul>
<li><code>NSArray</code></li>
<li><code>NSAssertionHandler</code></li>
<li><code>NSAttributedString</code></li>
<li><code>NSBundle</code></li>
<li><code>NSCalendar</code></li>
<li><code>NSCalendarDate</code></li>
<li><code>NSCharacterSet</code></li>
<li><code>NSConditionLock</code></li>
<li><code>NSConnection</code></li>
<li><code>NSData</code></li>
<li><code>NSDate</code></li>
<li><code>NSDateFormatter</code></li>
<li><code>NSDecimal</code> åŠŸèƒ½</li>
<li><code>NSDecimalNumber</code></li>
<li><code>NSDecimalNumberHandler</code></li>
<li><code>NSDeserializer</code></li>
<li><code>NSDictionary</code></li>
<li><code>NSDistantObject</code></li>
<li><code>NSDistributedLock</code></li>
<li><code>NSDistributedNotificationCenter</code></li>
<li><code>NSException</code></li>
<li><code>NSFileManager</code></li>
<li><code>NSFormatter</code></li>
<li><code>NSHost</code></li>
<li><code>NSJSONSerialization</code></li>
<li><code>NSLock</code></li>
<li><code>NSLog</code>/<code>NSLogv</code></li>
<li><code>NSMethodSignature</code></li>
<li><code>NSNotification</code></li>
<li><code>NSNotificationCenter</code></li>
<li><code>NSNumber</code></li>
<li><code>NSNumberFormatter</code></li>
<li><code>NSObject</code></li>
<li><code>NSOrderedSet</code></li>
<li><code>NSPortCoder</code></li>
<li><code>NSPortMessage</code></li>
<li><code>NSPortNameServer</code></li>
<li><code>NSProgress</code></li>
<li><code>NSProtocolChecker</code></li>
<li><code>NSProxy</code></li>
<li><code>NSRecursiveLock</code></li>
<li><code>NSSet</code></li>
<li><code>NSString</code></li>
<li><code>NSThread</code></li>
<li><code>NSTimer</code></li>
<li><code>NSTimeZone</code></li>
<li><code>NSUserDefaults</code></li>
<li><code>NSValue</code></li>
<li><code>NSXMLParser</code></li>
<li>å¯¹è±¡åˆ†é…å’Œä¿ç•™è®¡æ•°åŠŸèƒ½</li>
<li>åŒºåŸŸå’Œè®°å¿†åŠŸèƒ½</li>
</ul>
<p>######## çº¿ç¨‹ä¸å®‰å…¨ç±»</p>
<p>ä»¥ä¸‹ç±»å’Œå‡½æ•°é€šå¸¸ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä»Žä»»ä½•çº¿ç¨‹ä½¿ç”¨è¿™äº›ç±»ï¼Œåªè¦ä¸€æ¬¡ä»…ä»Žä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨å®ƒä»¬å³å¯ã€‚æ£€æŸ¥ç±»æ–‡æ¡£ä»¥èŽ·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p>
<ul>
<li><code>NSArchiver</code></li>
<li><code>NSAutoreleasePool</code></li>
<li><code>NSCoder</code></li>
<li><code>NSCountedSet</code></li>
<li><code>NSEnumerator</code></li>
<li><code>NSFileHandle</code></li>
<li><code>NSHashTable</code> åŠŸèƒ½</li>
<li><code>NSInvocation</code></li>
<li><code>NSMapTable</code> åŠŸèƒ½</li>
<li><code>NSMutableArray</code></li>
<li><code>NSMutableAttributedString</code></li>
<li><code>NSMutableCharacterSet</code></li>
<li><code>NSMutableData</code></li>
<li><code>NSMutableDictionary</code></li>
<li><code>NSMutableOrderedSet</code></li>
<li><code>NSMutableSet</code></li>
<li><code>NSMutableString</code></li>
<li><code>NSNotificationQueue</code></li>
<li><code>NSPipe</code></li>
<li><code>NSPort</code></li>
<li><code>NSProcessInfo</code></li>
<li><code>NSRunLoop</code></li>
<li><code>NSScanner</code></li>
<li><code>NSSerializer</code></li>
<li><code>NSTask</code></li>
<li><code>NSUnarchiver</code></li>
<li><code>NSUndoManager</code></li>
<li>ç”¨æˆ·åå’Œä¸»ç›®å½•åŠŸèƒ½</li>
</ul>
<p>è¯·æ³¨æ„ï¼Œå°½ç®¡<code>NSArchiver</code>ï¼Œ<code>NSCoder</code>å’Œ<code>NSEnumerator</code>å¯¹è±¡æœ¬èº«éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†åœ¨æ­¤å¤„åˆ—å‡ºå®ƒä»¬æ˜¯å› ä¸ºåœ¨ä½¿ç”¨å®ƒä»¬æ—¶æ›´æ”¹ç”±å®ƒä»¬åŒ…è£…çš„æ•°æ®å¯¹è±¡å¹¶ä¸å®‰å…¨ã€‚ä¾‹å¦‚ï¼Œå¯¹äºŽå½’æ¡£å™¨ï¼Œæ›´æ”¹è¦å½’æ¡£çš„å¯¹è±¡å›¾æ˜¯ä¸å®‰å…¨çš„ã€‚å¯¹äºŽæžšä¸¾ï¼Œä»»ä½•çº¿ç¨‹æ›´æ”¹æžšä¸¾é›†åˆéƒ½æ˜¯ä¸å®‰å…¨çš„ã€‚</p>
<p>######## ä»…ä¸»çº¿ç¨‹ç±»</p>
<p>åªèƒ½åœ¨åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨ä»¥ä¸‹ç±»ã€‚</p>
<ul>
<li><code>NSAppleScript</code></li>
</ul>
<p>######## å¯å˜ä¸Žä¸å¯å˜</p>
<p>ä¸å˜çš„å¯¹è±¡é€šå¸¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›åˆ›å»ºå®ƒä»¬ä¹‹åŽï¼Œå°±å¯ä»¥å®‰å…¨åœ°åœ¨çº¿ç¨‹ä¹‹é—´ä¼ é€’è¿™äº›å¯¹è±¡ã€‚å½“ç„¶ï¼Œå½“ä½¿ç”¨ä¸å¯å˜å¯¹è±¡æ—¶ï¼Œæ‚¨ä»ç„¶éœ€è¦è®°ä½æ­£ç¡®ä½¿ç”¨å¼•ç”¨è®¡æ•°ã€‚å¦‚æžœä¸å½“é‡Šæ”¾äº†ä¸€ä¸ªæœªä¿ç•™çš„å¯¹è±¡ï¼Œåˆ™ç¨åŽå¯èƒ½ä¼šå¯¼è‡´å¼‚å¸¸ã€‚</p>
<p>å¯å˜å¯¹è±¡é€šå¸¸ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚è¦åœ¨çº¿ç¨‹åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å¯å˜å¯¹è±¡ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»ä½¿ç”¨é”åŒæ­¥å¯¹å®ƒä»¬çš„è®¿é—®ã€‚ï¼ˆæœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/ThreadSafety/ThreadSafety.html#//apple_ref/doc/uid/10000057i-CH8-SW2">åŽŸå­æ“ä½œ</a>ï¼‰ã€‚é€šå¸¸ï¼Œå½“æ¶‰åŠåˆ°çªå˜æ—¶ï¼Œæ”¶é›†ç±»ï¼ˆä¾‹å¦‚<code>NSMutableArray</code>ï¼Œ<code>NSMutableDictionary</code>ï¼‰ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹æ­£åœ¨æ›´æ”¹åŒä¸€é˜µåˆ—ï¼Œåˆ™å¯èƒ½ä¼šå‡ºçŽ°é—®é¢˜ã€‚æ‚¨å¿…é¡»é”å®šå‘ç”Ÿè¯»å†™çš„åœ°æ–¹ï¼Œä»¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚</p>
<p>å³ä½¿æŸä¸ªæ–¹æ³•å£°ç§°è¦è¿”å›žä¸€ä¸ªä¸å¯å˜çš„å¯¹è±¡ï¼Œæ‚¨ä¹Ÿç»ä¸èƒ½ç®€å•åœ°å‡è®¾è¿”å›žçš„å¯¹è±¡æ˜¯ä¸å¯å˜çš„ã€‚æ ¹æ®æ–¹æ³•çš„å®žçŽ°ï¼Œè¿”å›žçš„å¯¹è±¡å¯èƒ½æ˜¯å¯å˜çš„æˆ–ä¸å¯å˜çš„ã€‚ä¾‹å¦‚ï¼Œè¿”å›žç±»åž‹ä¸ºçš„æ–¹æ³•<code>NSString</code>å¯èƒ½ä¼š<code>NSMutableString</code>ç”±äºŽå…¶å®žçŽ°è€Œå®žé™…ä¸Šè¿”å›ž a ã€‚å¦‚æžœè¦ä¿è¯æ‰€æ‹¥æœ‰çš„å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œåˆ™åº”åˆ¶ä½œä¸å¯å˜çš„å‰¯æœ¬ã€‚</p>
<p>######## å†å…¥</p>
<p>åªæœ‰åœ¨æ“ä½œâ€œè°ƒå‡ºâ€åŒä¸€å¯¹è±¡æˆ–ä¸åŒå¯¹è±¡ä¸Šçš„å…¶ä»–æ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ‰å¯ä»¥é‡å…¥ã€‚ä¿ç•™å’Œé‡Šæ”¾ç‰©ä½“æ˜¯ä¸€ç§æœ‰æ—¶è¢«å¿½ç•¥çš„â€œå¬å”¤â€ã€‚</p>
<p>ä¸‹è¡¨åˆ—å‡ºäº† Foundation æ¡†æž¶ä¸­æ˜Žç¡®å¯é‡å…¥çš„éƒ¨åˆ†ã€‚æ‰€æœ‰å…¶ä»–ç±»åˆ«å¯èƒ½ä¼šä¹Ÿå¯èƒ½ä¸ä¼šé‡å…¥ï¼Œæˆ–è€…å°†æ¥å¯èƒ½ä¼šé‡å…¥ã€‚å°šæœªå¯¹æŠ˜è¿”è¿›è¡Œå®Œæ•´çš„åˆ†æžï¼Œæ­¤åˆ—è¡¨å¯èƒ½å¹¶ä¸è¯¦å°½ã€‚</p>
<ul>
<li>åˆ†å¸ƒå¼å¯¹è±¡</li>
<li><code>NSConditionLock</code></li>
<li><code>NSDistributedLock</code></li>
<li><code>NSLock</code></li>
<li><code>NSLog</code>/<code>NSLogv</code></li>
<li><code>NSNotificationCenter</code></li>
<li><code>NSRecursiveLock</code></li>
<li><code>NSRunLoop</code></li>
<li><code>NSUserDefaults</code></li>
</ul>
<p>######## ç±»åˆå§‹åŒ–</p>
<p>Objective-C è¿è¡Œæ—¶ç³»ç»Ÿå‘é€ä¸€ä¸ª <code>initialize</code>åœ¨ç±»æ”¶åˆ°ä»»ä½•å…¶ä»–æ¶ˆæ¯ä¹‹å‰ï¼Œå‘æ¯ä¸ªç±»å¯¹è±¡å‘é€æ¶ˆæ¯ã€‚è¿™ä½¿è¯¥ç±»æœ‰æœºä¼šè®¾ç½®å…¶è¿è¡Œæ—¶çŽ¯å¢ƒåœ¨ä½¿ç”¨ä¹‹å‰ã€‚åœ¨å¤šçº¿ç¨‹åº”ç”¨ç¨‹åºä¸­ï¼Œè¿è¡Œæ—¶ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼ˆæ°å¥½å°†ç¬¬ä¸€æ¡æ¶ˆæ¯å‘é€ç»™ç±»çš„çº¿ç¨‹ï¼‰æ‰§è¡Œè¯¥<code>initialize</code>æ–¹æ³•ã€‚å¦‚æžœåœ¨ç¬¬ä¸€ä¸ªçº¿ç¨‹ä»åœ¨è¯¥<code>initialize</code>æ–¹æ³•ä¸­æ—¶ç¬¬äºŒä¸ªçº¿ç¨‹å°è¯•å‘è¯¥ç±»å‘é€æ¶ˆæ¯ï¼Œåˆ™ç¬¬äºŒä¸ªçº¿ç¨‹å°†é˜»å¡žç›´åˆ°è¯¥<code>initialize</code>æ–¹æ³•å®Œæˆæ‰§è¡Œã€‚åŒæ—¶ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç»§ç»­è°ƒç”¨è¯¥ç±»ä¸Šçš„å…¶ä»–æ–¹æ³•ã€‚è¯¥<code>initialize</code>æ–¹æ³•ä¸åº”ä¾èµ–äºŽè¯¥ç±»çš„ç¬¬äºŒä¸ªçº¿ç¨‹è°ƒç”¨æ–¹æ³•ã€‚å¦‚æžœæ˜¯è¿™æ ·ï¼Œåˆ™ä¸¤ä¸ªçº¿ç¨‹å°†é™·å…¥åƒµå±€ã€‚</p>
<p>ç”±äºŽ OS X ç‰ˆæœ¬ 10.1.x å’Œæ›´æ—©ç‰ˆæœ¬ä¸­çš„é”™è¯¯ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥åœ¨å¦ä¸€ä¸ªçº¿ç¨‹å®Œæˆæ‰§è¡Œè¯¥ç±»çš„<code>initialize</code>æ–¹æ³•ä¹‹å‰å°†æ¶ˆæ¯å‘é€ç»™è¯¥ç±»ã€‚ç„¶åŽï¼Œçº¿ç¨‹å¯ä»¥è®¿é—®å°šæœªå®Œå…¨åˆå§‹åŒ–çš„å€¼ï¼Œè¿™å¯èƒ½ä¼šä½¿åº”ç”¨ç¨‹åºå´©æºƒã€‚å¦‚æžœé‡åˆ°æ­¤é—®é¢˜ï¼Œåˆ™éœ€è¦å¼•å…¥é”ä»¥é˜²æ­¢åœ¨åˆå§‹åŒ–å€¼ä¹‹å‰è®¿é—®å€¼ï¼Œæˆ–è€…å¼ºåˆ¶ç±»åœ¨æˆä¸ºå¤šçº¿ç¨‹ä¹‹å‰å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ã€‚</p>
<p>######## è‡ªåŠ¨é‡Šæ”¾æ± </p>
<p>æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤è‡ªå·±çš„<code>NSAutoreleasePool</code>å¯¹è±¡å †æ ˆã€‚Cocoa å¸Œæœ›åœ¨å½“å‰çº¿ç¨‹çš„å †æ ˆä¸Šå§‹ç»ˆæœ‰ä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ã€‚å¦‚æžœæ± ä¸å¯ç”¨ï¼Œåˆ™ä¸ä¼šé‡Šæ”¾å¯¹è±¡ï¼Œå¹¶ä¸”ä¼šæ³„æ¼å†…å­˜ã€‚ä¸€ä¸ª<code>NSAutoreleasePool</code>å¯¹è±¡ä¼šè‡ªåŠ¨åˆ›å»ºå¹¶åœ¨åŸºäºŽåº”ç”¨ç¨‹åºå¥—ä»¶åº”ç”¨çš„ä¸»çº¿ç¨‹æ‘§æ¯ï¼Œä½†è¾…åŠ©çº¿ç¨‹ï¼ˆå’ŒåŸºé‡‘ä¼šåªåº”ç”¨ï¼‰å¿…é¡»åœ¨ä½¿ç”¨å‰ï¼Œå¯å¯åˆ›å»ºè‡ªå·±çš„ã€‚å¦‚æžœæ‚¨çš„çº¿ç¨‹æ˜¯é•¿æœŸå­˜åœ¨çš„ï¼Œå¹¶å¯èƒ½ç”Ÿæˆè®¸å¤šè‡ªåŠ¨é‡Šæ”¾çš„å¯¹è±¡ï¼Œæ‚¨åº”è¯¥å®šæœŸé”€æ¯å¹¶åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ï¼ˆå°±åƒ Application Kit åœ¨ä¸»çº¿ç¨‹ä¸Šä¸€æ ·ï¼‰ï¼›å¦åˆ™ï¼Œè‡ªåŠ¨é‡Šæ”¾çš„å¯¹è±¡ä¼šå †ç§¯ï¼Œå¹¶ä¸”æ‚¨çš„å†…å­˜å ç”¨ä¹Ÿä¼šå¢žåŠ ã€‚å¦‚æžœåˆ†ç¦»çš„çº¿ç¨‹ä¸ä½¿ç”¨ Cocoaï¼Œåˆ™æ— éœ€åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ã€‚</p>
<p>######## è¿è¡Œå¾ªçŽ¯</p>
<p>æ¯ä¸ªçº¿ç¨‹åªæœ‰ä¸€ä¸ªè¿è¡Œå¾ªçŽ¯ã€‚ä½†æ˜¯ï¼Œæ¯ä¸ªè¿è¡Œå¾ªçŽ¯ä»¥åŠæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸€ç»„è¾“å…¥æ¨¡å¼ï¼Œè¿™äº›è¾“å…¥æ¨¡å¼ç¡®å®šè¿è¡Œè¿è¡Œå¾ªçŽ¯æ—¶ä¾¦å¬å“ªäº›è¾“å…¥æºã€‚ä¸€ä¸ªè¿è¡Œå¾ªçŽ¯ä¸­å®šä¹‰çš„è¾“å…¥æ¨¡å¼ä¸ä¼šå½±å“å¦ä¸€ä¸ªè¿è¡Œå¾ªçŽ¯ä¸­å®šä¹‰çš„è¾“å…¥æ¨¡å¼ï¼Œå³ä½¿å®ƒä»¬çš„åç§°ç›¸åŒã€‚</p>
<p>å¦‚æžœæ‚¨çš„åº”ç”¨ç¨‹åºåŸºäºŽ Application Kitï¼Œåˆ™ä¸»çº¿ç¨‹çš„è¿è¡Œå¾ªçŽ¯å°†è‡ªåŠ¨è¿è¡Œï¼Œä½†æ˜¯è¾…åŠ©çº¿ç¨‹ï¼ˆå’Œä»…åŸºé‡‘ä¼šçš„åº”ç”¨ç¨‹åºï¼‰å¿…é¡»è‡ªå·±è¿è¡Œè¿è¡Œå¾ªçŽ¯ã€‚å¦‚æžœåˆ†ç¦»çš„çº¿ç¨‹æœªè¿›å…¥è¿è¡Œå¾ªçŽ¯ï¼Œåˆ™è¯¥çº¿ç¨‹å°†åœ¨åˆ†ç¦»çš„æ–¹æ³•å®Œæˆæ‰§è¡ŒåŽç«‹å³é€€å‡ºã€‚</p>
<p>å°½ç®¡æœ‰ä¸€äº›å¤–è¡¨ï¼Œä½†<code>NSRunLoop</code>è¯¥ç±»ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ‚¨åªèƒ½ä»Žæ‹¥æœ‰å®ƒçš„çº¿ç¨‹ä¸­è°ƒç”¨æ­¤ç±»çš„å®žä¾‹æ–¹æ³•ã€‚</p>
<h6 id="åº”ç”¨å¥—ä»¶æ¡†æž¶çº¿ç¨‹å®‰å…¨"><a href="#åº”ç”¨å¥—ä»¶æ¡†æž¶çº¿ç¨‹å®‰å…¨" class="headerlink" title="åº”ç”¨å¥—ä»¶æ¡†æž¶çº¿ç¨‹å®‰å…¨"></a>åº”ç”¨å¥—ä»¶æ¡†æž¶çº¿ç¨‹å®‰å…¨</h6><p>ä»¥ä¸‹å„èŠ‚æè¿°äº† Application Kit æ¡†æž¶çš„ä¸€èˆ¬çº¿ç¨‹å®‰å…¨æ€§ã€‚</p>
<p>######## çº¿ç¨‹ä¸å®‰å…¨ç±»</p>
<p>ä»¥ä¸‹ç±»å’Œå‡½æ•°é€šå¸¸ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä»Žä»»ä½•çº¿ç¨‹ä½¿ç”¨è¿™äº›ç±»ï¼Œåªè¦ä¸€æ¬¡ä»…ä»Žä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨å®ƒä»¬å³å¯ã€‚æ£€æŸ¥ç±»æ–‡æ¡£ä»¥èŽ·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p>
<ul>
<li><code>NSGraphicsContext</code>ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/ThreadSafetySummary/ThreadSafetySummary.html#//apple_ref/doc/uid/10000057i-CH12-126712">NSGraphicsContext é™åˆ¶</a>ã€‚</li>
<li><code>NSImage</code>ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/ThreadSafetySummary/ThreadSafetySummary.html#//apple_ref/doc/uid/10000057i-CH12-126728">NSImage é™åˆ¶</a>ã€‚</li>
<li><code>NSResponder</code></li>
<li><code>NSWindow</code>åŠå…¶æ‰€æœ‰åŽä»£ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/ThreadSafetySummary/ThreadSafetySummary.html#//apple_ref/doc/uid/10000057i-CH12-123364">çª—å£é™åˆ¶</a>ã€‚</li>
</ul>
<p>######## ä»…ä¸»çº¿ç¨‹ç±»</p>
<p>åªèƒ½åœ¨åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨ä»¥ä¸‹ç±»ã€‚</p>
<ul>
<li><code>NSCell</code> åŠå…¶æ‰€æœ‰åŽä»£</li>
<li><code>NSView</code>åŠå…¶æ‰€æœ‰åŽä»£ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/ThreadSafetySummary/ThreadSafetySummary.html#//apple_ref/doc/uid/10000057i-CH12-123427">NSView é™åˆ¶</a>ã€‚</li>
</ul>
<p>######## çª—å£é™åˆ¶</p>
<p>æ‚¨å¯ä»¥åœ¨è¾…åŠ©çº¿ç¨‹ä¸Šåˆ›å»ºä¸€ä¸ªçª—å£ã€‚åº”ç”¨ç¨‹åºåŒ…ç¡®ä¿ä¸Žçª—å£å…³è”çš„æ•°æ®ç»“æž„åœ¨ä¸»çº¿ç¨‹ä¸Šè¢«é‡æ–°åˆ†é…ï¼Œä»¥é¿å…å‡ºçŽ°ç«žäº‰æƒ…å†µã€‚çª—å£å¯¹è±¡å¯èƒ½ä¼šåœ¨åŒæ—¶å¤„ç†å¤§é‡çª—å£çš„åº”ç”¨ç¨‹åºä¸­æ³„æ¼ã€‚</p>
<p>æ‚¨å¯ä»¥åœ¨è¾…åŠ©çº¿ç¨‹ä¸Šåˆ›å»ºæ¨¡å¼çª—å£ã€‚å½“ä¸»çº¿ç¨‹è¿è¡Œæ¨¡å¼å¾ªçŽ¯æ—¶ï¼Œåº”ç”¨ç¨‹åºå·¥å…·åŒ…å°†é˜»æ­¢æ­£åœ¨è°ƒç”¨çš„è¾…åŠ©çº¿ç¨‹ã€‚</p>
<p>######## äº‹ä»¶å¤„ç†é™åˆ¶</p>
<p>åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹è´Ÿè´£å¤„ç†äº‹ä»¶ã€‚ä¸»çº¿ç¨‹æ˜¯çš„<code>run</code>æ–¹æ³•ä¸­è¢«é˜»å¡žçš„çº¿ç¨‹<code>NSApplication</code>ï¼Œé€šå¸¸åœ¨åº”ç”¨ç¨‹åºçš„<code>main</code>å‡½æ•°ä¸­è°ƒç”¨ã€‚å¦‚æžœäº‹ä»¶è·¯å¾„ä¸­æ¶‰åŠå…¶ä»–çº¿ç¨‹ï¼Œåˆ™ Application Kit ç»§ç»­å·¥ä½œæ—¶ï¼Œæ“ä½œå¯èƒ½ä¼šä¸æŒ‰é¡ºåºè¿›è¡Œã€‚ä¾‹å¦‚ï¼Œå¦‚æžœä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹æ­£åœ¨å“åº”æŒ‰é”®äº‹ä»¶ï¼Œåˆ™å¯èƒ½ä¼šä¹±åºæŽ¥æ”¶æŒ‰é”®ã€‚é€šè¿‡è®©ä¸»çº¿ç¨‹å¤„ç†äº‹ä»¶ï¼Œæ‚¨å¯ä»¥èŽ·å¾—æ›´ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒã€‚æŽ¥æ”¶åˆ°äº‹ä»¶åŽï¼Œå¦‚æžœéœ€è¦ï¼Œå¯ä»¥å°†äº‹ä»¶è°ƒåº¦åˆ°è¾…åŠ©çº¿ç¨‹è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚</p>
<p>æ‚¨å¯ä»¥ä»Žè¾…åŠ©çº¿ç¨‹è°ƒç”¨<code>postEvent:atStart:</code>æ–¹æ³•ï¼Œ<code>NSApplication</code>ä»¥å°†äº‹ä»¶å‘å¸ƒåˆ°ä¸»çº¿ç¨‹çš„äº‹ä»¶é˜Ÿåˆ—ä¸­ã€‚ä½†æ˜¯ï¼Œä¸èƒ½ä¿è¯æœ‰å…³ç”¨æˆ·è¾“å…¥äº‹ä»¶çš„é¡ºåºã€‚åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ä»è´Ÿè´£å¤„ç†äº‹ä»¶é˜Ÿåˆ—ä¸­çš„äº‹ä»¶ã€‚</p>
<p>######## ç»˜å›¾é™åˆ¶</p>
<p>ä½¿ç”¨å…¶å›¾å½¢åŠŸèƒ½å’Œç±»ï¼ˆåŒ…æ‹¬<code>NSBezierPath</code>å’Œ<code>NSString</code>ç±»ï¼‰è¿›è¡Œç»˜åˆ¶æ—¶ï¼ŒApplication Kit é€šå¸¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä»¥ä¸‹å„èŠ‚ä»‹ç»äº†ä½¿ç”¨ç‰¹å®šç±»çš„è¯¦ç»†ä¿¡æ¯ã€‚æœ‰å…³ç»˜å›¾å’Œèžºçº¹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ã€Š_<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CocoaDrawingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40003290">å¯å¯ç»˜å›¾æŒ‡å—ã€‹</a>_ã€‚</p>
<p>########## NSView é™åˆ¶</p>
<p>è¯¥<code>NSView</code>ç­é€šå¸¸ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ‚¨<code>NSView</code>ä»…åº”ä»Žåº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹åˆ›å»ºï¼Œé”€æ¯ï¼Œè°ƒæ•´å¤§å°ï¼Œç§»åŠ¨å¯¹è±¡å¹¶æ‰§è¡Œå…¶ä»–æ“ä½œã€‚ä»Žè¾…åŠ©çº¿ç¨‹è¿›è¡Œç»˜å›¾æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåªè¦å°†ç»˜å›¾è°ƒç”¨ä¸Ž<code>lockFocusIfCanDraw</code> å’Œ <code>unlockFocus</code>ã€‚</p>
<p>å¦‚æžœä¸€ä¸ªåº”ç”¨ç¨‹åºçš„ä¸€ä¸ªæ¬¡çº§çº¿ç¨‹æƒ³è¦ä½¿è§†å›¾çš„éƒ¨åˆ†æ˜¯ä¸»è¦çš„çº¿ç¨‹ä¸Šé‡æ–°ç»˜åˆ¶ï¼Œå®ƒå¿…é¡»è¿™æ ·åšä½¿ç”¨çš„æ–¹æ³•ï¼Œå¦‚<code>display</code>ï¼Œ<code>setNeedsDisplay:</code>ï¼Œ<code>setNeedsDisplayInRect:</code>ï¼Œæˆ–<code>setViewsNeedDisplay:</code>ã€‚ç›¸åï¼Œå®ƒåº”è¯¥å‘ä¸»çº¿ç¨‹å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œæˆ–ä½¿ç”¨<code>performSelectorOnMainThread:withObject:waitUntilDone:</code> æ–¹æ³•ä»£æ›¿ã€‚</p>
<p>è§†å›¾ç³»ç»Ÿçš„å›¾å½¢çŠ¶æ€ï¼ˆgstatesï¼‰æ˜¯æ¯ä¸ªçº¿ç¨‹çš„ã€‚ä½¿ç”¨å›¾å½¢çŠ¶æ€æ›¾ç»æ˜¯åœ¨å•çº¿ç¨‹åº”ç”¨ç¨‹åºä¸ŠèŽ·å¾—æ›´å¥½ç»˜å›¾æ€§èƒ½çš„ä¸€ç§æ–¹å¼ï¼Œä½†æ˜¯çŽ°åœ¨ä¸å†å¦‚æ­¤ã€‚é”™è¯¯ä½¿ç”¨å›¾å½¢çŠ¶æ€å®žé™…ä¸Šä¼šå¯¼è‡´ç»˜åˆ¶ä»£ç çš„æ•ˆçŽ‡ä½ŽäºŽåœ¨ä¸»çº¿ç¨‹ä¸­ç»˜åˆ¶çš„æ•ˆçŽ‡ã€‚</p>
<p>########## NSGraphicsContext é™åˆ¶</p>
<p>è¯¥<code>NSGraphicsContext</code>ç­è¡¨ç¤ºåŸºç¡€å›¾å½¢ç³»ç»Ÿæä¾›çš„ç»˜å›¾ä¸Šä¸‹æ–‡ã€‚æ¯ä¸ª<code>NSGraphicsContext</code>å®žä¾‹éƒ½æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„å›¾å½¢çŠ¶æ€ï¼šåæ ‡ç³»ï¼Œå‰ªè¾‘ï¼Œå½“å‰å­—ä½“ç­‰ã€‚åœ¨æ¯ä¸ª<code>NSWindow</code>å®žä¾‹çš„ä¸»çº¿ç¨‹ä¸Šè‡ªåŠ¨åˆ›å»ºè¯¥ç±»çš„å®žä¾‹ã€‚å¦‚æžœæ‚¨ä»Žè¾…åŠ©çº¿ç¨‹è¿›è¡Œä»»ä½•ç»˜å›¾ï¼Œ<code>NSGraphicsContext</code>åˆ™ä¼šä¸“é—¨ä¸ºè¯¥çº¿ç¨‹åˆ›å»ºä¸€ä¸ªæ–°çš„å®žä¾‹ã€‚</p>
<p>å¦‚æžœä»Žè¾…åŠ©çº¿ç¨‹è¿›è¡Œä»»ä½•ç»˜å›¾ï¼Œåˆ™å¿…é¡»æ‰‹åŠ¨åˆ·æ–°ç»˜å›¾è°ƒç”¨ã€‚Cocoa ä¸ä¼šè‡ªåŠ¨ä½¿ç”¨ä»Žè¾…åŠ©çº¿ç¨‹ç»˜åˆ¶çš„å†…å®¹æ¥æ›´æ–°è§†å›¾ï¼Œå› æ­¤æ‚¨éœ€è¦åœ¨å®Œæˆç»˜åˆ¶æ—¶è°ƒç”¨<code>flushGraphics</code>æ–¹æ³•<code>NSGraphicsContext</code>ã€‚å¦‚æžœæ‚¨çš„åº”ç”¨ç¨‹åºä»…ä»Žä¸»çº¿ç¨‹ç»˜åˆ¶å†…å®¹ï¼Œåˆ™æ— éœ€åˆ·æ–°ç»˜åˆ¶è°ƒç”¨ã€‚</p>
<p>########## NSImage é™åˆ¶</p>
<p>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºä¸€ä¸ª<code>NSImage</code>å¯¹è±¡ï¼Œç»˜åˆ¶åˆ°å›¾åƒç¼“å†²åŒºï¼Œç„¶åŽå°†å…¶ä¼ é€’ç»™ä¸»çº¿ç¨‹è¿›è¡Œç»˜åˆ¶ã€‚åŸºç¡€å›¾åƒç¼“å­˜åœ¨æ‰€æœ‰çº¿ç¨‹ä¹‹é—´å…±äº«ã€‚æœ‰å…³å›¾åƒä»¥åŠç¼“å­˜å¦‚ä½•å·¥ä½œçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§*<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CocoaDrawingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40003290">Cocoa Drawing Guide</a>*ã€‚</p>
<h6 id="æ ¸å¿ƒæ•°æ®æ¡†æž¶"><a href="#æ ¸å¿ƒæ•°æ®æ¡†æž¶" class="headerlink" title="æ ¸å¿ƒæ•°æ®æ¡†æž¶"></a>æ ¸å¿ƒæ•°æ®æ¡†æž¶</h6><p>å°½ç®¡æœ‰ä¸€äº›ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼Œä½† Core Data æ¡†æž¶é€šå¸¸æ”¯æŒçº¿ç¨‹åŒ–ã€‚æœ‰å…³è¿™äº›è­¦å‘Šä¿¡æ¯ï¼Œè¯·å‚é˜…å¹¶å‘ä¸Žæ ¸å¿ƒæ•°æ®çš„*<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CoreData/index.html#//apple_ref/doc/uid/TP40001075">æ ¸å¿ƒæ•°æ®ç¼–ç¨‹æŒ‡å—</a>*ã€‚</p>
<h4 id="æ ¸å¿ƒåŸºç¡€"><a href="#æ ¸å¿ƒåŸºç¡€" class="headerlink" title="æ ¸å¿ƒåŸºç¡€"></a>æ ¸å¿ƒåŸºç¡€</h4><p>Core Foundation å…·æœ‰è¶³å¤Ÿçš„çº¿ç¨‹å®‰å…¨æ€§ï¼Œå› æ­¤ï¼Œå¦‚æžœè°¨æ…Žç¼–ç¨‹ï¼Œå°±ä¸ä¼šé‡åˆ°ä¸Žç«žäº‰çº¿ç¨‹æœ‰å…³çš„ä»»ä½•é—®é¢˜ã€‚åœ¨å¸¸è§æƒ…å†µä¸‹ï¼Œä¾‹å¦‚æŸ¥è¯¢ï¼Œä¿ç•™ï¼Œé‡Šæ”¾å’Œä¼ é€’ä¸å¯å˜å¯¹è±¡æ—¶ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å³ä½¿æ˜¯å¯èƒ½ä»Žå¤šä¸ªçº¿ç¨‹ä¸­æŸ¥è¯¢çš„ä¸­å¤®å…±äº«å¯¹è±¡ï¼Œä¹Ÿæ˜¯å¯é çš„çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>åƒ Cocoa ä¸€æ ·ï¼Œå½“æ¶‰åŠå¯¹è±¡æˆ–å…¶å†…å®¹çš„çªå˜æ—¶ï¼ŒCore Foundation ä¹Ÿä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¾‹å¦‚ï¼Œæ­£å¦‚æ‚¨å¯èƒ½æœŸæœ›çš„é‚£æ ·ï¼Œä¿®æ”¹å¯å˜æ•°æ®æˆ–å¯å˜æ•°ç»„å¯¹è±¡ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†ä¿®æ”¹ä¸å¯å˜æ•°ç»„å†…éƒ¨çš„å¯¹è±¡ä¹Ÿä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åŽŸå› ä¹‹ä¸€å°±æ˜¯æ€§èƒ½ï¼Œè¿™åœ¨è¿™äº›æƒ…å†µä¸‹è‡³å…³é‡è¦ã€‚æ­¤å¤–ï¼Œé€šå¸¸æ— æ³•åœ¨æ­¤çº§åˆ«ä¸Šå®žçŽ°ç»å¯¹çº¿ç¨‹å®‰å…¨ã€‚ä¾‹å¦‚ï¼Œæ‚¨ä¸èƒ½æŽ’é™¤ç”±äºŽä¿ç•™ä»Žé›†åˆä¸­èŽ·å–çš„å¯¹è±¡è€Œå¯¼è‡´çš„ä¸ç¡®å®šè¡Œä¸ºã€‚åœ¨è¿›è¡Œè°ƒç”¨ä»¥ä¿ç•™åŒ…å«çš„å¯¹è±¡ä¹‹å‰ï¼Œå¯èƒ½ä¼šé‡Šæ”¾é›†åˆæœ¬èº«ã€‚</p>
<p>åœ¨è¦ä»Žå¤šä¸ªçº¿ç¨‹è®¿é—®å’Œå˜å¼‚çš„ Core Foundation å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œæ‚¨çš„ä»£ç åº”é€šè¿‡åœ¨è®¿é—®ç‚¹ä½¿ç”¨é”æ¥é˜²æ­¢åŒæ—¶è®¿é—®ã€‚ä¾‹å¦‚ï¼Œæžšä¸¾ Core Foundation æ•°ç»„å¯¹è±¡çš„ä»£ç åº”åœ¨æžšä¸¾å—å‘¨å›´ä½¿ç”¨é€‚å½“çš„é”å®šè°ƒç”¨ï¼Œä»¥é˜²æ­¢å…¶ä»–äººæ›´æ”¹è¯¥æ•°ç»„ã€‚</p>
<h2 id="è¯æ±‡è¡¨"><a href="#è¯æ±‡è¡¨" class="headerlink" title="è¯æ±‡è¡¨"></a>è¯æ±‡è¡¨</h2><ul>
<li><p>åº”ç”¨</p>
<p>ä¸€ç§ç‰¹å®šçš„<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/Glossary/Glossary.html#//apple_ref/doc/uid/10000057i-CH13-SW3">ç¨‹åº</a>æ ·å¼ï¼Œå‘ç”¨æˆ·æ˜¾ç¤ºå›¾å½¢ç•Œé¢ã€‚</p>
</li>
<li><p>å¥åº·ï¼‰çŠ¶å†µ</p>
<p>ç”¨äºŽåŒæ­¥å¯¹èµ„æºçš„è®¿é—®çš„æž„é€ ã€‚åœ¨å…¶ä»–æ¡ä»¶æ˜Žç¡®æŒ‡ç¤ºæ¡ä»¶ä¹‹å‰ï¼Œä¸å…è®¸ç­‰å¾…æ¡ä»¶çš„çº¿ç¨‹ç»§ç»­è¿›è¡Œã€‚</p>
</li>
<li><p>å…³é”®éƒ¨åˆ†</p>
<p>ä¸€æ¬¡åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œçš„ä¸€éƒ¨åˆ†ä»£ç ã€‚</p>
</li>
<li><p>è¾“å…¥æº</p>
<p>çº¿ç¨‹çš„å¼‚æ­¥äº‹ä»¶çš„æºã€‚è¾“å…¥æºå¯ä»¥åŸºäºŽç«¯å£æˆ–æ‰‹åŠ¨è§¦å‘ï¼Œå¹¶ä¸”å¿…é¡»é™„åŠ åˆ°çº¿ç¨‹çš„è¿è¡Œå¾ªçŽ¯ä¸­ã€‚</p>
</li>
<li><p>å¯è¿žæŽ¥çº¿ç¨‹</p>
<p>ç»ˆæ­¢åŽä¸ä¼šç«‹å³å›žæ”¶å…¶èµ„æºçš„çº¿ç¨‹ã€‚å¿…é¡»å…ˆæ˜¾å¼åœ°åˆ†ç¦»å¯è¿žæŽ¥çº¿ç¨‹ï¼Œå¦åˆ™å¿…é¡»ç”±å¦ä¸€ä¸ªçº¿ç¨‹å°†å…¶è¿žæŽ¥ï¼Œæ‰èƒ½å›žæ”¶èµ„æºã€‚å¯è¿žæŽ¥çº¿ç¨‹ä¸ºä¸Žå®ƒä»¬è¿žæŽ¥çš„çº¿ç¨‹æä¾›è¿”å›žå€¼ã€‚</p>
</li>
<li><p>ä¸»çº¿</p>
<p>åˆ›å»ºå…¶æ‹¥æœ‰è¿›ç¨‹æ—¶åˆ›å»ºçš„ä¸€ç§ç‰¹æ®Šç±»åž‹çš„<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/Glossary/Glossary.html#//apple_ref/doc/uid/10000057i-CH13-SW1">çº¿ç¨‹</a>ã€‚å½“ç¨‹åºçš„ä¸»çº¿ç¨‹é€€å‡ºæ—¶ï¼Œè¯¥è¿‡ç¨‹ç»“æŸã€‚</p>
</li>
<li><p>äº’æ–¥ä½“</p>
<p>æä¾›äº’æ–¥è®¿é—®å…±äº«èµ„æºçš„é”ã€‚äº’æ–¥é”ä¸€æ¬¡åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€‚å°è¯•èŽ·å–ç”±å…¶ä»–çº¿ç¨‹æŒæœ‰çš„äº’æ–¥é”ä¼šä½¿å½“å‰çº¿ç¨‹è¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œç›´åˆ°æœ€ç»ˆèŽ·å–è¯¥é”ä¸ºæ­¢ã€‚</p>
</li>
<li><p>æ“ä½œå¯¹è±¡</p>
<p><code>NSOperation</code>ç±»çš„å®žä¾‹ã€‚æ“ä½œå¯¹è±¡å°†ä¸Žä»»åŠ¡å…³è”çš„ä»£ç å’Œæ•°æ®åŒ…è£…åˆ°å¯æ‰§è¡Œå•å…ƒä¸­ã€‚</p>
</li>
<li><p>æ“ä½œé˜Ÿåˆ—</p>
<p><code>NSOperationQueue</code>ç±»çš„å®žä¾‹ã€‚æ“ä½œé˜Ÿåˆ—ç®¡ç†æ“ä½œå¯¹è±¡çš„æ‰§è¡Œã€‚</p>
</li>
<li><p>å¤„ç†</p>
<p>åº”ç”¨ç¨‹åºæˆ–ç¨‹åºçš„è¿è¡Œæ—¶å®žä¾‹ã€‚è¿›ç¨‹å…·æœ‰è‡ªå·±çš„è™šæ‹Ÿå†…å­˜ç©ºé—´å’Œç³»ç»Ÿèµ„æºï¼ˆåŒ…æ‹¬ç«¯å£æƒé™ï¼‰ï¼Œä¸Žåˆ†é…ç»™å…¶ä»–ç¨‹åºçš„èµ„æºæ— å…³ã€‚ä¸€ä¸ªè¿›ç¨‹å§‹ç»ˆè‡³å°‘åŒ…å«ä¸€ä¸ªçº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„é™„åŠ çº¿ç¨‹ã€‚</p>
</li>
<li><p>ç¨‹åº</p>
<p>å¯ä»¥è¿è¡Œä»£ç å’Œèµ„æºä»¥æ‰§è¡ŒæŸäº›ä»»åŠ¡çš„ç»„åˆã€‚ç¨‹åºæ— éœ€å…·æœ‰å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼Œå°½ç®¡å›¾å½¢åº”ç”¨ç¨‹åºä¹Ÿè¢«è§†ä¸ºç¨‹åºã€‚</p>
</li>
<li><p>é€’å½’é”</p>
<p>å¯ä»¥ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡é”å®šçš„é”ã€‚</p>
</li>
<li><p>è¿è¡Œå¾ªçŽ¯</p>
<p>äº‹ä»¶å¤„ç†å¾ªçŽ¯ï¼Œåœ¨æ­¤å¾ªçŽ¯ä¸­ï¼Œäº‹ä»¶è¢«æŽ¥æ”¶å¹¶è°ƒåº¦åˆ°é€‚å½“çš„å¤„ç†ç¨‹åºã€‚</p>
</li>
<li><p>è¿è¡Œå¾ªçŽ¯æ¨¡å¼</p>
<p>ä¸Žç‰¹å®šåç§°å…³è”çš„è¾“å…¥æºï¼Œè®¡æ—¶å™¨æºå’Œè¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨çš„é›†åˆã€‚å½“ä»¥ç‰¹å®šçš„â€œæ¨¡å¼â€è¿è¡Œæ—¶ï¼Œè¿è¡Œå¾ªçŽ¯ä»…ç›‘è§†ä¸Žè¯¥æ¨¡å¼å…³è”çš„æºå’Œè§‚å¯Ÿè€…ã€‚</p>
</li>
<li><p>è¿è¡Œå¾ªçŽ¯å¯¹è±¡</p>
<p><code>NSRunLoop</code>ç±»æˆ–<code>CFRunLoopRef</code>ä¸é€æ˜Žç±»åž‹çš„å®žä¾‹ã€‚è¿™äº›å¯¹è±¡æä¾›äº†ç”¨äºŽåœ¨çº¿ç¨‹ä¸­å®žçŽ°äº‹ä»¶å¤„ç†å¾ªçŽ¯çš„æŽ¥å£ã€‚</p>
</li>
<li><p>è¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨</p>
<p>è¿è¡Œå¾ªçŽ¯æ‰§è¡Œçš„ä¸åŒé˜¶æ®µä¸­çš„é€šçŸ¥çš„æŽ¥æ”¶è€…ã€‚</p>
</li>
<li><p>ä¿¡å·</p>
<p>å—ä¿æŠ¤çš„å˜é‡ï¼Œç”¨äºŽé™åˆ¶å¯¹å…±äº«èµ„æºçš„è®¿é—®ã€‚äº’æ–¥é‡å’Œæ¡ä»¶éƒ½æ˜¯ä¿¡å·ç¯çš„ä¸åŒç±»åž‹ã€‚</p>
</li>
<li><p>ä»»åŠ¡</p>
<p>è¦æ‰§è¡Œçš„å·¥ä½œé‡ã€‚</p>
</li>
<li><p>çº¿</p>
<p>æµç¨‹ä¸­çš„æ‰§è¡Œæµç¨‹ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å †æ ˆç©ºé—´ï¼Œä½†åœ¨åŒä¸€è¿›ç¨‹ä¸­ä¸Žå…¶ä»–çº¿ç¨‹å…±äº«å†…å­˜ã€‚</p>
</li>
<li><p>è®¡æ—¶å™¨æº</p>
<p>çº¿ç¨‹çš„åŒæ­¥äº‹ä»¶çš„æºã€‚è®¡æ—¶å™¨åœ¨é¢„å®šçš„å°†æ¥æ—¶é—´ç”Ÿæˆä¸€æ¬¡æˆ–é‡å¤äº‹ä»¶ã€‚</p>
</li>
</ul>
<h2 id="æ–‡æ¡£ä¿®è®¢åŽ†å²"><a href="#æ–‡æ¡£ä¿®è®¢åŽ†å²" class="headerlink" title="æ–‡æ¡£ä¿®è®¢åŽ†å²"></a>æ–‡æ¡£ä¿®è®¢åŽ†å²</h2><p>ä¸‹è¡¨æè¿°äº†å¯¹ã€Š<em>çº¿ç¨‹ç¼–ç¨‹æŒ‡å—ã€‹</em>çš„æ›´æ”¹ã€‚</p>
<table>
<thead>
<tr>
<th><strong>æ—¥æœŸ</strong></th>
<th><strong>ç¬”è®°</strong></th>
</tr>
</thead>
<tbody><tr>
<td>2014-07-15</td>
<td>ä»Žçº¿ç¨‹å®‰å…¨çš„ç±»åˆ—è¡¨ä¸­åˆ é™¤äº† NSXMLDocumentã€‚</td>
</tr>
<tr>
<td>2013-10-22</td>
<td>å°† NSXMLParser å’Œ NSXMLDocument æ·»åŠ åˆ°çº¿ç¨‹å®‰å…¨å¯¹è±¡åˆ—è¡¨ã€‚</td>
</tr>
<tr>
<td>2013-08-08</td>
<td>åˆ é™¤äº†è¿‡æ—¶çš„ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td>2010-04-28</td>
<td>æ›´æ­£äº†é”™åˆ«å­—ã€‚</td>
</tr>
<tr>
<td>2009-05-22</td>
<td>æœ‰å…³æ“ä½œå¯¹è±¡çš„ä¿¡æ¯å·²ç§»è‡³ã€Šå¹¶å‘ç¼–ç¨‹æŒ‡å—ã€‹ã€‚ä»…å°†æœ¬ä¹¦é‡ç‚¹æ”¾åœ¨çº¿ç¨‹ä¸Šã€‚</td>
</tr>
<tr>
<td>2008-10-15</td>
<td>æ›´æ–°äº†æœ‰å…³æ“ä½œå¯¹è±¡å’Œæ“ä½œé˜Ÿåˆ—çš„ç¤ºä¾‹ä»£ç ã€‚</td>
</tr>
<tr>
<td>2008-03-21</td>
<td>å·²é’ˆå¯¹ iOS æ›´æ–°ã€‚</td>
</tr>
<tr>
<td>2008-02-08</td>
<td>å¯¹çº¿ç¨‹ç›¸å…³çš„æ¦‚å¿µå’Œä»»åŠ¡è¿›è¡Œäº†é‡å¤§çš„é‡å†™å’Œæ›´æ–°ã€‚</td>
</tr>
<tr>
<td></td>
<td>æ·»åŠ äº†æœ‰å…³é…ç½®çº¿ç¨‹çš„æ›´å¤šä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td></td>
<td>å°†åŒæ­¥å·¥å…·éƒ¨åˆ†é‡ç»„ä¸ºä¸€ç« ï¼Œå¹¶æ·»åŠ äº†æœ‰å…³åŽŸå­æ“ä½œï¼Œå†…å­˜å±éšœå’Œæ˜“å¤±å˜é‡çš„ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td></td>
<td>æ·»åŠ äº†æœ‰å…³è¿è¡Œå¾ªçŽ¯çš„ä½¿ç”¨å’Œé…ç½®çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td></td>
<td>æ›´æ”¹äº†<em>å¤šçº¿ç¨‹ç¼–ç¨‹ä¸»é¢˜ä¸­çš„</em>æ–‡æ¡£æ ‡é¢˜ã€‚</td>
</tr>
<tr>
<td>2007-10-31</td>
<td>æ·»åŠ äº†æœ‰å…³ NSOperation å’Œ NSOperationQueue å¯¹è±¡çš„ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td>2006-04-04</td>
<td>æ·»åŠ äº†ä¸€äº›æ–°å‡†åˆ™å¹¶æ›´æ–°äº†æœ‰å…³è¿è¡Œå¾ªçŽ¯çš„ä¿¡æ¯ã€‚éªŒè¯äº†åˆ†å¸ƒå¼ç›®æ ‡ä»£ç ç¤ºä¾‹çš„å‡†ç¡®æ€§ï¼Œå¹¶åœ¨å…¶ä»–å‡ ç¯‡æ–‡ç« ä¸­æ›´æ–°äº†ä»£ç ç¤ºä¾‹ã€‚</td>
</tr>
<tr>
<td>2005-03-03</td>
<td>æ›´æ–°äº†ç«¯å£ç¤ºä¾‹ï¼Œä»¥ä½¿ç”¨ NSPort è€Œä¸æ˜¯ NSMessagePortã€‚</td>
</tr>
<tr>
<td>2005-01-11</td>
<td>é‡ç»„æ–‡ç« å’Œæ‰©å±•æ–‡æ¡£ï¼Œä½¿å…¶ä¸ä»…æ¶µç›–å¯å¯çº¿ç¨‹æŠ€æœ¯ã€‚</td>
</tr>
<tr>
<td></td>
<td>æ›´æ–°äº†çº¿ç¨‹æ¦‚å¿µä¿¡æ¯ï¼Œå¹¶æ·»åŠ äº†æ¶µç›– OS X ä¸­ä¸åŒçº¿ç¨‹åŒ…çš„ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td></td>
<td>åˆå¹¶äº† Core Foundation å¤šçº¿ç¨‹æ–‡æ¡£ä¸­çš„ææ–™ã€‚</td>
</tr>
<tr>
<td></td>
<td>æ·»åŠ äº†æœ‰å…³åœ¨çº¿ç¨‹ä¹‹é—´æ‰§è¡ŒåŸºäºŽå¥—æŽ¥å­—çš„é€šä¿¡çš„ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td></td>
<td>æ·»åŠ äº†æœ‰å…³åˆ›å»ºå’Œä½¿ç”¨ Carbon çº¿ç¨‹çš„ç¤ºä¾‹ä»£ç å’Œä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td></td>
<td>æ·»åŠ äº†çº¿ç¨‹å®‰å…¨å‡†åˆ™ã€‚</td>
</tr>
<tr>
<td></td>
<td>æ·»åŠ äº†æœ‰å…³ POSIX çº¿ç¨‹å’Œé”çš„ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td></td>
<td>æ·»åŠ äº†ç¤ºä¾‹ä»£ç ï¼Œä»¥æ¼”ç¤ºåŸºäºŽç«¯å£çš„é€šä¿¡ã€‚</td>
</tr>
<tr>
<td></td>
<td>æœ¬æ–‡æ¡£æ›¿æ¢äº†ä»¥å‰åœ¨â€œ <em>å¤š</em>çº¿ç¨‹â€ä¸­å‘å¸ƒçš„æœ‰å…³çº¿ç¨‹çš„ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td>2003-07-28</td>
<td>æ›´æ–°äº†æœ‰å…³åœ¨ç¬¬ä¸‰æ–¹åº“ä¸­ä½¿ç”¨é”çš„å»ºè®®ã€‚</td>
</tr>
<tr>
<td>2003-04-08</td>
<td>åœ¨ç¬¬ä¸‰æ–¹åº“ä¸­æœ‰å…³é”å®š/è§£é”å¹³è¡¡çš„å·²é‡è¿°ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td>2002-11-12</td>
<td>ä¿®è®¢åŽ†å²è®°å½•å·²æ·»åŠ åˆ°çŽ°æœ‰ä¸»é¢˜ã€‚</td>
</tr>
</tbody></table>

    </div>

    
    
    
      
  <div class="popular-posts-header">Related Posts</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/Concurrency-Programming-Guide/" rel="bookmark">Concurrency Programming Guide</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/ios-7-programming-cookbook/" rel="bookmark">iOS 7 Programming Cookbook</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/Pull-to-Refresh-UIViewController-in-iOS/" rel="bookmark">Pull to Refresh UIViewController in iOS</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/iOS-CI-Jenkins-Phabricator-Slack/" rel="bookmark">iOS CI (Jenkins + Phabricator + Slack)</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/View-blurred-after-CGAffineTransformMakeRotation/" rel="bookmark">View blurred after CGAffineTransformMakeRotation</a></div>
    </li>
  </ul>


    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me ðŸ‘¨â€ðŸ’» a coffee â˜•ï¸</div>
  <button onclick="document.querySelector('.post-reward').classList.toggle('active');">
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/wechat.png" alt="LeiHao WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/alipay.png" alt="LeiHao Alipay">
        <span>Alipay</span>
      </div>
      <div>
        <img src="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/bitcoin.png" alt="LeiHao Bitcoin">
        <span>Bitcoin</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/ios/" rel="tag"># iOS</a>
              <a href="/tags/interview/" rel="tag"># Interview</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/Concurrency-Programming-Guide/" rel="prev" title="Concurrency Programming Guide">
                  <i class="fa fa-chevron-left"></i> Concurrency Programming Guide
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/iOS-Token-Based-APNs/" rel="next" title="iOS Token-Based APNs">
                  iOS Token-Based APNs <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
  
  
  



      
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  Â© 2012 â€“ 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-laptop-code"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LeiHao</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Symbols count total">436k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">6:36</span>
  </span>
</div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>


  




  












  








  

  

  






<script src="/bundle.js"></script><script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://Artwalk.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
;

  var disqus_config = function() {
    this.page.url = "https://leihao0.github.io/Threading-Programming-Guide/";
    this.page.identifier = "Threading-Programming-Guide/";
    this.page.title = "Threading Programming Guide";
    };
  NexT.utils.loadComments('#disqus_thread', () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://Artwalk.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script></body></html>