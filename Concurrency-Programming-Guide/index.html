<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo-192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo-192.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="rbaH_zC-qBwXaawJ10Mno3FHzv9HRFHGFdXx2f1BwyI">







<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"leihao0.github.io","root":"/","scheme":"Pisces","version":"8.0.0","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="Concurrency Programming Guideæ„Ÿè§‰çº¿ç¨‹ç›¸å…³çš„é¢è¯•é¢˜éƒ½èƒ½åœ¨ ðŸ‘† è¿™ä¸ª ðŸ”— é‡Œæ‰¾åˆ°ç­”æ¡ˆå‘¢">
<meta property="og:type" content="article">
<meta property="og:title" content="Concurrency Programming Guide">
<meta property="og:url" content="https://leihao0.github.io/Concurrency-Programming-Guide/index.html">
<meta property="og:site_name" content="LeiHao's Blog">
<meta property="og:description" content="Concurrency Programming Guideæ„Ÿè§‰çº¿ç¨‹ç›¸å…³çš„é¢è¯•é¢˜éƒ½èƒ½åœ¨ ðŸ‘† è¿™ä¸ª ðŸ”— é‡Œæ‰¾åˆ°ç­”æ¡ˆå‘¢">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-05-27T06:07:04.000Z">
<meta property="article:modified_time" content="2020-09-03T00:53:32.986Z">
<meta property="article:author" content="LeiHao">
<meta property="article:tag" content="iOS">
<meta property="article:tag" content="Interview">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://leihao0.github.io/Concurrency-Programming-Guide/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Concurrency Programming Guide | LeiHao's Blog</title>
  
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-159363268-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-159363268-1');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?25f016f633270b8e0baf56c4fe6f2dc1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <style>:root {
  --body-bg-color: #f5f7f9;
  --content-bg-color: #fff;
  --card-bg-color: #f5f5f5;
  --text-color: #555;
  --blockquote-color: #666;
  --link-color: #555;
  --link-hover-color: #222;
  --brand-color: #fff;
  --brand-hover-color: #fff;
  --table-row-odd-bg-color: #f9f9f9;
  --table-row-hover-bg-color: #f5f5f5;
  --menu-item-bg-color: #f5f5f5;
  --btn-default-bg: #fff;
  --btn-default-color: #555;
  --btn-default-border-color: #555;
  --btn-default-hover-bg: #222;
  --btn-default-hover-color: #fff;
  --btn-default-hover-border-color: #222;
  --highlight-background: #f0f0f0;
  --highlight-foreground: #444;
  --highlight-gutter-background: #dedede;
  --highlight-gutter-foreground: #555;
}
@media (prefers-color-scheme: dark) {
  :root {
    --body-bg-color: #282828;
    --content-bg-color: #333;
    --card-bg-color: #555;
    --text-color: #ccc;
    --blockquote-color: #bbb;
    --link-color: #ccc;
    --link-hover-color: #eee;
    --brand-color: #ddd;
    --brand-hover-color: #ddd;
    --table-row-odd-bg-color: #282828;
    --table-row-hover-bg-color: #363636;
    --menu-item-bg-color: #555;
    --btn-default-bg: #222;
    --btn-default-color: #ccc;
    --btn-default-border-color: #555;
    --btn-default-hover-bg: #666;
    --btn-default-hover-color: #ccc;
    --btn-default-hover-border-color: #666;
    --highlight-background: #1d1f21;
    --highlight-foreground: #c5c8c6;
    --highlight-gutter-background: #2d2f31;
    --highlight-gutter-foreground: #b4b7b5;
  }
  img {
    opacity: 0.75;
  }
  img:hover {
    opacity: 0.9;
  }
}
html {
  line-height: 1.15; /* 1 */
  -webkit-text-size-adjust: 100%; /* 2 */
}
body {
  margin: 0;
}
main {
  display: block;
}
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}
hr {
  box-sizing: content-box; /* 1 */
  height: 0; /* 1 */
  overflow: visible; /* 2 */
}
pre {
  font-family: monospace, monospace; /* 1 */
  font-size: 1em; /* 2 */
}
a {
  background: transparent;
}
abbr[title] {
  border-bottom: none; /* 1 */
  text-decoration: underline; /* 2 */
  text-decoration: underline dotted; /* 2 */
}
b,
strong {
  font-weight: bolder;
}
code,
kbd,
samp {
  font-family: monospace, monospace; /* 1 */
  font-size: 1em; /* 2 */
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sub {
  bottom: -0.25em;
}
sup {
  top: -0.5em;
}
img {
  border-style: none;
}
button,
input,
optgroup,
select,
textarea {
  font-family: inherit; /* 1 */
  font-size: 100%; /* 1 */
  line-height: 1.15; /* 1 */
  margin: 0; /* 2 */
}
button,
input {
/* 1 */
  overflow: visible;
}
button,
select {
/* 1 */
  text-transform: none;
}
button,
[type='button'],
[type='reset'],
[type='submit'] {
  -webkit-appearance: button;
}
button::-moz-focus-inner,
[type='button']::-moz-focus-inner,
[type='reset']::-moz-focus-inner,
[type='submit']::-moz-focus-inner {
  border-style: none;
  padding: 0;
}
button:-moz-focusring,
[type='button']:-moz-focusring,
[type='reset']:-moz-focusring,
[type='submit']:-moz-focusring {
  outline: 1px dotted ButtonText;
}
fieldset {
  padding: 0.35em 0.75em 0.625em;
}
legend {
  box-sizing: border-box; /* 1 */
  color: inherit; /* 2 */
  display: table; /* 1 */
  max-width: 100%; /* 1 */
  padding: 0; /* 3 */
  white-space: normal; /* 1 */
}
progress {
  vertical-align: baseline;
}
textarea {
  overflow: auto;
}
[type='checkbox'],
[type='radio'] {
  box-sizing: border-box; /* 1 */
  padding: 0; /* 2 */
}
[type='number']::-webkit-inner-spin-button,
[type='number']::-webkit-outer-spin-button {
  height: auto;
}
[type='search'] {
  outline-offset: -2px; /* 2 */
  -webkit-appearance: textfield; /* 1 */
}
[type='search']::-webkit-search-decoration {
  -webkit-appearance: none;
}
::-webkit-file-upload-button {
  font: inherit; /* 2 */
  -webkit-appearance: button; /* 1 */
}
details {
  display: block;
}
summary {
  display: list-item;
}
template {
  display: none;
}
[hidden] {
  display: none;
}
::selection {
  background: #262a30;
  color: #eee;
}
html,
body {
  height: 100%;
}
body {
  background: var(--body-bg-color);
  color: var(--text-color);
  font-family: Lato, "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 1em;
  line-height: 2;
  min-height: 100%;
  position: relative;
  transition: all 0.2s ease-in-out;
}
h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: Lato, "PingFang SC", "Microsoft YaHei", sans-serif;
  font-weight: bold;
  line-height: 1.5;
  margin: 20px 0 15px;
}
h1 {
  font-size: 1.5em;
}
h2 {
  font-size: 1.375em;
}
h3 {
  font-size: 1.25em;
}
h4 {
  font-size: 1.125em;
}
h5 {
  font-size: 1em;
}
h6 {
  font-size: 0.875em;
}
p {
  margin: 0 0 20px 0;
}
a,
span.exturl {
  border-bottom: 1px solid #999;
  color: var(--link-color);
  outline: 0;
  text-decoration: none;
  overflow-wrap: break-word;
  cursor: pointer;
}
a:hover,
span.exturl:hover {
  border-bottom-color: var(--link-hover-color);
  color: var(--link-hover-color);
}
iframe,
img,
video,
embed {
  display: block;
  margin-left: auto;
  margin-right: auto;
  max-width: 100%;
}
hr {
  background-image: repeating-linear-gradient(-45deg, #ddd, #ddd 4px, transparent 4px, transparent 8px);
  border: 0;
  height: 3px;
  margin: 40px 0;
}
blockquote {
  border-left: 4px solid #ddd;
  color: var(--blockquote-color);
  margin: 0;
  padding: 0 15px;
}
blockquote cite::before {
  content: '-';
  padding: 0 5px;
}
dt {
  font-weight: bold;
}
dd {
  margin: 0;
  padding: 0;
}
.table-container {
  overflow: auto;
}
table {
  border-collapse: collapse;
  border-spacing: 0;
  font-size: 0.875em;
  margin: 0 0 20px 0;
  width: 100%;
}
tbody tr:nth-of-type(odd) {
  background: var(--table-row-odd-bg-color);
}
tbody tr:hover {
  background: var(--table-row-hover-bg-color);
}
caption,
th,
td {
  padding: 8px;
}
th,
td {
  border: 1px solid #ddd;
  border-bottom: 3px solid #ddd;
}
th {
  font-weight: 700;
  padding-bottom: 10px;
}
td {
  border-bottom-width: 1px;
}
.btn {
  background: var(--btn-default-bg);
  border: 2px solid var(--btn-default-border-color);
  border-radius: 2px;
  color: var(--btn-default-color);
  display: inline-block;
  font-size: 0.875em;
  line-height: 2;
  padding: 0 20px;
  transition: background-color 0.2s ease-in-out;
}
.btn:hover {
  background: var(--btn-default-hover-bg);
  border-color: var(--btn-default-hover-border-color);
  color: var(--btn-default-hover-color);
}
.btn + .btn {
  margin: 0 0 8px 8px;
}
.btn .fa-fw {
  text-align: left;
  width: 1.285714285714286em;
}
.toggle {
  line-height: 0;
}
.toggle .toggle-line {
  background: #fff;
  display: block;
  height: 2px;
  left: 0;
  position: relative;
  top: 0;
  transition: all 0.4s;
  width: 100%;
}
.toggle .toggle-line:not(:first-child) {
  margin-top: 3px;
}
.toggle.toggle-arrow .toggle-line:first-child {
  left: 50%;
  top: 2px;
  transform: rotate(45deg);
  width: 50%;
}
.toggle.toggle-arrow .toggle-line:last-child {
  left: 50%;
  top: -2px;
  transform: rotate(-45deg);
  width: 50%;
}
.toggle.toggle-close .toggle-line:nth-child(2) {
  opacity: 0;
}
.toggle.toggle-close .toggle-line:first-child {
  top: 5px;
  transform: rotate(45deg);
}
.toggle.toggle-close .toggle-line:last-child {
  top: -5px;
  transform: rotate(-45deg);
}
/*

Original highlight.js style (c) Ivan Sagalaev <maniac@softwaremaniacs.org>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  background: #F0F0F0;
}


/* Base color: saturation 0; */

.hljs,
.hljs-subst {
  color: #444;
}

.hljs-comment {
  color: #888888;
}

.hljs-keyword,
.hljs-attribute,
.hljs-selector-tag,
.hljs-meta-keyword,
.hljs-doctag,
.hljs-name {
  font-weight: bold;
}


/* User color: hue: 0 */

.hljs-type,
.hljs-string,
.hljs-number,
.hljs-selector-id,
.hljs-selector-class,
.hljs-quote,
.hljs-template-tag,
.hljs-deletion {
  color: #880000;
}

.hljs-title,
.hljs-section {
  color: #880000;
  font-weight: bold;
}

.hljs-regexp,
.hljs-symbol,
.hljs-variable,
.hljs-template-variable,
.hljs-link,
.hljs-selector-attr,
.hljs-selector-pseudo {
  color: #BC6060;
}


/* Language color: hue: 90; */

.hljs-literal {
  color: #78A960;
}

.hljs-built_in,
.hljs-bullet,
.hljs-code,
.hljs-addition {
  color: #397300;
}


/* Meta color: hue: 200 */

.hljs-meta {
  color: #1f7199;
}

.hljs-meta-string {
  color: #4d99bf;
}


/* Misc effects */

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}

@media (prefers-color-scheme: dark) {
/* Tomorrow Night Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
  color: #969896;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
  color: #cc6666;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
  color: #de935f;
}

/* Tomorrow Yellow */
.hljs-attribute {
  color: #f0c674;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
  color: #b5bd68;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
  color: #81a2be;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
  color: #b294bb;
}

.hljs {
  display: block;
  overflow-x: auto;
  background: #1d1f21;
  color: #c5c8c6;
  padding: 0.5em;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}

}
code,
kbd,
figure.highlight,
pre {
  background: var(--highlight-background);
  color: var(--highlight-foreground);
}
figure.highlight,
pre {
  line-height: 1.6;
  margin: 0 auto 20px;
}
pre,
code {
  font-family: consolas, Menlo, monospace, "PingFang SC", "Microsoft YaHei";
}
code {
  border-radius: 3px;
  font-size: 0.875em;
  padding: 2px 4px;
  overflow-wrap: break-word;
}
kbd {
  border: 2px solid #ccc;
  border-radius: 0.2em;
  box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1);
  font-family: inherit;
  padding: 0.1em 0.3em;
  white-space: nowrap;
}
figure.highlight {
  position: relative;
}
figure.highlight pre {
  border: 0;
  margin: 0;
  padding: 10px 0;
}
figure.highlight table {
  border: 0;
  margin: 0;
  width: auto;
}
figure.highlight td {
  border: 0;
  padding: 0;
}
figure.highlight figcaption,
pre .caption,
pre figcaption {
  background: var(--highlight-gutter-background);
  color: var(--highlight-foreground);
  display: flow-root;
  font-size: 0.875em;
  line-height: 1.2;
  padding: 0.5em;
}
figure.highlight figcaption a,
pre .caption a,
pre figcaption a {
  color: var(--highlight-foreground);
  float: right;
}
figure.highlight figcaption a:hover,
pre .caption a:hover,
pre figcaption a:hover {
  border-bottom-color: var(--highlight-foreground);
}
figure.highlight .gutter {
  -moz-user-select: none;
  -ms-user-select: none;
  -webkit-user-select: none;
  user-select: none;
}
figure.highlight .gutter pre {
  background: var(--highlight-gutter-background);
  color: var(--highlight-gutter-foreground);
  padding-left: 10px;
  padding-right: 10px;
  text-align: right;
}
figure.highlight .code pre {
  padding-left: 10px;
  width: 100%;
}
pre .caption,
pre figcaption {
  margin-bottom: 10px;
}
.gist table {
  width: auto;
}
.gist table td {
  border: 0;
}
pre {
  overflow: auto;
  padding: 10px;
  position: relative;
}
pre code {
  background: none;
  padding: 0;
  text-shadow: none;
}
.blockquote-center {
  border-left: none;
  margin: 40px 0;
  padding: 0;
  position: relative;
  text-align: center;
}
.blockquote-center::before,
.blockquote-center::after {
  left: 0;
  line-height: 1;
  opacity: 0.6;
  position: absolute;
  width: 100%;
}
.blockquote-center::before {
  border-top: 1px solid #ccc;
  text-align: left;
  top: -20px;
  content: '\f10d';
  font-family: 'Font Awesome 5 Free';
  font-weight: 900;
}
.blockquote-center::after {
  border-bottom: 1px solid #ccc;
  bottom: -20px;
  text-align: right;
  content: '\f10e';
  font-family: 'Font Awesome 5 Free';
  font-weight: 900;
}
.blockquote-center p,
.blockquote-center div {
  text-align: center;
}
.group-picture {
  margin-bottom: 20px;
}
.group-picture .group-picture-row {
  display: flex;
  gap: 3px;
  margin-bottom: 3px;
}
.group-picture .group-picture-column {
  flex: 1;
}
.group-picture .group-picture-column img {
  height: 100%;
  margin: 0;
  object-fit: cover;
  width: 100%;
}
.post-body .label {
  color: #555;
  padding: 0 2px;
}
.post-body .label.default {
  background: #f0f0f0;
}
.post-body .label.primary {
  background: #efe6f7;
}
.post-body .label.info {
  background: #e5f2f8;
}
.post-body .label.success {
  background: #e7f4e9;
}
.post-body .label.warning {
  background: #fcf6e1;
}
.post-body .label.danger {
  background: #fae8eb;
}
.post-body .link-grid {
  display: grid;
  gap: 1.5rem 1.5rem;
  grid-template-columns: 1fr 1fr;
  margin-bottom: 20px;
  padding: 1rem;
}
@media (max-width: 767px) {
  .post-body .link-grid {
    grid-template-columns: 1fr;
  }
}
.post-body .link-grid .link-grid-container {
  border: solid #ddd;
  box-shadow: 1rem 1rem 0.5rem rgba(0,0,0,0.5);
  min-height: 5rem;
  min-width: 0;
  padding: 0.5rem;
  position: relative;
  transition: background 0.3s;
}
.post-body .link-grid .link-grid-container:hover {
  animation: next-shake 0.5s;
  background: var(--card-bg-color);
}
.post-body .link-grid .link-grid-container:active {
  box-shadow: 0.5rem 0.5rem 0.25rem rgba(0,0,0,0.5);
  transform: translate(0.2rem, 0.2rem);
}
.post-body .link-grid .link-grid-container .link-grid-image {
  background-clip: content-box;
  background-origin: content-box;
  background-size: cover;
  border: 1px solid #ddd;
  border-radius: 50%;
  box-sizing: border-box;
  height: 5rem;
  padding: 3px;
  position: absolute;
  width: 5rem;
}
.post-body .link-grid .link-grid-container p {
  margin: 0 1rem 0 6rem;
}
.post-body .link-grid .link-grid-container p:first-of-type {
  font-size: 1.2em;
}
.post-body .link-grid .link-grid-container p:last-of-type {
  font-size: 0.8em;
  line-height: 1.3rem;
  opacity: 0.7;
}
.post-body .link-grid .link-grid-container a {
  border: 0;
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}
@-moz-keyframes next-shake {
  0% {
    transform: translate(1pt, 1pt) rotate(0deg);
  }
  10% {
    transform: translate(-1pt, -2pt) rotate(-1deg);
  }
  20% {
    transform: translate(-3pt, 0pt) rotate(1deg);
  }
  30% {
    transform: translate(3pt, 2pt) rotate(0deg);
  }
  40% {
    transform: translate(1pt, -1pt) rotate(1deg);
  }
  50% {
    transform: translate(-1pt, 2pt) rotate(-1deg);
  }
  60% {
    transform: translate(-3pt, 1pt) rotate(0deg);
  }
  70% {
    transform: translate(3pt, 1pt) rotate(-1deg);
  }
  80% {
    transform: translate(-1pt, -1pt) rotate(1deg);
  }
  90% {
    transform: translate(1pt, 2pt) rotate(0deg);
  }
  100% {
    transform: translate(1pt, -2pt) rotate(-1deg);
  }
}
@-webkit-keyframes next-shake {
  0% {
    transform: translate(1pt, 1pt) rotate(0deg);
  }
  10% {
    transform: translate(-1pt, -2pt) rotate(-1deg);
  }
  20% {
    transform: translate(-3pt, 0pt) rotate(1deg);
  }
  30% {
    transform: translate(3pt, 2pt) rotate(0deg);
  }
  40% {
    transform: translate(1pt, -1pt) rotate(1deg);
  }
  50% {
    transform: translate(-1pt, 2pt) rotate(-1deg);
  }
  60% {
    transform: translate(-3pt, 1pt) rotate(0deg);
  }
  70% {
    transform: translate(3pt, 1pt) rotate(-1deg);
  }
  80% {
    transform: translate(-1pt, -1pt) rotate(1deg);
  }
  90% {
    transform: translate(1pt, 2pt) rotate(0deg);
  }
  100% {
    transform: translate(1pt, -2pt) rotate(-1deg);
  }
}
@-o-keyframes next-shake {
  0% {
    transform: translate(1pt, 1pt) rotate(0deg);
  }
  10% {
    transform: translate(-1pt, -2pt) rotate(-1deg);
  }
  20% {
    transform: translate(-3pt, 0pt) rotate(1deg);
  }
  30% {
    transform: translate(3pt, 2pt) rotate(0deg);
  }
  40% {
    transform: translate(1pt, -1pt) rotate(1deg);
  }
  50% {
    transform: translate(-1pt, 2pt) rotate(-1deg);
  }
  60% {
    transform: translate(-3pt, 1pt) rotate(0deg);
  }
  70% {
    transform: translate(3pt, 1pt) rotate(-1deg);
  }
  80% {
    transform: translate(-1pt, -1pt) rotate(1deg);
  }
  90% {
    transform: translate(1pt, 2pt) rotate(0deg);
  }
  100% {
    transform: translate(1pt, -2pt) rotate(-1deg);
  }
}
@keyframes next-shake {
  0% {
    transform: translate(1pt, 1pt) rotate(0deg);
  }
  10% {
    transform: translate(-1pt, -2pt) rotate(-1deg);
  }
  20% {
    transform: translate(-3pt, 0pt) rotate(1deg);
  }
  30% {
    transform: translate(3pt, 2pt) rotate(0deg);
  }
  40% {
    transform: translate(1pt, -1pt) rotate(1deg);
  }
  50% {
    transform: translate(-1pt, 2pt) rotate(-1deg);
  }
  60% {
    transform: translate(-3pt, 1pt) rotate(0deg);
  }
  70% {
    transform: translate(3pt, 1pt) rotate(-1deg);
  }
  80% {
    transform: translate(-1pt, -1pt) rotate(1deg);
  }
  90% {
    transform: translate(1pt, 2pt) rotate(0deg);
  }
  100% {
    transform: translate(1pt, -2pt) rotate(-1deg);
  }
}
.post-body .tabs {
  margin-bottom: 20px;
}
.post-body .tabs,
.tabs-comment {
  padding-top: 10px;
}
.post-body .tabs ul.nav-tabs,
.tabs-comment ul.nav-tabs {
  display: flex;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  margin: 0;
  padding: 0;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs,
  .tabs-comment ul.nav-tabs {
    display: block;
    margin-bottom: 5px;
  }
}
.post-body .tabs ul.nav-tabs li.tab,
.tabs-comment ul.nav-tabs li.tab {
  border-bottom: 1px solid #ddd;
  border-left: 1px solid transparent;
  border-right: 1px solid transparent;
  border-top: 3px solid transparent;
  flex-grow: 1;
  list-style-type: none;
  border-radius: 0 0 0 0;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab,
  .tabs-comment ul.nav-tabs li.tab {
    border-bottom: 1px solid transparent;
    border-left: 3px solid transparent;
    border-right: 1px solid transparent;
    border-top: 1px solid transparent;
  }
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab,
  .tabs-comment ul.nav-tabs li.tab {
    border-radius: 0;
  }
}
.post-body .tabs ul.nav-tabs li.tab a,
.tabs-comment ul.nav-tabs li.tab a {
  border-bottom: initial;
  display: block;
  line-height: 1.8;
  padding: 0.25em 0.75em;
  text-align: center;
  transition: all 0.2s ease-out;
}
.post-body .tabs ul.nav-tabs li.tab a i,
.tabs-comment ul.nav-tabs li.tab a i {
  width: 1.285714285714286em;
}
.post-body .tabs ul.nav-tabs li.tab.active,
.tabs-comment ul.nav-tabs li.tab.active {
  border-bottom-color: transparent;
  border-left-color: #ddd;
  border-right-color: #ddd;
  border-top-color: #fc6423;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab.active,
  .tabs-comment ul.nav-tabs li.tab.active {
    border-bottom-color: #ddd;
    border-left-color: #fc6423;
    border-right-color: #ddd;
    border-top-color: #ddd;
  }
}
.post-body .tabs ul.nav-tabs li.tab.active a,
.tabs-comment ul.nav-tabs li.tab.active a {
  cursor: default;
}
.post-body .tabs .tab-content,
.tabs-comment .tab-content {
  border: 1px solid #ddd;
  border-top-color: transparent;
  border-radius: 0 0 0 0;
}
@media (max-width: 413px) {
  .post-body .tabs .tab-content,
  .tabs-comment .tab-content {
    border-radius: 0;
    border-top-color: #ddd;
  }
}
.post-body .tabs .tab-content .tab-pane,
.tabs-comment .tab-content .tab-pane {
  padding: 20px 20px 0 20px;
}
.post-body .tabs .tab-content .tab-pane:not(.active),
.tabs-comment .tab-content .tab-pane:not(.active) {
  display: none;
}
.post-body .note {
  border-radius: 3px;
  margin-bottom: 20px;
  padding: 1em;
  position: relative;
  border: 1px solid #eee;
  border-left-width: 5px;
}
.post-body .note summary {
  cursor: pointer;
  outline: 0;
}
.post-body .note summary p {
  display: inline;
}
.post-body .note h2,
.post-body .note h3,
.post-body .note h4,
.post-body .note h5,
.post-body .note h6 {
  border-bottom: initial;
  margin: 0;
  padding-top: 0;
}
.post-body .note p:first-child,
.post-body .note ul:first-child,
.post-body .note ol:first-child,
.post-body .note table:first-child,
.post-body .note pre:first-child,
.post-body .note blockquote:first-child,
.post-body .note img:first-child {
  margin-top: 0;
}
.post-body .note p:last-child,
.post-body .note ul:last-child,
.post-body .note ol:last-child,
.post-body .note table:last-child,
.post-body .note pre:last-child,
.post-body .note blockquote:last-child,
.post-body .note img:last-child {
  margin-bottom: 0;
}
.post-body .note.default {
  border-left-color: #777;
}
.post-body .note.default h2,
.post-body .note.default h3,
.post-body .note.default h4,
.post-body .note.default h5,
.post-body .note.default h6 {
  color: #777;
}
.post-body .note.primary {
  border-left-color: #6f42c1;
}
.post-body .note.primary h2,
.post-body .note.primary h3,
.post-body .note.primary h4,
.post-body .note.primary h5,
.post-body .note.primary h6 {
  color: #6f42c1;
}
.post-body .note.info {
  border-left-color: #428bca;
}
.post-body .note.info h2,
.post-body .note.info h3,
.post-body .note.info h4,
.post-body .note.info h5,
.post-body .note.info h6 {
  color: #428bca;
}
.post-body .note.success {
  border-left-color: #5cb85c;
}
.post-body .note.success h2,
.post-body .note.success h3,
.post-body .note.success h4,
.post-body .note.success h5,
.post-body .note.success h6 {
  color: #5cb85c;
}
.post-body .note.warning {
  border-left-color: #f0ad4e;
}
.post-body .note.warning h2,
.post-body .note.warning h3,
.post-body .note.warning h4,
.post-body .note.warning h5,
.post-body .note.warning h6 {
  color: #f0ad4e;
}
.post-body .note.danger {
  border-left-color: #d9534f;
}
.post-body .note.danger h2,
.post-body .note.danger h3,
.post-body .note.danger h4,
.post-body .note.danger h5,
.post-body .note.danger h6 {
  color: #d9534f;
}
.pagination .prev,
.pagination .next,
.pagination .page-number,
.pagination .space {
  display: inline-block;
  margin: -1px 10px 0 10px;
  padding: 0 10px;
}
@media (max-width: 767px) {
  .pagination .prev,
  .pagination .next,
  .pagination .page-number,
  .pagination .space {
    margin: 0 5px;
  }
}
.pagination {
  border-top: 1px solid #eee;
  margin: 120px 0 0;
  text-align: center;
}
.pagination .prev,
.pagination .next,
.pagination .page-number {
  border-bottom: 0;
  border-top: 1px solid #eee;
  transition: border-color 0.2s ease-in-out;
}
.pagination .prev:hover,
.pagination .next:hover,
.pagination .page-number:hover {
  border-top-color: var(--link-hover-color);
}
@media (max-width: 767px) {
  .pagination {
    border-top: 0;
  }
  .pagination .prev,
  .pagination .next,
  .pagination .page-number {
    border-bottom: 1px solid #eee;
    border-top: 0;
  }
  .pagination .prev:hover,
  .pagination .next:hover,
  .pagination .page-number:hover {
    border-bottom-color: var(--link-hover-color);
  }
}
.pagination .space {
  margin: 0;
  padding: 0;
}
.pagination .page-number.current {
  background: #ccc;
  border-color: #ccc;
  color: var(--content-bg-color);
}
.comments {
  margin-top: 60px;
  overflow: hidden;
}
.comment-button-group {
  display: flex;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  justify-content: center;
  margin: 1em 0;
}
.comment-button-group .comment-button {
  margin: 0.1em 0.2em;
}
.comment-button-group .comment-button.active {
  background: var(--btn-default-hover-bg);
  border-color: var(--btn-default-hover-border-color);
  color: var(--btn-default-hover-color);
}
.comment-position {
  display: none;
}
.comment-position.active {
  display: block;
}
.tabs-comment {
  margin-top: 4em;
  padding-top: 0;
}
.tabs-comment .comments {
  margin-top: 0;
  padding-top: 0;
}
.headband {
  background: #222;
  height: 3px;
}
@media (max-width: 991px) {
  .headband {
    display: none;
  }
}
.header {
  background: transparent;
}
.header-inner {
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .header-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .header-inner {
    width: 73%;
  }
}
.site-brand-container {
  display: flex;
  flex-shrink: 0;
  padding: 0 10px;
}
.use-motion .header,
.use-motion .site-brand-container .toggle {
  opacity: 0;
}
.site-meta {
  flex-grow: 1;
  text-align: center;
}
@media (max-width: 767px) {
  .site-meta {
    text-align: center;
  }
}
.custom-logo-image {
  margin-top: 20px;
}
@media (max-width: 991px) {
  .custom-logo-image {
    display: none;
  }
}
.brand {
  border-bottom: none;
  color: var(--brand-color);
  display: inline-block;
  padding: 0 40px;
}
.brand:hover {
  color: var(--brand-hover-color);
}
.site-title {
  font-family: Lato, "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 1.375em;
  font-weight: normal;
  margin: 0;
}
.site-subtitle {
  color: #ddd;
  font-size: 0.8125em;
  margin: 10px 0;
}
.use-motion .site-title,
.use-motion .site-subtitle,
.use-motion .custom-logo-image {
  opacity: 0;
  position: relative;
  top: -10px;
}
.site-nav-toggle,
.site-nav-right {
  display: none;
}
@media (max-width: 767px) {
  .site-nav-toggle,
  .site-nav-right {
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
}
.site-nav-toggle .toggle,
.site-nav-right .toggle {
  color: var(--text-color);
  padding: 10px;
  width: 22px;
}
.site-nav-toggle .toggle .toggle-line,
.site-nav-right .toggle .toggle-line {
  background: var(--text-color);
  border-radius: 1px;
}
@media (max-width: 767px) {
  .site-nav {
    display: none;
  }
}
.site-nav-on .site-nav {
  display: block;
}
.menu {
  margin: 0;
  padding: 1em 0;
  text-align: center;
}
.menu-item {
  display: inline-block;
  list-style: none;
  margin: 0 10px;
}
@media (max-width: 767px) {
  .menu-item {
    display: block;
    margin-top: 10px;
  }
  .menu-item.menu-item-search {
    display: none;
  }
}
.menu-item a,
.menu-item span.exturl {
  border-bottom: 0;
  display: block;
  font-size: 0.8125em;
  transition: border-color 0.2s ease-in-out;
}
.menu-item a:hover,
.menu-item span.exturl:hover,
.menu-item a.menu-item-active,
.menu-item span.exturl.menu-item-active {
  background: var(--menu-item-bg-color);
}
.menu-item .fa,
.menu-item .fab,
.menu-item .far,
.menu-item .fas {
  margin-right: 8px;
}
.menu-item .badge {
  display: inline-block;
  font-weight: bold;
  line-height: 1;
  margin-left: 0.35em;
  margin-top: 0.35em;
  text-align: center;
  white-space: nowrap;
}
@media (max-width: 767px) {
  .menu-item .badge {
    float: right;
    margin-left: 0;
  }
}
.use-motion .menu-item {
  visibility: hidden;
}
.sidebar-inner {
  color: #999;
  padding: 18px 10px;
  text-align: center;
}
.cc-license {
  margin-top: 10px;
}
.cc-license .cc-opacity {
  border-bottom: none;
  opacity: 0.7;
}
.cc-license .cc-opacity:hover {
  opacity: 0.9;
}
.cc-license img {
  display: inline-block;
}
.site-author-image {
  border: 1px solid #eee;
  max-width: 120px;
  padding: 2px;
}
.site-author-name {
  color: var(--text-color);
  font-weight: 600;
  margin: 0;
}
.site-description {
  color: #999;
  font-size: 0.8125em;
  margin-top: 0;
}
.links-of-author a,
.links-of-author span.exturl {
  font-size: 0.8125em;
}
.sidebar-button {
  margin-top: 15px;
}
.sidebar-button a {
  border: 1px solid #fc6423;
  border-radius: 4px;
  color: #fc6423;
  display: inline-block;
  padding: 0 15px;
}
.sidebar-button a .fa,
.sidebar-button a .fab,
.sidebar-button a .far,
.sidebar-button a .fas {
  margin-right: 5px;
}
.sidebar-button a:hover {
  background: #fc6423;
  border: 1px solid #fc6423;
  color: #fff;
}
.sidebar-button a:hover .fa,
.sidebar-button a:hover .fab,
.sidebar-button a:hover .far,
.sidebar-button a:hover .fas {
  color: #fff;
}
.links-of-blogroll {
  font-size: 0.8125em;
  margin-top: 10px;
}
.links-of-blogroll-title {
  font-size: 0.875em;
  font-weight: 600;
  margin-top: 0;
}
.links-of-blogroll-list {
  list-style: none;
  margin: 0;
  padding: 0;
}
.sidebar-dimmer {
  display: none;
}
@media (max-width: 767px) {
  .sidebar-dimmer {
    background: #000;
    display: block;
    height: 100%;
    left: 0;
    opacity: 0;
    position: fixed;
    top: 0;
    transition: visibility 0.4s, opacity 0.4s;
    visibility: hidden;
    width: 100%;
    z-index: 1100;
  }
  .sidebar-active .sidebar-dimmer {
    opacity: 0.7;
    visibility: visible;
  }
}
.sidebar-nav {
  display: none;
  margin: 0;
  padding-bottom: 20px;
  padding-left: 0;
}
.sidebar-nav-active .sidebar-nav {
  display: block;
}
.sidebar-nav li {
  border-bottom: 1px solid transparent;
  color: var(--text-color);
  cursor: pointer;
  display: inline-block;
  font-size: 0.875em;
}
.sidebar-nav li.sidebar-nav-overview {
  margin-left: 10px;
}
.sidebar-nav li:hover {
  color: #fc6423;
}
.sidebar-toc-active .sidebar-nav-toc,
.sidebar-overview-active .sidebar-nav-overview {
  border-bottom-color: #fc6423;
  color: #fc6423;
}
.sidebar-toc-active .sidebar-nav-toc:hover,
.sidebar-overview-active .sidebar-nav-overview:hover {
  color: #fc6423;
}
.sidebar-panel {
  display: none;
  max-height: var(--sidebar-wrapper-height);
  overflow-x: hidden;
  overflow-y: auto;
}
.sidebar-toc-active .post-toc-wrap,
.sidebar-overview-active .site-overview-wrap {
  display: block;
}
.sidebar-toggle {
  bottom: 45px;
  height: 12px;
  padding: 6px 5px;
  width: 14px;
  background: #222;
  cursor: pointer;
  opacity: 0.6;
  position: fixed;
  z-index: 1300;
  right: 30px;
}
@media (max-width: 991px) {
  .sidebar-toggle {
    right: 20px;
  }
}
.sidebar-toggle:hover {
  opacity: 0.8;
}
@media (max-width: 991px) {
  .sidebar-toggle {
    opacity: 0.8;
  }
}
.sidebar-toggle:hover .toggle-line {
  background: #fc6423;
}
@media (any-hover: hover) {
  body:not(.sidebar-active) .sidebar-toggle:hover .toggle-line:first-child {
    left: 50%;
    top: 2px;
    transform: rotate(45deg);
    width: 50%;
  }
  body:not(.sidebar-active) .sidebar-toggle:hover .toggle-line:last-child {
    left: 50%;
    top: -2px;
    transform: rotate(-45deg);
    width: 50%;
  }
}
.sidebar-active .sidebar-toggle .toggle-line:nth-child(2) {
  opacity: 0;
}
.sidebar-active .sidebar-toggle .toggle-line:first-child {
  top: 5px;
  transform: rotate(45deg);
}
.sidebar-active .sidebar-toggle .toggle-line:last-child {
  top: -5px;
  transform: rotate(-45deg);
}
.post-toc {
  font-size: 0.875em;
}
.post-toc ol {
  list-style: none;
  margin: 0;
  padding: 0 2px 5px 10px;
  text-align: left;
}
.post-toc ol > ol {
  padding-left: 0;
}
.post-toc ol a {
  transition: all 0.2s ease-in-out;
}
.post-toc .nav-item {
  line-height: 1.8;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.post-toc .nav .nav-child {
  display: none;
}
.post-toc .nav .active > .nav-child {
  display: block;
}
.post-toc .nav .active-current > .nav-child {
  display: block;
}
.post-toc .nav .active-current > .nav-child > .nav-item {
  display: block;
}
.post-toc .nav .active > a {
  border-bottom-color: #fc6423;
  color: #fc6423;
}
.post-toc .nav .active-current > a {
  color: #fc6423;
}
.post-toc .nav .active-current > a:hover {
  color: #fc6423;
}
.site-state {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  line-height: 1.4;
  margin-top: 10px;
}
.site-state-item a {
  border-bottom: none;
  display: block;
  padding: 0 15px;
}
.site-state-item-count {
  display: block;
  font-size: 1em;
  font-weight: 600;
}
.site-state-item-name {
  color: #999;
  font-size: 0.8125em;
}
.footer {
  color: #999;
  font-size: 0.875em;
  padding: 20px 0;
}
.footer.footer-fixed {
  bottom: 0;
  left: 0;
  position: absolute;
  right: 0;
}
.footer-inner {
  box-sizing: border-box;
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .footer-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .footer-inner {
    width: 73%;
  }
}
.use-motion .footer {
  opacity: 0;
}
.languages {
  display: inline-block;
  font-size: 1.125em;
  position: relative;
}
.languages .lang-select-label span {
  margin: 0 0.5em;
}
.languages .lang-select {
  height: 100%;
  left: 0;
  opacity: 0;
  position: absolute;
  top: 0;
  width: 100%;
}
.with-love {
  color: #CCCCCC;
  display: inline-block;
  margin: 0 5px;
  animation: icon-animate 1.33s ease-in-out infinite;
}
@-moz-keyframes icon-animate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@-webkit-keyframes icon-animate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@-o-keyframes icon-animate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@keyframes icon-animate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
.back-to-top {
  font-size: 12px;
}
.back-to-top span {
  display: none;
}
.back-to-top {
  bottom: -100px;
  box-sizing: border-box;
  color: #fff;
  padding: 0 6px;
  transition: bottom 0.2s ease-in-out;
  background: #222;
  cursor: pointer;
  opacity: 0.6;
  position: fixed;
  z-index: 1300;
  right: 30px;
  width: 24px;
}
@media (max-width: 991px) {
  .back-to-top {
    right: 20px;
  }
}
.back-to-top:hover {
  opacity: 0.8;
}
@media (max-width: 991px) {
  .back-to-top {
    opacity: 0.8;
  }
}
.back-to-top:hover {
  color: #fc6423;
}
.back-to-top.back-to-top-on {
  bottom: 30px;
}
.noscript-warning {
  background-color: #f55;
  color: #fff;
  font-family: sans-serif;
  font-size: 1rem;
  font-weight: bold;
  left: 0;
  position: fixed;
  text-align: center;
  top: 0;
  width: 100%;
  z-index: 1500;
}
.rtl.post-body p,
.rtl.post-body a,
.rtl.post-body h1,
.rtl.post-body h2,
.rtl.post-body h3,
.rtl.post-body h4,
.rtl.post-body h5,
.rtl.post-body h6,
.rtl.post-body li,
.rtl.post-body ul,
.rtl.post-body ol {
  direction: rtl;
  font-family: UKIJ Ekran;
}
.rtl.post-title {
  font-family: UKIJ Ekran;
}
.post-button {
  margin-top: 40px;
  text-align: center;
}
.use-motion .post-block,
.use-motion .pagination,
.use-motion .comments {
  visibility: hidden;
}
.use-motion .post-header {
  visibility: hidden;
}
.use-motion .post-body {
  visibility: hidden;
}
.use-motion .collection-header {
  visibility: hidden;
}
.posts-collapse .post-content {
  margin-bottom: 35px;
  margin-left: 35px;
  position: relative;
}
@media (max-width: 767px) {
  .posts-collapse .post-content {
    margin-left: 0;
    margin-right: 0;
  }
}
.posts-collapse .post-content .collection-title {
  font-size: 1.125em;
  position: relative;
}
.posts-collapse .post-content .collection-title::before {
  background: #999;
  border: 1px solid #fff;
  margin-left: -6px;
  margin-top: -4px;
  position: absolute;
  top: 50%;
  border-radius: 50%;
  content: ' ';
  height: 10px;
  width: 10px;
}
.posts-collapse .post-content .collection-year {
  font-size: 1.5em;
  font-weight: bold;
  margin: 60px 0;
  position: relative;
}
.posts-collapse .post-content .collection-year::before {
  background: #bbb;
  margin-left: -4px;
  margin-top: -4px;
  position: absolute;
  top: 50%;
  border-radius: 50%;
  content: ' ';
  height: 8px;
  width: 8px;
}
.posts-collapse .post-content .collection-header {
  display: block;
  margin-left: 20px;
}
.posts-collapse .post-content .collection-header small {
  color: #bbb;
  margin-left: 5px;
}
.posts-collapse .post-content .post-header {
  border-bottom: 1px dashed #ccc;
  margin: 30px 2px 0;
  padding-left: 15px;
  position: relative;
  transition: border 0.2s ease-in-out;
}
.posts-collapse .post-content .post-header::before {
  background: #bbb;
  border: 1px solid #fff;
  left: -6px;
  position: absolute;
  top: 0.75em;
  transition: background 0.2s ease-in-out;
  border-radius: 50%;
  content: ' ';
  height: 6px;
  width: 6px;
}
.posts-collapse .post-content .post-header:hover {
  border-bottom-color: #666;
}
.posts-collapse .post-content .post-header:hover::before {
  background: #222;
}
.posts-collapse .post-content .post-meta-container {
  display: inline;
  font-size: 0.75em;
  margin-right: 10px;
}
.posts-collapse .post-content .post-title {
  display: inline;
}
.posts-collapse .post-content .post-title a,
.posts-collapse .post-content .post-title span.exturl {
  border-bottom: none;
  color: var(--link-color);
}
.posts-collapse .post-content .post-title .fa-external-link-alt {
  font-size: 0.875em;
  margin-left: 5px;
}
.posts-collapse .post-content::before {
  background: #f5f5f5;
  content: ' ';
  height: 100%;
  margin-left: -2px;
  position: absolute;
  top: 1.25em;
  width: 4px;
}
.post-body {
  font-family: Lato, "PingFang SC", "Microsoft YaHei", sans-serif;
  overflow-wrap: break-word;
}
@media (min-width: 1200px) {
  .post-body {
    font-size: 1.125em;
  }
}
@media (min-width: 992px) {
  .post-body {
    text-align: justify;
  }
}
@media (max-width: 991px) {
  .post-body {
    text-align: justify;
  }
}
.post-body h1,
.post-body h2,
.post-body h3,
.post-body h4,
.post-body h5,
.post-body h6 {
  padding-top: 10px;
}
.post-body h1 .header-anchor,
.post-body h2 .header-anchor,
.post-body h3 .header-anchor,
.post-body h4 .header-anchor,
.post-body h5 .header-anchor,
.post-body h6 .header-anchor,
.post-body h1 .headerlink,
.post-body h2 .headerlink,
.post-body h3 .headerlink,
.post-body h4 .headerlink,
.post-body h5 .headerlink,
.post-body h6 .headerlink {
  border-bottom-style: none;
  color: inherit;
  float: right;
  font-size: 0.875em;
  margin-left: 10px;
  opacity: 0;
}
.post-body h1 .header-anchor::before,
.post-body h2 .header-anchor::before,
.post-body h3 .header-anchor::before,
.post-body h4 .header-anchor::before,
.post-body h5 .header-anchor::before,
.post-body h6 .header-anchor::before,
.post-body h1 .headerlink::before,
.post-body h2 .headerlink::before,
.post-body h3 .headerlink::before,
.post-body h4 .headerlink::before,
.post-body h5 .headerlink::before,
.post-body h6 .headerlink::before {
  content: '\f0c1';
  font-family: 'Font Awesome 5 Free';
  font-weight: 900;
}
.post-body h1:hover .header-anchor,
.post-body h2:hover .header-anchor,
.post-body h3:hover .header-anchor,
.post-body h4:hover .header-anchor,
.post-body h5:hover .header-anchor,
.post-body h6:hover .header-anchor,
.post-body h1:hover .headerlink,
.post-body h2:hover .headerlink,
.post-body h3:hover .headerlink,
.post-body h4:hover .headerlink,
.post-body h5:hover .headerlink,
.post-body h6:hover .headerlink {
  opacity: 0.5;
}
.post-body h1:hover .header-anchor:hover,
.post-body h2:hover .header-anchor:hover,
.post-body h3:hover .header-anchor:hover,
.post-body h4:hover .header-anchor:hover,
.post-body h5:hover .header-anchor:hover,
.post-body h6:hover .header-anchor:hover,
.post-body h1:hover .headerlink:hover,
.post-body h2:hover .headerlink:hover,
.post-body h3:hover .headerlink:hover,
.post-body h4:hover .headerlink:hover,
.post-body h5:hover .headerlink:hover,
.post-body h6:hover .headerlink:hover {
  opacity: 1;
}
.post-body .exturl .fa {
  font-size: 0.875em;
  margin-left: 4px;
}
.post-body .image-caption,
.post-body .figure .caption {
  color: #999;
  font-size: 0.875em;
  font-weight: bold;
  line-height: 1;
  margin: -20px auto 15px;
  text-align: center;
}
.post-body iframe,
.post-body img,
.post-body video,
.post-body embed {
  margin-bottom: 20px;
}
.post-body .video-container {
  height: 0;
  margin-bottom: 20px;
  overflow: hidden;
  padding-top: 75%;
  position: relative;
  width: 100%;
}
.post-body .video-container iframe,
.post-body .video-container object,
.post-body .video-container embed {
  height: 100%;
  left: 0;
  margin: 0;
  position: absolute;
  top: 0;
  width: 100%;
}
.post-gallery {
  display: flex;
  min-height: 200px;
}
.post-gallery .post-gallery-image {
  flex: 1;
}
.post-gallery .post-gallery-image:not(:first-child) {
  clip-path: polygon(40px 0, 100% 0, 100% 100%, 0 100%);
  margin-left: -20px;
}
.post-gallery .post-gallery-image:not(:last-child) {
  margin-right: -20px;
}
.post-gallery .post-gallery-image img {
  height: 100%;
  object-fit: cover;
  opacity: 1;
  width: 100%;
}
.posts-expand .post-gallery {
  margin-bottom: 60px;
}
.posts-collapse .post-gallery {
  margin: 15px 0;
}
.posts-expand .post-header {
  font-size: 1.125em;
  margin-bottom: 60px;
  text-align: center;
}
.posts-expand .post-title {
  font-size: 1.5em;
  font-weight: normal;
  margin: initial;
  overflow-wrap: break-word;
}
.posts-expand .post-title-link {
  border-bottom: none;
  color: var(--link-color);
  display: inline-block;
  position: relative;
}
.posts-expand .post-title-link::before {
  background: var(--link-color);
  bottom: 0;
  content: '';
  height: 2px;
  left: 0;
  position: absolute;
  transform: scaleX(0);
  transition: transform 0.2s ease-in-out;
  width: 100%;
}
.posts-expand .post-title-link:hover::before {
  transform: scaleX(1);
}
.posts-expand .post-title-link .fa-external-link-alt {
  font-size: 0.875em;
  margin-left: 5px;
}
.post-sticky-flag {
  display: inline-block;
  transform: rotate(30deg);
}
.posts-expand .post-meta-container {
  color: #999;
  font-family: Lato, "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 0.75em;
  margin-top: 3px;
}
.posts-expand .post-meta-container .post-description {
  font-size: 0.875em;
  margin-top: 2px;
}
.posts-expand .post-meta-container time {
  border-bottom: 1px dashed #999;
  cursor: pointer;
}
.post-meta {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}
.post-meta-item:not(:first-child)::before {
  content: '|';
  margin: 0 0.5em;
}
.post-meta-item-icon {
  margin-right: 3px;
}
@media (max-width: 991px) {
  .post-meta-item-text {
    display: none;
  }
}
.post-nav {
  border-top: 1px solid #eee;
  display: flex;
  gap: 30px;
  justify-content: space-between;
  margin-top: 1em;
  padding: 10px 5px 0;
}
.post-nav-item {
  flex: 1;
}
.post-nav-item a {
  border-bottom: none;
  display: block;
  font-size: 0.875em;
  line-height: 1.6;
}
.post-nav-item a:active {
  top: 2px;
}
.post-nav-item .fa {
  font-size: 0.75em;
}
.post-nav-item:first-child .fa {
  margin-right: 5px;
}
.post-nav-item:last-child {
  text-align: right;
}
.post-nav-item:last-child .fa {
  margin-left: 5px;
}
.post-footer {
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.post-eof {
  background: #ccc;
  height: 1px;
  margin: 80px auto 60px;
  width: 8%;
}
.post-block:last-of-type .post-eof {
  display: none;
}
.post-tags {
  margin-top: 40px;
  text-align: center;
}
.post-tags a {
  display: inline-block;
  font-size: 0.8125em;
}
.post-tags a:not(:last-child) {
  margin-right: 10px;
}
.post-widgets {
  border-top: 1px solid #eee;
  margin-top: 15px;
  text-align: center;
}
.wp_rating {
  height: 20px;
  line-height: 20px;
  margin-top: 10px;
  padding-top: 6px;
  text-align: center;
}
.social-like {
  display: flex;
  font-size: 0.875em;
  justify-content: center;
  text-align: center;
}
.reward-container {
  margin: 1em 0 0;
  padding: 1em 0;
  text-align: center;
}
.reward-container button {
  background: transparent;
  border: 2px solid #fc6423;
  border-radius: 2px;
  color: #fc6423;
  cursor: pointer;
  line-height: 2;
  outline: 0;
  padding: 0 15px;
  transition: all 0.2s ease-in-out;
  vertical-align: text-top;
}
.reward-container button:hover {
  background: #fc6423;
  border: 2px solid transparent;
  color: #fff;
}
.post-reward {
  display: none;
  padding-top: 20px;
}
.post-reward.active {
  display: block;
}
.post-reward div {
  display: inline-block;
}
.post-reward div span {
  display: block;
}
.post-reward div:hover span {
  animation: next-roll 0.1s infinite linear;
  pointer-events: none;
}
.post-reward img {
  display: inline-block;
  margin: 0.8em 2em 0 2em;
  max-width: 100%;
  width: 180px;
}
@-moz-keyframes next-roll {
  from {
    transform: rotateZ(30deg);
  }
  to {
    transform: rotateZ(-30deg);
  }
}
@-webkit-keyframes next-roll {
  from {
    transform: rotateZ(30deg);
  }
  to {
    transform: rotateZ(-30deg);
  }
}
@-o-keyframes next-roll {
  from {
    transform: rotateZ(30deg);
  }
  to {
    transform: rotateZ(-30deg);
  }
}
@keyframes next-roll {
  from {
    transform: rotateZ(30deg);
  }
  to {
    transform: rotateZ(-30deg);
  }
}
.category-all-page .category-all-title {
  text-align: center;
}
.category-all-page .category-all {
  margin-top: 20px;
}
.category-all-page .category-list {
  list-style: none;
  margin: 0;
  padding: 0;
}
.category-all-page .category-list-item {
  margin: 5px 10px;
}
.category-all-page .category-list-count {
  color: #bbb;
}
.category-all-page .category-list-count::before {
  content: ' (';
}
.category-all-page .category-list-count::after {
  content: ') ';
}
.category-all-page .category-list-child {
  padding-left: 10px;
}
.event-list hr {
  background: #222;
  margin: 20px 0 45px 0;
}
.event-list hr::after {
  background: #222;
  color: #fff;
  content: 'NOW';
  display: inline-block;
  font-weight: bold;
  padding: 0 5px;
}
.event-list .event {
  --event-background: #222;
  --event-foreground: #bbb;
  --event-title: #fff;
  background: var(--event-background);
  padding: 15px;
}
.event-list .event .event-summary {
  border-bottom: 0;
  color: var(--event-title);
  margin: 0;
  padding: 0 0 0 35px;
  position: relative;
}
.event-list .event .event-summary::before {
  animation: dot-flash 1s alternate infinite ease-in-out;
  background: var(--event-title);
  left: 0;
  margin-top: -6px;
  position: absolute;
  top: 50%;
  border-radius: 50%;
  content: ' ';
  height: 12px;
  width: 12px;
}
.event-list .event:nth-of-type(odd) .event-summary::before {
  animation-delay: 0.5s;
}
.event-list .event:not(:last-child) {
  margin-bottom: 20px;
}
.event-list .event .event-relative-time {
  color: var(--event-foreground);
  display: inline-block;
  font-size: 12px;
  font-weight: normal;
  padding-left: 12px;
}
.event-list .event .event-details {
  color: var(--event-foreground);
  display: block;
  line-height: 18px;
  padding: 6px 0 6px 35px;
}
.event-list .event .event-details::before {
  color: var(--event-foreground);
  display: inline-block;
  margin-right: 9px;
  width: 14px;
  font-family: 'Font Awesome 5 Free';
  font-weight: 900;
}
.event-list .event .event-details.event-location::before {
  content: '\f041';
}
.event-list .event .event-details.event-duration::before {
  content: '\f017';
}
.event-list .event .event-details.event-description::before {
  content: '\f024';
}
.event-list .event-past {
  --event-background: #f5f5f5;
  --event-foreground: #999;
  --event-title: #222;
}
@-moz-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
@-webkit-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
@-o-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
@keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
ul.breadcrumb {
  font-size: 0.75em;
  list-style: none;
  margin: 1em 0;
  padding: 0 2em;
  text-align: center;
}
ul.breadcrumb li {
  display: inline;
}
ul.breadcrumb li:not(:first-child)::before {
  content: '/\00a0';
  font-weight: normal;
  padding: 0.5em;
}
ul.breadcrumb li:last-child {
  font-weight: bold;
}
.tag-cloud {
  text-align: center;
}
.tag-cloud a {
  display: inline-block;
  margin: 10px;
}
.tag-cloud-0 {
  border-bottom-color: #aaa;
  color: #aaa;
}
.tag-cloud-1 {
  border-bottom-color: #9a9a9a;
  color: #9a9a9a;
}
.tag-cloud-2 {
  border-bottom-color: #8b8b8b;
  color: #8b8b8b;
}
.tag-cloud-3 {
  border-bottom-color: #7c7c7c;
  color: #7c7c7c;
}
.tag-cloud-4 {
  border-bottom-color: #6c6c6c;
  color: #6c6c6c;
}
.tag-cloud-5 {
  border-bottom-color: #5d5d5d;
  color: #5d5d5d;
}
.tag-cloud-6 {
  border-bottom-color: #4e4e4e;
  color: #4e4e4e;
}
.tag-cloud-7 {
  border-bottom-color: #3e3e3e;
  color: #3e3e3e;
}
.tag-cloud-8 {
  border-bottom-color: #2f2f2f;
  color: #2f2f2f;
}
.tag-cloud-9 {
  border-bottom-color: #202020;
  color: #202020;
}
.tag-cloud-10 {
  border-bottom-color: #111;
  color: #111;
}
@media (prefers-color-scheme: dark) {
  .tag-cloud-0 {
    border-bottom-color: #555;
    color: #555;
  }
  .tag-cloud-1 {
    border-bottom-color: #646464;
    color: #646464;
  }
  .tag-cloud-2 {
    border-bottom-color: #737373;
    color: #737373;
  }
  .tag-cloud-3 {
    border-bottom-color: #828282;
    color: #828282;
  }
  .tag-cloud-4 {
    border-bottom-color: #929292;
    color: #929292;
  }
  .tag-cloud-5 {
    border-bottom-color: #a1a1a1;
    color: #a1a1a1;
  }
  .tag-cloud-6 {
    border-bottom-color: #b0b0b0;
    color: #b0b0b0;
  }
  .tag-cloud-7 {
    border-bottom-color: #c0c0c0;
    color: #c0c0c0;
  }
  .tag-cloud-8 {
    border-bottom-color: #cfcfcf;
    color: #cfcfcf;
  }
  .tag-cloud-9 {
    border-bottom-color: #dedede;
    color: #dedede;
  }
  .tag-cloud-10 {
    border-bottom-color: #eee;
    color: #eee;
  }
}
.search-active {
  overflow: hidden;
}
.search-pop-overlay {
  background: rgba(0,0,0,0);
  display: flex;
  height: 100%;
  left: 0;
  position: fixed;
  top: 0;
  transition: visibility 0.4s, background 0.4s;
  visibility: hidden;
  width: 100%;
  z-index: 1400;
}
.search-active .search-pop-overlay {
  background: rgba(0,0,0,0.3);
  visibility: visible;
}
.search-popup {
  background: var(--card-bg-color);
  border-radius: 5px;
  height: 80%;
  margin: auto;
  transform: scale(0);
  transition: transform 0.4s;
  width: 700px;
}
.search-active .search-popup {
  transform: scale(1);
}
@media (max-width: 767px) {
  .search-popup {
    border-radius: 0;
    height: 100%;
    width: 100%;
  }
}
.search-popup .search-icon,
.search-popup .popup-btn-close {
  color: #999;
  font-size: 18px;
  padding: 0 10px;
}
.search-popup .popup-btn-close {
  cursor: pointer;
}
.search-popup .popup-btn-close:hover .fa {
  color: #222;
}
.search-popup .search-header {
  background: #eee;
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
  display: flex;
  padding: 5px;
}
.search-popup input.search-input {
  background: transparent;
  border: 0;
  outline: 0;
  width: 100%;
}
.search-popup input.search-input::-webkit-search-cancel-button {
  display: none;
}
.search-popup .search-result-container {
  height: calc(100% - 55px);
  overflow: auto;
  padding: 5px 25px;
}
.search-popup .search-result-container hr {
  margin: 5px 0 10px;
}
.search-popup .search-result-container hr:first-child {
  display: none;
}
.search-popup .search-result-list {
  margin: 0 5px;
  padding: 0;
}
.search-popup a.search-result-title {
  font-weight: bold;
}
.search-popup p.search-result {
  border-bottom: 1px dashed #ccc;
  padding: 5px 0;
}
.search-popup .search-input-container {
  flex-grow: 1;
  padding: 2px;
}
.search-popup .no-result {
  display: flex;
}
.search-popup .search-result-list {
  width: 100%;
}
.search-popup .search-result-icon {
  color: #ccc;
  margin: auto;
}
mark.search-keyword {
  background: transparent;
  border-bottom: 1px dashed #ff2a2a;
  color: #ff2a2a;
  font-weight: bold;
}
.popular-posts-header {
  border-bottom: 1px solid #eee;
  font-size: 1.125em;
  margin-bottom: 10px;
  margin-top: 60px;
}
.popular-posts {
  padding: 0;
}
.popular-posts .popular-posts-item {
  margin-left: 2em;
}
.popular-posts .popular-posts-item .popular-posts-title {
  font-size: 0.875em;
  font-weight: normal;
  line-height: 2.4;
  margin: 0;
}
mjx-container[jax="CHTML"][display="true"],
.has-jax {
  overflow: auto hidden;
}
mjx-container[display="true"] + br {
  display: none;
}
.use-motion .animated {
  animation-fill-mode: none;
  visibility: inherit;
}
.use-motion .sidebar .animated {
  animation-fill-mode: both;
}
.header-inner {
  background: var(--content-bg-color);
  border-radius: initial;
  box-shadow: initial;
  width: 240px;
}
@media (max-width: 991px) {
  .header-inner {
    border-radius: initial;
    width: auto;
  }
}
.main {
  align-items: stretch;
  display: flex;
  justify-content: space-between;
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .main {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .main {
    width: 73%;
  }
}
@media (max-width: 991px) {
  .main {
    display: block;
    width: auto;
  }
}
.main-inner {
  border-radius: initial;
  box-sizing: border-box;
  width: calc(100% - 252px);
}
@media (max-width: 991px) {
  .main-inner {
    border-radius: initial;
    width: 100%;
  }
}
.footer-inner {
  padding-left: 252px;
}
@media (max-width: 991px) {
  .footer-inner {
    padding-left: 0;
    padding-right: 0;
    width: auto;
  }
}
.site-brand-container {
  background: #222;
}
@media (max-width: 991px) {
  .site-nav-on .site-brand-container {
    box-shadow: 0 0 16px rgba(0,0,0,0.5);
  }
}
.site-meta {
  padding: 20px 0;
}
.brand {
  padding: 0;
}
.site-subtitle {
  margin: 10px 10px 0;
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav-toggle,
  .site-nav-right {
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
}
.site-nav-toggle .toggle,
.site-nav-right .toggle {
  color: #fff;
}
.site-nav-toggle .toggle .toggle-line,
.site-nav-right .toggle .toggle-line {
  background: #fff;
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav {
    display: none;
  }
}
.menu .menu-item {
  display: block;
  margin: 0;
}
.menu .menu-item a,
.menu .menu-item span.exturl {
  padding: 5px 20px;
  position: relative;
  text-align: left;
  transition-property: background-color;
}
@media (max-width: 991px) {
  .menu .menu-item.menu-item-search {
    display: none;
  }
}
.menu .menu-item .badge {
  background: #ccc;
  border-radius: 10px;
  color: var(--content-bg-color);
  float: right;
  padding: 2px 5px;
  text-shadow: 1px 1px 0 rgba(0,0,0,0.1);
}
.main-menu .menu-item-active::after {
  background: #bbb;
  border-radius: 50%;
  content: ' ';
  height: 6px;
  margin-top: -3px;
  position: absolute;
  right: 15px;
  top: 50%;
  width: 6px;
}
.sub-menu {
  margin: 0;
  padding: 6px 0;
}
.sub-menu .menu-item {
  display: inline-block;
}
.sub-menu .menu-item a,
.sub-menu .menu-item span.exturl {
  background: transparent;
  margin: 5px 10px;
  padding: initial;
}
.sub-menu .menu-item a:hover,
.sub-menu .menu-item span.exturl:hover {
  background: transparent;
  color: #fc6423;
}
.sub-menu .menu-item-active {
  border-bottom-color: #fc6423;
  color: #fc6423;
}
.sub-menu .menu-item-active:hover {
  border-bottom-color: #fc6423;
}
.sidebar {
  margin-top: 12px;
  position: -webkit-sticky;
  position: sticky;
  top: 12px;
  width: 240px;
}
@media (max-width: 991px) {
  .sidebar {
    display: none;
  }
}
.sidebar-toggle {
  display: none;
}
.sidebar-inner {
  background: var(--content-bg-color);
  border-radius: initial;
  box-shadow: initial;
  box-sizing: border-box;
  color: var(--text-color);
}
.site-state-item a {
  padding: 0 10px;
}
.sidebar-button {
  border-bottom: 1px dotted #ccc;
  border-top: 1px dotted #ccc;
  margin-top: 10px;
}
.sidebar-button a {
  border: 0;
  color: #fc6423;
  display: block;
}
.sidebar-button a:hover {
  background: none;
  border: 0;
  color: #e34603;
}
.sidebar-button a:hover .fa,
.sidebar-button a:hover .fab,
.sidebar-button a:hover .far,
.sidebar-button a:hover .fas {
  color: #e34603;
}
.links-of-author {
  margin-top: 10px;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}
.links-of-author-item {
  margin: 5px 0 0;
}
.links-of-author-item a,
.links-of-author-item span.exturl {
  box-sizing: border-box;
  display: inline-block;
  max-width: 100%;
  overflow: hidden;
  padding: 0 5px;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.links-of-author-item a,
.links-of-author-item span.exturl {
  border-bottom: none;
  border-radius: 4px;
  display: block;
}
.links-of-author-item a:hover,
.links-of-author-item span.exturl:hover {
  background: var(--body-bg-color);
}
.main-inner {
  background: var(--content-bg-color);
  box-shadow: initial;
  padding: 40px;
}
@media (max-width: 991px) {
  .main-inner {
    padding: 20px;
  }
}
.sub-menu {
  border-bottom: 1px solid #ddd;
}
.post-block:first-of-type {
  padding-top: 40px;
}
@media (max-width: 767px) {
  .pagination {
    margin-bottom: 10px;
  }
}
</style><noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="LeiHao's Blog" type="application/atom+xml">
<script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}</script><noscript><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"></noscript></head>

<body itemscope="" itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">LeiHao's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-rss">

    <a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Concurrency-Programming-Guide"><span class="nav-number">1.</span> <span class="nav-text">Concurrency Programming Guide</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.1.</span> <span class="nav-text">ä»‹ç»</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%AC%E6%96%87%E4%BB%B6%E7%9A%84%E7%BB%84%E7%BB%87"><span class="nav-number">1.1.0.1.</span> <span class="nav-text">æœ¬æ–‡ä»¶çš„ç»„ç»‡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%89%E5%85%B3%E6%9C%AF%E8%AF%AD%E7%9A%84%E6%B3%A8%E9%87%8A"><span class="nav-number">1.1.0.2.</span> <span class="nav-text">æœ‰å…³æœ¯è¯­çš„æ³¨é‡Š</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%9C%8B%E7%9C%8B"><span class="nav-number">1.1.0.3.</span> <span class="nav-text">ä¹Ÿå¯ä»¥çœ‹çœ‹</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1"><span class="nav-number">1.2.</span> <span class="nav-text">å¹¶å‘ä¸Žåº”ç”¨ç¨‹åºè®¾è®¡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%9C%E7%A6%BB%E7%BA%BF%E7%A8%8B"><span class="nav-number">1.2.0.1.</span> <span class="nav-text">è¿œç¦»çº¿ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%B0%83%E5%BA%A6%E9%98%9F%E5%88%97"><span class="nav-number">1.2.0.1.0.1.</span> <span class="nav-text">è°ƒåº¦é˜Ÿåˆ—</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%B4%BE%E9%81%A3%E6%9D%A5%E6%BA%90"><span class="nav-number">1.2.0.1.0.2.</span> <span class="nav-text">æ´¾é£æ¥æº</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%93%8D%E4%BD%9C%E9%98%9F%E5%88%97"><span class="nav-number">1.2.0.1.0.3.</span> <span class="nav-text">æ“ä½œé˜Ÿåˆ—</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E8%AE%BE%E8%AE%A1%E6%8A%80%E6%9C%AF"><span class="nav-number">1.2.0.2.</span> <span class="nav-text">å¼‚æ­¥è®¾è®¡æŠ€æœ¯</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E9%A2%84%E6%9C%9F%E8%A1%8C%E4%B8%BA"><span class="nav-number">1.2.0.2.0.1.</span> <span class="nav-text">å®šä¹‰åº”ç”¨ç¨‹åºçš„é¢„æœŸè¡Œä¸º</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%8E%92%E9%99%A4%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8D%95%E5%85%83"><span class="nav-number">1.2.0.2.0.2.</span> <span class="nav-text">æŽ’é™¤å¯æ‰§è¡Œçš„å·¥ä½œå•å…ƒ</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%A1%AE%E5%AE%9A%E6%82%A8%E9%9C%80%E8%A6%81%E7%9A%84%E9%98%9F%E5%88%97"><span class="nav-number">1.2.0.2.0.3.</span> <span class="nav-text">ç¡®å®šæ‚¨éœ€è¦çš„é˜Ÿåˆ—</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%8F%90%E9%AB%98%E6%95%88%E7%8E%87%E7%9A%84%E6%8A%80%E5%B7%A7"><span class="nav-number">1.2.0.2.0.4.</span> <span class="nav-text">æé«˜æ•ˆçŽ‡çš„æŠ€å·§</span></a></li></ol></li></ol><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E5%BD%B1%E5%93%8D"><span class="nav-number">1.2.0.3.</span> <span class="nav-text">æ€§èƒ½å½±å“</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B9%B6%E5%8F%91%E5%92%8C%E5%85%B6%E4%BB%96%E6%8A%80%E6%9C%AF"><span class="nav-number">1.2.0.4.</span> <span class="nav-text">å¹¶å‘å’Œå…¶ä»–æŠ€æœ¯</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#OpenCL-%E5%92%8C%E5%B9%B6%E5%8F%91"><span class="nav-number">1.2.0.4.0.1.</span> <span class="nav-text">OpenCL å’Œå¹¶å‘</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BD%95%E6%97%B6%E4%BD%BF%E7%94%A8%E7%BA%BF%E7%A8%8B"><span class="nav-number">1.2.0.4.0.2.</span> <span class="nav-text">ä½•æ—¶ä½¿ç”¨çº¿ç¨‹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%93%8D%E4%BD%9C%E9%98%9F%E5%88%97-1"><span class="nav-number">1.3.</span> <span class="nav-text">æ“ä½œé˜Ÿåˆ—</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E%E6%93%8D%E4%BD%9C%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.3.0.1.</span> <span class="nav-text">å…³äºŽæ“ä½œå¯¹è±¡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B9%B6%E8%A1%8C%E4%B8%8E%E9%9D%9E%E5%B9%B6%E8%A1%8C%E6%93%8D%E4%BD%9C"><span class="nav-number">1.3.0.2.</span> <span class="nav-text">å¹¶è¡Œä¸Žéžå¹¶è¡Œæ“ä½œ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-NSInvocationOperation-%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.3.0.3.</span> <span class="nav-text">åˆ›å»ºä¸€ä¸ª NSInvocationOperation å¯¹è±¡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-NSBlockOperation-%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.3.0.4.</span> <span class="nav-text">åˆ›å»ºä¸€ä¸ª NSBlockOperation å¯¹è±¡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E8%87%AA%E5%AE%9A%E4%B9%89%E6%93%8D%E4%BD%9C%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.3.0.5.</span> <span class="nav-text">å®šä¹‰è‡ªå®šä¹‰æ“ä½œå¯¹è±¡</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E4%B8%BB%E8%A6%81%E4%BB%BB%E5%8A%A1"><span class="nav-number">1.3.0.5.0.1.</span> <span class="nav-text">æ‰§è¡Œä¸»è¦ä»»åŠ¡</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E5%8F%96%E6%B6%88%E4%BA%8B%E4%BB%B6"><span class="nav-number">1.3.0.5.0.2.</span> <span class="nav-text">å“åº”å–æ¶ˆäº‹ä»¶</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%B9%B6%E5%8F%91%E6%89%A7%E8%A1%8C%E6%93%8D%E4%BD%9C"><span class="nav-number">1.3.0.5.0.3.</span> <span class="nav-text">é…ç½®å¹¶å‘æ‰§è¡Œæ“ä½œ</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BF%9D%E6%8C%81-KVO-%E5%90%88%E8%A7%84%E6%80%A7"><span class="nav-number">1.3.0.5.0.4.</span> <span class="nav-text">ä¿æŒ KVO åˆè§„æ€§</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%93%8D%E4%BD%9C%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%89%A7%E8%A1%8C%E8%A1%8C%E4%B8%BA"><span class="nav-number">1.3.0.6.</span> <span class="nav-text">è‡ªå®šä¹‰æ“ä½œå¯¹è±¡çš„æ‰§è¡Œè¡Œä¸º</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E4%BA%92%E6%93%8D%E4%BD%9C%E4%BE%9D%E8%B5%96%E6%80%A7"><span class="nav-number">1.3.0.6.0.1.</span> <span class="nav-text">é…ç½®äº’æ“ä½œä¾èµ–æ€§</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%9B%B4%E6%94%B9%E5%B7%A5%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C%E4%BC%98%E5%85%88%E7%BA%A7"><span class="nav-number">1.3.0.6.0.2.</span> <span class="nav-text">æ›´æ”¹å·¥åºçš„æ‰§è¡Œä¼˜å…ˆçº§</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%9B%B4%E6%94%B9%E5%BA%95%E5%B1%82%E7%BA%BF%E7%A8%8B%E4%BC%98%E5%85%88%E7%BA%A7"><span class="nav-number">1.3.0.6.0.3.</span> <span class="nav-text">æ›´æ”¹åº•å±‚çº¿ç¨‹ä¼˜å…ˆçº§</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%AE%BE%E5%AE%9A%E5%AE%8C%E6%88%90%E5%8C%BA%E5%9D%97"><span class="nav-number">1.3.0.6.0.4.</span> <span class="nav-text">è®¾å®šå®ŒæˆåŒºå—</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E6%96%BD%E6%93%8D%E4%BD%9C%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%8A%80%E5%B7%A7"><span class="nav-number">1.3.0.7.</span> <span class="nav-text">å®žæ–½æ“ä½œå¯¹è±¡çš„æŠ€å·§</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E6%93%8D%E4%BD%9C%E5%AF%B9%E8%B1%A1%E4%B8%AD%E7%9A%84%E5%86%85%E5%AD%98"><span class="nav-number">1.3.0.7.0.1.</span> <span class="nav-text">ç®¡ç†æ“ä½œå¯¹è±¡ä¸­çš„å†…å­˜</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF%E5%92%8C%E5%BC%82%E5%B8%B8"><span class="nav-number">1.3.0.7.0.2.</span> <span class="nav-text">å¤„ç†é”™è¯¯å’Œå¼‚å¸¸</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A1%AE%E5%AE%9A%E6%93%8D%E4%BD%9C%E5%AF%B9%E8%B1%A1%E7%9A%84%E9%80%82%E5%BD%93%E8%8C%83%E5%9B%B4"><span class="nav-number">1.3.0.8.</span> <span class="nav-text">ç¡®å®šæ“ä½œå¯¹è±¡çš„é€‚å½“èŒƒå›´</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E6%93%8D%E4%BD%9C"><span class="nav-number">1.3.0.9.</span> <span class="nav-text">æ‰§è¡Œæ“ä½œ</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%B0%86%E6%93%8D%E4%BD%9C%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%93%8D%E4%BD%9C%E9%98%9F%E5%88%97"><span class="nav-number">1.3.0.9.0.1.</span> <span class="nav-text">å°†æ“ä½œæ·»åŠ åˆ°æ“ä½œé˜Ÿåˆ—</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%89%8B%E5%8A%A8%E6%89%A7%E8%A1%8C%E6%93%8D%E4%BD%9C"><span class="nav-number">1.3.0.9.0.2.</span> <span class="nav-text">æ‰‹åŠ¨æ‰§è¡Œæ“ä½œ</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%8F%96%E6%B6%88%E6%93%8D%E4%BD%9C"><span class="nav-number">1.3.0.9.0.3.</span> <span class="nav-text">å–æ¶ˆæ“ä½œ</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%AD%89%E5%BE%85%E6%93%8D%E4%BD%9C%E5%AE%8C%E6%88%90"><span class="nav-number">1.3.0.9.0.4.</span> <span class="nav-text">ç­‰å¾…æ“ä½œå®Œæˆ</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%8C%82%E8%B5%B7%E5%92%8C%E6%81%A2%E5%A4%8D%E9%98%9F%E5%88%97"><span class="nav-number">1.3.0.9.0.5.</span> <span class="nav-text">æŒ‚èµ·å’Œæ¢å¤é˜Ÿåˆ—</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E5%BA%A6%E9%98%9F%E5%88%97-1"><span class="nav-number">1.4.</span> <span class="nav-text">è°ƒåº¦é˜Ÿåˆ—</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E%E8%B0%83%E5%BA%A6%E9%98%9F%E5%88%97"><span class="nav-number">1.4.0.1.</span> <span class="nav-text">å…³äºŽè°ƒåº¦é˜Ÿåˆ—</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%98%9F%E5%88%97%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF"><span class="nav-number">1.4.0.2.</span> <span class="nav-text">é˜Ÿåˆ—ç›¸å…³æŠ€æœ¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%9D%97%E5%AE%9E%E7%8E%B0%E4%BB%BB%E5%8A%A1"><span class="nav-number">1.4.0.3.</span> <span class="nav-text">ä½¿ç”¨å—å®žçŽ°ä»»åŠ¡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E7%AE%A1%E7%90%86%E8%B0%83%E5%BA%A6%E9%98%9F%E5%88%97"><span class="nav-number">1.4.0.4.</span> <span class="nav-text">åˆ›å»ºå’Œç®¡ç†è°ƒåº¦é˜Ÿåˆ—</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%85%A8%E5%B1%80%E5%B9%B6%E5%8F%91%E8%B0%83%E5%BA%A6%E9%98%9F%E5%88%97"><span class="nav-number">1.4.0.4.0.1.</span> <span class="nav-text">èŽ·å–å…¨å±€å¹¶å‘è°ƒåº¦é˜Ÿåˆ—</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%B2%E8%A1%8C%E8%B0%83%E5%BA%A6%E9%98%9F%E5%88%97"><span class="nav-number">1.4.0.4.0.2.</span> <span class="nav-text">åˆ›å»ºä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%9C%A8%E8%BF%90%E8%A1%8C%E6%97%B6%E8%8E%B7%E5%8F%96%E9%80%9A%E7%94%A8%E9%98%9F%E5%88%97"><span class="nav-number">1.4.0.4.0.3.</span> <span class="nav-text">åœ¨è¿è¡Œæ—¶èŽ·å–é€šç”¨é˜Ÿåˆ—</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%B0%83%E5%BA%A6%E9%98%9F%E5%88%97%E7%9A%84%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="nav-number">1.4.0.4.0.4.</span> <span class="nav-text">è°ƒåº¦é˜Ÿåˆ—çš„å†…å­˜ç®¡ç†</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E9%98%9F%E5%88%97%E5%AD%98%E5%82%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF"><span class="nav-number">1.4.0.4.0.5.</span> <span class="nav-text">ä½¿ç”¨é˜Ÿåˆ—å­˜å‚¨è‡ªå®šä¹‰ä¸Šä¸‹æ–‡ä¿¡æ¯</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%8F%90%E4%BE%9B%E9%98%9F%E5%88%97%E7%9A%84%E6%B8%85%E7%90%86%E5%8A%9F%E8%83%BD"><span class="nav-number">1.4.0.4.0.6.</span> <span class="nav-text">æä¾›é˜Ÿåˆ—çš„æ¸…ç†åŠŸèƒ½</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%86%E4%BB%BB%E5%8A%A1%E6%B7%BB%E5%8A%A0%E5%88%B0%E9%98%9F%E5%88%97"><span class="nav-number">1.4.0.5.</span> <span class="nav-text">å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%B0%86%E5%8D%95%E4%B8%AA%E4%BB%BB%E5%8A%A1%E6%B7%BB%E5%8A%A0%E5%88%B0%E9%98%9F%E5%88%97"><span class="nav-number">1.4.0.5.0.1.</span> <span class="nav-text">å°†å•ä¸ªä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AE%8C%E6%88%90%E4%BB%BB%E5%8A%A1%E5%90%8E%E6%89%A7%E8%A1%8C%E8%A1%A5%E5%85%A8"><span class="nav-number">1.4.0.5.0.2.</span> <span class="nav-text">å®Œæˆä»»åŠ¡åŽæ‰§è¡Œè¡¥å…¨</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%90%8C%E6%97%B6%E6%89%A7%E8%A1%8C%E5%BE%AA%E7%8E%AF%E8%BF%AD%E4%BB%A3"><span class="nav-number">1.4.0.5.0.3.</span> <span class="nav-text">åŒæ—¶æ‰§è¡Œå¾ªçŽ¯è¿­ä»£</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%9C%A8%E4%B8%BB%E7%BA%BF%E7%A8%8B%E4%B8%8A%E6%89%A7%E8%A1%8C%E4%BB%BB%E5%8A%A1"><span class="nav-number">1.4.0.5.0.4.</span> <span class="nav-text">åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œä»»åŠ¡</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%9C%A8%E4%BB%BB%E5%8A%A1%E4%B8%AD%E4%BD%BF%E7%94%A8-Objective-C-%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.4.0.5.0.5.</span> <span class="nav-text">åœ¨ä»»åŠ¡ä¸­ä½¿ç”¨ Objective-C å¯¹è±¡</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%82%E8%B5%B7%E5%92%8C%E6%81%A2%E5%A4%8D%E9%98%9F%E5%88%97-1"><span class="nav-number">1.4.0.6.</span> <span class="nav-text">æŒ‚èµ·å’Œæ¢å¤é˜Ÿåˆ—</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%B0%83%E5%BA%A6%E4%BF%A1%E5%8F%B7%E9%87%8F%E6%9D%A5%E8%B0%83%E8%8A%82%E6%9C%89%E9%99%90%E8%B5%84%E6%BA%90%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">1.4.0.7.</span> <span class="nav-text">ä½¿ç”¨è°ƒåº¦ä¿¡å·é‡æ¥è°ƒèŠ‚æœ‰é™èµ„æºçš„ä½¿ç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AD%89%E5%BE%85%E6%8E%92%E9%98%9F%E7%9A%84%E4%BB%BB%E5%8A%A1%E7%BB%84"><span class="nav-number">1.4.0.8.</span> <span class="nav-text">ç­‰å¾…æŽ’é˜Ÿçš„ä»»åŠ¡ç»„</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B0%83%E5%BA%A6%E9%98%9F%E5%88%97%E5%92%8C%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8"><span class="nav-number">1.4.0.9.</span> <span class="nav-text">è°ƒåº¦é˜Ÿåˆ—å’Œçº¿ç¨‹å®‰å…¨</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B4%BE%E9%81%A3%E6%9D%A5%E6%BA%90-1"><span class="nav-number">1.5.</span> <span class="nav-text">æ´¾é£æ¥æº</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E%E8%B0%83%E5%BA%A6%E6%BA%90"><span class="nav-number">1.5.0.1.</span> <span class="nav-text">å…³äºŽè°ƒåº¦æº</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%B0%83%E5%BA%A6%E6%BA%90"><span class="nav-number">1.5.0.2.</span> <span class="nav-text">åˆ›å»ºè°ƒåº¦æº</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E5%92%8C%E5%AE%89%E8%A3%85%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.5.0.2.0.1.</span> <span class="nav-text">ç¼–å†™å’Œå®‰è£…äº‹ä»¶å¤„ç†ç¨‹åº</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E5%8F%96%E6%B6%88%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.5.0.2.0.2.</span> <span class="nav-text">å®‰è£…å–æ¶ˆå¤„ç†ç¨‹åº</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%9B%B4%E6%94%B9%E7%9B%AE%E6%A0%87%E9%98%9F%E5%88%97"><span class="nav-number">1.5.0.2.0.3.</span> <span class="nav-text">æ›´æ”¹ç›®æ ‡é˜Ÿåˆ—</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%B0%86%E8%87%AA%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E4%B8%8E%E8%B0%83%E5%BA%A6%E6%BA%90%E5%85%B3%E8%81%94"><span class="nav-number">1.5.0.2.0.4.</span> <span class="nav-text">å°†è‡ªå®šä¹‰æ•°æ®ä¸Žè°ƒåº¦æºå…³è”</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%B0%83%E5%BA%A6%E6%BA%90%E7%9A%84%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="nav-number">1.5.0.2.0.5.</span> <span class="nav-text">è°ƒåº¦æºçš„å†…å­˜ç®¡ç†</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B0%83%E5%BA%A6%E6%BA%90%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.5.0.3.</span> <span class="nav-text">è°ƒåº¦æºç¤ºä¾‹</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%AE%A1%E6%97%B6%E5%99%A8"><span class="nav-number">1.5.0.3.0.1.</span> <span class="nav-text">åˆ›å»ºä¸€ä¸ªè®¡æ—¶å™¨</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BB%8E%E6%8F%8F%E8%BF%B0%E7%AC%A6%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="nav-number">1.5.0.3.0.2.</span> <span class="nav-text">ä»Žæè¿°ç¬¦è¯»å–æ•°æ®</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%B0%86%E6%95%B0%E6%8D%AE%E5%86%99%E5%85%A5%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="nav-number">1.5.0.3.0.3.</span> <span class="nav-text">å°†æ•°æ®å†™å…¥æè¿°ç¬¦</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%9B%91%E8%A7%86%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.5.0.3.0.4.</span> <span class="nav-text">ç›‘è§†æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%9B%91%E6%8E%A7%E4%BF%A1%E5%8F%B7"><span class="nav-number">1.5.0.3.0.5.</span> <span class="nav-text">ç›‘æŽ§ä¿¡å·</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%9B%91%E6%8E%A7%E8%BF%87%E7%A8%8B"><span class="nav-number">1.5.0.3.0.6.</span> <span class="nav-text">ç›‘æŽ§è¿‡ç¨‹</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%96%E6%B6%88%E6%B4%BE%E9%81%A3%E6%BA%90"><span class="nav-number">1.5.0.4.</span> <span class="nav-text">å–æ¶ˆæ´¾é£æº</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%82%E8%B5%B7%E5%92%8C%E6%81%A2%E5%A4%8D%E6%B4%BE%E9%81%A3%E6%BA%90"><span class="nav-number">1.5.0.5.</span> <span class="nav-text">æŒ‚èµ·å’Œæ¢å¤æ´¾é£æº</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9C%E7%A6%BB%E7%BA%BF%E7%A8%8B-1"><span class="nav-number">1.6.</span> <span class="nav-text">è¿œç¦»çº¿ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%A8%E8%B0%83%E5%BA%A6%E9%98%9F%E5%88%97%E6%9B%BF%E6%8D%A2%E7%BA%BF%E7%A8%8B"><span class="nav-number">1.6.0.1.</span> <span class="nav-text">ç”¨è°ƒåº¦é˜Ÿåˆ—æ›¿æ¢çº¿ç¨‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B6%88%E9%99%A4%E5%9F%BA%E4%BA%8E%E9%94%81%E7%9A%84%E4%BB%A3%E7%A0%81"><span class="nav-number">1.6.0.2.</span> <span class="nav-text">æ¶ˆé™¤åŸºäºŽé”çš„ä»£ç </span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%BC%82%E6%AD%A5%E9%94%81"><span class="nav-number">1.6.0.2.0.1.</span> <span class="nav-text">å®žçŽ°å¼‚æ­¥é”</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5%E6%89%A7%E8%A1%8C%E5%85%B3%E9%94%AE%E9%83%A8%E5%88%86"><span class="nav-number">1.6.0.2.0.2.</span> <span class="nav-text">åŒæ­¥æ‰§è¡Œå…³é”®éƒ¨åˆ†</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%94%B9%E8%BF%9B%E5%BE%AA%E7%8E%AF%E4%BB%A3%E7%A0%81"><span class="nav-number">1.6.0.3.</span> <span class="nav-text">æ”¹è¿›å¾ªçŽ¯ä»£ç </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%BF%E6%8D%A2%E7%BA%BF%E7%A8%8B%E8%BF%9E%E6%8E%A5"><span class="nav-number">1.6.0.4.</span> <span class="nav-text">æ›¿æ¢çº¿ç¨‹è¿žæŽ¥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%B4%E6%94%B9%E7%94%9F%E4%BA%A7%E8%80%85-%E6%B6%88%E8%B4%B9%E8%80%85%E5%AE%9E%E6%96%BD"><span class="nav-number">1.6.0.5.</span> <span class="nav-text">æ›´æ”¹ç”Ÿäº§è€…-æ¶ˆè´¹è€…å®žæ–½</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%BF%E6%8D%A2%E4%BF%A1%E5%8F%B7%E9%87%8F%E4%BB%A3%E7%A0%81"><span class="nav-number">1.6.0.6.</span> <span class="nav-text">æ›¿æ¢ä¿¡å·é‡ä»£ç </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%BF%E6%8D%A2%E8%BF%90%E8%A1%8C%E5%BE%AA%E7%8E%AF%E4%BB%A3%E7%A0%81"><span class="nav-number">1.6.0.7.</span> <span class="nav-text">æ›¿æ¢è¿è¡Œå¾ªçŽ¯ä»£ç </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E-POSIX-%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%85%BC%E5%AE%B9%E6%80%A7"><span class="nav-number">1.6.0.8.</span> <span class="nav-text">ä¸Ž POSIX çº¿ç¨‹çš„å…¼å®¹æ€§</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%8D%E6%B1%87%E8%A1%A8"><span class="nav-number">1.7.</span> <span class="nav-text">è¯æ±‡è¡¨</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E6%A1%A3%E4%BF%AE%E8%AE%A2%E5%8E%86%E5%8F%B2"><span class="nav-number">1.8.</span> <span class="nav-text">æ–‡æ¡£ä¿®è®¢åŽ†å²</span></a></li></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">LeiHao</p>
  <div class="site-description" itemprop="description">ðŸ˜ƒðŸ˜ƒðŸ˜ƒ</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">183</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">82</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/leihao0" title="GitHub â†’ https://github.com/leihao0" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/leihao0" title="Twitter â†’ https://twitter.com/leihao0" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.linkedin.com/in/leihao0" title="Linkedin â†’ https://www.linkedin.com/in/leihao0" rel="noopener" target="_blank"><i class="fab fa-linkedin-in fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

    
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leihao0.github.io/Concurrency-Programming-Guide/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LeiHao">
      <meta itemprop="description" content="ðŸ˜ƒðŸ˜ƒðŸ˜ƒ">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeiHao's Blog">
    </span>

    
    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Concurrency Programming Guide
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-27 14:07:04" itemprop="dateCreated datePublished" datetime="2020-05-27T14:07:04+08:00">2020-05-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-09-03 08:53:32" itemprop="dateModified" datetime="2020-09-03T08:53:32+08:00">2020-09-03</time>
      </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/Concurrency-Programming-Guide/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="Concurrency-Programming-Guide/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>57k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time â‰ˆ</span>
      <span>52 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Concurrency-Programming-Guide"><a href="#Concurrency-Programming-Guide" class="headerlink" title="Concurrency Programming Guide"></a><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40008091-CH1-SW1">Concurrency Programming Guide</a></h1><p>æ„Ÿè§‰çº¿ç¨‹ç›¸å…³çš„é¢è¯•é¢˜éƒ½èƒ½åœ¨ ðŸ‘† è¿™ä¸ª ðŸ”— é‡Œæ‰¾åˆ°ç­”æ¡ˆå‘¢</p>
<a id="more"></a>

<p>ðŸ‘‡ æ˜¯ Google AI ç¿»è¯‘ (jifan)</p>
<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>å¹¶å‘æ˜¯æŒ‡åŒæ—¶å‘ç”Ÿå¤šä»¶äº‹çš„æ¦‚å¿µã€‚éšç€å¤šæ ¸ CPU çš„æ¿€å¢žä»¥åŠæ¯ä¸ªå¤„ç†å™¨ä¸­æ ¸æ•°åªä¼šå¢žåŠ çš„è®¤è¯†ï¼Œè½¯ä»¶å¼€å‘äººå‘˜éœ€è¦æ–°çš„æ–¹æ³•æ¥åˆ©ç”¨å®ƒä»¬ã€‚å°½ç®¡ OS X å’Œ iOS ä¹‹ç±»çš„æ“ä½œç³»ç»Ÿèƒ½å¤Ÿå¹¶è¡Œè¿è¡Œå¤šä¸ªç¨‹åºï¼Œä½†æ˜¯å…¶ä¸­å¤§å¤šæ•°ç¨‹åºéƒ½åœ¨åŽå°è¿è¡Œï¼Œå¹¶æ‰§è¡Œéœ€è¦å¾ˆå°‘çš„è¿žç»­å¤„ç†å™¨æ—¶é—´çš„ä»»åŠ¡ã€‚å½“å‰çš„å‰å°åº”ç”¨ç¨‹åºæ—¢å¯ä»¥å¸å¼•ç”¨æˆ·çš„æ³¨æ„åŠ›ï¼Œåˆå¯ä»¥ä½¿è®¡ç®—æœºä¿æŒç¹å¿™ã€‚å¦‚æžœåº”ç”¨ç¨‹åºæœ‰å¾ˆå¤šå·¥ä½œè¦åšï¼Œä½†åªå ç”¨äº†ä¸€éƒ¨åˆ†å¯ç”¨å†…æ ¸ï¼Œé‚£ä¹ˆè¿™äº›é¢å¤–çš„å¤„ç†èµ„æºå°±ä¼šè¢«æµªè´¹æŽ‰ã€‚</p>
<p>è¿‡åŽ»ï¼Œå°†å¹¶å‘å¼•å…¥åº”ç”¨ç¨‹åºéœ€è¦åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»–çº¿ç¨‹ã€‚ä¸å¹¸çš„æ˜¯ï¼Œç¼–å†™çº¿ç¨‹ä»£ç å…·æœ‰æŒ‘æˆ˜æ€§ã€‚çº¿ç¨‹æ˜¯å¿…é¡»æ‰‹åŠ¨ç®¡ç†çš„ä½Žçº§å·¥å…·ã€‚é‰´äºŽåº”ç”¨ç¨‹åºçš„æœ€ä½³çº¿ç¨‹æ•°å¯ä»¥æ ¹æ®å½“å‰ç³»ç»Ÿè´Ÿè½½å’Œåº•å±‚ç¡¬ä»¶åŠ¨æ€å˜åŒ–ï¼Œå› æ­¤å³ä½¿ä¸æ˜¯ä¸å¯èƒ½å®žçŽ°ï¼Œå®žçŽ°æ­£ç¡®çš„çº¿ç¨‹è§£å†³æ–¹æ¡ˆä¹Ÿå˜å¾—éžå¸¸å›°éš¾ã€‚å¦å¤–ï¼Œé€šå¸¸ä¸Žçº¿ç¨‹ä¸€èµ·ä½¿ç”¨çš„åŒæ­¥æœºåˆ¶å¢žåŠ äº†è½¯ä»¶è®¾è®¡çš„å¤æ‚æ€§å’Œé£Žé™©ï¼Œè€Œæ²¡æœ‰ä»»ä½•ä¿è¯æ€§èƒ½æé«˜çš„ä¿è¯ã€‚</p>
<p>ä¸Žä¼ ç»Ÿçš„åŸºäºŽçº¿ç¨‹çš„ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºç›¸æ¯”ï¼ŒOS X å’Œ iOS éƒ½é‡‡ç”¨äº†æ›´å¤šçš„å¼‚æ­¥æ–¹æ³•æ¥æ‰§è¡Œå¹¶å‘ä»»åŠ¡ã€‚åº”ç”¨ç¨‹åºæ— éœ€ç›´æŽ¥åˆ›å»ºçº¿ç¨‹ï¼Œè€Œä»…éœ€è¦å®šä¹‰ç‰¹å®šä»»åŠ¡ï¼Œç„¶åŽè®©ç³»ç»Ÿæ‰§è¡Œå®ƒä»¬ã€‚é€šè¿‡è®©ç³»ç»Ÿç®¡ç†çº¿ç¨‹ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥èŽ·å¾—åŽŸå§‹çº¿ç¨‹æ— æ³•å®žçŽ°çš„å¯ä¼¸ç¼©æ€§çº§åˆ«ã€‚åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜è¿˜å¯ä»¥èŽ·å¾—æ›´ç®€å•ï¼Œæ›´æœ‰æ•ˆçš„ç¼–ç¨‹æ¨¡åž‹ã€‚</p>
<p>æœ¬æ–‡æ¡£ä»‹ç»äº†åº”åœ¨åº”ç”¨ç¨‹åºä¸­å®žçŽ°å¹¶å‘çš„ä¸€ç§æˆ–å¤šç§æŠ€æœ¯ã€‚æœ¬æ–‡æ¡£ä¸­æè¿°çš„æŠ€æœ¯åœ¨ OS X å’Œ iOS ä¸­å‡å¯ç”¨ã€‚</p>
<h4 id="æœ¬æ–‡ä»¶çš„ç»„ç»‡"><a href="#æœ¬æ–‡ä»¶çš„ç»„ç»‡" class="headerlink" title="æœ¬æ–‡ä»¶çš„ç»„ç»‡"></a>æœ¬æ–‡ä»¶çš„ç»„ç»‡</h4><p>æœ¬æ–‡æ¡£åŒ…å«ä»¥ä¸‹ç« èŠ‚ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/ConcurrencyandApplicationDesign/ConcurrencyandApplicationDesign.html#//apple_ref/doc/uid/TP40008091-CH100-SW1">å¹¶å‘å’Œåº”ç”¨ç¨‹åºè®¾è®¡</a>ä»‹ç»äº†å¼‚æ­¥åº”ç”¨ç¨‹åºè®¾è®¡çš„åŸºç¡€çŸ¥è¯†ä»¥åŠç”¨äºŽå¼‚æ­¥æ‰§è¡Œè‡ªå®šä¹‰ä»»åŠ¡çš„æŠ€æœ¯ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationObjects/OperationObjects.html#//apple_ref/doc/uid/TP40008091-CH101-SW1">â€œæ“ä½œé˜Ÿåˆ—â€</a>å‘æ‚¨å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Objective-C å¯¹è±¡å°è£…å’Œæ‰§è¡Œä»»åŠ¡ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW1">è°ƒåº¦é˜Ÿåˆ—</a>æ˜¾ç¤ºäº†å¦‚ä½•åœ¨åŸºäºŽ C çš„åº”ç”¨ç¨‹åºä¸­åŒæ—¶æ‰§è¡Œä»»åŠ¡ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW1">è°ƒåº¦æº</a>å‘æ‚¨å±•ç¤ºå¦‚ä½•å¼‚æ­¥å¤„ç†ç³»ç»Ÿäº‹ä»¶ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/ThreadMigration/ThreadMigration.html#//apple_ref/doc/uid/TP40008091-CH105-SW1">è¿œç¦»çº¿ç¨‹è¿ç§»</a>æä¾›äº†ä¸€äº›æŠ€å·§å’ŒæŠ€æœ¯ï¼Œå¯ä»¥å°†çŽ°æœ‰çš„åŸºäºŽçº¿ç¨‹çš„ä»£ç è¿ç§»åˆ°æ–°çš„æŠ€æœ¯ä¸Šã€‚</li>
</ul>
<p>æœ¬æ–‡æ¡£è¿˜åŒ…æ‹¬å®šä¹‰ç›¸å…³æœ¯è¯­çš„è¯æ±‡è¡¨ã€‚</p>
<h4 id="æœ‰å…³æœ¯è¯­çš„æ³¨é‡Š"><a href="#æœ‰å…³æœ¯è¯­çš„æ³¨é‡Š" class="headerlink" title="æœ‰å…³æœ¯è¯­çš„æ³¨é‡Š"></a>æœ‰å…³æœ¯è¯­çš„æ³¨é‡Š</h4><p>åœ¨è®¨è®ºå¹¶å‘ä¹‹å‰ï¼Œæœ‰å¿…è¦å®šä¹‰ä¸€äº›ç›¸å…³æœ¯è¯­ä»¥é˜²æ­¢æ··æ·†ã€‚å¯¹ UNIX ç³»ç»Ÿæˆ–è¾ƒæ—©çš„ OS X æŠ€æœ¯æ›´åŠ ç†Ÿæ‚‰çš„å¼€å‘äººå‘˜å¯èƒ½ä¼šåœ¨æœ¬æ–‡ä¸­å‘çŽ°â€œä»»åŠ¡â€ï¼Œâ€œè¿›ç¨‹â€å’Œâ€œçº¿ç¨‹â€è¿™ä¸¤ä¸ªè¯çš„ç”¨æ³•æœ‰æ‰€ä¸åŒã€‚æœ¬æ–‡æ¡£ä»¥ä¸‹åˆ—æ–¹å¼ä½¿ç”¨è¿™äº›æœ¯è¯­ï¼š</p>
<ul>
<li>æœ¯è¯­<em>çº¿ç¨‹</em>ç”¨äºŽæŒ‡ä»£ä»£ç çš„ç‹¬ç«‹æ‰§è¡Œè·¯å¾„ã€‚OS X ä¸­çº¿ç¨‹çš„åŸºç¡€å®žçŽ°åŸºäºŽ POSIX çº¿ç¨‹ APIã€‚</li>
<li>æœ¯è¯­â€œ <em>è¿›ç¨‹â€</em>ç”¨äºŽæŒ‡ä»£ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå®ƒå¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ã€‚</li>
<li>æœ¯è¯­â€œ <em>ä»»åŠ¡â€</em>ç”¨äºŽæŒ‡ä»£éœ€è¦æ‰§è¡Œçš„å·¥ä½œçš„æŠ½è±¡æ¦‚å¿µã€‚</li>
</ul>
<p>æœ‰å…³æœ¬æ–‡æ¡£ä½¿ç”¨çš„è¿™äº›æœ¯è¯­å’Œå…¶ä»–å…³é”®æœ¯è¯­çš„å®Œæ•´å®šä¹‰ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Glossary/Glossary.html#//apple_ref/doc/uid/TP40008091-CH104-SW2">è¯æ±‡è¡¨</a>ã€‚</p>
<h4 id="ä¹Ÿå¯ä»¥çœ‹çœ‹"><a href="#ä¹Ÿå¯ä»¥çœ‹çœ‹" class="headerlink" title="ä¹Ÿå¯ä»¥çœ‹çœ‹"></a>ä¹Ÿå¯ä»¥çœ‹çœ‹</h4><p>æœ¬æ–‡æ¡£é‡ç‚¹ä»‹ç»åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­å®žçŽ°å¹¶å‘æ€§çš„é¦–é€‰æŠ€æœ¯ï¼Œå¹¶ä¸”ä¸æ¶‰åŠçº¿ç¨‹çš„ä½¿ç”¨ã€‚å¦‚æžœæ‚¨éœ€è¦æœ‰å…³ä½¿ç”¨çº¿ç¨‹å’Œå…¶ä»–çº¿ç¨‹ç›¸å…³æŠ€æœ¯çš„ä¿¡æ¯ï¼Œè¯·å‚è§ã€Š_<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/Introduction/Introduction.html#//apple_ref/doc/uid/10000057i">çº¿ç¨‹ç¼–ç¨‹æŒ‡å—ã€‹</a>_ã€‚</p>
<h2 id="å¹¶å‘ä¸Žåº”ç”¨ç¨‹åºè®¾è®¡"><a href="#å¹¶å‘ä¸Žåº”ç”¨ç¨‹åºè®¾è®¡" class="headerlink" title="å¹¶å‘ä¸Žåº”ç”¨ç¨‹åºè®¾è®¡"></a>å¹¶å‘ä¸Žåº”ç”¨ç¨‹åºè®¾è®¡</h2><p>åœ¨è®¡ç®—çš„æ—©æœŸï¼Œè®¡ç®—æœºå¯ä»¥æ‰§è¡Œçš„æ¯å•ä½æ—¶é—´çš„æœ€å¤§å·¥ä½œé‡å–å†³äºŽ CPU çš„æ—¶é’Ÿé€Ÿåº¦ã€‚ä½†æ˜¯ï¼Œéšç€æŠ€æœ¯çš„è¿›æ­¥å’Œå¤„ç†å™¨è®¾è®¡å˜å¾—æ›´åŠ ç´§å‡‘ï¼Œçƒ­é‡å’Œå…¶ä»–ç‰©ç†é™åˆ¶å¼€å§‹é™åˆ¶å¤„ç†å™¨çš„æœ€å¤§æ—¶é’Ÿé€Ÿåº¦ã€‚å› æ­¤ï¼ŒèŠ¯ç‰‡åˆ¶é€ å•†æ­£åœ¨å¯»æ‰¾å…¶ä»–æ–¹æ³•æ¥æé«˜å…¶èŠ¯ç‰‡çš„æ€»ä½“æ€§èƒ½ã€‚ä»–ä»¬ç¡®å®šçš„è§£å†³æ–¹æ¡ˆæ˜¯å¢žåŠ æ¯ä¸ªèŠ¯ç‰‡ä¸Šçš„å¤„ç†å™¨å†…æ ¸æ•°é‡ã€‚é€šè¿‡å¢žåŠ å†…æ ¸æ•°é‡ï¼Œå•ä¸ªèŠ¯ç‰‡å¯ä»¥æ¯ç§’æ‰§è¡Œæ›´å¤šæŒ‡ä»¤ï¼Œè€Œæ— éœ€æé«˜ CPU é€Ÿåº¦æˆ–æ›´æ”¹èŠ¯ç‰‡å°ºå¯¸æˆ–æ•£çƒ­ç‰¹æ€§ã€‚å”¯ä¸€çš„é—®é¢˜æ˜¯å¦‚ä½•åˆ©ç”¨é¢å¤–çš„å†…æ ¸ã€‚</p>
<p>ä¸ºäº†åˆ©ç”¨å¤šä¸ªå†…æ ¸ï¼Œè®¡ç®—æœºéœ€è¦å¯ä»¥åŒæ—¶æ‰§è¡Œå¤šé¡¹æ“ä½œçš„è½¯ä»¶ã€‚å¯¹äºŽåƒ OS X æˆ– iOS è¿™æ ·çš„çŽ°ä»£å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿï¼Œåœ¨ä»»ä½•ç»™å®šæ—¶é—´å¯ä»¥è¿è¡Œä¸€ç™¾ä¸ªæˆ–æ›´å¤šç¨‹åºï¼Œå› æ­¤åº”è¯¥å¯ä»¥åœ¨ä¸åŒçš„å†…æ ¸ä¸Šè°ƒåº¦æ¯ä¸ªç¨‹åºã€‚ä½†æ˜¯ï¼Œè¿™äº›ç¨‹åºå¤§å¤šæ•°æ˜¯ç³»ç»Ÿå®ˆæŠ¤ç¨‹åºæˆ–åŽå°åº”ç”¨ç¨‹åºï¼Œå®ƒä»¬æ¶ˆè€—å¾ˆå°‘çš„å®žé™…å¤„ç†æ—¶é—´ã€‚ç›¸åï¼ŒçœŸæ­£éœ€è¦çš„æ˜¯ä½¿å„ä¸ªåº”ç”¨ç¨‹åºæ›´æœ‰æ•ˆåœ°åˆ©ç”¨é¢å¤–å†…æ ¸çš„æ–¹å¼ã€‚</p>
<p>åº”ç”¨ç¨‹åºä½¿ç”¨å¤šä¸ªå†…æ ¸çš„ä¼ ç»Ÿæ–¹å¼æ˜¯åˆ›å»ºå¤šä¸ªçº¿ç¨‹ã€‚ä½†æ˜¯ï¼Œéšç€å†…æ ¸æ•°é‡çš„å¢žåŠ ï¼Œçº¿ç¨‹è§£å†³æ–¹æ¡ˆå­˜åœ¨é—®é¢˜ã€‚æœ€å¤§çš„é—®é¢˜æ˜¯çº¿ç¨‹ä»£ç æ— æ³•å¾ˆå¥½åœ°æ‰©å±•åˆ°ä»»æ„æ•°é‡çš„å†…æ ¸ã€‚æ‚¨ä¸èƒ½åˆ›å»ºä¸Žå†…æ ¸ä¸€æ ·å¤šçš„çº¿ç¨‹ï¼Œå¹¶ä¸”æœŸæœ›ç¨‹åºè¿è¡Œè‰¯å¥½ã€‚æ‚¨éœ€è¦çŸ¥é“çš„æ˜¯å¯ä»¥æœ‰æ•ˆä½¿ç”¨çš„å†…æ ¸æ•°é‡ï¼Œè¿™å¯¹äºŽåº”ç”¨ç¨‹åºè‡ªå·±è¿›è¡Œè®¡ç®—æ˜¯ä¸€é¡¹æŒ‘æˆ˜ã€‚å³ä½¿æ‚¨è®¾æ³•ä½¿æ•°å­—æ­£ç¡®ï¼Œä¹Ÿä»ç„¶é¢ä¸´ç€å¯¹å¦‚æ­¤å¤šçš„çº¿ç¨‹è¿›è¡Œç¼–ç¨‹ï¼Œä½¿å…¶é«˜æ•ˆè¿è¡Œä»¥åŠé˜²æ­¢å®ƒä»¬ç›¸äº’å¹²æ‰°çš„æŒ‘æˆ˜ã€‚</p>
<p>å› æ­¤ï¼Œæ€»ç»“é—®é¢˜ï¼Œéœ€è¦ä¸ºåº”ç”¨ç¨‹åºæä¾›ä¸€ç§åˆ©ç”¨å¯å˜æ•°é‡çš„è®¡ç®—æœºå†…æ ¸çš„æ–¹æ³•ã€‚å•ä¸ªåº”ç”¨ç¨‹åºæ‰§è¡Œçš„å·¥ä½œé‡è¿˜éœ€è¦èƒ½å¤ŸåŠ¨æ€æ‰©å±•ä»¥é€‚åº”ä¸æ–­å˜åŒ–çš„ç³»ç»Ÿæ¡ä»¶ã€‚è§£å†³æ–¹æ¡ˆå¿…é¡»è¶³å¤Ÿç®€å•ï¼Œä»¥å…å¢žåŠ åˆ©ç”¨è¿™äº›å†…æ ¸æ‰€éœ€çš„å·¥ä½œé‡ã€‚å¥½æ¶ˆæ¯æ˜¯ï¼ŒApple çš„æ“ä½œç³»ç»Ÿä¸ºæ‰€æœ‰è¿™äº›é—®é¢˜æä¾›äº†è§£å†³æ–¹æ¡ˆï¼Œæœ¬ç« ä»‹ç»äº†æž„æˆè¯¥è§£å†³æ–¹æ¡ˆçš„æŠ€æœ¯ä»¥åŠå¯ä»¥å¯¹ä»£ç è¿›è¡Œçš„è®¾è®¡è°ƒæ•´ï¼Œä»¥åˆ©ç”¨å®ƒä»¬ã€‚</p>
<h4 id="è¿œç¦»çº¿ç¨‹"><a href="#è¿œç¦»çº¿ç¨‹" class="headerlink" title="è¿œç¦»çº¿ç¨‹"></a>è¿œç¦»çº¿ç¨‹</h4><p>å°½ç®¡çº¿ç¨‹å·²ç»å­˜åœ¨å¾ˆå¤šå¹´äº†å¹¶ä¸”ç»§ç»­ä½¿ç”¨å®ƒä»¬ï¼Œä½†æ˜¯å®ƒä»¬å¹¶ä¸èƒ½è§£å†³ä»¥å¯ä¼¸ç¼©æ–¹å¼æ‰§è¡Œå¤šä¸ªä»»åŠ¡çš„ä¸€èˆ¬é—®é¢˜ã€‚ä½¿ç”¨çº¿ç¨‹ï¼Œåˆ›å»ºå¯ä¼¸ç¼©è§£å†³æ–¹æ¡ˆçš„è´Ÿæ‹…å®Œå…¨ç”±å¼€å‘äººå‘˜æ‰¿æ‹…ã€‚æ‚¨å¿…é¡»å†³å®šè¦åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹ï¼Œå¹¶éšç€ç³»ç»Ÿæ¡ä»¶çš„å˜åŒ–åŠ¨æ€åœ°è°ƒæ•´è¯¥æ•°é‡ã€‚å¦ä¸€ä¸ªé—®é¢˜æ˜¯æ‚¨çš„åº”ç”¨ç¨‹åºæ‰¿æ‹…äº†ä¸Žåˆ›å»ºå’Œç»´æŠ¤å…¶ä½¿ç”¨çš„ä»»ä½•çº¿ç¨‹ç›¸å…³çš„å¤§éƒ¨åˆ†æˆæœ¬ã€‚</p>
<p>OS X å’Œ iOS æ— éœ€ä¾èµ–çº¿ç¨‹ï¼Œè€Œæ˜¯é‡‡ç”¨<em>å¼‚æ­¥è®¾è®¡æ–¹æ³•</em>è§£å†³å¹¶å‘é—®é¢˜ã€‚å¼‚æ­¥åŠŸèƒ½å·²ç»å­˜åœ¨äºŽæ“ä½œç³»ç»Ÿä¸­å¤šå¹´ï¼Œé€šå¸¸ç”¨äºŽå¯åŠ¨å¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´çš„ä»»åŠ¡ï¼Œä¾‹å¦‚ä»Žç£ç›˜è¯»å–æ•°æ®ã€‚è°ƒç”¨å¼‚æ­¥å‡½æ•°æ—¶ï¼Œå®ƒä¼šåœ¨åŽå°æ‰§è¡Œä¸€äº›å·¥ä½œä»¥å¯åŠ¨ä»»åŠ¡è¿è¡Œï¼Œä½†åœ¨è¯¥ä»»åŠ¡å¯èƒ½å®žé™…å®Œæˆä¹‹å‰è¿”å›žã€‚é€šå¸¸ï¼Œè¿™é¡¹å·¥ä½œæ¶‰åŠèŽ·å–åŽå°çº¿ç¨‹ï¼Œåœ¨è¯¥çº¿ç¨‹ä¸Šå¯åŠ¨æ‰€éœ€çš„ä»»åŠ¡ï¼Œç„¶åŽåœ¨ä»»åŠ¡å®Œæˆæ—¶å‘è°ƒç”¨è€…å‘é€é€šçŸ¥ï¼ˆé€šå¸¸é€šè¿‡å›žè°ƒå‡½æ•°ï¼‰ã€‚è¿‡åŽ»ï¼Œå¦‚æžœè¦æ‰§è¡Œçš„æ“ä½œä¸å­˜åœ¨å¼‚æ­¥å‡½æ•°ï¼Œåˆ™å¿…é¡»ç¼–å†™è‡ªå·±çš„å¼‚æ­¥å‡½æ•°å¹¶åˆ›å»ºè‡ªå·±çš„çº¿ç¨‹ã€‚ä½†çŽ°åœ¨ï¼Œ</p>
<p>å¼‚æ­¥å¯åŠ¨ä»»åŠ¡çš„æŠ€æœ¯ä¹‹ä¸€æ˜¯<em>å¤§ä¸­å¤®è°ƒåº¦ï¼ˆGCDï¼‰</em>ã€‚è¯¥æŠ€æœ¯é‡‡ç”¨äº†æ‚¨é€šå¸¸åœ¨è‡ªå·±çš„åº”ç”¨ç¨‹åºä¸­ç¼–å†™çš„çº¿ç¨‹ç®¡ç†ä»£ç ï¼Œå¹¶å°†è¯¥ä»£ç ä¸‹ç§»è‡³ç³»ç»Ÿçº§åˆ«ã€‚æ‚¨æ‰€è¦åšçš„å°±æ˜¯å®šä¹‰è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°é€‚å½“çš„è°ƒåº¦é˜Ÿåˆ—ä¸­ã€‚GCD è´Ÿè´£åˆ›å»ºæ‰€éœ€çš„çº¿ç¨‹ï¼Œå¹¶å®‰æŽ’ä»»åŠ¡åœ¨è¿™äº›çº¿ç¨‹ä¸Šè¿è¡Œã€‚ç”±äºŽçº¿ç¨‹ç®¡ç†çŽ°åœ¨æ˜¯ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤ GCD æä¾›äº†ä¸€ç§ç”¨äºŽä»»åŠ¡ç®¡ç†å’Œæ‰§è¡Œçš„æ•´ä½“æ–¹æ³•ï¼Œæ¯”ä¼ ç»Ÿçº¿ç¨‹æä¾›äº†æ›´é«˜çš„æ•ˆçŽ‡ã€‚</p>
<p><em>æ“ä½œé˜Ÿåˆ—</em>æ˜¯ Objective-C å¯¹è±¡ï¼Œå…¶è¡Œä¸ºä¸Žåˆ†æ´¾é˜Ÿåˆ—éžå¸¸ç›¸ä¼¼ã€‚æ‚¨å®šä¹‰è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç„¶åŽå°†å®ƒä»¬æ·»åŠ åˆ°æ“ä½œé˜Ÿåˆ—ä¸­ï¼Œè¯¥é˜Ÿåˆ—å¤„ç†è¿™äº›ä»»åŠ¡çš„è°ƒåº¦å’Œæ‰§è¡Œã€‚ä¸Ž GCD ä¸€æ ·ï¼Œæ“ä½œé˜Ÿåˆ—ä¸ºæ‚¨å¤„ç†æ‰€æœ‰çº¿ç¨‹ç®¡ç†ï¼Œä»¥ç¡®ä¿ä»»åŠ¡åœ¨ç³»ç»Ÿä¸Šå°½å¯èƒ½å¿«ä¸”é«˜æ•ˆåœ°æ‰§è¡Œã€‚</p>
<p>ä»¥ä¸‹å„èŠ‚æä¾›æœ‰å…³å¯åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çš„è°ƒåº¦é˜Ÿåˆ—ï¼Œæ“ä½œé˜Ÿåˆ—å’Œå…¶ä»–ä¸€äº›ç›¸å…³å¼‚æ­¥æŠ€æœ¯çš„æ›´å¤šä¿¡æ¯ã€‚</p>
<h6 id="è°ƒåº¦é˜Ÿåˆ—"><a href="#è°ƒåº¦é˜Ÿåˆ—" class="headerlink" title="è°ƒåº¦é˜Ÿåˆ—"></a>è°ƒåº¦é˜Ÿåˆ—</h6><p>è°ƒåº¦é˜Ÿåˆ—æ˜¯ç”¨äºŽæ‰§è¡Œè‡ªå®šä¹‰ä»»åŠ¡çš„åŸºäºŽ C çš„æœºåˆ¶ã€‚ä¸€ä¸ª<em>è°ƒåº¦é˜Ÿåˆ—</em>æ‰§è¡Œä»»åŠ¡çš„é¡ºåºæˆ–åŒæ—¶å´æ€»æ˜¯å…ˆå…¥å…ˆå‡ºçš„é¡ºåºã€‚ï¼ˆæ¢å¥è¯è¯´ï¼Œè°ƒåº¦é˜Ÿåˆ—å§‹ç»ˆä»¥æ·»åŠ ä»»åŠ¡åˆ°é˜Ÿåˆ—çš„é¡ºåºå‡ºé˜Ÿåˆ—å¹¶å¯åŠ¨ä»»åŠ¡ã€‚ï¼‰ä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—ä¸€æ¬¡ä»…è¿è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œç›´åˆ°è¯¥ä»»åŠ¡å®ŒæˆåŽæ‰å‡ºé˜Ÿåˆ—å¹¶å¯åŠ¨ä»»åŠ¡ã€‚æ–°çš„ä¸€ä¸ªã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå¹¶å‘è°ƒåº¦é˜Ÿåˆ—å¯ä»¥å¯åŠ¨å°½å¯èƒ½å¤šçš„ä»»åŠ¡ï¼Œè€Œä¸å¿…ç­‰å¾…å·²ç»å¯åŠ¨çš„ä»»åŠ¡å®Œæˆã€‚</p>
<p>è°ƒåº¦é˜Ÿåˆ—è¿˜æœ‰å…¶ä»–å¥½å¤„ï¼š</p>
<ul>
<li>å®ƒä»¬æä¾›äº†ç®€å•æ˜Žäº†çš„ç¼–ç¨‹ç•Œé¢ã€‚</li>
<li>å®ƒä»¬æä¾›è‡ªåŠ¨çš„æ•´ä½“çº¿ç¨‹æ± ç®¡ç†ã€‚</li>
<li>å®ƒä»¬æä¾›äº†è°ƒä¼˜è£…é…çš„é€Ÿåº¦ã€‚</li>
<li>å®ƒä»¬å…·æœ‰æ›´é«˜çš„å†…å­˜æ•ˆçŽ‡ï¼ˆå› ä¸ºçº¿ç¨‹å †æ ˆä¸ä¼šåœç•™åœ¨åº”ç”¨ç¨‹åºå†…å­˜ä¸­ï¼‰ã€‚</li>
<li>å®ƒä»¬ä¸ä¼šåœ¨è´Ÿè½½ä¸‹æ•èŽ·åˆ°å†…æ ¸ã€‚</li>
<li>ä»»åŠ¡åˆ°è°ƒåº¦é˜Ÿåˆ—çš„å¼‚æ­¥è°ƒåº¦ä¸èƒ½ä½¿é˜Ÿåˆ—æ­»é”ã€‚</li>
<li>ä»–ä»¬åœ¨ç«žäº‰ä¸­ä¼˜é›…åœ°æ‰©å±•ã€‚</li>
<li>ä¸²è¡Œåˆ†æ´¾é˜Ÿåˆ—ä¸ºé”å’Œå…¶ä»–åŒæ­¥åŽŸè¯­æä¾›äº†æ›´æœ‰æ•ˆçš„æ›¿ä»£æ–¹æ³•ã€‚</li>
</ul>
<p>æ‚¨æäº¤ç»™åˆ†æ´¾é˜Ÿåˆ—çš„ä»»åŠ¡å¿…é¡»å°è£…åœ¨å‡½æ•°æˆ–å—å¯¹è±¡ä¸­ã€‚<em>å—å¯¹è±¡</em>æ˜¯ OS X v10.6 å’Œ iOS 4.0 ä¸­å¼•å…¥çš„ C è¯­è¨€åŠŸèƒ½ï¼Œä»Žæ¦‚å¿µä¸Šè®²ç±»ä¼¼äºŽå‡½æ•°æŒ‡é’ˆï¼Œä½†è¿˜æœ‰ä¸€äº›å…¶ä»–å¥½å¤„ã€‚é€šå¸¸ï¼Œä¸æ˜¯åœ¨è‡ªå·±çš„è¯æ³•èŒƒå›´å†…å®šä¹‰å—ï¼Œè€Œæ˜¯é€šå¸¸åœ¨å¦ä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•å†…å®šä¹‰å—ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥ä»Žè¯¥å‡½æ•°æˆ–æ–¹æ³•è®¿é—®å…¶ä»–å˜é‡ã€‚å—ä¹Ÿå¯ä»¥ç§»å‡ºå…¶åŽŸå§‹èŒƒå›´å¹¶å¤åˆ¶åˆ°å †ä¸Šï¼Œè¿™æ˜¯å°†å®ƒä»¬æäº¤åˆ°è°ƒåº¦é˜Ÿåˆ—æ—¶å‘ç”Ÿçš„æƒ…å†µã€‚æ‰€æœ‰è¿™äº›è¯­ä¹‰ä½¿å¾—ä½¿ç”¨ç›¸å¯¹è¾ƒå°‘çš„ä»£ç å³å¯å®žçŽ°éžå¸¸åŠ¨æ€çš„ä»»åŠ¡ã€‚</p>
<p>è°ƒåº¦é˜Ÿåˆ—æ˜¯ Grand Central Dispatch æŠ€æœ¯çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”æ˜¯ C è¿è¡Œæ—¶çš„ä¸€éƒ¨åˆ†ã€‚æœ‰å…³åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è°ƒåº¦é˜Ÿåˆ—çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW1">è°ƒåº¦é˜Ÿåˆ—</a>ã€‚æœ‰å…³å—åŠå…¶å¥½å¤„çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§*<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Blocks/Articles/00_Introduction.html#//apple_ref/doc/uid/TP40007502">å—ç¼–ç¨‹ä¸»é¢˜</a>*ã€‚</p>
<h6 id="æ´¾é£æ¥æº"><a href="#æ´¾é£æ¥æº" class="headerlink" title="æ´¾é£æ¥æº"></a>æ´¾é£æ¥æº</h6><p>è°ƒåº¦æºæ˜¯ä¸€ç§åŸºäºŽ C çš„æœºåˆ¶ï¼Œç”¨äºŽå¼‚æ­¥å¤„ç†ç‰¹å®šç±»åž‹çš„ç³»ç»Ÿäº‹ä»¶ã€‚è°ƒåº¦æºå°è£…æœ‰å…³ç‰¹å®šç±»åž‹ç³»ç»Ÿäº‹ä»¶çš„ä¿¡æ¯ï¼Œå¹¶åœ¨è¯¥äº‹ä»¶å‘ç”Ÿæ—¶å°†ç‰¹å®šçš„å—å¯¹è±¡æˆ–åŠŸèƒ½æäº¤ç»™è°ƒåº¦é˜Ÿåˆ—ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è°ƒåº¦æºæ¥ç›‘è§†ä»¥ä¸‹ç±»åž‹çš„ç³»ç»Ÿäº‹ä»¶ï¼š</p>
<ul>
<li>è®¡æ—¶å™¨</li>
<li>ä¿¡å·å¤„ç†å™¨</li>
<li>æè¿°ç¬¦ç›¸å…³äº‹ä»¶</li>
<li>ä¸Žæµç¨‹ç›¸å…³çš„äº‹ä»¶</li>
<li>é©¬èµ«æ¸¯å£äº‹ä»¶</li>
<li>æ‚¨è§¦å‘çš„è‡ªå®šä¹‰äº‹ä»¶</li>
</ul>
<p>è°ƒåº¦æºæ˜¯å¤§ä¸­å¤®è°ƒåº¦æŠ€æœ¯çš„ä¸€éƒ¨åˆ†ã€‚æœ‰å…³ä½¿ç”¨è°ƒåº¦æºæŽ¥æ”¶åº”ç”¨ç¨‹åºä¸­çš„äº‹ä»¶çš„ä¿¡æ¯ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW1">è°ƒåº¦æº</a>ã€‚</p>
<h6 id="æ“ä½œé˜Ÿåˆ—"><a href="#æ“ä½œé˜Ÿåˆ—" class="headerlink" title="æ“ä½œé˜Ÿåˆ—"></a>æ“ä½œé˜Ÿåˆ—</h6><p>æ“ä½œé˜Ÿåˆ—åœ¨ Cocoa ä¸­ç­‰åŒäºŽå¹¶å‘è°ƒåº¦é˜Ÿåˆ—ï¼Œç”±<code>NSOperationQueue</code>ç±»å®žçŽ°ã€‚è°ƒåº¦é˜Ÿåˆ—å§‹ç»ˆæŒ‰å…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ‰§è¡Œä»»åŠ¡ï¼Œè€Œæ“ä½œé˜Ÿåˆ—åœ¨ç¡®å®šä»»åŠ¡çš„æ‰§è¡Œé¡ºåºæ—¶ä¼šè€ƒè™‘å…¶ä»–å› ç´ ã€‚è¿™äº›å› ç´ ä¸­æœ€ä¸»è¦çš„æ˜¯ç»™å®šä»»åŠ¡æ˜¯å¦å–å†³äºŽå…¶ä»–ä»»åŠ¡çš„å®Œæˆã€‚æ‚¨å¯ä»¥åœ¨å®šä¹‰ä»»åŠ¡æ—¶é…ç½®ä¾èµ–å…³ç³»ï¼Œå¹¶å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥ä¸ºä»»åŠ¡åˆ›å»ºå¤æ‚çš„æ‰§è¡Œé¡ºåºå›¾ã€‚</p>
<p>æ‚¨æäº¤ç»™æ“ä½œé˜Ÿåˆ—çš„ä»»åŠ¡å¿…é¡»æ˜¯<code>NSOperation</code>è¯¥ç±»çš„å®žä¾‹ã€‚çš„<em>æ“ä½œå¯¹è±¡</em>æ˜¯ Objective-C çš„å¯¹è±¡ï¼Œå®ƒå°è£…äº†è¦æ‰§è¡Œçš„å·¥ä½œï¼Œå¹¶æ‰§è¡Œå®ƒæ‰€éœ€è¦çš„ä»»ä½•æ•°æ®ã€‚å› ä¸º<code>NSOperation</code>è¯¥ç±»å®žè´¨ä¸Šæ˜¯æŠ½è±¡åŸºç±»ï¼Œæ‰€ä»¥é€šå¸¸å®šä¹‰è‡ªå®šä¹‰å­ç±»æ¥æ‰§è¡Œä»»åŠ¡ã€‚ä½†æ˜¯ï¼ŒFoundation æ¡†æž¶ç¡®å®žåŒ…å«ä¸€äº›å…·ä½“çš„å­ç±»ï¼Œæ‚¨å¯ä»¥ç›´æŽ¥åˆ›å»ºå’Œä½¿ç”¨è¿™äº›å­ç±»æ¥æ‰§è¡Œä»»åŠ¡ã€‚</p>
<p>æ“ä½œå¯¹è±¡ä¼šç”Ÿæˆé”®å€¼è§‚å¯Ÿï¼ˆKVOï¼‰é€šçŸ¥ï¼Œè¿™å¯ä»¥æ˜¯ç›‘è§†ä»»åŠ¡è¿›åº¦çš„æœ‰ç”¨æ–¹æ³•ã€‚å°½ç®¡æ“ä½œé˜Ÿåˆ—æ€»æ˜¯åŒæ—¶æ‰§è¡Œæ“ä½œï¼Œä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨ä¾èµ–é¡¹æ¥ç¡®ä¿åœ¨éœ€è¦æ—¶æŒ‰é¡ºåºæ‰§è¡Œå®ƒä»¬ã€‚</p>
<p>æœ‰å…³å¦‚ä½•ä½¿ç”¨æ“ä½œé˜Ÿåˆ—ä»¥åŠå¦‚ä½•å®šä¹‰è‡ªå®šä¹‰æ“ä½œå¯¹è±¡çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ã€Š<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationObjects/OperationObjects.html#//apple_ref/doc/uid/TP40008091-CH101-SW1">æ“ä½œé˜Ÿåˆ—ã€‹</a>ã€‚</p>
<h4 id="å¼‚æ­¥è®¾è®¡æŠ€æœ¯"><a href="#å¼‚æ­¥è®¾è®¡æŠ€æœ¯" class="headerlink" title="å¼‚æ­¥è®¾è®¡æŠ€æœ¯"></a>å¼‚æ­¥è®¾è®¡æŠ€æœ¯</h4><p>åœ¨ç”šè‡³è€ƒè™‘é‡æ–°è®¾è®¡ä»£ç ä»¥æ”¯æŒå¹¶å‘ä¹‹å‰ï¼Œæ‚¨åº”è¯¥é—®è‡ªå·±æ˜¯å¦è¿™æ ·åšã€‚å¹¶å‘å¯ä»¥ç¡®ä¿æ‚¨çš„ä¸»çº¿ç¨‹å¯ä»¥è‡ªç”±åœ°å“åº”ç”¨æˆ·äº‹ä»¶ï¼Œä»Žè€Œå¯ä»¥æé«˜ä»£ç çš„å“åº”é€Ÿåº¦ã€‚é€šè¿‡åˆ©ç”¨æ›´å¤šçš„å†…æ ¸åœ¨ç›¸åŒçš„æ—¶é—´å†…å®Œæˆæ›´å¤šçš„å·¥ä½œï¼Œå®ƒç”šè‡³å¯ä»¥æé«˜ä»£ç çš„æ•ˆçŽ‡ã€‚ä½†æ˜¯ï¼Œè¿™ä¹Ÿå¢žåŠ äº†å¼€é”€å¹¶å¢žåŠ äº†ä»£ç çš„æ•´ä½“å¤æ‚æ€§ï¼Œä»Žè€Œä½¿ç¼–å†™å’Œè°ƒè¯•ä»£ç å˜å¾—æ›´åŠ å›°éš¾ã€‚</p>
<p>å› ä¸ºå¹¶å‘æ€§å¢žåŠ äº†å¤æ‚æ€§ï¼Œæ‰€ä»¥æ‚¨ä¸èƒ½åœ¨äº§å“å‘¨æœŸç»“æŸæ—¶å°†å¹¶å‘æ€§ç§»æ¤åˆ°åº”ç”¨ç¨‹åºä¸Šã€‚æ­£ç¡®æ‰§è¡Œæ­¤æ“ä½œéœ€è¦ä»”ç»†è€ƒè™‘åº”ç”¨ç¨‹åºæ‰§è¡Œçš„ä»»åŠ¡ä»¥åŠç”¨äºŽæ‰§è¡Œè¿™äº›ä»»åŠ¡çš„æ•°æ®ç»“æž„ã€‚å¦‚æžœå¤„ç†ä¸æ­£ç¡®ï¼Œæ‚¨å¯èƒ½ä¼šå‘çŽ°ä»£ç è¿è¡Œé€Ÿåº¦æ¯”ä»¥å‰æ…¢ï¼Œå¹¶ä¸”å¯¹ç”¨æˆ·çš„å“åº”é€Ÿåº¦ä¹Ÿè¾ƒæ…¢ã€‚å› æ­¤ï¼Œå€¼å¾—åœ¨è®¾è®¡å‘¨æœŸå¼€å§‹æ—¶èŠ±ä¸€äº›æ—¶é—´è®¾å®šä¸€äº›ç›®æ ‡å¹¶è€ƒè™‘éœ€è¦é‡‡å–çš„æ–¹æ³•ã€‚</p>
<p>æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸åŒçš„è¦æ±‚å’Œæ‰§è¡Œçš„ä¸åŒä»»åŠ¡é›†ã€‚æ–‡æ¡£ä¸å¯èƒ½å‡†ç¡®åœ°å‘Šè¯‰æ‚¨å¦‚ä½•è®¾è®¡åº”ç”¨ç¨‹åºåŠå…¶ç›¸å…³ä»»åŠ¡ã€‚ä½†æ˜¯ï¼Œä»¥ä¸‹å„èŠ‚è¯•å›¾æä¾›ä¸€äº›æŒ‡å¯¼ï¼Œä»¥å¸®åŠ©æ‚¨åœ¨è®¾è®¡è¿‡ç¨‹ä¸­åšå‡ºæ­£ç¡®çš„é€‰æ‹©ã€‚</p>
<h6 id="å®šä¹‰åº”ç”¨ç¨‹åºçš„é¢„æœŸè¡Œä¸º"><a href="#å®šä¹‰åº”ç”¨ç¨‹åºçš„é¢„æœŸè¡Œä¸º" class="headerlink" title="å®šä¹‰åº”ç”¨ç¨‹åºçš„é¢„æœŸè¡Œä¸º"></a>å®šä¹‰åº”ç”¨ç¨‹åºçš„é¢„æœŸè¡Œä¸º</h6><p>åœ¨ç”šè‡³è€ƒè™‘å‘åº”ç”¨ç¨‹åºæ·»åŠ å¹¶å‘ä¹‹å‰ï¼Œæ‚¨åº”è¯¥å§‹ç»ˆä»Žå®šä¹‰æ‚¨è®¤ä¸ºæ­£ç¡®çš„åº”ç”¨ç¨‹åºè¡Œä¸ºå¼€å§‹ã€‚äº†è§£åº”ç”¨ç¨‹åºçš„é¢„æœŸè¡Œä¸ºä¸ºæ‚¨æä¾›äº†ä¸€ç§ç¨åŽéªŒè¯è®¾è®¡çš„æ–¹æ³•ã€‚å®ƒè¿˜åº”è¯¥ä½¿æ‚¨å¯¹é€šè¿‡å¼•å…¥å¹¶å‘å¯èƒ½èŽ·å¾—çš„é¢„æœŸæ€§èƒ½æ”¶ç›Šæœ‰æ‰€äº†è§£ã€‚</p>
<p>æ‚¨åº”è¯¥åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯æžšä¸¾åº”ç”¨ç¨‹åºæ‰§è¡Œçš„ä»»åŠ¡ä»¥åŠä¸Žæ¯ä¸ªä»»åŠ¡å…³è”çš„å¯¹è±¡æˆ–æ•°æ®ç»“æž„ã€‚æœ€åˆï¼Œæ‚¨å¯èƒ½æƒ³ä»Žç”¨æˆ·é€‰æ‹©èœå•é¡¹æˆ–å•å‡»æŒ‰é’®æ—¶æ‰§è¡Œçš„ä»»åŠ¡å¼€å§‹ã€‚è¿™äº›ä»»åŠ¡æä¾›äº†ç¦»æ•£çš„è¡Œä¸ºï¼Œå¹¶å…·æœ‰æ˜Žç¡®å®šä¹‰çš„èµ·ç‚¹å’Œç»ˆç‚¹ã€‚æ‚¨è¿˜åº”è¯¥æžšä¸¾åº”ç”¨ç¨‹åºæ— éœ€ç”¨æˆ·äº¤äº’å³å¯æ‰§è¡Œçš„å…¶ä»–ç±»åž‹çš„ä»»åŠ¡ï¼Œä¾‹å¦‚åŸºäºŽè®¡æ—¶å™¨çš„ä»»åŠ¡ã€‚</p>
<p>åœ¨èŽ·å¾—é«˜çº§ä»»åŠ¡åˆ—è¡¨ä¹‹åŽï¼Œå¼€å§‹å°†æ¯ä¸ªä»»åŠ¡è¿›ä¸€æ­¥ç»†åˆ†ä¸ºæˆåŠŸå®Œæˆä»»åŠ¡å¿…é¡»é‡‡å–çš„æ­¥éª¤ã€‚åœ¨æ­¤çº§åˆ«ä¸Šï¼Œæ‚¨åº”è¯¥ä¸»è¦å…³æ³¨éœ€è¦å¯¹ä»»ä½•æ•°æ®ç»“æž„å’Œå¯¹è±¡è¿›è¡Œçš„ä¿®æ”¹ï¼Œä»¥åŠè¿™äº›ä¿®æ”¹å¦‚ä½•å½±å“åº”ç”¨ç¨‹åºçš„æ•´ä½“çŠ¶æ€ã€‚æ‚¨è¿˜åº”è¯¥æ³¨æ„å¯¹è±¡ä¸Žæ•°æ®ç»“æž„ä¹‹é—´çš„ä»»ä½•ä¾èµ–å…³ç³»ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœä¸€é¡¹ä»»åŠ¡æ¶‰åŠå¯¹ä¸€ç»„å¯¹è±¡è¿›è¡Œç›¸åŒçš„æ›´æ”¹ï¼Œåˆ™å€¼å¾—æ³¨æ„çš„æ˜¯å¯¹ä¸€ä¸ªå¯¹è±¡çš„æ›´æ”¹æ˜¯å¦ä¼šå½±å“å…¶ä»–ä»»ä½•å¯¹è±¡ã€‚å¦‚æžœå¯ä»¥ç›¸äº’ç‹¬ç«‹åœ°ä¿®æ”¹å¯¹è±¡ï¼Œåˆ™å¯èƒ½æ˜¯å¯ä»¥åŒæ—¶è¿›è¡Œè¿™äº›ä¿®æ”¹çš„åœ°æ–¹ã€‚</p>
<h6 id="æŽ’é™¤å¯æ‰§è¡Œçš„å·¥ä½œå•å…ƒ"><a href="#æŽ’é™¤å¯æ‰§è¡Œçš„å·¥ä½œå•å…ƒ" class="headerlink" title="æŽ’é™¤å¯æ‰§è¡Œçš„å·¥ä½œå•å…ƒ"></a>æŽ’é™¤å¯æ‰§è¡Œçš„å·¥ä½œå•å…ƒ</h6><p>é€šè¿‡äº†è§£åº”ç”¨ç¨‹åºçš„ä»»åŠ¡ï¼Œæ‚¨åº”è¯¥å·²ç»èƒ½å¤Ÿç¡®å®šä»£ç å¯ä»¥ä»Žå¹¶å‘ä¸­å—ç›Šçš„åœ°æ–¹ã€‚å¦‚æžœæ›´æ”¹ä»»åŠ¡ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤çš„é¡ºåºä¼šæ”¹å˜ç»“æžœï¼Œåˆ™å¯èƒ½éœ€è¦ç»§ç»­æŒ‰é¡ºåºç»§ç»­æ‰§è¡Œè¿™äº›æ­¥éª¤ã€‚ä½†æ˜¯ï¼Œå¦‚æžœæ›´æ”¹é¡ºåºå¯¹è¾“å‡ºæ²¡æœ‰å½±å“ï¼Œåˆ™åº”è€ƒè™‘åŒæ—¶æ‰§è¡Œè¿™äº›æ­¥éª¤ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ‚¨éƒ½å®šä¹‰äº†ä»£è¡¨è¦æ‰§è¡Œçš„ä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤çš„å¯æ‰§è¡Œå·¥ä½œå•å…ƒã€‚ç„¶åŽï¼Œè¯¥å·¥ä½œå•å…ƒå°†æˆä¸ºæ‚¨ä½¿ç”¨å—æˆ–æ“ä½œå¯¹è±¡å°è£…çš„å†…å®¹ï¼Œå¹¶åˆ†æ´¾åˆ°é€‚å½“çš„é˜Ÿåˆ—ä¸­ã€‚</p>
<p>å¯¹äºŽæ‚¨æ ‡è¯†çš„æ¯ä¸ªå¯æ‰§è¡Œå·¥ä½œå•å…ƒï¼Œè‡³å°‘åœ¨æœ€åˆé˜¶æ®µï¼Œä¸å¿…è¿‡å¤šæ‹…å¿ƒæ‰§è¡Œçš„å·¥ä½œé‡ã€‚å°½ç®¡æ‹†åˆ†çº¿ç¨‹å§‹ç»ˆä¼šäº§ç”Ÿæˆæœ¬ï¼Œä½†æ˜¯åˆ†æ´¾é˜Ÿåˆ—å’Œæ“ä½œé˜Ÿåˆ—çš„ä¼˜ç‚¹ä¹‹ä¸€æ˜¯ï¼Œåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œè¿™äº›æˆæœ¬æ¯”ä¼ ç»Ÿçº¿ç¨‹è¦å°å¾—å¤šã€‚å› æ­¤ï¼Œä¸Žä½¿ç”¨çº¿ç¨‹ç›¸æ¯”ï¼Œä½¿ç”¨é˜Ÿåˆ—å¯ä»¥æ›´æœ‰æ•ˆåœ°æ‰§è¡Œè¾ƒå°çš„å·¥ä½œå•å…ƒã€‚å½“ç„¶ï¼Œæ‚¨åº”è¯¥å§‹ç»ˆæµ‹é‡å®žé™…æ€§èƒ½å¹¶æ ¹æ®éœ€è¦è°ƒæ•´ä»»åŠ¡çš„å¤§å°ï¼Œä½†æ˜¯ä¸€å¼€å§‹ï¼Œä¸åº”å°†ä»»ä½•ä»»åŠ¡è§†ä¸ºå¤ªå°ã€‚</p>
<h6 id="ç¡®å®šæ‚¨éœ€è¦çš„é˜Ÿåˆ—"><a href="#ç¡®å®šæ‚¨éœ€è¦çš„é˜Ÿåˆ—" class="headerlink" title="ç¡®å®šæ‚¨éœ€è¦çš„é˜Ÿåˆ—"></a>ç¡®å®šæ‚¨éœ€è¦çš„é˜Ÿåˆ—</h6><p>çŽ°åœ¨ï¼Œæ‚¨çš„ä»»åŠ¡å·²åˆ†è§£ä¸ºä¸åŒçš„å·¥ä½œå•å…ƒï¼Œå¹¶ä½¿ç”¨å—å¯¹è±¡æˆ–æ“ä½œå¯¹è±¡è¿›è¡Œäº†å°è£…ï¼ŒçŽ°åœ¨æ‚¨éœ€è¦å®šä¹‰è¦ç”¨äºŽæ‰§è¡Œè¯¥ä»£ç çš„é˜Ÿåˆ—ã€‚å¯¹äºŽç»™å®šçš„ä»»åŠ¡ï¼Œè¯·æ£€æŸ¥æ‚¨åˆ›å»ºçš„å—æˆ–æ“ä½œå¯¹è±¡ä»¥åŠå¿…é¡»æ‰§è¡Œå®ƒä»¬æ‰èƒ½æ­£ç¡®æ‰§è¡Œä»»åŠ¡çš„é¡ºåºã€‚</p>
<p>å¦‚æžœä½¿ç”¨å—æ¥å®žçŽ°ä»»åŠ¡ï¼Œåˆ™å¯ä»¥å°†å—æ·»åŠ åˆ°ä¸²è¡Œæˆ–å¹¶å‘è°ƒåº¦é˜Ÿåˆ—ä¸­ã€‚å¦‚æžœéœ€è¦ç‰¹å®šçš„å‘½ä»¤ï¼Œåˆ™å§‹ç»ˆå°†å—æ·»åŠ åˆ°ä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—ä¸­ã€‚å¦‚æžœä¸éœ€è¦ç‰¹å®šçš„é¡ºåºï¼Œåˆ™å¯ä»¥æ ¹æ®éœ€è¦å°†å—æ·»åŠ åˆ°å¹¶å‘è°ƒåº¦é˜Ÿåˆ—ä¸­ï¼Œæˆ–å°†å®ƒä»¬æ·»åŠ åˆ°å‡ ä¸ªä¸åŒçš„è°ƒåº¦é˜Ÿåˆ—ä¸­ã€‚</p>
<p>å¦‚æžœä½¿ç”¨æ“ä½œå¯¹è±¡å®žçŽ°ä»»åŠ¡ï¼Œåˆ™é€‰æ‹©é˜Ÿåˆ—é€šå¸¸æ¯”é…ç½®å¯¹è±¡æœ‰è¶£ã€‚è¦ä¸²è¡Œæ‰§è¡Œæ“ä½œå¯¹è±¡ï¼Œå¿…é¡»é…ç½®ç›¸å…³å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ä¾èµ–å…³ç³»ä¼šé˜»æ­¢ä¸€ä¸ªæ“ä½œæ‰§è¡Œåˆ°å®ƒæ‰€ä¾èµ–çš„å¯¹è±¡å®Œæˆå·¥ä½œä¸ºæ­¢ã€‚</p>
<h6 id="æé«˜æ•ˆçŽ‡çš„æŠ€å·§"><a href="#æé«˜æ•ˆçŽ‡çš„æŠ€å·§" class="headerlink" title="æé«˜æ•ˆçŽ‡çš„æŠ€å·§"></a>æé«˜æ•ˆçŽ‡çš„æŠ€å·§</h6><p>é™¤äº†ç®€å•åœ°å°†ä»£ç åˆ†è§£ä¸ºè¾ƒå°çš„ä»»åŠ¡å¹¶å°†å…¶æ·»åŠ åˆ°é˜Ÿåˆ—ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–æ–¹æ³•å¯ä»¥ä½¿ç”¨é˜Ÿåˆ—æ¥æé«˜ä»£ç çš„æ•´ä½“æ•ˆçŽ‡ï¼š</p>
<ul>
<li><strong>å¦‚æžœå†…å­˜ä½¿ç”¨æ˜¯ä¸€ä¸ªå› ç´ ï¼Œè¯·è€ƒè™‘ç›´æŽ¥åœ¨ä»»åŠ¡ä¸­è®¡ç®—å€¼ã€‚</strong>å¦‚æžœæ‚¨çš„åº”ç”¨ç¨‹åºå·²ç»å—å†…å­˜é™åˆ¶ï¼Œé‚£ä¹ˆçŽ°åœ¨ç›´æŽ¥è®¡ç®—å€¼å¯èƒ½æ¯”ä»Žä¸»å†…å­˜åŠ è½½ç¼“å­˜çš„å€¼è¦å¿«ã€‚è®¡ç®—å€¼ç›´æŽ¥ä½¿ç”¨ç»™å®šå¤„ç†å™¨å†…æ ¸çš„å¯„å­˜å™¨å’Œç¼“å­˜ï¼Œè¿™æ¯”ä¸»å†…å­˜å¿«å¾—å¤šã€‚å½“ç„¶ï¼Œåªæœ‰åœ¨æµ‹è¯•è¡¨æ˜Žè¿™æ˜¯æ€§èƒ½ä¸Šçš„èƒœåˆ©æ—¶ï¼Œæ‰åº”è¯¥è¿™æ ·åšã€‚</li>
<li><strong>å°½æ—©è¯†åˆ«ä¸²è¡Œä»»åŠ¡ï¼Œå¹¶å°½åŠ›ä½¿å®ƒä»¬æ›´åŠ å¹¶è¡Œã€‚</strong>å¦‚æžœç”±äºŽæŸä¸ªä»»åŠ¡ä¾èµ–æŸäº›å…±äº«èµ„æºè€Œå¿…é¡»ä¸²è¡Œæ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œè¯·è€ƒè™‘æ›´æ”¹ä½“ç³»ç»“æž„ä»¥åˆ é™¤è¯¥å…±äº«èµ„æºã€‚æ‚¨å¯ä»¥è€ƒè™‘ä¸ºæ¯ä¸ªéœ€è¦ä¸€ä¸ªçš„å®¢æˆ·ç«¯åˆ¶ä½œèµ„æºå‰¯æœ¬ï¼Œæˆ–è€…å®Œå…¨æ¶ˆé™¤è¯¥èµ„æºã€‚</li>
<li><strong>é¿å…ä½¿ç”¨é”ã€‚</strong>åˆ†æ´¾é˜Ÿåˆ—å’Œæ“ä½œé˜Ÿåˆ—æä¾›çš„æ”¯æŒä½¿å¾—åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¸éœ€è¦é”ã€‚ä¸Žå…¶ä½¿ç”¨é”æ¥ä¿æŠ¤æŸäº›å…±äº«èµ„æºï¼Œä¸å¦‚æŒ‡å®šä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ï¼ˆæˆ–ä½¿ç”¨æ“ä½œå¯¹è±¡ä¾èµ–é¡¹ï¼‰ä»¥æ­£ç¡®çš„é¡ºåºæ‰§è¡Œä»»åŠ¡ã€‚</li>
<li><strong>å°½å¯èƒ½ä¾é ç³»ç»Ÿæ¡†æž¶ã€‚</strong>å®žçŽ°å¹¶å‘çš„æœ€ä½³æ–¹æ³•æ˜¯åˆ©ç”¨ç³»ç»Ÿæ¡†æž¶æä¾›çš„å†…ç½®å¹¶å‘ã€‚è®¸å¤šæ¡†æž¶åœ¨å†…éƒ¨ä½¿ç”¨çº¿ç¨‹å’Œå…¶ä»–æŠ€æœ¯æ¥å®žçŽ°å¹¶å‘è¡Œä¸ºã€‚åœ¨å®šä¹‰ä»»åŠ¡æ—¶ï¼Œè¯·æŸ¥çœ‹çŽ°æœ‰æ¡†æž¶æ˜¯å¦å®šä¹‰äº†å¯ä»¥å®Œå…¨æ»¡è¶³æ‚¨æœŸæœ›å¹¶åŒæ—¶å®žçŽ°çš„åŠŸèƒ½æˆ–æ–¹æ³•ã€‚ä½¿ç”¨è¯¥ API å¯ä»¥èŠ‚çœæ‚¨çš„ç²¾åŠ›ï¼Œå¹¶ä¸”æ›´æœ‰å¯èƒ½ä¸ºæ‚¨æä¾›æœ€å¤§çš„å¹¶å‘æ€§ã€‚</li>
</ul>
<h4 id="æ€§èƒ½å½±å“"><a href="#æ€§èƒ½å½±å“" class="headerlink" title="æ€§èƒ½å½±å“"></a>æ€§èƒ½å½±å“</h4><p>æä¾›äº†æ“ä½œé˜Ÿåˆ—ï¼Œè°ƒåº¦é˜Ÿåˆ—å’Œè°ƒåº¦æºï¼Œä½¿æ‚¨å¯ä»¥æ›´è½»æ¾åœ°åŒæ—¶æ‰§è¡Œæ›´å¤šä»£ç ã€‚ä½†æ˜¯ï¼Œè¿™äº›æŠ€æœ¯ä¸èƒ½ä¿è¯æé«˜åº”ç”¨ç¨‹åºçš„æ•ˆçŽ‡æˆ–å“åº”èƒ½åŠ›ã€‚ä½¿ç”¨é˜Ÿåˆ—æ—¢å¯ä»¥æ»¡è¶³æ‚¨çš„éœ€æ±‚ï¼Œåˆä¸ä¼šç»™åº”ç”¨ç¨‹åºçš„å…¶ä»–èµ„æºå¸¦æ¥è¿‡å¤šè´Ÿæ‹…ï¼Œä»ç„¶æ˜¯æ‚¨çš„è´£ä»»ã€‚ä¾‹å¦‚ï¼Œå°½ç®¡æ‚¨å¯ä»¥åˆ›å»º 10,000 ä¸ªæ“ä½œå¯¹è±¡å¹¶å°†å…¶æäº¤åˆ°æ“ä½œé˜Ÿåˆ—ï¼Œä½†æ˜¯è¿™æ ·åšå°†å¯¼è‡´æ‚¨çš„åº”ç”¨ç¨‹åºåˆ†é…æ½œåœ¨çš„é‡è¦å†…å­˜é‡ï¼Œè¿™å¯èƒ½å¯¼è‡´åˆ†é¡µå’Œæ€§èƒ½ä¸‹é™ã€‚</p>
<p>åœ¨ä¸ºä»£ç å¼•å…¥ä»»ä½•æ•°é‡çš„å¹¶å‘ä¹‹å‰ï¼ˆæ— è®ºä½¿ç”¨é˜Ÿåˆ—è¿˜æ˜¯çº¿ç¨‹ï¼‰ï¼Œæ‚¨åº”è¯¥å§‹ç»ˆæ”¶é›†ä¸€ç»„åæ˜ åº”ç”¨ç¨‹åºå½“å‰æ€§èƒ½çš„åŸºå‡†åº¦é‡ã€‚å¼•å…¥æ›´æ”¹åŽï¼Œæ‚¨åº”è¯¥æ”¶é›†å…¶ä»–æŒ‡æ ‡å¹¶å°†å…¶ä¸ŽåŸºå‡†è¿›è¡Œæ¯”è¾ƒï¼Œä»¥æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„æ•´ä½“æ•ˆçŽ‡æ˜¯å¦æœ‰æ‰€æé«˜ã€‚å¦‚æžœå¹¶å‘æ€§å¼•å…¥ä½¿æ‚¨çš„åº”ç”¨ç¨‹åºæ•ˆçŽ‡æˆ–å“åº”é€Ÿåº¦é™ä½Žï¼Œåˆ™åº”ä½¿ç”¨å¯ç”¨çš„æ€§èƒ½å·¥å…·æ¥æ£€æŸ¥æ½œåœ¨åŽŸå› ã€‚</p>
<p>æœ‰å…³æ€§èƒ½å’Œå¯ç”¨æ€§èƒ½å·¥å…·çš„ä»‹ç»ï¼Œä»¥åŠæŒ‡å‘æ›´å¤šä¸Žæ€§èƒ½ç›¸å…³çš„é«˜çº§ä¸»é¢˜çš„é“¾æŽ¥ï¼Œè¯·å‚è§*<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Performance/Conceptual/PerformanceOverview/Introduction/Introduction.html#//apple_ref/doc/uid/TP40001410">æ€§èƒ½æ¦‚è¿°</a>*ã€‚</p>
<h4 id="å¹¶å‘å’Œå…¶ä»–æŠ€æœ¯"><a href="#å¹¶å‘å’Œå…¶ä»–æŠ€æœ¯" class="headerlink" title="å¹¶å‘å’Œå…¶ä»–æŠ€æœ¯"></a>å¹¶å‘å’Œå…¶ä»–æŠ€æœ¯</h4><p>å°†ä»£ç åˆ†è§£ä¸ºæ¨¡å—åŒ–ä»»åŠ¡æ˜¯å°è¯•å¹¶æé«˜åº”ç”¨ç¨‹åºä¸­å¹¶å‘æ€§çš„æœ€ä½³æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œè¿™ç§è®¾è®¡æ–¹æ³•å¯èƒ½æ— æ³•æ»¡è¶³æ¯ç§æƒ…å†µä¸‹æ¯ç§åº”ç”¨ç¨‹åºçš„éœ€æ±‚ã€‚æ ¹æ®æ‚¨çš„ä»»åŠ¡ï¼Œå¯èƒ½è¿˜æœ‰å…¶ä»–é€‰é¡¹å¯ä»¥ä¸ºåº”ç”¨ç¨‹åºçš„æ•´ä½“å¹¶å‘æ€§æä¾›å…¶ä»–æ”¹è¿›ã€‚æœ¬èŠ‚æ¦‚è¿°äº†è®¾è®¡ä¸­è¦è€ƒè™‘ä½¿ç”¨çš„å…¶ä»–ä¸€äº›æŠ€æœ¯ã€‚</p>
<h6 id="OpenCL-å’Œå¹¶å‘"><a href="#OpenCL-å’Œå¹¶å‘" class="headerlink" title="OpenCL å’Œå¹¶å‘"></a>OpenCL å’Œå¹¶å‘</h6><p>åœ¨ OS X ä¸­ï¼Œ<em>å¼€æ”¾è®¡ç®—è¯­è¨€ï¼ˆOpenCLï¼‰</em>æ˜¯ä¸€ç§åŸºäºŽæ ‡å‡†çš„æŠ€æœ¯ï¼Œç”¨äºŽåœ¨è®¡ç®—æœºçš„å›¾å½¢å¤„ç†å™¨ä¸Šæ‰§è¡Œé€šç”¨è®¡ç®—ã€‚å¦‚æžœæ‚¨è¦å¯¹å¤§åž‹æ•°æ®é›†åº”ç”¨ä¸€ç»„å®šä¹‰æ˜Žç¡®çš„è®¡ç®—ï¼Œåˆ™ OpenCL æ˜¯ä¸€é¡¹å¾ˆå¥½çš„æŠ€æœ¯ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ OpenCL å¯¹å›¾åƒçš„åƒç´ æ‰§è¡Œè¿‡æ»¤å™¨è®¡ç®—ï¼Œæˆ–ä¸€æ¬¡å¯¹å¤šä¸ªå€¼æ‰§è¡Œå¤æ‚çš„æ•°å­¦è®¡ç®—ã€‚æ¢å¥è¯è¯´ï¼ŒOpenCL æ›´é€‚åˆé—®é¢˜é›†ï¼Œè¿™äº›é—®é¢˜é›†çš„æ•°æ®å¯ä»¥å¹¶è¡Œå¤„ç†ã€‚</p>
<p>å°½ç®¡ OpenCL å¯ä»¥å¾ˆå¥½åœ°æ‰§è¡Œå¤§é‡æ•°æ®å¹¶è¡Œæ“ä½œï¼Œä½†å®ƒä¸é€‚ç”¨äºŽæ›´é€šç”¨çš„è®¡ç®—ã€‚å°†æ•°æ®å’Œæ‰€éœ€çš„å·¥ä½œå†…æ ¸å‡†å¤‡å¹¶ä¼ è¾“åˆ°å›¾å½¢å¡éœ€è¦å¤§é‡çš„ç²¾åŠ›ï¼Œä»¥ä¾¿å¯ä»¥é€šè¿‡ GPU å¯¹å…¶è¿›è¡Œæ“ä½œã€‚åŒæ ·ï¼Œæ£€ç´¢ OpenCL ç”Ÿæˆçš„ä»»ä½•ç»“æžœéƒ½éœ€è¦èŠ±è´¹å¤§é‡ç²¾åŠ›ã€‚å› æ­¤ï¼Œé€šå¸¸ä¸å»ºè®®ä¸Žç³»ç»Ÿäº¤äº’çš„ä»»ä½•ä»»åŠ¡ä¸Ž OpenCL ä¸€èµ·ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œæ‚¨ä¸ä¼šä½¿ç”¨ OpenCL å¤„ç†æ–‡ä»¶æˆ–ç½‘ç»œæµä¸­çš„æ•°æ®ã€‚ç›¸åï¼Œæ‚¨ä½¿ç”¨ OpenCL æ‰§è¡Œçš„å·¥ä½œå¿…é¡»æ›´åŠ ç‹¬ç«‹ï¼Œä»¥ä¾¿å¯ä»¥å°†å…¶ä¼ è¾“åˆ°å›¾å½¢å¤„ç†å™¨å¹¶è¿›è¡Œç‹¬ç«‹è®¡ç®—ã€‚</p>
<p>æœ‰å…³ OpenCL åŠå…¶ä½¿ç”¨æ–¹å¼çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…*<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Performance/Conceptual/OpenCL_MacProgGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40008312">ã€Šé€‚ç”¨äºŽ Mac çš„ OpenCL ç¼–ç¨‹æŒ‡å—ã€‹</a>*ã€‚</p>
<h6 id="ä½•æ—¶ä½¿ç”¨çº¿ç¨‹"><a href="#ä½•æ—¶ä½¿ç”¨çº¿ç¨‹" class="headerlink" title="ä½•æ—¶ä½¿ç”¨çº¿ç¨‹"></a>ä½•æ—¶ä½¿ç”¨çº¿ç¨‹</h6><p>å°½ç®¡æ“ä½œé˜Ÿåˆ—å’Œè°ƒåº¦é˜Ÿåˆ—æ˜¯åŒæ—¶æ‰§è¡Œä»»åŠ¡çš„é¦–é€‰æ–¹å¼ï¼Œä½†å®ƒä»¬ä¸æ˜¯ä¸‡èƒ½è¯ã€‚æ ¹æ®æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œæœ‰æ—¶ä»ç„¶éœ€è¦åˆ›å»ºè‡ªå®šä¹‰çº¿ç¨‹ã€‚å¦‚æžœç¡®å®žåˆ›å»ºè‡ªå®šä¹‰çº¿ç¨‹ï¼Œåˆ™åº”åŠªåŠ›è‡ªå·±åˆ›å»ºå°½å¯èƒ½å°‘çš„çº¿ç¨‹ï¼Œå¹¶ä¸”åº”ä»…å°†è¿™äº›çº¿ç¨‹ç”¨äºŽæ— æ³•ä»¥å…¶ä»–ä»»ä½•æ–¹å¼å®žçŽ°çš„ç‰¹å®šä»»åŠ¡ã€‚</p>
<p>çº¿ç¨‹ä»ç„¶æ˜¯å®žçŽ°å¿…é¡»å®žæ—¶è¿è¡Œçš„ä»£ç çš„å¥½æ–¹æ³•ã€‚è°ƒåº¦é˜Ÿåˆ—ä¼šå°½ä¸€åˆ‡åŠªåŠ›å°½å¯èƒ½å¿«åœ°è¿è¡Œå…¶ä»»åŠ¡ï¼Œä½†ä¸èƒ½è§£å†³å®žæ—¶çº¦æŸã€‚å¦‚æžœæ‚¨éœ€è¦ä»ŽåŽå°è¿è¡Œçš„ä»£ç ä¸­èŽ·å¾—æ›´å¤šå¯é¢„æµ‹çš„è¡Œä¸ºï¼Œåˆ™çº¿ç¨‹å¯èƒ½ä»ç„¶æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p>
<p>ä¸Žä»»ä½•çº¿ç¨‹ç¼–ç¨‹ä¸€æ ·ï¼Œæ‚¨åº”å§‹ç»ˆæ˜Žæ™ºåœ°ä½¿ç”¨çº¿ç¨‹ï¼Œå¹¶ä¸”ä»…åœ¨ç»å¯¹å¿…è¦æ—¶ä½¿ç”¨ã€‚æœ‰å…³çº¿ç¨‹åŒ…åŠå…¶ä½¿ç”¨æ–¹å¼çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ã€Š_<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/Introduction/Introduction.html#//apple_ref/doc/uid/10000057i">çº¿ç¨‹ç¼–ç¨‹æŒ‡å—ã€‹</a>_ã€‚</p>
<h2 id="æ“ä½œé˜Ÿåˆ—-1"><a href="#æ“ä½œé˜Ÿåˆ—-1" class="headerlink" title="æ“ä½œé˜Ÿåˆ—"></a>æ“ä½œé˜Ÿåˆ—</h2><p>å¯å¯æ“ä½œæ˜¯ä¸€ç§é¢å‘å¯¹è±¡çš„æ–¹æ³•ï¼Œç”¨äºŽå°è£…è¦å¼‚æ­¥æ‰§è¡Œçš„å·¥ä½œã€‚æ“ä½œè¢«è®¾è®¡ä¸ºä¸Žæ“ä½œé˜Ÿåˆ—ç»“åˆä½¿ç”¨æˆ–å•ç‹¬ä½¿ç”¨ã€‚ç”±äºŽå®ƒä»¬åŸºäºŽ Objective-Cï¼Œå› æ­¤åœ¨ OS X å’Œ iOS çš„åŸºäºŽ Cocoa çš„åº”ç”¨ç¨‹åºä¸­æœ€å¸¸ä½¿ç”¨æ“ä½œã€‚</p>
<p>æœ¬ç« ä»‹ç»å¦‚ä½•å®šä¹‰å’Œä½¿ç”¨æ“ä½œã€‚</p>
<h4 id="å…³äºŽæ“ä½œå¯¹è±¡"><a href="#å…³äºŽæ“ä½œå¯¹è±¡" class="headerlink" title="å…³äºŽæ“ä½œå¯¹è±¡"></a>å…³äºŽæ“ä½œå¯¹è±¡</h4><p>çš„<em>æ“ä½œå¯¹è±¡</em>æ˜¯çš„å®žä¾‹<code>NSOperation</code>ç±»ï¼ˆFoundation æ¡†æž¶ï¼‰ï¼Œæ‚¨ä½¿ç”¨æ‚¨å¸Œæœ›æ‚¨çš„åº”ç”¨ç¨‹åºæ‰§è¡Œå°è£…å·¥ä½œã€‚åœ¨<code>NSOperation</code>ç±»æœ¬èº«æ˜¯ä¸€ä¸ªæŠ½è±¡åŸºç±»ï¼Œå¿…é¡»æŒ‰é¡ºåºåšä»»ä½•æœ‰ç”¨çš„å·¥ä½œè¢«ç»§æ‰¿ã€‚å°½ç®¡æ˜¯æŠ½è±¡ç±»ï¼Œä½†æ­¤ç±»ç¡®å®žæä¾›äº†å¤§é‡çš„åŸºç¡€ç»“æž„ï¼Œä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘æ‚¨å¿…é¡»åœ¨è‡ªå·±çš„å­ç±»ä¸­å®Œæˆçš„å·¥ä½œé‡ã€‚å¦å¤–ï¼ŒFoundation æ¡†æž¶æä¾›äº†ä¸¤ä¸ªå…·ä½“çš„å­ç±»ï¼Œæ‚¨å¯ä»¥æŒ‰åŽŸæ ·ä½¿ç”¨çŽ°æœ‰ä»£ç ã€‚è¡¨ 2-1 åˆ—å‡ºäº†è¿™äº›ç±»ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨æ¯ç§ç±»çš„æ‘˜è¦ã€‚</p>
<table>
<thead>
<tr>
<th align="left">ç±»</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>NSInvocationOperation</code></td>
<td align="left">æ‚¨åŽŸæ ·ä½¿ç”¨çš„ç±»åŸºäºŽåº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡å’Œé€‰æ‹©å™¨åˆ›å»ºæ“ä½œå¯¹è±¡ã€‚å¦‚æžœæ‚¨å…·æœ‰å·²ç»æ‰§è¡Œæ‰€éœ€ä»»åŠ¡çš„çŽ°æœ‰æ–¹æ³•ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ­¤ç±»ã€‚ç”±äºŽä¸éœ€è¦å­ç±»ï¼Œå› æ­¤æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨æ­¤ç±»ä»¥æ›´åŠ¨æ€çš„æ–¹å¼åˆ›å»ºæ“ä½œå¯¹è±¡ã€‚æœ‰å…³å¦‚ä½•ä½¿ç”¨æ­¤ç±»çš„ä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationObjects/OperationObjects.html#//apple_ref/doc/uid/TP40008091-CH101-SW6">åˆ›å»º NSInvocationOperation å¯¹è±¡</a>ã€‚</td>
</tr>
<tr>
<td align="left"><code>NSBlockOperation</code></td>
<td align="left">æŒ‰åŽŸæ ·ä½¿ç”¨çš„ç±»å¯åŒæ—¶æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªå—å¯¹è±¡ã€‚å› ä¸ºå¯ä»¥æ‰§è¡Œå¤šä¸ªå—ï¼Œæ‰€ä»¥å—æ“ä½œå¯¹è±¡ä½¿ç”¨ç»„è¯­ä¹‰è¿›è¡Œæ“ä½œï¼›ä»…å½“æ‰€æœ‰ç›¸å…³å—å·²å®Œæˆæ‰§è¡Œæ—¶ï¼Œæ“ä½œæœ¬èº«æ‰è§†ä¸ºå®Œæˆã€‚æœ‰å…³å¦‚ä½•ä½¿ç”¨æ­¤ç±»çš„ä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationObjects/OperationObjects.html#//apple_ref/doc/uid/TP40008091-CH101-SW2">åˆ›å»º NSBlockOperation å¯¹è±¡</a>ã€‚æ­¤ç±»åœ¨ OS X v10.6 å’Œæ›´é«˜ç‰ˆæœ¬ä¸­å¯ç”¨ã€‚æœ‰å…³å—çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§*<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Blocks/Articles/00_Introduction.html#//apple_ref/doc/uid/TP40007502">å—ç¼–ç¨‹ä¸»é¢˜</a>*ã€‚</td>
</tr>
<tr>
<td align="left"><code>NSOperation</code></td>
<td align="left">å®šä¹‰è‡ªå®šä¹‰æ“ä½œå¯¹è±¡çš„åŸºç±»ã€‚å­ç±»åŒ–<code>NSOperation</code>ä½¿æ‚¨å¯ä»¥å®Œå…¨æŽ§åˆ¶è‡ªå·±çš„æ“ä½œçš„å®žçŽ°ï¼ŒåŒ…æ‹¬æ›´æ”¹æ“ä½œæ‰§è¡Œå’ŒæŠ¥å‘Šå…¶çŠ¶æ€çš„é»˜è®¤æ–¹å¼çš„èƒ½åŠ›ã€‚æœ‰å…³å¦‚ä½•å®šä¹‰è‡ªå®šä¹‰æ“ä½œå¯¹è±¡çš„ä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationObjects/OperationObjects.html#//apple_ref/doc/uid/TP40008091-CH101-SW16">å®šä¹‰è‡ªå®šä¹‰æ“ä½œå¯¹è±¡</a>ã€‚</td>
</tr>
</tbody></table>
<p>æ‰€æœ‰æ“ä½œå¯¹è±¡éƒ½æ”¯æŒä»¥ä¸‹å…³é”®åŠŸèƒ½ï¼š</p>
<ul>
<li>æ”¯æŒåœ¨æ“ä½œå¯¹è±¡ä¹‹é—´å»ºç«‹åŸºäºŽå›¾çš„ä¾èµ–å…³ç³»ã€‚è¿™äº›ä¾èµ–å…³ç³»ä¼šé˜»æ­¢ç»™å®šæ“ä½œè¿è¡Œï¼Œç›´åˆ°å®ƒæ‰€ä¾èµ–çš„æ‰€æœ‰æ“ä½œéƒ½å·²è¿è¡Œå®Œæ¯•ã€‚æœ‰å…³å¦‚ä½•é…ç½®ä¾èµ–å…³ç³»çš„ä¿¡æ¯ï¼Œè¯·å‚é˜…ã€Š<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationObjects/OperationObjects.html#//apple_ref/doc/uid/TP40008091-CH101-SW17">é…ç½®äº’æ“ä½œä¾èµ–å…³ç³»ã€‹</a>ã€‚</li>
<li>æ”¯æŒå¯é€‰çš„å®Œæˆå—ï¼Œè¯¥å—åœ¨æ“ä½œçš„ä¸»è¦ä»»åŠ¡å®ŒæˆåŽæ‰§è¡Œã€‚ï¼ˆä»…é€‚ç”¨äºŽ OS X v10.6 å’Œæ›´é«˜ç‰ˆæœ¬ã€‚ï¼‰æœ‰å…³å¦‚ä½•è®¾ç½®å®Œæˆå—çš„ä¿¡æ¯ï¼Œè¯·å‚é˜…ã€Š<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationObjects/OperationObjects.html#//apple_ref/doc/uid/TP40008091-CH101-SW33">è®¾ç½®å®Œæˆå—ã€‹</a>ã€‚</li>
<li>æ”¯æŒä½¿ç”¨ KVO é€šçŸ¥ç›‘è§†å¯¹æ“ä½œçš„æ‰§è¡ŒçŠ¶æ€çš„æ›´æ”¹ã€‚æœ‰å…³å¦‚ä½•è§‚å¯Ÿ KVO é€šçŸ¥çš„ä¿¡æ¯ï¼Œè¯·å‚é˜…ã€Š_<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/KeyValueObserving/KeyValueObserving.html#//apple_ref/doc/uid/10000177i">é”®å€¼è§‚å¯Ÿç¼–ç¨‹æŒ‡å—ã€‹</a>_ã€‚</li>
<li>æ”¯æŒå¯¹æ“ä½œè¿›è¡Œä¼˜å…ˆçº§æŽ’åºï¼Œä»Žè€Œå½±å“å…¶ç›¸å¯¹æ‰§è¡Œé¡ºåºã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationObjects/OperationObjects.html#//apple_ref/doc/uid/TP40008091-CH101-SW31">æ›´æ”¹æ“ä½œçš„æ‰§è¡Œä¼˜å…ˆçº§</a>ã€‚</li>
<li>æ”¯æŒå–æ¶ˆè¯­ä¹‰ï¼Œä½¿æ‚¨å¯ä»¥åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æš‚åœæ“ä½œã€‚æœ‰å…³å¦‚ä½•å–æ¶ˆæ“ä½œçš„ä¿¡æ¯ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationObjects/OperationObjects.html#//apple_ref/doc/uid/TP40008091-CH101-SW39">å–æ¶ˆæ“ä½œ</a>ã€‚æœ‰å…³å¦‚ä½•åœ¨è‡ªå·±çš„æ“ä½œä¸­æ”¯æŒå–æ¶ˆçš„ä¿¡æ¯ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationObjects/OperationObjects.html#//apple_ref/doc/uid/TP40008091-CH101-SW24">å“åº”å–æ¶ˆäº‹ä»¶</a>ã€‚</li>
</ul>
<p>æ“ä½œæ—¨åœ¨å¸®åŠ©æ‚¨æé«˜åº”ç”¨ç¨‹åºä¸­çš„å¹¶å‘çº§åˆ«ã€‚æ“ä½œä¹Ÿæ˜¯å°†åº”ç”¨ç¨‹åºçš„è¡Œä¸ºç»„ç»‡å’Œå°è£…ä¸ºç®€å•çš„ç¦»æ•£å—çš„å¥½æ–¹æ³•ã€‚æ‚¨å¯ä»¥åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­æäº¤ä¸€ä¸ªæˆ–å¤šä¸ªæ“ä½œå¯¹è±¡ï¼Œè€Œä¸æ˜¯åœ¨åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ä¸Šè¿è¡Œä¸€äº›ä»£ç ï¼Œè€Œå¯ä»¥åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸Šå¼‚æ­¥æ‰§è¡Œç›¸åº”çš„å·¥ä½œã€‚</p>
<h4 id="å¹¶è¡Œä¸Žéžå¹¶è¡Œæ“ä½œ"><a href="#å¹¶è¡Œä¸Žéžå¹¶è¡Œæ“ä½œ" class="headerlink" title="å¹¶è¡Œä¸Žéžå¹¶è¡Œæ“ä½œ"></a>å¹¶è¡Œä¸Žéžå¹¶è¡Œæ“ä½œ</h4><p>å°½ç®¡é€šå¸¸é€šè¿‡å°†æ“ä½œæ·»åŠ åˆ°æ“ä½œé˜Ÿåˆ—æ¥æ‰§è¡Œæ“ä½œï¼Œä½†è¿™ä¸æ˜¯å¿…éœ€çš„ã€‚ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨æ“ä½œå¯¹è±¡çš„<code>start</code>æ–¹æ³•æ¥æ‰‹åŠ¨æ‰§è¡Œæ“ä½œå¯¹è±¡ï¼Œä½†è¿™æ ·åšä¸èƒ½ä¿è¯æ“ä½œä¸Žä»£ç çš„å…¶ä½™éƒ¨åˆ†åŒæ—¶è¿è¡Œã€‚è¯¥ç±»çš„<code>isConcurrent</code>æ–¹æ³•<code>NSOperation</code>å‘Šè¯‰æ‚¨æ“ä½œç›¸å¯¹äºŽ<code>start</code>è°ƒç”¨å…¶æ–¹æ³•çš„çº¿ç¨‹æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥è¿è¡Œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤æ–¹æ³•è¿”å›ž<code>NO</code>ï¼Œè¿™æ„å‘³ç€è¯¥æ“ä½œåœ¨è°ƒç”¨çº¿ç¨‹ä¸­åŒæ­¥è¿è¡Œã€‚</p>
<p>å¦‚æžœè¦å®žçŽ°<em>å¹¶å‘æ“ä½œï¼ˆ</em>å³ç›¸å¯¹äºŽè°ƒç”¨çº¿ç¨‹å¼‚æ­¥è¿è¡Œçš„<em>æ“ä½œ</em>ï¼‰ï¼Œåˆ™å¿…é¡»ç¼–å†™å…¶ä»–ä»£ç ä»¥å¼‚æ­¥å¯åŠ¨æ“ä½œã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ç”Ÿæˆå•ç‹¬çš„çº¿ç¨‹ï¼Œè°ƒç”¨å¼‚æ­¥ç³»ç»Ÿå‡½æ•°æˆ–æ‰§è¡Œä»»ä½•å…¶ä»–æ“ä½œä»¥ç¡®ä¿è¯¥<code>start</code>æ–¹æ³•å¯åŠ¨ä»»åŠ¡å¹¶ç«‹å³è¿”å›žï¼Œå¹¶ä¸”å¾ˆå¯èƒ½åœ¨ä»»åŠ¡å®Œæˆä¹‹å‰è¿”å›žã€‚</p>
<p>å¤§å¤šæ•°å¼€å‘äººå‘˜æ°¸è¿œéƒ½ä¸éœ€è¦å®žçŽ°å¹¶å‘æ“ä½œå¯¹è±¡ã€‚å¦‚æžœå§‹ç»ˆå°†æ“ä½œæ·»åŠ åˆ°æ“ä½œé˜Ÿåˆ—ä¸­ï¼Œåˆ™æ— éœ€å®žçŽ°å¹¶å‘æ“ä½œã€‚å½“æ‚¨å°†éžå¹¶è¡Œæ“ä½œæäº¤ç»™æ“ä½œé˜Ÿåˆ—æ—¶ï¼Œé˜Ÿåˆ—æœ¬èº«ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥åœ¨å…¶ä¸Šè¿è¡Œæ‚¨çš„æ“ä½œã€‚å› æ­¤ï¼Œå‘æ“ä½œé˜Ÿåˆ—ä¸­æ·»åŠ éžå¹¶å‘æ“ä½œä»ç„¶ä¼šå¯¼è‡´æ“ä½œç›®æ ‡ä»£ç çš„å¼‚æ­¥æ‰§è¡Œã€‚ä»…åœ¨éœ€è¦å¼‚æ­¥æ‰§è¡Œæ“ä½œè€Œä¸å°†å…¶æ·»åŠ åˆ°æ“ä½œé˜Ÿåˆ—çš„æƒ…å†µä¸‹ï¼Œæ‰éœ€è¦å®šä¹‰å¹¶å‘æ“ä½œçš„åŠŸèƒ½ã€‚</p>
<p>æœ‰å…³å¦‚ä½•åˆ›å»ºå¹¶å‘æ“ä½œçš„ä¿¡æ¯ï¼Œè¯·å‚é˜…ã€Š<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationObjects/OperationObjects.html#//apple_ref/doc/uid/TP40008091-CH101-SW8">é…ç½®</a>å¹¶å‘æ“ä½œå’Œ*<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/foundation/nsoperation">NSOperation ç±»å‚è€ƒã€‹</a>*ã€‚</p>
<h4 id="åˆ›å»ºä¸€ä¸ª-NSInvocationOperation-å¯¹è±¡"><a href="#åˆ›å»ºä¸€ä¸ª-NSInvocationOperation-å¯¹è±¡" class="headerlink" title="åˆ›å»ºä¸€ä¸ª NSInvocationOperation å¯¹è±¡"></a>åˆ›å»ºä¸€ä¸ª NSInvocationOperation å¯¹è±¡</h4><p>è¯¥<code>NSInvocationOperation</code>ç­æ˜¯ä¸€ä¸ªå…·ä½“å­ç±»<code>NSOperation</code>æ˜¯åœ¨è¿è¡Œæ—¶è°ƒç”¨é€‰æ‹©ä½ æŒ‡å®šçš„å¯¹è±¡ä¸Šæ³¨æ˜Žã€‚ä½¿ç”¨æ­¤ç±»å¯é¿å…ä¸ºåº”ç”¨ç¨‹åºä¸­çš„æ¯ä¸ªä»»åŠ¡å®šä¹‰å¤§é‡çš„è‡ªå®šä¹‰æ“ä½œå¯¹è±¡ï¼›ç‰¹åˆ«æ˜¯å¦‚æžœæ‚¨æ­£åœ¨ä¿®æ”¹çŽ°æœ‰åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”å·²ç»å…·æœ‰æ‰§è¡Œå¿…è¦ä»»åŠ¡æ‰€éœ€çš„å¯¹è±¡å’Œæ–¹æ³•ã€‚å½“æ‚¨è¦è°ƒç”¨çš„æ–¹æ³•å¯ä»¥æ ¹æ®æƒ…å†µæ”¹å˜æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è°ƒç”¨æ“ä½œæ¥æ‰§è¡Œæ ¹æ®ç”¨æˆ·è¾“å…¥åŠ¨æ€é€‰æ‹©çš„é€‰æ‹©å™¨ã€‚</p>
<p>åˆ›å»ºè°ƒç”¨æ“ä½œçš„è¿‡ç¨‹å¾ˆç®€å•ã€‚æ‚¨åˆ›å»ºå¹¶åˆå§‹åŒ–è¯¥ç±»çš„æ–°å®žä¾‹ï¼Œå¹¶å°†æ‰€éœ€çš„å¯¹è±¡å’Œé€‰æ‹©å™¨ä¼ é€’ç»™åˆå§‹åŒ–æ–¹æ³•ã€‚æ¸…å• 2-1 æ˜¾ç¤ºäº†æ¥è‡ªè‡ªå®šä¹‰ç±»çš„ä¸¤ç§æ–¹æ³•ï¼Œå®ƒä»¬æ¼”ç¤ºäº†åˆ›å»ºè¿‡ç¨‹ã€‚è¯¥<code>taskWithData:</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„è°ƒç”¨å¯¹è±¡ï¼Œå¹¶ä¸ºå…¶æä¾›å¦ä¸€ä¸ªæ–¹æ³•çš„åç§°ï¼Œè¯¥åç§°åŒ…å«ä»»åŠ¡å®žçŽ°ã€‚</p>
<p><strong>æ¸…å• 2-1</strong> åˆ›å»ºä¸€ä¸ª<code>NSInvocationOperation</code>å¯¹è±¡</p>
<table>
<thead>
<tr>
<th><code>@implementation MyCustomClass</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>-ï¼ˆNSOperation *ï¼‰taskWithDataï¼šï¼ˆidï¼‰data {</code></td>
</tr>
<tr>
<td><code>NSInvocationOperation * theOp = [[NSInvocationOperation alloc] initWithTargetï¼šself</code></td>
</tr>
<tr>
<td><code>é€‰æ‹©å™¨ï¼š@é€‰æ‹©å™¨ï¼ˆmyTaskMethod :)å¯¹è±¡ï¼šæ•°æ®];</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>è¿”å›žtheOp;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//è¿™æ˜¯æ‰§è¡Œä»»åŠ¡å®žé™…å·¥ä½œçš„æ–¹æ³•ã€‚</code></td>
</tr>
<tr>
<td><code>-ï¼ˆvoidï¼‰myTaskMethodï¼šï¼ˆidï¼‰data {</code></td>
</tr>
<tr>
<td><code>//æ‰§è¡Œä»»åŠ¡ã€‚</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>@ç»“æŸ</code></td>
</tr>
</tbody></table>
<h4 id="åˆ›å»ºä¸€ä¸ª-NSBlockOperation-å¯¹è±¡"><a href="#åˆ›å»ºä¸€ä¸ª-NSBlockOperation-å¯¹è±¡" class="headerlink" title="åˆ›å»ºä¸€ä¸ª NSBlockOperation å¯¹è±¡"></a>åˆ›å»ºä¸€ä¸ª NSBlockOperation å¯¹è±¡</h4><p>çš„<code>NSBlockOperation</code>ç±»æ˜¯çš„å…·ä½“å­ç±»<code>NSOperation</code>å……å½“ç”¨äºŽä¸€ä¸ªæˆ–å¤šä¸ªçš„åŒ…è£…å—çš„å¯¹è±¡ã€‚æ­¤ç±»ä¸ºå·²ç»åœ¨ä½¿ç”¨æ“ä½œé˜Ÿåˆ—å¹¶ä¸”ä¸æƒ³åˆ›å»ºè°ƒåº¦é˜Ÿåˆ—çš„åº”ç”¨ç¨‹åºæä¾›é¢å‘å¯¹è±¡çš„åŒ…è£…ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨å—æ“ä½œæ¥åˆ©ç”¨æ“ä½œä¾èµ–æ€§ï¼ŒKVO é€šçŸ¥å’Œåˆ†æ´¾é˜Ÿåˆ—å¯èƒ½ä¸æä¾›çš„å…¶ä»–åŠŸèƒ½ã€‚</p>
<p>åˆ›å»ºå—æ“ä½œæ—¶ï¼Œé€šå¸¸åœ¨åˆå§‹åŒ–æ—¶è‡³å°‘æ·»åŠ ä¸€ä¸ªå—ã€‚æ‚¨å¯ä»¥ç¨åŽæ ¹æ®éœ€è¦æ·»åŠ æ›´å¤šå—ã€‚å½“éœ€è¦æ‰§è¡Œä¸€ä¸ª<code>NSBlockOperation</code>å¯¹è±¡æ—¶ï¼Œè¯¥å¯¹è±¡å°†å…¶æ‰€æœ‰å—æäº¤ç»™é»˜è®¤ä¼˜å…ˆçº§çš„å¹¶å‘è°ƒåº¦é˜Ÿåˆ—ã€‚ç„¶åŽï¼Œå¯¹è±¡ç­‰å¾…ç›´åˆ°æ‰€æœ‰å—å®Œæˆæ‰§è¡Œã€‚å½“æœ€åŽä¸€ä¸ªå—å®Œæˆæ‰§è¡Œæ—¶ï¼Œæ“ä½œå¯¹è±¡å°†è‡ªèº«æ ‡è®°ä¸ºå®Œæˆã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å—æ“ä½œæ¥è·Ÿè¸ªä¸€ç»„æ­£åœ¨æ‰§è¡Œçš„å—ï¼Œå°±åƒä½¿ç”¨çº¿ç¨‹è”æŽ¥åˆå¹¶æ¥è‡ªå¤šä¸ªçº¿ç¨‹çš„ç»“æžœä¸€æ ·ã€‚åŒºåˆ«åœ¨äºŽï¼Œç”±äºŽå—æ“ä½œæœ¬èº«åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸Šè¿è¡Œï¼Œå› æ­¤åº”ç”¨ç¨‹åºçš„å…¶ä»–çº¿ç¨‹å¯ä»¥åœ¨ç­‰å¾…å—æ“ä½œå®Œæˆçš„åŒæ—¶ç»§ç»­è¿›è¡Œå·¥ä½œã€‚</p>
<p>æ¸…å• 2-2 æ˜¾ç¤ºäº†å¦‚ä½•åˆ›å»º<code>NSBlockOperation</code>å¯¹è±¡çš„ç®€å•ç¤ºä¾‹ã€‚è¯¥å—æœ¬èº«æ²¡æœ‰å‚æ•°ï¼Œä¹Ÿæ²¡æœ‰æ˜Žæ˜¾çš„è¿”å›žç»“æžœã€‚</p>
<p><strong>æ¸…å• 2-2</strong> åˆ›å»ºä¸€ä¸ª<code>NSBlockOperation</code>å¯¹è±¡</p>
<table>
<thead>
<tr>
<th><code>NSBlockOperation * theOp = [NSBlockOperation blockOperationWithBlockï¼š^ {</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>NSLogï¼ˆ@â€œå¼€å§‹æ“ä½œã€‚\ nâ€ï¼‰;</code></td>
</tr>
<tr>
<td><code>// åšä¸€äº›å·¥ä½œã€‚</code></td>
</tr>
<tr>
<td><code>}];</code></td>
</tr>
</tbody></table>
<p>åˆ›å»ºå—æ“ä½œå¯¹è±¡åŽï¼Œå¯ä»¥ä½¿ç”¨è¯¥<code>addExecutionBlock:</code>æ–¹æ³•å‘å…¶æ·»åŠ æ›´å¤šå—ã€‚å¦‚æžœéœ€è¦é¡ºåºæ‰§è¡Œå—ï¼Œåˆ™å¿…é¡»å°†å®ƒä»¬ç›´æŽ¥æäº¤ç»™æ‰€éœ€çš„è°ƒåº¦é˜Ÿåˆ—ã€‚</p>
<h4 id="å®šä¹‰è‡ªå®šä¹‰æ“ä½œå¯¹è±¡"><a href="#å®šä¹‰è‡ªå®šä¹‰æ“ä½œå¯¹è±¡" class="headerlink" title="å®šä¹‰è‡ªå®šä¹‰æ“ä½œå¯¹è±¡"></a>å®šä¹‰è‡ªå®šä¹‰æ“ä½œå¯¹è±¡</h4><p>å¦‚æžœå—æ“ä½œå’Œè°ƒç”¨æ“ä½œå¯¹è±¡ä¸èƒ½å®Œå…¨æ»¡è¶³åº”ç”¨ç¨‹åºçš„éœ€æ±‚ï¼Œåˆ™å¯ä»¥<code>NSOperation</code>ç›´æŽ¥å­ç±»åŒ–å¹¶æ·»åŠ æ‰€éœ€çš„ä»»ä½•è¡Œä¸ºã€‚æœ¬<code>NSOperation</code>ç±»æä¾›çš„æ‰€æœ‰æ“ä½œå¯¹è±¡çš„é€šç”¨å­ç±»ç‚¹ã€‚è¯¥ç±»è¿˜æä¾›äº†å¤§é‡çš„åŸºç¡€ç»“æž„æ¥å¤„ç†ä¾èµ–é¡¹å’Œ KVO é€šçŸ¥æ‰€éœ€çš„å¤§éƒ¨åˆ†å·¥ä½œã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶ä»ç„¶éœ€è¦è¡¥å……çŽ°æœ‰çš„åŸºç¡€æž¶æž„ä»¥ç¡®ä¿æ‚¨çš„æ“ä½œæ­£å¸¸è¿›è¡Œã€‚æ‚¨å¿…é¡»æ‰§è¡Œçš„é¢å¤–å·¥ä½œé‡å–å†³äºŽæ‚¨è¦å®žçŽ°çš„æ˜¯éžå¹¶å‘æ“ä½œè¿˜æ˜¯å¹¶å‘æ“ä½œã€‚</p>
<p>å®šä¹‰éžå¹¶å‘æ“ä½œæ¯”å®šä¹‰å¹¶å‘æ“ä½œè¦ç®€å•å¾—å¤šã€‚å¯¹äºŽéžå¹¶è¡Œæ“ä½œï¼Œæ‚¨æ‰€éœ€è¦åšçš„å°±æ˜¯æ‰§è¡Œä¸»è¦ä»»åŠ¡å¹¶é€‚å½“åœ°å“åº”å–æ¶ˆäº‹ä»¶ï¼›çŽ°æœ‰çš„ç­çº§åŸºç¡€æž¶æž„ä¼šä¸ºæ‚¨å®Œæˆæ‰€æœ‰å…¶ä»–å·¥ä½œã€‚å¯¹äºŽå¹¶å‘æ“ä½œï¼Œå¿…é¡»ç”¨è‡ªå®šä¹‰ä»£ç æ›¿æ¢ä¸€äº›çŽ°æœ‰çš„åŸºç¡€ç»“æž„ã€‚ä»¥ä¸‹å„èŠ‚å‘æ‚¨å±•ç¤ºå¦‚ä½•å®žçŽ°ä¸¤ç§ç±»åž‹çš„å¯¹è±¡ã€‚</p>
<h6 id="æ‰§è¡Œä¸»è¦ä»»åŠ¡"><a href="#æ‰§è¡Œä¸»è¦ä»»åŠ¡" class="headerlink" title="æ‰§è¡Œä¸»è¦ä»»åŠ¡"></a>æ‰§è¡Œä¸»è¦ä»»åŠ¡</h6><p>æ¯ä¸ªæ“ä½œå¯¹è±¡è‡³å°‘åº”å®žçŽ°è‡³å°‘ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<ul>
<li>è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•</li>
<li><code>main</code></li>
</ul>
<p>æ‚¨éœ€è¦ä¸€ä¸ªè‡ªå®šä¹‰çš„åˆå§‹åŒ–æ–¹æ³•æ¥å°†æ“ä½œå¯¹è±¡ç½®äºŽå·²çŸ¥çŠ¶æ€ï¼Œå¹¶éœ€è¦ä¸€ä¸ªè‡ªå®šä¹‰çš„<code>main</code>æ–¹æ³•æ¥æ‰§è¡Œä»»åŠ¡ã€‚å½“ç„¶ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦å®žçŽ°å…¶ä»–æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>æ‚¨è®¡åˆ’ä»Ž<code>main</code>æ–¹æ³•çš„å®žçŽ°ä¸­è°ƒç”¨çš„è‡ªå®šä¹‰æ–¹æ³•</li>
<li>ç”¨äºŽè®¾ç½®æ•°æ®å€¼å’Œè®¿é—®æ“ä½œç»“æžœçš„è®¿é—®å™¨æ–¹æ³•</li>
<li><code>NSCoding</code>å…è®¸æ‚¨å½’æ¡£å’Œå–æ¶ˆå½’æ¡£æ“ä½œå¯¹è±¡çš„åè®®æ–¹æ³•</li>
</ul>
<p>æ¸…å• 2-3 æ˜¾ç¤ºäº†è‡ªå®šä¹‰<code>NSOperation</code>å­ç±»çš„èµ·å§‹æ¨¡æ¿ã€‚ï¼ˆæ­¤æ¸…å•æœªæ˜¾ç¤ºå¦‚ä½•å¤„ç†å–æ¶ˆï¼Œä½†æ˜¾ç¤ºäº†é€šå¸¸å…·æœ‰çš„æ–¹æ³•ã€‚æœ‰å…³å¤„ç†å–æ¶ˆçš„ä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationObjects/OperationObjects.html#//apple_ref/doc/uid/TP40008091-CH101-SW24">å“åº”å–æ¶ˆäº‹ä»¶</a>ã€‚ï¼‰æ­¤ç±»çš„åˆå§‹åŒ–æ–¹æ³•å°†å•ä¸ªå¯¹è±¡ä½œä¸ºæ•°æ®å‚æ•°å¹¶å­˜å‚¨ä¸€ä¸ªå¯¹è±¡ã€‚åœ¨æ“ä½œå¯¹è±¡å†…éƒ¨å¯¹å…¶çš„å¼•ç”¨ã€‚è¯¥<code>main</code>æ–¹æ³•è¡¨é¢ä¸Šå°†å¯¹è¯¥æ•°æ®å¯¹è±¡èµ·ä½œç”¨ï¼Œç„¶åŽå†å°†ç»“æžœè¿”å›žç»™æ‚¨çš„åº”ç”¨ç¨‹åºã€‚</p>
<p><strong>æ¸…å• 2-3</strong> å®šä¹‰ä¸€ä¸ªç®€å•çš„æ“ä½œå¯¹è±¡</p>
<table>
<thead>
<tr>
<th><code>@interface MyNonConcurrentOperationï¼šNSOperation</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>@property idï¼ˆstrongï¼‰myData;</code></td>
</tr>
<tr>
<td><code>-ï¼ˆidï¼‰initWithDataï¼šï¼ˆidï¼‰æ•°æ®;</code></td>
</tr>
<tr>
<td><code>@ç»“æŸ</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>@implementation MyNonConcurrentOperation</code></td>
</tr>
<tr>
<td><code>-ï¼ˆidï¼‰initWithDataï¼šï¼ˆidï¼‰data {</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆè‡ªæˆ‘= [è¶…çº§åˆå§‹åŒ–]ï¼‰</code></td>
</tr>
<tr>
<td><code>myData =æ•°æ®ï¼›</code></td>
</tr>
<tr>
<td><code>è¿”å›žè‡ªæˆ‘</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>-ï¼ˆvoidï¼‰main {</code></td>
</tr>
<tr>
<td><code>@å°è¯•{</code></td>
</tr>
<tr>
<td><code>//å¯¹myDataåšä¸€äº›å·¥ä½œå¹¶æŠ¥å‘Šç»“æžœã€‚</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>@catchï¼ˆ...ï¼‰{</code></td>
</tr>
<tr>
<td><code>//ä¸è¦æŠ›å‡ºå¼‚å¸¸ã€‚</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>@ç»“æŸ</code></td>
</tr>
<tr>
<td>``</td>
</tr>
</tbody></table>
<p>æœ‰å…³å¦‚ä½•å®žçŽ°<code>NSOperation</code>å­ç±»çš„è¯¦ç»†ç¤ºä¾‹ï¼Œè¯·å‚è§*<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/samplecode/NSOperationSample/Introduction/Intro.html#//apple_ref/doc/uid/DTS10004184">NSOperationSample</a>*ã€‚</p>
<h6 id="å“åº”å–æ¶ˆäº‹ä»¶"><a href="#å“åº”å–æ¶ˆäº‹ä»¶" class="headerlink" title="å“åº”å–æ¶ˆäº‹ä»¶"></a>å“åº”å–æ¶ˆäº‹ä»¶</h6><p>æ“ä½œå¼€å§‹æ‰§è¡ŒåŽï¼Œå®ƒå°†ç»§ç»­æ‰§è¡Œå…¶ä»»åŠ¡ï¼Œç›´åˆ°å®Œæˆä¸ºæ­¢ï¼Œæˆ–è€…ç›´åˆ°æ‚¨çš„ä»£ç æ˜Žç¡®å–æ¶ˆäº†è¯¥æ“ä½œã€‚å–æ¶ˆå¯ä»¥éšæ—¶å‘ç”Ÿï¼Œç”šè‡³åœ¨æ“ä½œå¼€å§‹æ‰§è¡Œä¹‹å‰ã€‚å°½ç®¡<code>NSOperation</code>è¯¥ç±»ä¸ºå®¢æˆ·æä¾›äº†å–æ¶ˆæ“ä½œçš„æ–¹æ³•ï¼Œä½†æ˜¯è¯†åˆ«å–æ¶ˆäº‹ä»¶æ˜¯å¿…è¦çš„ï¼Œæ˜¯è‡ªæ„¿çš„ã€‚å¦‚æžœæ“ä½œè¢«å½»åº•ç»ˆæ­¢ï¼Œåˆ™å¯èƒ½æ²¡æœ‰åŠžæ³•å›žæ”¶å·²åˆ†é…çš„èµ„æºã€‚ç»“æžœï¼ŒæœŸæœ›æ“ä½œå¯¹è±¡æ£€æŸ¥å–æ¶ˆäº‹ä»¶ï¼Œå¹¶åœ¨å®ƒä»¬å‡ºçŽ°åœ¨æ“ä½œä¸­é—´æ—¶æ­£å¸¸é€€å‡ºã€‚</p>
<p>ä¸ºäº†æ”¯æŒå–æ¶ˆæ“ä½œå¯¹è±¡ä¸­çš„æ“ä½œï¼Œæ‚¨è¦åšçš„å°±æ˜¯<code>isCancelled</code>ä»Žæ‚¨çš„è‡ªå®šä¹‰ä»£ç ä¸­å®šæœŸè°ƒç”¨è¯¥å¯¹è±¡çš„æ–¹æ³•ï¼Œå¹¶åœ¨è¿”å›žæ—¶ç«‹å³è¿”å›ž<code>YES</code>ã€‚æ— è®ºæ“ä½œæ—¶é—´é•¿çŸ­ï¼Œæ˜¯<code>NSOperation</code>ç›´æŽ¥å­ç±»åŒ–è¿˜æ˜¯ä½¿ç”¨å…¶å…·ä½“å­ç±»ä¹‹ä¸€ï¼Œæ”¯æŒå–æ¶ˆéƒ½å¾ˆé‡è¦ã€‚è¯¥<code>isCancelled</code>æ–¹æ³•æœ¬èº«éžå¸¸è½»å·§ï¼Œå¯ä»¥é¢‘ç¹è°ƒç”¨è€Œä¸ä¼šé€ æˆä»»ä½•æ˜Žæ˜¾çš„æ€§èƒ½æŸå¤±ã€‚è®¾è®¡æ“ä½œå¯¹è±¡æ—¶ï¼Œåº”è€ƒè™‘<code>isCancelled</code>åœ¨ä»£ç çš„ä»¥ä¸‹ä½ç½®è°ƒç”¨è¯¥æ–¹æ³•ï¼š</p>
<ul>
<li>åœ¨æ‚¨æ‰§è¡Œä»»ä½•å®žé™…å·¥ä½œä¹‹å‰</li>
<li>åœ¨å¾ªçŽ¯çš„æ¯æ¬¡è¿­ä»£ä¸­è‡³å°‘ä¸€æ¬¡ï¼Œå¦‚æžœæ¯æ¬¡è¿­ä»£ç›¸å¯¹è¾ƒé•¿ï¼Œåˆ™æ›´é¢‘ç¹</li>
<li>åœ¨ä»£ç ä¸­çš„ä»»ä½•æ—¶å€™ï¼Œç›¸å¯¹å®¹æ˜“ä¸­æ­¢æ“ä½œ</li>
</ul>
<p>æ¸…å• 2-4 æä¾›äº†ä¸€ä¸ªéžå¸¸ç®€å•çš„ç¤ºä¾‹ï¼Œè¯´æ˜Žå¦‚ä½•ä»¥<code>main</code>æ“ä½œå¯¹è±¡çš„æ–¹æ³•å“åº”å–æ¶ˆäº‹ä»¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>isCancelled</code>æ¯æ¬¡é€šè¿‡<code>while</code>å¾ªçŽ¯éƒ½ä¼šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥åœ¨å·¥ä½œå¼€å§‹ä¹‹å‰å¿«é€Ÿé€€å‡ºï¼Œå¹¶æœ‰è§„å¾‹åœ°é—´éš”ä¸€æ¬¡ã€‚</p>
<p><strong>æ¸…å• 2-4</strong> å“åº”å–æ¶ˆè¯·æ±‚</p>
<table>
<thead>
<tr>
<th><code>-ï¼ˆvoidï¼‰main {</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>@å°è¯•{</code></td>
</tr>
<tr>
<td><code>BOOL isDone = NO;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>whileï¼ˆï¼[self isCancelled] &amp;&amp;ï¼isDoneï¼‰{</code></td>
</tr>
<tr>
<td><code>//åšä¸€äº›å·¥ä½œï¼Œå®ŒæˆåŽå°†isDoneè®¾ç½®ä¸ºYES</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>@catchï¼ˆ...ï¼‰{</code></td>
</tr>
<tr>
<td><code>//ä¸è¦æŠ›å‡ºå¼‚å¸¸ã€‚</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>å°½ç®¡å‰é¢çš„ç¤ºä¾‹ä¸åŒ…å«æ¸…é™¤ä»£ç ï¼Œä½†æ˜¯æ‚¨è‡ªå·±çš„ä»£ç åº”ç¡®ä¿é‡Šæ”¾æ‚¨çš„è‡ªå®šä¹‰ä»£ç åˆ†é…çš„æ‰€æœ‰èµ„æºã€‚</p>
<h6 id="é…ç½®å¹¶å‘æ‰§è¡Œæ“ä½œ"><a href="#é…ç½®å¹¶å‘æ‰§è¡Œæ“ä½œ" class="headerlink" title="é…ç½®å¹¶å‘æ‰§è¡Œæ“ä½œ"></a>é…ç½®å¹¶å‘æ‰§è¡Œæ“ä½œ</h6><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ“ä½œå¯¹è±¡ä»¥åŒæ­¥æ–¹å¼æ‰§è¡Œ-ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬åœ¨è°ƒç”¨å…¶<code>start</code>æ–¹æ³•çš„çº¿ç¨‹ä¸­æ‰§è¡Œå…¶ä»»åŠ¡ã€‚ä½†æ˜¯ï¼Œç”±äºŽæ“ä½œé˜Ÿåˆ—ä¸ºéžå¹¶å‘æ“ä½œæä¾›äº†çº¿ç¨‹ï¼Œå› æ­¤å¤§å¤šæ•°æ“ä½œä»ç„¶å¼‚æ­¥è¿è¡Œã€‚ä½†æ˜¯ï¼Œå¦‚æžœæ‚¨æ‰“ç®—æ‰‹åŠ¨æ‰§è¡Œæ“ä½œï¼Œä½†ä»å¸Œæœ›å®ƒä»¬å¼‚æ­¥è¿è¡Œï¼Œåˆ™å¿…é¡»é‡‡å–é€‚å½“çš„æŽªæ–½ä»¥ç¡®ä¿å®ƒä»¬èƒ½å¤Ÿæ‰§è¡Œã€‚é€šè¿‡å°†æ“ä½œå¯¹è±¡å®šä¹‰ä¸ºå¹¶å‘æ“ä½œæ¥æ‰§è¡Œæ­¤æ“ä½œã€‚</p>
<p>è¡¨ 2-2 åˆ—å‡ºäº†é€šå¸¸ä¸ºå®žçŽ°å¹¶å‘æ“ä½œè€Œé‡å†™çš„æ–¹æ³•ã€‚</p>
<table>
<thead>
<tr>
<th align="left">æ–¹æ³•</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>start</code></td>
<td align="left">ï¼ˆå¿…éœ€ï¼‰æ‰€æœ‰å¹¶å‘æ“ä½œéƒ½å¿…é¡»é‡å†™æ­¤æ–¹æ³•ï¼Œå¹¶ç”¨å…¶è‡ªå·±çš„è‡ªå®šä¹‰å®žçŽ°æ›¿æ¢é»˜è®¤è¡Œä¸ºã€‚è¦æ‰‹åŠ¨æ‰§è¡Œæ“ä½œï¼Œè¯·è°ƒç”¨å…¶<code>start</code>æ–¹æ³•ã€‚å› æ­¤ï¼Œæ­¤æ–¹æ³•çš„å®žçŽ°æ˜¯æ‚¨æ“ä½œçš„èµ·ç‚¹ï¼Œå¹¶ä¸”æ˜¯æ‚¨åœ¨å…¶ä¸­è®¾ç½®æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æˆ–å…¶ä»–æ‰§è¡ŒçŽ¯å¢ƒçš„åœ°æ–¹ã€‚æ‚¨çš„å®žçŽ°ä¸å¾—<code>super</code>åœ¨ä»»ä½•æ—¶å€™è°ƒç”¨ã€‚</td>
</tr>
<tr>
<td align="left"><code>main</code></td>
<td align="left">ï¼ˆå¯é€‰ï¼‰æ­¤æ–¹æ³•é€šå¸¸ç”¨äºŽå®žçŽ°ä¸Žæ“ä½œå¯¹è±¡å…³è”çš„ä»»åŠ¡ã€‚å°½ç®¡æ‚¨å¯ä»¥åœ¨<code>start</code>æ–¹æ³•ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œä½†æ˜¯ä½¿ç”¨æ­¤æ–¹æ³•å®žçŽ°ä»»åŠ¡å¯ä»¥ä½¿æ‚¨çš„è®¾ç½®å’Œä»»åŠ¡ä»£ç æ›´åŠ æ¸…æ™°ã€‚</td>
</tr>
<tr>
<td align="left"><code>isExecuting``isFinished</code></td>
<td align="left">ï¼ˆå¿…éœ€ï¼‰å¹¶å‘æ“ä½œè´Ÿè´£è®¾ç½®å…¶æ‰§è¡ŒçŽ¯å¢ƒï¼Œå¹¶å‘å¤–éƒ¨å®¢æˆ·ç«¯æŠ¥å‘Šè¯¥çŽ¯å¢ƒçš„çŠ¶æ€ã€‚å› æ­¤ï¼Œå¹¶å‘æ“ä½œå¿…é¡»ç»´æŠ¤ä¸€äº›çŠ¶æ€ä¿¡æ¯ï¼Œä»¥äº†è§£ä½•æ—¶æ‰§è¡Œä»»åŠ¡ä»¥åŠä½•æ—¶å®Œæˆè¯¥ä»»åŠ¡ã€‚ç„¶åŽï¼Œå¿…é¡»ä½¿ç”¨è¿™äº›æ–¹æ³•æŠ¥å‘Šè¯¥çŠ¶æ€ã€‚æ‚¨å¯ä»¥å®‰å…¨åœ°åŒæ—¶ä»Žå…¶ä»–çº¿ç¨‹è°ƒç”¨è¿™äº›æ–¹æ³•çš„å®žçŽ°ã€‚åœ¨æ›´æ”¹è¿™äº›æ–¹æ³•æŠ¥å‘Šçš„å€¼æ—¶ï¼Œè¿˜å¿…é¡»ä¸ºé¢„æœŸçš„é”®è·¯å¾„ç”Ÿæˆé€‚å½“çš„ KVO é€šçŸ¥ã€‚</td>
</tr>
<tr>
<td align="left"><code>isConcurrent</code></td>
<td align="left">ï¼ˆå¿…éœ€ï¼‰è¦å°†æ“ä½œæ ‡è¯†ä¸ºå¹¶å‘æ“ä½œï¼Œè¯·è¦†ç›–æ­¤æ–¹æ³•å¹¶è¿”å›ž<code>YES</code>ã€‚</td>
</tr>
</tbody></table>
<p>æœ¬èŠ‚çš„å…¶ä½™éƒ¨åˆ†æ˜¾ç¤ºäº†<code>MyOperation</code>è¯¥ç±»çš„ç¤ºä¾‹å®žçŽ°ï¼Œè¯¥ç¤ºä¾‹æ¼”ç¤ºäº†å®žçŽ°å¹¶å‘æ“ä½œæ‰€éœ€çš„åŸºæœ¬ä»£ç ã€‚å°†<code>MyOperation</code>ç±»ç®€å•åœ°æ‰§è¡Œå®ƒè‡ªå·±çš„<code>main</code>ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ–¹æ³•ï¼Œå®ƒåˆ›é€ ã€‚è¯¥<code>main</code>æ–¹æ³•æ‰§è¡Œçš„å®žé™…å·¥ä½œæ— å…³ç´§è¦ã€‚è¯¥ç¤ºä¾‹çš„é‡ç‚¹æ˜¯æ¼”ç¤ºå®šä¹‰å¹¶å‘æ“ä½œæ—¶éœ€è¦æä¾›çš„åŸºç¡€ç»“æž„ã€‚</p>
<p>æ¸…å• 2-5 æ˜¾ç¤ºäº†<code>MyOperation</code>è¯¥ç±»çš„æŽ¥å£å’Œéƒ¨åˆ†å®žçŽ°ã€‚çš„çš„å®žçŽ°<code>isConcurrent</code>ï¼Œ<code>isExecuting</code>å’Œ<code>isFinished</code>æ–¹æ³•çš„<code>MyOperation</code>ç±»æ˜¯ç›¸å¯¹ç®€å•çš„ã€‚è¯¥<code>isConcurrent</code>æ–¹æ³•åº”è¯¥ç®€å•åœ°è¿”å›ž<code>YES</code>ä»¥æŒ‡ç¤ºè¿™æ˜¯ä¸€ä¸ªå¹¶å‘æ“ä½œã€‚è¯¥<code>isExecuting</code>å’Œ<code>isFinished</code>æ–¹æ³•ç®€å•åœ°è¿”å›žä¿å­˜åœ¨ç±»æœ¬èº«çš„å®žä¾‹å˜é‡çš„å€¼ã€‚</p>
<p><strong>æ¸…å• 2-5</strong> å®šä¹‰å¹¶å‘æ“ä½œ</p>
<table>
<thead>
<tr>
<th><code>@interface MyOperationï¼šNSOperation {</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>å¸ƒå°”æ‰§è¡Œï¼›</code></td>
</tr>
<tr>
<td><code>BOOLå®Œæˆï¼›</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>-ï¼ˆvoidï¼‰completeOperationï¼›</code></td>
</tr>
<tr>
<td><code>@ç»“æŸ</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>@implementation MyOperation</code></td>
</tr>
<tr>
<td><code>-ï¼ˆidï¼‰init {</code></td>
</tr>
<tr>
<td><code>è‡ªæˆ‘= [è¶…çº§åˆå§‹åŒ–];</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆè‡ªå·±ï¼‰{</code></td>
</tr>
<tr>
<td><code>æ‰§è¡Œ=å¦;</code></td>
</tr>
<tr>
<td><code>å®Œæˆ=å¦ï¼›</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>è¿”å›žè‡ªæˆ‘</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>-ï¼ˆBOOLï¼‰æ˜¯å¹¶å‘{</code></td>
</tr>
<tr>
<td><code>è¿”å›žæ˜¯ï¼›</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>-ï¼ˆBOOLï¼‰æ­£åœ¨æ‰§è¡Œ{</code></td>
</tr>
<tr>
<td><code>è¿”å›žæ‰§è¡Œï¼›</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>-ï¼ˆBOOLï¼‰å·²å®Œæˆ{</code></td>
</tr>
<tr>
<td><code>è¿”å›žå®Œæˆï¼›</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>@ç»“æŸ</code></td>
</tr>
</tbody></table>
<p>æ¸…å• 2-6 æ˜¾ç¤ºäº†çš„<code>start</code>æ–¹æ³•<code>MyOperation</code>ã€‚æ­¤æ–¹æ³•çš„å®žçŽ°æ˜¯æœ€å°‘çš„ï¼Œä»¥ä¾¿æ¼”ç¤ºæ‚¨ç»å¯¹å¿…é¡»æ‰§è¡Œçš„ä»»åŠ¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥æ–¹æ³•ä»…å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹å¹¶å°†å…¶é…ç½®ä¸ºè°ƒç”¨è¯¥<code>main</code>æ–¹æ³•ã€‚è¯¥æ–¹æ³•è¿˜æ›´æ–°<code>executing</code>æˆå‘˜å˜é‡å¹¶ä¸º<code>isExecuting</code>é”®è·¯å¾„ç”Ÿæˆ KVO é€šçŸ¥ä»¥åæ˜ è¯¥å€¼çš„æ›´æ”¹ã€‚å®Œæˆå·¥ä½œåŽï¼Œæ­¤æ–¹æ³•å°†ç®€å•åœ°è¿”å›žï¼Œä¿ç•™æ–°åˆ†ç¦»çš„çº¿ç¨‹æ¥æ‰§è¡Œå®žé™…ä»»åŠ¡ã€‚</p>
<p><strong>æ¸…å• 2-6</strong> start æ–¹æ³•</p>
<table>
<thead>
<tr>
<th><code>-ï¼ˆvoidï¼‰å¼€å§‹{</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>//åœ¨å¯åŠ¨ä»»åŠ¡ä¹‹å‰ï¼Œè¯·åŠ¡å¿…æ£€æŸ¥æ˜¯å¦å–æ¶ˆã€‚</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆ[self isCancelled]ï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//å¦‚æžœå–æ¶ˆæ“ä½œï¼Œåˆ™å¿…é¡»å°†æ“ä½œç§»è‡³å®ŒæˆçŠ¶æ€ã€‚</code></td>
</tr>
<tr>
<td><code>[self willChangeValueForKeyï¼š@â€œ isFinishedâ€]ï¼›</code></td>
</tr>
<tr>
<td><code>å®Œæˆ=æ˜¯ï¼›</code></td>
</tr>
<tr>
<td><code>[self didChangeValueForKeyï¼š@â€œ isFinishedâ€]ï¼›</code></td>
</tr>
<tr>
<td><code>è¿”å›ž;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å¦‚æžœæœªå–æ¶ˆæ“ä½œï¼Œåˆ™å¼€å§‹æ‰§è¡Œä»»åŠ¡ã€‚</code></td>
</tr>
<tr>
<td><code>[self willChangeValueForKeyï¼š@â€œ isExecutingâ€];</code></td>
</tr>
<tr>
<td><code>[NSThread detachNewThreadSelectorï¼š@selectorï¼ˆmainï¼‰toTargetï¼šself withObjectï¼šnil];</code></td>
</tr>
<tr>
<td><code>æ‰§è¡Œ=æ˜¯;</code></td>
</tr>
<tr>
<td><code>[self didChangeValueForKeyï¼š@â€œ isExecutingâ€];</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>æ¸…å• 2-7 æ˜¾ç¤ºäº†<code>MyOperation</code>è¯¥ç±»çš„å…¶ä½™å®žçŽ°ã€‚å¦‚<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationObjects/OperationObjects.html#//apple_ref/doc/uid/TP40008091-CH101-SW11">æ¸…å• 2-6 æ‰€ç¤º</a>ï¼Œè¯¥<code>main</code>æ–¹æ³•æ˜¯æ–°çº¿ç¨‹çš„å…¥å£ç‚¹ã€‚å®ƒæ‰§è¡Œä¸Žæ“ä½œå¯¹è±¡å…³è”çš„å·¥ä½œï¼Œå¹¶åœ¨<code>completeOperation</code>æœ€ç»ˆå®Œæˆè¯¥å·¥ä½œæ—¶è°ƒç”¨è‡ªå®šä¹‰æ–¹æ³•ã€‚<code>completeOperation</code>ç„¶åŽï¼Œè¯¥æ–¹æ³•ä¸º<code>isExecuting</code>å’Œ<code>isFinished</code>è·¯å¾„ç”Ÿæˆæ‰€éœ€çš„ KVO é€šçŸ¥ï¼Œä»¥åæ˜ æ“ä½œçŠ¶æ€çš„å˜åŒ–ã€‚</p>
<p><strong>æ¸…å• 2-7</strong> åœ¨å®Œæˆæ—¶æ›´æ–°æ“ä½œ</p>
<table>
<thead>
<tr>
<th><code>-ï¼ˆvoidï¼‰main {</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>@å°è¯•{</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//åœ¨æ­¤æ‰§è¡Œæ“ä½œçš„ä¸»è¦å·¥ä½œã€‚</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>[è‡ªæˆ‘å®Œæˆæ“ä½œ];</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>@catchï¼ˆ...ï¼‰{</code></td>
</tr>
<tr>
<td><code>//ä¸è¦æŠ›å‡ºå¼‚å¸¸ã€‚</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>-ï¼ˆvoidï¼‰completeOperation {</code></td>
</tr>
<tr>
<td><code>[self willChangeValueForKeyï¼š@â€œ isFinishedâ€]ï¼›</code></td>
</tr>
<tr>
<td><code>[self willChangeValueForKeyï¼š@â€œ isExecutingâ€];</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>æ‰§è¡Œ=å¦;</code></td>
</tr>
<tr>
<td><code>å®Œæˆ=æ˜¯ï¼›</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>[self didChangeValueForKeyï¼š@â€œ isExecutingâ€];</code></td>
</tr>
<tr>
<td><code>[self didChangeValueForKeyï¼š@â€œ isFinishedâ€]ï¼›</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>å³ä½¿å–æ¶ˆäº†æ“ä½œï¼Œä¹Ÿåº”å§‹ç»ˆé€šçŸ¥ KVO è§‚å¯Ÿè€…æ‚¨çš„æ“ä½œçŽ°å·²å®Œæˆã€‚å½“ä¸€ä¸ªæ“ä½œå¯¹è±¡ä¾èµ–äºŽå…¶ä»–æ“ä½œå¯¹è±¡çš„å®Œæˆæ—¶ï¼Œå®ƒå°†ç›‘è§†<code>isFinished</code>é‚£äº›å¯¹è±¡çš„é”®è·¯å¾„ã€‚ä»…å½“æ‰€æœ‰å¯¹è±¡éƒ½æŠ¥å‘Šå®ƒä»¬å®Œæˆæ—¶ï¼Œç›¸å…³æ“ä½œæ‰ä¼šå‘å‡ºä¿¡å·ï¼Œè¡¨æ˜Žå®ƒå·²å‡†å¤‡å¥½è¿è¡Œã€‚å› æ­¤ï¼Œæ— æ³•ç”Ÿæˆå®Œæˆé€šçŸ¥å¯èƒ½ä¼šé˜»æ­¢åº”ç”¨ç¨‹åºä¸­å…¶ä»–æ“ä½œçš„æ‰§è¡Œã€‚</p>
<h6 id="ä¿æŒ-KVO-åˆè§„æ€§"><a href="#ä¿æŒ-KVO-åˆè§„æ€§" class="headerlink" title="ä¿æŒ KVO åˆè§„æ€§"></a>ä¿æŒ KVO åˆè§„æ€§</h6><p>çš„<code>NSOperation</code>ç±»æ˜¯é”®-å€¼è§‚å¯Ÿï¼ˆKVOï¼‰å…¼å®¹ä»¥ä¸‹å…³é”®è·¯å¾„ï¼š</p>
<ul>
<li><code>isCancelled</code></li>
<li><code>isConcurrent</code></li>
<li><code>isExecuting</code></li>
<li><code>isFinished</code></li>
<li><code>isReady</code></li>
<li><code>dependencies</code></li>
<li><code>queuePriority</code></li>
<li><code>completionBlock</code></li>
</ul>
<p>å¦‚æžœæ‚¨é‡å†™è¯¥<code>start</code>æ–¹æ³•æˆ–å¯¹<code>NSOperation</code>å¯¹è±¡è¿›è¡Œä»»ä½•é‡è¦çš„è‡ªå®šä¹‰ï¼ˆè€Œä¸æ˜¯ overrideï¼‰<code>main</code>ï¼Œåˆ™å¿…é¡»ç¡®ä¿æ‚¨çš„è‡ªå®šä¹‰å¯¹è±¡å¯¹è¿™äº›å…³é”®è·¯å¾„ä¿æŒ KVO å…¼å®¹ã€‚è¦†ç›–è¯¥<code>start</code>æ–¹æ³•æ—¶ï¼Œæ‚¨åº”è¯¥æœ€å…³æ³¨çš„å…³é”®è·¯å¾„æ˜¯<code>isExecuting</code>å’Œ<code>isFinished</code>ã€‚è¿™äº›æ˜¯é‡æ–°å®žçŽ°è¯¥æ–¹æ³•æœ€å¸¸å½±å“çš„å…³é”®è·¯å¾„ã€‚</p>
<p>å¦‚æžœè¦å®žçŽ°å¯¹é™¤å…¶ä»–æ“ä½œå¯¹è±¡ä¹‹å¤–çš„å…¶ä»–å¯¹è±¡çš„ä¾èµ–å…³ç³»çš„æ”¯æŒï¼Œåˆ™è¿˜å¯ä»¥é‡å†™è¯¥<code>isReady</code>æ–¹æ³•å¹¶å¼ºåˆ¶å…¶è¿”å›žï¼Œ<code>NO</code>ç›´åˆ°æ»¡è¶³æ‚¨çš„è‡ªå®šä¹‰ä¾èµ–å…³ç³»ä¸ºæ­¢ã€‚ï¼ˆå¦‚æžœå®žçŽ°è‡ªå®šä¹‰ä¾èµ–é¡¹ï¼Œåˆ™å¦‚æžœä»ç„¶æ”¯æŒè¯¥ç±»æä¾›çš„é»˜è®¤ä¾èµ–é¡¹ç®¡ç†ç³»ç»Ÿï¼Œè¯·ç¡®ä¿<code>super</code>ä»Ž<code>isReady</code>æ–¹æ³•ä¸­è°ƒç”¨<code>NSOperation</code>ã€‚ï¼‰å½“æ“ä½œå¯¹è±¡çš„å°±ç»ªçŠ¶æ€æ›´æ”¹æ—¶ï¼Œè¯·ä¸º<code>isReady</code>å…³é”®è·¯å¾„ç”Ÿæˆ KVO é€šçŸ¥ä»¥æŠ¥å‘Šè¿™äº›æ›´æ”¹ã€‚é™¤éžæ‚¨é‡å†™<code>addDependency:</code>or <code>removeDependency:</code>æ–¹æ³•ï¼Œå¦åˆ™æ‚¨ä¸å¿…æ‹…å¿ƒä¼šä¸º<code>dependencies</code>å¯†é’¥è·¯å¾„ç”Ÿæˆ KVO é€šçŸ¥ã€‚</p>
<p>å°½ç®¡æ‚¨å¯ä»¥ä¸ºçš„å…¶ä»–å…³é”®è·¯å¾„ç”Ÿæˆ KVO é€šçŸ¥<code>NSOperation</code>ï¼Œä½†æ‚¨ä¸å¤ªå¯èƒ½éœ€è¦è¿™æ ·åšã€‚å¦‚æžœæ‚¨éœ€è¦å–æ¶ˆæ“ä½œï¼Œåˆ™åªéœ€è°ƒç”¨çŽ°æœ‰<code>cancel</code>æ–¹æ³•å³å¯ã€‚åŒæ ·ï¼Œæ‚¨å‡ ä¹Žä¸éœ€è¦ä¿®æ”¹æ“ä½œå¯¹è±¡ä¸­çš„é˜Ÿåˆ—ä¼˜å…ˆçº§ä¿¡æ¯ã€‚æœ€åŽï¼Œé™¤éžæ‚¨çš„æ“ä½œèƒ½å¤ŸåŠ¨æ€æ›´æ”¹å…¶å¹¶å‘çŠ¶æ€ï¼Œå¦åˆ™æ‚¨ä¸éœ€è¦ä¸º<code>isConcurrent</code>å¯†é’¥è·¯å¾„æä¾› KVO é€šçŸ¥ã€‚</p>
<p>æœ‰å…³é”®å€¼è§‚å¯Ÿä»¥åŠå¦‚ä½•åœ¨è‡ªå®šä¹‰å¯¹è±¡ä¸­æ”¯æŒé”®å€¼çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ã€Š_<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/KeyValueObserving/KeyValueObserving.html#//apple_ref/doc/uid/10000177i">é”®å€¼è§‚å¯Ÿç¼–ç¨‹æŒ‡å—ã€‹</a>_ã€‚</p>
<h4 id="è‡ªå®šä¹‰æ“ä½œå¯¹è±¡çš„æ‰§è¡Œè¡Œä¸º"><a href="#è‡ªå®šä¹‰æ“ä½œå¯¹è±¡çš„æ‰§è¡Œè¡Œä¸º" class="headerlink" title="è‡ªå®šä¹‰æ“ä½œå¯¹è±¡çš„æ‰§è¡Œè¡Œä¸º"></a>è‡ªå®šä¹‰æ“ä½œå¯¹è±¡çš„æ‰§è¡Œè¡Œä¸º</h4><p>æ“ä½œå¯¹è±¡çš„é…ç½®åœ¨åˆ›å»ºå¯¹è±¡ä¹‹åŽä½†å°†å®ƒä»¬æ·»åŠ åˆ°é˜Ÿåˆ—ä¹‹å‰è¿›è¡Œã€‚æœ¬èŠ‚ä¸­æè¿°çš„é…ç½®ç±»åž‹å¯ä»¥åº”ç”¨äºŽæ‰€æœ‰æ“ä½œå¯¹è±¡ï¼Œè€Œä¸ç®¡æ‚¨æ˜¯<code>NSOperation</code>è‡ªå·±ç»§æ‰¿è¿˜æ˜¯ä½¿ç”¨çŽ°æœ‰çš„å­ç±»ã€‚</p>
<h6 id="é…ç½®äº’æ“ä½œä¾èµ–æ€§"><a href="#é…ç½®äº’æ“ä½œä¾èµ–æ€§" class="headerlink" title="é…ç½®äº’æ“ä½œä¾èµ–æ€§"></a>é…ç½®äº’æ“ä½œä¾èµ–æ€§</h6><p>ä¾èµ–å…³ç³»æ˜¯æ‚¨åºåˆ—åŒ–ä¸åŒæ“ä½œå¯¹è±¡çš„æ‰§è¡Œçš„ä¸€ç§æ–¹æ³•ã€‚ä¾èµ–äºŽå…¶ä»–æ“ä½œçš„æ“ä½œè¦ç­‰åˆ°å®ƒæ‰€ä¾èµ–çš„æ‰€æœ‰æ“ä½œå®Œæˆæ‰§è¡ŒåŽæ‰èƒ½å¼€å§‹æ‰§è¡Œã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¾èµ–å…³ç³»åœ¨ä¸¤ä¸ªæ“ä½œå¯¹è±¡ä¹‹é—´åˆ›å»ºç®€å•çš„ä¸€å¯¹ä¸€ä¾èµ–å…³ç³»æˆ–æž„å»ºå¤æ‚çš„å¯¹è±¡ä¾èµ–å…³ç³»å›¾ã€‚</p>
<p>è¦å»ºç«‹ä¸¤ä¸ªæ“ä½œå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œè¯·ä½¿ç”¨çš„<code>addDependency:</code>æ–¹æ³•<code>NSOperation</code>ã€‚æ­¤æ–¹æ³•åˆ›å»ºä»Žå½“å‰æ“ä½œå¯¹è±¡åˆ°æ‚¨æŒ‡å®šä¸ºå‚æ•°çš„ç›®æ ‡æ“ä½œçš„å•å‘ä¾èµ–å…³ç³»ã€‚è¿™ç§ä¾èµ–æ€§æ„å‘³ç€åœ¨ç›®æ ‡å¯¹è±¡å®Œæˆæ‰§è¡Œä¹‹å‰ï¼Œå½“å‰å¯¹è±¡æ— æ³•å¼€å§‹æ‰§è¡Œã€‚ä¾èµ–å…³ç³»ä¹Ÿä¸é™äºŽåŒä¸€é˜Ÿåˆ—ä¸­çš„æ“ä½œã€‚æ“ä½œå¯¹è±¡ç®¡ç†å®ƒä»¬è‡ªå·±çš„ä¾èµ–å…³ç³»ï¼Œå› æ­¤å®Œå…¨å¯ä»¥åœ¨æ“ä½œä¹‹é—´åˆ›å»ºä¾èµ–å…³ç³»å¹¶å°†å®ƒä»¬å…¨éƒ¨æ·»åŠ åˆ°ä¸åŒçš„é˜Ÿåˆ—ä¸­ã€‚ä½†æ˜¯ï¼Œä¸å¯æŽ¥å—çš„ä¸€ä»¶äº‹æ˜¯åœ¨æ“ä½œä¹‹é—´åˆ›å»ºå¾ªçŽ¯ä¾èµ–å…³ç³»ã€‚è¿™æ ·åšæ˜¯ç¨‹åºå‘˜çš„é”™è¯¯ï¼Œå®ƒå°†é˜»æ­¢å—å½±å“çš„æ“ä½œè¿è¡Œã€‚</p>
<p>å½“æ‰€æœ‰æ“ä½œçš„ä¾èµ–é¡¹æœ¬èº«éƒ½å·²å®Œæˆæ‰§è¡Œæ—¶ï¼Œæ“ä½œå¯¹è±¡é€šå¸¸å¯ä»¥æ‰§è¡Œã€‚ï¼ˆå¦‚æžœè‡ªå®šä¹‰<code>isReady</code>æ–¹æ³•çš„è¡Œä¸ºï¼Œåˆ™æ“ä½œçš„å°±ç»ªçŠ¶æ€ç”±æ‚¨è®¾ç½®çš„æ¡ä»¶å†³å®šã€‚ï¼‰å¦‚æžœæ“ä½œå¯¹è±¡åœ¨é˜Ÿåˆ—ä¸­ï¼Œåˆ™è¯¥é˜Ÿåˆ—å¯éšæ—¶å¼€å§‹æ‰§è¡Œè¯¥æ“ä½œã€‚å¦‚æžœæ‚¨æ‰“ç®—æ‰‹åŠ¨æ‰§è¡Œè¯¥æ“ä½œï¼Œåˆ™å–å†³äºŽæ‚¨è°ƒç”¨è¯¥æ“ä½œçš„<code>start</code>æ–¹æ³•ã€‚</p>
<p><strong>è¦ç‚¹ï¼š</strong> åœ¨è¿è¡Œæ“ä½œæˆ–å°†å®ƒä»¬æ·»åŠ åˆ°æ“ä½œé˜Ÿåˆ—ä¹‹å‰ï¼Œåº”å§‹ç»ˆé…ç½®ä¾èµ–å…³ç³»ã€‚ä¹‹åŽæ·»åŠ çš„ä¾èµ–å…³ç³»å¯èƒ½ä¸ä¼šé˜»æ­¢ç»™å®šçš„æ“ä½œå¯¹è±¡è¿è¡Œã€‚</p>
<p>ä¾èµ–å…³ç³»ä¾èµ–äºŽæ¯ä¸€ä¸ªæ“ä½œå¯¹è±¡æ¯å½“å¯¹è±¡çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶å°±å‘å‡ºé€‚å½“çš„ KVO é€šçŸ¥ã€‚å¦‚æžœè‡ªå®šä¹‰æ“ä½œå¯¹è±¡çš„è¡Œä¸ºï¼Œåˆ™å¯èƒ½éœ€è¦ä»Žè‡ªå®šä¹‰ä»£ç ç”Ÿæˆé€‚å½“çš„ KVO é€šçŸ¥ï¼Œä»¥é¿å…å¼•èµ·ä¾èµ–å…³ç³»é—®é¢˜ã€‚æœ‰å…³ KVO é€šçŸ¥å’Œæ“ä½œå¯¹è±¡çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationObjects/OperationObjects.html#//apple_ref/doc/uid/TP40008091-CH101-SW10">ç»´æŠ¤ KVO åˆè§„æ€§</a>ã€‚æœ‰å…³é…ç½®ä¾èµ–é¡¹çš„å…¶ä»–ä¿¡æ¯ï¼Œè¯·å‚è§ã€Š_<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/foundation/nsoperation">NSOperation ç±»å‚è€ƒã€‹</a>_ã€‚</p>
<h6 id="æ›´æ”¹å·¥åºçš„æ‰§è¡Œä¼˜å…ˆçº§"><a href="#æ›´æ”¹å·¥åºçš„æ‰§è¡Œä¼˜å…ˆçº§" class="headerlink" title="æ›´æ”¹å·¥åºçš„æ‰§è¡Œä¼˜å…ˆçº§"></a>æ›´æ”¹å·¥åºçš„æ‰§è¡Œä¼˜å…ˆçº§</h6><p>å¯¹äºŽæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œæ‰§è¡Œé¡ºåºé¦–å…ˆç”±æŽ’é˜Ÿçš„æ“ä½œçš„å°±ç»ªçŠ¶æ€ç¡®å®šï¼Œç„¶åŽç”±å…¶ç›¸å¯¹ä¼˜å…ˆçº§ç¡®å®šã€‚å°±ç»ªçŠ¶æ€ç”±æ“ä½œå¯¹å…¶ä»–æ“ä½œçš„ä¾èµ–å…³ç³»ç¡®å®šï¼Œä½†æ˜¯ä¼˜å…ˆçº§æ˜¯æ“ä½œå¯¹è±¡æœ¬èº«çš„å±žæ€§ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ–°æ“ä½œå¯¹è±¡éƒ½å…·æœ‰â€œæ™®é€šâ€ä¼˜å…ˆçº§ï¼Œä½†æ˜¯æ‚¨å¯ä»¥æ ¹æ®éœ€è¦é€šè¿‡è°ƒç”¨å¯¹è±¡çš„<code>setQueuePriority:</code>æ–¹æ³•æ¥å¢žåŠ æˆ–å‡å°‘è¯¥ä¼˜å…ˆçº§ã€‚</p>
<p>ä¼˜å…ˆçº§ä»…é€‚ç”¨äºŽåŒä¸€æ“ä½œé˜Ÿåˆ—ä¸­çš„æ“ä½œã€‚å¦‚æžœæ‚¨çš„åº”ç”¨ç¨‹åºå…·æœ‰å¤šä¸ªæ“ä½œé˜Ÿåˆ—ï¼Œåˆ™æ¯ä¸ªé˜Ÿåˆ—éƒ½å°†ç‹¬ç«‹äºŽå…¶ä»–é˜Ÿåˆ—çš„ä¼˜å…ˆçº§åˆ†é…ç»™è‡ªå·±çš„æ“ä½œã€‚å› æ­¤ï¼Œä½Žä¼˜å…ˆçº§æ“ä½œä»ç„¶æœ‰å¯èƒ½åœ¨ä¸åŒé˜Ÿåˆ—ä¸­å…ˆäºŽé«˜ä¼˜å…ˆçº§æ“ä½œæ‰§è¡Œã€‚</p>
<p>ä¼˜å…ˆçº§ä¸èƒ½æ›¿ä»£ä¾èµ–å…³ç³»ã€‚ä¼˜å…ˆçº§ç¡®å®šæ“ä½œé˜Ÿåˆ—å¼€å§‹ä»…æ‰§è¡Œå½“å‰å‡†å¤‡å°±ç»ªçš„é‚£äº›æ“ä½œçš„é¡ºåºã€‚ä¾‹å¦‚ï¼Œå¦‚æžœé˜Ÿåˆ—åŒæ—¶åŒ…å«é«˜ä¼˜å…ˆçº§å’Œä½Žä¼˜å…ˆçº§æ“ä½œï¼Œå¹¶ä¸”ä¸¤ä¸ªæ“ä½œéƒ½å‡†å¤‡å°±ç»ªï¼Œåˆ™è¯¥é˜Ÿåˆ—é¦–å…ˆæ‰§è¡Œé«˜ä¼˜å…ˆçº§æ“ä½œã€‚ä½†æ˜¯ï¼Œå¦‚æžœé«˜ä¼˜å…ˆçº§æ“ä½œå°šæœªå‡†å¤‡å°±ç»ªï¼Œä½†ä½Žä¼˜å…ˆçº§æ“ä½œå·²å°±ç»ªï¼Œåˆ™é˜Ÿåˆ—é¦–å…ˆæ‰§è¡Œä½Žä¼˜å…ˆçº§æ“ä½œã€‚å¦‚æžœè¦é˜»æ­¢ä¸€ä¸ªæ“ä½œåœ¨å¦ä¸€ä¸ªæ“ä½œå®Œæˆä¹‹å‰å¼€å§‹ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ä¾èµ–é¡¹ï¼ˆå¦‚<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationObjects/OperationObjects.html#//apple_ref/doc/uid/TP40008091-CH101-SW17">é…ç½®äº’æ“ä½œä¾èµ–é¡¹ä¸­æ‰€è¿°</a>ï¼‰ã€‚</p>
<h6 id="æ›´æ”¹åº•å±‚çº¿ç¨‹ä¼˜å…ˆçº§"><a href="#æ›´æ”¹åº•å±‚çº¿ç¨‹ä¼˜å…ˆçº§" class="headerlink" title="æ›´æ”¹åº•å±‚çº¿ç¨‹ä¼˜å…ˆçº§"></a>æ›´æ”¹åº•å±‚çº¿ç¨‹ä¼˜å…ˆçº§</h6><p>åœ¨ OS X v10.6 å’Œæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥é…ç½®æ“ä½œçš„åŸºç¡€çº¿ç¨‹çš„æ‰§è¡Œä¼˜å…ˆçº§ã€‚ç³»ç»Ÿä¸­çš„çº¿ç¨‹ç­–ç•¥æœ¬èº«ç”±å†…æ ¸ç®¡ç†ï¼Œä½†é€šå¸¸ï¼Œä¼˜å…ˆçº§è¾ƒé«˜çš„çº¿ç¨‹æ¯”ä½Žä¼˜å…ˆçº§çš„çº¿ç¨‹æœ‰æ›´å¤šçš„è¿è¡Œæœºä¼šã€‚åœ¨æ“ä½œå¯¹è±¡ä¸­ï¼Œå°†çº¿ç¨‹ä¼˜å…ˆçº§æŒ‡å®šä¸º 0.0 åˆ° 1.0 èŒƒå›´å†…çš„æµ®ç‚¹å€¼ï¼Œå…¶ä¸­ 0.0 æ˜¯æœ€ä½Žä¼˜å…ˆçº§ï¼Œè€Œ 1.0 æ˜¯æœ€é«˜ä¼˜å…ˆçº§ã€‚å¦‚æžœæœªæŒ‡å®šæ˜¾å¼çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œåˆ™è¯¥æ“ä½œå°†ä»¥é»˜è®¤çº¿ç¨‹ä¼˜å…ˆçº§ 0.5 è¿è¡Œã€‚</p>
<p>è‹¥è¦è®¾ç½®æ“ä½œçš„çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œå¿…é¡»å…ˆå°†<code>setThreadPriority:</code>æ“ä½œå¯¹è±¡çš„æ–¹æ³•æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼ˆæˆ–æ‰‹åŠ¨æ‰§è¡Œï¼‰ï¼Œç„¶åŽå†è°ƒç”¨è¯¥æ–¹æ³•ã€‚å½“éœ€è¦æ‰§è¡Œè¯¥æ“ä½œæ—¶ï¼Œé»˜è®¤<code>start</code>æ–¹æ³•å°†ä½¿ç”¨æ‚¨æŒ‡å®šçš„å€¼æ¥ä¿®æ”¹å½“å‰çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚æ­¤æ–°ä¼˜å…ˆçº§<code>main</code>ä»…åœ¨æ‚¨çš„æ“ä½œæ–¹æ³•æœŸé—´æœ‰æ•ˆã€‚æ‰€æœ‰å…¶ä»–ä»£ç ï¼ˆåŒ…æ‹¬æ“ä½œçš„å®Œæˆå—ï¼‰å‡ä»¥é»˜è®¤çº¿ç¨‹ä¼˜å…ˆçº§è¿è¡Œã€‚å¦‚æžœåˆ›å»ºå¹¶å‘æ“ä½œå¹¶å› æ­¤è¦†ç›–è¯¥<code>start</code>æ–¹æ³•ï¼Œåˆ™å¿…é¡»è‡ªå·±é…ç½®çº¿ç¨‹ä¼˜å…ˆçº§ã€‚</p>
<h6 id="è®¾å®šå®ŒæˆåŒºå—"><a href="#è®¾å®šå®ŒæˆåŒºå—" class="headerlink" title="è®¾å®šå®ŒæˆåŒºå—"></a>è®¾å®šå®ŒæˆåŒºå—</h6><p>åœ¨ OS X v10.6 å’Œæ›´é«˜ç‰ˆæœ¬ä¸­ï¼ŒæŸä¸ªæ“ä½œå¯ä»¥åœ¨å…¶ä¸»è¦ä»»åŠ¡å®Œæˆæ‰§è¡Œæ—¶æ‰§è¡Œå®Œæˆå—ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®Œæˆå—æ¥æ‰§è¡Œä»»ä½•ä¸å±žäºŽä¸»è¦ä»»åŠ¡çš„å·¥ä½œã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ­¤å—æ¥é€šçŸ¥æ„Ÿå…´è¶£çš„å®¢æˆ·ç«¯æ“ä½œæœ¬èº«å·²å®Œæˆã€‚å¹¶å‘æ“ä½œå¯¹è±¡å¯èƒ½ä½¿ç”¨æ­¤å—æ¥ç”Ÿæˆå…¶æœ€ç»ˆçš„ KVO é€šçŸ¥ã€‚</p>
<p>è¦è®¾ç½®å®Œæˆå—ï¼Œè¯·ä½¿ç”¨çš„<code>setCompletionBlock:</code>æ–¹æ³•<code>NSOperation</code>ã€‚ä¼ é€’ç»™æ­¤æ–¹æ³•çš„å—åº”è¯¥æ²¡æœ‰å‚æ•°ï¼Œä¹Ÿæ²¡æœ‰è¿”å›žå€¼ã€‚</p>
<h4 id="å®žæ–½æ“ä½œå¯¹è±¡çš„æŠ€å·§"><a href="#å®žæ–½æ“ä½œå¯¹è±¡çš„æŠ€å·§" class="headerlink" title="å®žæ–½æ“ä½œå¯¹è±¡çš„æŠ€å·§"></a>å®žæ–½æ“ä½œå¯¹è±¡çš„æŠ€å·§</h4><p>å°½ç®¡æ“ä½œå¯¹è±¡ç›¸å½“å®¹æ˜“å®žçŽ°ï¼Œä½†æ˜¯åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œæ‚¨åº”è¯¥æ³¨æ„å‡ ä»¶äº‹ã€‚ä»¥ä¸‹å„èŠ‚æè¿°äº†ä¸ºæ“ä½œå¯¹è±¡ç¼–å†™ä»£ç æ—¶åº”è€ƒè™‘çš„å› ç´ ã€‚</p>
<h6 id="ç®¡ç†æ“ä½œå¯¹è±¡ä¸­çš„å†…å­˜"><a href="#ç®¡ç†æ“ä½œå¯¹è±¡ä¸­çš„å†…å­˜" class="headerlink" title="ç®¡ç†æ“ä½œå¯¹è±¡ä¸­çš„å†…å­˜"></a>ç®¡ç†æ“ä½œå¯¹è±¡ä¸­çš„å†…å­˜</h6><p>ä»¥ä¸‹å„èŠ‚æè¿°äº†æ“ä½œå¯¹è±¡ä¸­è‰¯å¥½çš„å†…å­˜ç®¡ç†çš„å…³é”®å…ƒç´ ã€‚æœ‰å…³ Objective-C ç¨‹åºä¸­çš„å†…å­˜ç®¡ç†çš„ä¸€èˆ¬ä¿¡æ¯ï¼Œè¯·å‚é˜…ã€Š_<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/MemoryMgmt/Articles/MemoryMgmt.html#//apple_ref/doc/uid/10000011i">é«˜çº§å†…å­˜ç®¡ç†ç¼–ç¨‹æŒ‡å—ã€‹</a>_ã€‚</p>
<p>######## é¿å…æŒ‰çº¿ç¨‹å­˜å‚¨</p>
<p>å°½ç®¡å¤§å¤šæ•°æ“ä½œåœ¨çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œä½†åœ¨éžå¹¶è¡Œæ“ä½œçš„æƒ…å†µä¸‹ï¼Œè¯¥çº¿ç¨‹é€šå¸¸ç”±æ“ä½œé˜Ÿåˆ—æä¾›ã€‚å¦‚æžœæ“ä½œé˜Ÿåˆ—ä¸ºæ‚¨æä¾›äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œåˆ™åº”è€ƒè™‘è¯¥çº¿ç¨‹å½’é˜Ÿåˆ—æ‰€æœ‰ï¼Œè€Œä¸åº”è¢«æ‚¨çš„æ“ä½œè§¦åŠã€‚ç‰¹åˆ«æ˜¯ï¼Œæ‚¨æ°¸è¿œä¸è¦å°†ä»»ä½•æ•°æ®ä¸Žæ‚¨è‡ªå·±åˆ›å»ºæˆ–ç®¡ç†çš„çº¿ç¨‹æ— å…³ã€‚ç”±æ“ä½œé˜Ÿåˆ—ç®¡ç†çš„çº¿ç¨‹æ¥æ¥å¾€å¾€å–å†³äºŽç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„éœ€æ±‚ã€‚å› æ­¤ï¼Œä½¿ç”¨æ¯çº¿ç¨‹å­˜å‚¨åœ¨æ“ä½œä¹‹é—´ä¼ é€’æ•°æ®æ˜¯ä¸å¯é çš„ï¼Œå¹¶ä¸”å¾ˆå¯èƒ½å¤±è´¥ã€‚</p>
<p>å¯¹äºŽæ“ä½œå¯¹è±¡ï¼Œæ— è®ºå¦‚ä½•éƒ½æ²¡æœ‰ç†ç”±ä½¿ç”¨æ¯çº¿ç¨‹å­˜å‚¨ã€‚åˆå§‹åŒ–æ“ä½œå¯¹è±¡æ—¶ï¼Œåº”ä¸ºè¯¥å¯¹è±¡æä¾›å®Œæˆå…¶å·¥ä½œæ‰€éœ€çš„ä¸€åˆ‡ã€‚å› æ­¤ï¼Œæ“ä½œå¯¹è±¡æœ¬èº«æä¾›äº†æ‰€éœ€çš„ä¸Šä¸‹æ–‡å­˜å‚¨ã€‚æ‰€æœ‰ä¼ å…¥å’Œä¼ å‡ºçš„æ•°æ®éƒ½åº”å­˜å‚¨åœ¨æ­¤å¤„ï¼Œç›´åˆ°å¯ä»¥å°†å…¶é‡æ–°é›†æˆåˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­æˆ–ä¸å†éœ€è¦ä¸ºæ­¢ã€‚</p>
<p>######## æ ¹æ®éœ€è¦ä¿ç•™å¯¹æ“ä½œå¯¹è±¡çš„å¼•ç”¨</p>
<p>ä»…ä»…å› ä¸ºæ“ä½œå¯¹è±¡æ˜¯å¼‚æ­¥è¿è¡Œçš„ï¼Œæ‚¨ä¸åº”è¯¥å‡è®¾æ‚¨å¯ä»¥åˆ›å»ºå®ƒä»¬è€Œå¿˜è®°å®ƒä»¬ã€‚å®ƒä»¬ä»ç„¶åªæ˜¯å¯¹è±¡ï¼Œæ‚¨éœ€è¦ç®¡ç†ä»£ç éœ€è¦çš„å¯¹å®ƒä»¬çš„ä»»ä½•å¼•ç”¨ã€‚å¦‚æžœæ‚¨éœ€è¦åœ¨æ“ä½œå®ŒæˆåŽä»Žç»“æžœæ•°æ®ä¸­æ£€ç´¢ç»“æžœï¼Œè¿™å°¤å…¶é‡è¦ã€‚</p>
<p>æ‚¨åº”è¯¥å§‹ç»ˆä¿ç•™è‡ªå·±å¯¹æ“ä½œçš„å¼•ç”¨çš„åŽŸå› æ˜¯ï¼Œæ‚¨ä»¥åŽå¯èƒ½æ²¡æœ‰æœºä¼šå‘è¯¥é˜Ÿåˆ—è¯¢é—®å¯¹è±¡ã€‚é˜Ÿåˆ—å°½ä¸€åˆ‡åŠªåŠ›å°½å¿«åˆ†é…å’Œæ‰§è¡Œæ“ä½œã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œé˜Ÿåˆ—åœ¨æ·»åŠ åŽå‡ ä¹Žç«‹å³å¼€å§‹æ‰§è¡Œæ“ä½œã€‚ç­‰åˆ°æ‚¨è‡ªå·±çš„ä»£ç è¿”å›žé˜Ÿåˆ—ä»¥èŽ·å–å¯¹è¯¥æ“ä½œçš„å¼•ç”¨æ—¶ï¼Œè¯¥æ“ä½œå¯èƒ½å·²ç»å®Œæˆå¹¶ä»Žé˜Ÿåˆ—ä¸­åˆ é™¤ã€‚</p>
<h6 id="å¤„ç†é”™è¯¯å’Œå¼‚å¸¸"><a href="#å¤„ç†é”™è¯¯å’Œå¼‚å¸¸" class="headerlink" title="å¤„ç†é”™è¯¯å’Œå¼‚å¸¸"></a>å¤„ç†é”™è¯¯å’Œå¼‚å¸¸</h6><p>å› ä¸ºæ“ä½œæœ¬è´¨ä¸Šæ˜¯åº”ç”¨ç¨‹åºå†…éƒ¨çš„ç¦»æ•£å®žä½“ï¼Œæ‰€ä»¥å®ƒä»¬è´Ÿè´£å¤„ç†å‡ºçŽ°çš„ä»»ä½•é”™è¯¯æˆ–å¼‚å¸¸ã€‚åœ¨ OS X v10.6 å’Œæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œè¯¥ç±»<code>start</code>æä¾›çš„é»˜è®¤æ–¹æ³•<code>NSOperation</code>ä¸ä¼šæ•èŽ·å¼‚å¸¸ã€‚ï¼ˆåœ¨ OS X v10.5 ä¸­ï¼Œstart æ–¹æ³•ç¡®å®žæ•èŽ·å’ŒæŠ‘åˆ¶å¼‚å¸¸ã€‚ï¼‰æ‚¨è‡ªå·±çš„ä»£ç åº”å§‹ç»ˆç›´æŽ¥æ•èŽ·å’ŒæŠ‘åˆ¶å¼‚å¸¸ã€‚å®ƒè¿˜åº”æ£€æŸ¥é”™è¯¯ä»£ç ï¼Œå¹¶æ ¹æ®éœ€è¦é€šçŸ¥åº”ç”¨ç¨‹åºçš„é€‚å½“éƒ¨åˆ†ã€‚å¹¶ä¸”ï¼Œå¦‚æžœæ›¿æ¢äº†è¯¥<code>start</code>æ–¹æ³•ï¼Œåˆ™å¿…é¡»ç±»ä¼¼åœ°åœ¨è‡ªå®šä¹‰å®žçŽ°ä¸­æ•èŽ·ä»»ä½•å¼‚å¸¸ï¼Œä»¥é˜²æ­¢å®ƒä»¬ç¦»å¼€åŸºç¡€çº¿ç¨‹çš„èŒƒå›´ã€‚</p>
<p>åœ¨é”™è¯¯æƒ…å†µç±»åž‹ä¸­ï¼Œæ‚¨åº”è¯¥å‡†å¤‡å¤„ç†ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>æ£€æŸ¥å¹¶å¤„ç† UNIX <code>errno</code>é£Žæ ¼çš„é”™è¯¯ä»£ç ã€‚</li>
<li>æ£€æŸ¥æ–¹æ³•å’Œå‡½æ•°è¿”å›žçš„æ˜¾å¼é”™è¯¯ä»£ç ã€‚</li>
<li>æ•èŽ·ç”±æ‚¨è‡ªå·±çš„ä»£ç æˆ–å…¶ä»–ç³»ç»Ÿæ¡†æž¶å¼•å‘çš„å¼‚å¸¸ã€‚</li>
<li>æ•èŽ·ç”±<code>NSOperation</code>ç±»æœ¬èº«å¼•å‘çš„å¼‚å¸¸ï¼Œåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä¼šå¼•å‘å¼‚å¸¸ï¼š<ul>
<li>å½“æ“ä½œå°šæœªå‡†å¤‡å¥½æ‰§è¡Œä½†å…¶<code>start</code>æ–¹æ³•è¢«è°ƒç”¨æ—¶</li>
<li>å½“æ“ä½œæ­£åœ¨æ‰§è¡Œæˆ–å®Œæˆæ—¶ï¼ˆå¯èƒ½æ˜¯å› ä¸ºå·²å–æ¶ˆï¼‰ï¼Œå¹¶ä¸”<code>start</code>å†æ¬¡è°ƒç”¨äº†å…¶æ–¹æ³•</li>
<li>å½“æ‚¨å°è¯•å°†å®Œæˆå—æ·»åŠ åˆ°å·²æ‰§è¡Œæˆ–å·²å®Œæˆçš„æ“ä½œä¸­æ—¶</li>
<li>å½“æ‚¨å°è¯•æ£€ç´¢<code>NSInvocationOperation</code>å·²å–æ¶ˆå¯¹è±¡çš„ç»“æžœæ—¶</li>
</ul>
</li>
</ul>
<p>å¦‚æžœæ‚¨çš„è‡ªå®šä¹‰ä»£ç ç¡®å®žé‡åˆ°å¼‚å¸¸æˆ–é”™è¯¯ï¼Œåˆ™åº”é‡‡å–æ‰€éœ€çš„ä»»ä½•æ­¥éª¤å°†è¯¥é”™è¯¯ä¼ æ’­åˆ°åº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†ã€‚æœ¬<code>NSOperation</code>ç±»ä¸æ²¿ç€é”™è¯¯çš„ç»“æžœä»£ç æˆ–ä¾‹å¤–ä¼ é€’ç»™ä½ çš„åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†æä¾›äº†æ˜Žç¡®çš„æ–¹æ³•ã€‚å› æ­¤ï¼Œå¦‚æžœæ­¤ç±»ä¿¡æ¯å¯¹æ‚¨çš„åº”ç”¨ç¨‹åºå¾ˆé‡è¦ï¼Œåˆ™å¿…é¡»æä¾›å¿…è¦çš„ä»£ç ã€‚</p>
<h4 id="ç¡®å®šæ“ä½œå¯¹è±¡çš„é€‚å½“èŒƒå›´"><a href="#ç¡®å®šæ“ä½œå¯¹è±¡çš„é€‚å½“èŒƒå›´" class="headerlink" title="ç¡®å®šæ“ä½œå¯¹è±¡çš„é€‚å½“èŒƒå›´"></a>ç¡®å®šæ“ä½œå¯¹è±¡çš„é€‚å½“èŒƒå›´</h4><p>å°½ç®¡å¯ä»¥å‘æ“ä½œé˜Ÿåˆ—ä¸­æ·»åŠ ä»»æ„æ•°é‡çš„æ“ä½œï¼Œä½†æ˜¯è¿™æ ·åšé€šå¸¸æ˜¯ä¸åˆ‡å®žé™…çš„ã€‚åƒä»»ä½•å¯¹è±¡ä¸€æ ·ï¼Œ<code>NSOperation</code>è¯¥ç±»çš„å®žä¾‹ä¼šæ¶ˆè€—å†…å­˜ï¼Œå¹¶å…·æœ‰ä¸Žå…¶æ‰§è¡Œç›¸å…³çš„å®žé™…æˆæœ¬ã€‚å¦‚æžœæ¯ä¸ªæ“ä½œå¯¹è±¡ä»…æ‰§è¡Œå°‘é‡å·¥ä½œï¼Œå¹¶ä¸”åˆ›å»ºäº†æ•°ä»¥ä¸‡è®¡çš„å¯¹è±¡ï¼Œåˆ™å¯èƒ½ä¼šå‘çŽ°ä¸Žå®žé™…å·¥ä½œç›¸æ¯”ï¼Œæ‚¨èŠ±è´¹çš„æ—¶é—´æ›´å¤šã€‚è€Œä¸”ï¼Œå¦‚æžœæ‚¨çš„åº”ç”¨ç¨‹åºå·²ç»å—åˆ°å†…å­˜çš„é™åˆ¶ï¼Œæ‚¨å¯èƒ½ä¼šå‘çŽ°ï¼Œåœ¨å†…å­˜ä¸­åªæœ‰æˆåƒä¸Šä¸‡ä¸ªæ“ä½œå¯¹è±¡å¯èƒ½ä¼šè¿›ä¸€æ­¥é™ä½Žæ€§èƒ½ã€‚</p>
<p>æœ‰æ•ˆä½¿ç”¨æ“ä½œçš„å…³é”®æ˜¯åœ¨éœ€è¦åšçš„å·¥ä½œé‡å’Œä¿æŒè®¡ç®—æœºå¿™ä¹‹é—´æ‰¾åˆ°é€‚å½“çš„å¹³è¡¡ã€‚å°è¯•ç¡®ä¿æ‚¨çš„æ“ä½œå®Œæˆäº†åˆç†çš„å·¥ä½œé‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæ‚¨çš„åº”ç”¨ç¨‹åºåˆ›å»ºäº† 100 ä¸ªæ“ä½œå¯¹è±¡ä»¥å¯¹ 100 ä¸ªä¸åŒçš„å€¼æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ï¼Œè¯·è€ƒè™‘åˆ›å»º 10 ä¸ªæ“ä½œå¯¹è±¡ä»¥åˆ†åˆ«å¤„ç† 10 ä¸ªå€¼ã€‚</p>
<p>æ‚¨è¿˜åº”è¯¥é¿å…ä¸€æ¬¡å°†å¤§é‡æ“ä½œæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œæˆ–è€…é¿å…å°†æ“ä½œå¯¹è±¡è¿žç»­æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„é€Ÿåº¦æ¯”å¤„ç†å¯¹è±¡å¿«ã€‚è€Œä¸æ˜¯ç”¨æ“ä½œå¯¹è±¡å¡«å……é˜Ÿåˆ—ï¼Œè€Œæ˜¯åˆ†æ‰¹åˆ›å»ºè¿™äº›å¯¹è±¡ã€‚å½“ä¸€ä¸ªæ‰¹å¤„ç†å®Œæˆæ‰§è¡Œæ—¶ï¼Œè¯·ä½¿ç”¨å®Œæˆå—å‘Šè¯‰æ‚¨çš„åº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªæ–°çš„æ‰¹å¤„ç†ã€‚å½“æ‚¨æœ‰å¾ˆå¤šå·¥ä½œè¦åšæ—¶ï¼Œæ‚¨å¸Œæœ›ä½¿é˜Ÿåˆ—ä¸­å……æ»¡è¶³å¤Ÿçš„æ“ä½œï¼Œä»¥ä½¿è®¡ç®—æœºä¿æŒç¹å¿™çŠ¶æ€ï¼Œä½†æ˜¯æ‚¨ä¸æƒ³ä¸€æ¬¡åˆ›å»ºå¤ªå¤šçš„æ“ä½œï¼Œè€Œå¯¼è‡´åº”ç”¨ç¨‹åºå†…å­˜ä¸è¶³ã€‚</p>
<p>å½“ç„¶ï¼Œæ‚¨åˆ›å»ºçš„æ“ä½œå¯¹è±¡çš„æ•°é‡ä»¥åŠåœ¨æ¯ä¸ªå¯¹è±¡ä¸­æ‰§è¡Œçš„å·¥ä½œé‡æ˜¯å¯å˜çš„ï¼Œå¹¶ä¸”å®Œå…¨å–å†³äºŽæ‚¨çš„åº”ç”¨ç¨‹åºã€‚æ‚¨åº”è¯¥å§‹ç»ˆä½¿ç”¨ä»ªå™¨ä¹‹ç±»çš„å·¥å…·æ¥å¸®åŠ©æ‚¨åœ¨æ•ˆçŽ‡å’Œé€Ÿåº¦ä¹‹é—´æ‰¾åˆ°é€‚å½“çš„å¹³è¡¡ã€‚æœ‰å…³å¯ç”¨äºŽæ”¶é›†ä»£ç æŒ‡æ ‡çš„å·¥å…·å’Œå…¶ä»–æ€§èƒ½å·¥å…·çš„<em><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Performance/Conceptual/PerformanceOverview/Introduction/Introduction.html#//apple_ref/doc/uid/TP40001410">æ¦‚è¿°</a>*ï¼Œè¯·å‚è§</em><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Performance/Conceptual/PerformanceOverview/Introduction/Introduction.html#//apple_ref/doc/uid/TP40001410">æ€§èƒ½æ¦‚è¿°</a>*ã€‚</p>
<h4 id="æ‰§è¡Œæ“ä½œ"><a href="#æ‰§è¡Œæ“ä½œ" class="headerlink" title="æ‰§è¡Œæ“ä½œ"></a>æ‰§è¡Œæ“ä½œ</h4><p>æœ€ç»ˆï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºéœ€è¦æ‰§è¡Œæ“ä½œæ‰èƒ½å®Œæˆå…³è”çš„å·¥ä½œã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å‡ ç§æ‰§è¡Œæ“ä½œçš„æ–¹æ³•ï¼Œä»¥åŠå¦‚ä½•åœ¨è¿è¡Œæ—¶æ“çºµæ“ä½œçš„æ‰§è¡Œã€‚</p>
<h6 id="å°†æ“ä½œæ·»åŠ åˆ°æ“ä½œé˜Ÿåˆ—"><a href="#å°†æ“ä½œæ·»åŠ åˆ°æ“ä½œé˜Ÿåˆ—" class="headerlink" title="å°†æ“ä½œæ·»åŠ åˆ°æ“ä½œé˜Ÿåˆ—"></a>å°†æ“ä½œæ·»åŠ åˆ°æ“ä½œé˜Ÿåˆ—</h6><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‰§è¡Œæ“ä½œçš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨æ“ä½œé˜Ÿåˆ—ï¼Œå®ƒæ˜¯<code>NSOperationQueue</code>ç±»çš„å®žä¾‹ã€‚æ‚¨çš„åº”ç”¨ç¨‹åºè´Ÿè´£åˆ›å»ºå’Œç»´æŠ¤æ‰“ç®—ä½¿ç”¨çš„ä»»ä½•æ“ä½œé˜Ÿåˆ—ã€‚ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥æœ‰ä»»æ„æ•°é‡çš„é˜Ÿåˆ—ï¼Œä½†æ˜¯åœ¨ç»™å®šçš„æ—¶é—´ç‚¹å¯èƒ½è¦æ‰§è¡Œå¤šå°‘æ“ä½œæœ‰å®žé™…çš„é™åˆ¶ã€‚æ“ä½œé˜Ÿåˆ—ä¸Žç³»ç»Ÿä¸€èµ·ä½¿ç”¨ï¼Œä»¥å°†å¹¶å‘æ“ä½œçš„æ•°é‡é™åˆ¶ä¸ºé€‚åˆäºŽå¯ç”¨æ ¸å¿ƒå’Œç³»ç»Ÿè´Ÿè½½çš„å€¼ã€‚å› æ­¤ï¼Œåˆ›å»ºå…¶ä»–é˜Ÿåˆ—å¹¶ä¸æ„å‘³ç€æ‚¨å¯ä»¥æ‰§è¡Œå…¶ä»–æ“ä½œã€‚</p>
<p>è¦åˆ›å»ºé˜Ÿåˆ—ï¼Œå¯ä»¥åƒåœ¨ä»»ä½•å…¶ä»–å¯¹è±¡ä¸­ä¸€æ ·åœ¨åº”ç”¨ç¨‹åºä¸­åˆ†é…å®ƒï¼š</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSOperationQueue * aQueue = [[NSOperationQueue alloc] init];</span><br></pre></td></tr></tbody></table></figure>

<p>è¦å°†æ“ä½œæ·»åŠ åˆ°é˜Ÿåˆ—ï¼Œè¯·ä½¿ç”¨<code>addOperation:</code>æ–¹æ³•ã€‚åœ¨ OS X v10.6 å’Œæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>addOperations:waitUntilFinished:</code>æ–¹æ³•æ·»åŠ æ“ä½œç»„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å°†å—å¯¹è±¡ç›´æŽ¥æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼ˆæ²¡æœ‰ç›¸åº”çš„æ“ä½œå¯¹è±¡ï¼‰<code>addOperationWithBlock:</code>æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•ä¸­çš„æ¯ä¸€ä¸ªéƒ½å°†ä¸€ä¸ªæ“ä½œï¼ˆæˆ–å¤šä¸ªæ“ä½œï¼‰æŽ’é˜Ÿï¼Œå¹¶é€šçŸ¥é˜Ÿåˆ—å®ƒåº”è¯¥å¼€å§‹å¤„ç†å®ƒä»¬ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ“ä½œä¼šåœ¨æ·»åŠ åˆ°é˜Ÿåˆ—åŽç«‹å³æ‰§è¡Œï¼Œä½†æ˜¯ç”±äºŽå¤šç§åŽŸå› ï¼Œæ“ä½œé˜Ÿåˆ—å¯èƒ½ä¼šå»¶è¿ŸæŽ’é˜Ÿæ“ä½œçš„æ‰§è¡Œã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æžœæŽ’é˜Ÿçš„æ“ä½œä¾èµ–äºŽå°šæœªå®Œæˆçš„å…¶ä»–æ“ä½œï¼Œåˆ™æ‰§è¡Œå¯èƒ½ä¼šå»¶è¿Ÿã€‚å¦‚æžœæ“ä½œé˜Ÿåˆ—æœ¬èº«è¢«æŒ‚èµ·æˆ–å·²ç»åœ¨æ‰§è¡Œå…¶æœ€å¤§æ•°é‡çš„å¹¶å‘æ“ä½œï¼Œåˆ™æ‰§è¡Œä¹Ÿå¯èƒ½ä¼šå»¶è¿Ÿã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å°†æ“ä½œæ·»åŠ åˆ°é˜Ÿåˆ—çš„åŸºæœ¬è¯­æ³•ã€‚</p>
<table>
<thead>
<tr>
<th><code>[aQueue addOperationï¼šanOp]; //æ·»åŠ ä¸€ä¸ªæ“ä½œ</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>[aQueue addOperationsï¼šanArrayOfOps waitUntilFinishedï¼šNO]ï¼›//æ·»åŠ å¤šä¸ªæ“ä½œ</code></td>
</tr>
<tr>
<td><code>[aQueue addOperationWithBlockï¼š^ {</code></td>
</tr>
<tr>
<td><code>/* åšä¸€ç‚¹äº‹ã€‚* /</code></td>
</tr>
<tr>
<td><code>}];</code></td>
</tr>
</tbody></table>
<p><strong>é‡è¦ï¼š</strong></p>
<p>åœ¨å°†æ“ä½œå¯¹è±¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¹‹å‰ï¼Œåº”è¯¥å¯¹å…¶è¿›è¡Œæ‰€æœ‰å¿…è¦çš„é…ç½®å’Œä¿®æ”¹ï¼Œå› ä¸ºä¸€æ—¦æ·»åŠ äº†æ“ä½œå¯¹è±¡ï¼Œè¯¥æ“ä½œå°±å¯ä»¥åœ¨ä»»ä½•æ—¶é—´è¿è¡Œï¼Œå¯¹äºŽè¿›è¡Œæ›´æ”¹ä»¥è¾¾åˆ°é¢„æœŸæ•ˆæžœè€Œè¨€å¯èƒ½ä¸ºæ—¶å·²æ™šã€‚</p>
<p>å°½ç®¡<code>NSOperationQueue</code>è¯¥ç±»æ˜¯ä¸ºåŒæ—¶æ‰§è¡Œæ“ä½œè€Œè®¾è®¡çš„ï¼Œä½†æ˜¯å¯ä»¥å¼ºåˆ¶å•ä¸ªé˜Ÿåˆ—ä¸€æ¬¡ä»…è¿è¡Œä¸€ä¸ªæ“ä½œã€‚çš„<code>setMaxConcurrentOperationCount:</code>æ–¹æ³•å¯è®©æ‚¨é…ç½®æ“ä½œé˜Ÿåˆ—å¯¹è±¡çš„æœ€å¤§å¹¶å‘æ“ä½œæ•°ã€‚å°†å€¼ 1 ä¼ é€’ç»™æ­¤æ–¹æ³•å°†å¯¼è‡´é˜Ÿåˆ—ä¸€æ¬¡ä»…æ‰§è¡Œä¸€ä¸ªæ“ä½œã€‚å°½ç®¡ä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªæ“ä½œï¼Œä½†æ˜¯æ‰§è¡Œçš„é¡ºåºä»ç„¶åŸºäºŽå…¶ä»–å› ç´ ï¼Œä¾‹å¦‚æ¯ä¸ªæ“ä½œçš„å°±ç»ªæ€§åŠå…¶åˆ†é…çš„ä¼˜å…ˆçº§ã€‚å› æ­¤ï¼Œä¸²è¡ŒåŒ–æ“ä½œé˜Ÿåˆ—æ‰€æä¾›çš„è¡Œä¸ºä¸Ž Grand Central Dispatch ä¸­çš„ä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—æ‰€æä¾›çš„è¡Œä¸ºå®Œå…¨ä¸åŒã€‚å¦‚æžœæ“ä½œå¯¹è±¡çš„æ‰§è¡Œé¡ºåºå¯¹æ‚¨å¾ˆé‡è¦ï¼Œåˆ™åº”åœ¨å°†æ“ä½œæ·»åŠ åˆ°é˜Ÿåˆ—ä¹‹å‰ä½¿ç”¨ä¾èµ–å…³ç³»æ¥å»ºç«‹é¡ºåºã€‚æœ‰å…³é…ç½®ä¾èµ–å…³ç³»çš„ä¿¡æ¯ï¼Œè¯·å‚é˜…ã€Š<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationObjects/OperationObjects.html#//apple_ref/doc/uid/TP40008091-CH101-SW17">é…ç½®äº’æ“ä½œä¾èµ–å…³ç³»ã€‹</a>ã€‚</p>
<p>æœ‰å…³ä½¿ç”¨æ“ä½œé˜Ÿåˆ—çš„ä¿¡æ¯ï¼Œè¯·å‚è§*<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/foundation/nsoperationqueue">NSOperationQueue ç±»å‚è€ƒ</a>*ã€‚æœ‰å…³ä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW6">åˆ›å»ºä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—</a>ã€‚</p>
<h6 id="æ‰‹åŠ¨æ‰§è¡Œæ“ä½œ"><a href="#æ‰‹åŠ¨æ‰§è¡Œæ“ä½œ" class="headerlink" title="æ‰‹åŠ¨æ‰§è¡Œæ“ä½œ"></a>æ‰‹åŠ¨æ‰§è¡Œæ“ä½œ</h6><p>å°½ç®¡æ“ä½œé˜Ÿåˆ—æ˜¯è¿è¡Œæ“ä½œå¯¹è±¡çš„æœ€æ–¹ä¾¿çš„æ–¹æ³•ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥åœ¨æ²¡æœ‰é˜Ÿåˆ—çš„æƒ…å†µä¸‹æ‰§è¡Œæ“ä½œã€‚ä½†æ˜¯ï¼Œå¦‚æžœé€‰æ‹©æ‰‹åŠ¨æ‰§è¡Œæ“ä½œï¼Œåˆ™åº”åœ¨ä»£ç ä¸­é‡‡å–ä¸€äº›é¢„é˜²æŽªæ–½ã€‚ç‰¹åˆ«æ˜¯ï¼Œè¯¥æ“ä½œå¿…é¡»å‡†å¤‡å°±ç»ªå¯ä»¥è¿è¡Œï¼Œå¹¶ä¸”æ‚¨å¿…é¡»å§‹ç»ˆä½¿ç”¨å…¶<code>start</code>æ–¹æ³•å¯åŠ¨å®ƒã€‚</p>
<p>ç›´åˆ°æ“ä½œçš„<code>isReady</code>æ–¹æ³•è¿”å›žåŽï¼Œæ‰è®¤ä¸ºè¯¥æ“ä½œå¯ä»¥è¿è¡Œ<code>YES</code>ã€‚è¯¥<code>isReady</code>æ–¹æ³•è¢«é›†æˆåˆ°<code>NSOperation</code>è¯¥ç±»çš„ä¾èµ–ç®¡ç†ç³»ç»Ÿä¸­ï¼Œä»¥æä¾›æ“ä½œçš„ä¾èµ–çŠ¶æ€ã€‚åªæœ‰æ¸…é™¤äº†å…¶ä¾èµ–æ€§åŽï¼Œæ‰å¯ä»¥å¼€å§‹æ‰§è¡Œæ“ä½œã€‚</p>
<p>æ‰‹åŠ¨æ‰§è¡Œæ“ä½œæ—¶ï¼Œåº”å§‹ç»ˆä½¿ç”¨è¯¥<code>start</code>æ–¹æ³•å¼€å§‹æ‰§è¡Œã€‚æ‚¨ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œè€Œä¸æ˜¯<code>main</code>å…¶ä»–æ–¹æ³•ï¼Œå› ä¸ºè¯¥<code>start</code>æ–¹æ³•åœ¨å®žé™…è¿è¡Œæ‚¨çš„è‡ªå®šä¹‰ä»£ç ä¹‹å‰ä¼šæ‰§è¡Œå¤šé¡¹å®‰å…¨æ£€æŸ¥ã€‚ç‰¹åˆ«æ˜¯ï¼Œé»˜è®¤<code>start</code>æ–¹æ³•ä¼šç”Ÿæˆæ“ä½œæ­£ç¡®å¤„ç†å…¶ä¾èµ–å…³ç³»æ‰€éœ€çš„ KVO é€šçŸ¥ã€‚å¦‚æžœè¯¥æ“ä½œå·²è¢«å–æ¶ˆï¼Œåˆ™æ­¤æ–¹æ³•è¿˜å¯ä»¥æ­£ç¡®é¿å…æ‰§è¡Œè¯¥æ“ä½œï¼Œå¹¶ä¸”å¦‚æžœæ‚¨çš„æ“ä½œå®žé™…ä¸Šå°šæœªå‡†å¤‡å¥½è¿è¡Œï¼Œåˆ™è¯¥æ–¹æ³•å°†å¼•å‘å¼‚å¸¸ã€‚</p>
<p>å¦‚æžœæ‚¨çš„åº”ç”¨ç¨‹åºå®šä¹‰äº†å¹¶å‘æ“ä½œå¯¹è±¡ï¼Œåˆ™è¿˜åº”è¯¥è€ƒè™‘<code>isConcurrent</code>åœ¨å¯åŠ¨å®ƒä»¬ä¹‹å‰è°ƒç”¨æ“ä½œæ–¹æ³•ã€‚åœ¨æ­¤æ–¹æ³•è¿”å›žçš„æƒ…å†µä¸‹<code>NO</code>ï¼Œæ‚¨çš„æœ¬åœ°ä»£ç å¯ä»¥å†³å®šæ˜¯åœ¨å½“å‰çº¿ç¨‹ä¸­åŒæ­¥æ‰§è¡Œæ“ä½œè¿˜æ˜¯é¦–å…ˆåˆ›å»ºå•ç‹¬çš„çº¿ç¨‹ã€‚ä½†æ˜¯ï¼Œå®žæ–½è¿™ç§æ£€æŸ¥å®Œå…¨å–å†³äºŽæ‚¨ã€‚</p>
<p>æ¸…å• 2-8 æ˜¾ç¤ºäº†åœ¨æ‰‹åŠ¨æ‰§è¡Œæ“ä½œä¹‹å‰åº”æ‰§è¡Œçš„æ£€æŸ¥ç±»åž‹çš„ç®€å•ç¤ºä¾‹ã€‚å¦‚æžœè¯¥æ–¹æ³•è¿”å›ž<code>NO</code>ï¼Œåˆ™å¯ä»¥å®‰æŽ’ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œç¨åŽå†è°ƒç”¨è¯¥æ–¹æ³•ã€‚ç„¶åŽï¼Œæ‚¨å°†ç»§ç»­é‡æ–°å®‰æŽ’è®¡æ—¶å™¨çš„æ—¶é—´ï¼Œç›´åˆ°æ–¹æ³•è¿”å›ž<code>YES</code>ï¼Œè¿™å¯èƒ½æ˜¯ç”±äºŽæ“ä½œè¢«å–æ¶ˆè€Œå‘ç”Ÿçš„ã€‚</p>
<p><strong>æ¸…å• 2-8</strong> æ‰‹åŠ¨æ‰§è¡Œæ“ä½œå¯¹è±¡</p>
<table>
<thead>
<tr>
<th><code>-ï¼ˆBOOLï¼‰performOperationï¼šï¼ˆNSOperation *ï¼‰anOp</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>BOOL ranIt = NO;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆ[anOp isReady] &amp;&amp;ï¼[anOp isCancelled]ï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆï¼[anOp isConcurrent]ï¼‰</code></td>
</tr>
<tr>
<td><code>[anOpå¼€å§‹]ï¼›</code></td>
</tr>
<tr>
<td><code>å…¶ä»–</code></td>
</tr>
<tr>
<td><code>[NSThread detachNewThreadSelectorï¼š@selectorï¼ˆå¼€å§‹ï¼‰</code></td>
</tr>
<tr>
<td><code>toTargetï¼šanOp withObjectï¼šnil];</code></td>
</tr>
<tr>
<td><code>ranIt =æ˜¯ï¼›</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>å¦åˆ™ï¼Œå¦‚æžœï¼ˆ[anOp isCancelled]ï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//å¦‚æžœåœ¨å¼€å§‹ä¹‹å‰å·²å°†å…¶å–æ¶ˆï¼Œ</code></td>
</tr>
<tr>
<td><code>//å°†æ“ä½œç§»è‡³å®ŒæˆçŠ¶æ€ã€‚</code></td>
</tr>
<tr>
<td><code>[self willChangeValueForKeyï¼š@â€œ isFinishedâ€]ï¼›</code></td>
</tr>
<tr>
<td><code>[self willChangeValueForKeyï¼š@â€œ isExecutingâ€];</code></td>
</tr>
<tr>
<td><code>æ‰§è¡Œ=å¦;</code></td>
</tr>
<tr>
<td><code>å®Œæˆ=æ˜¯ï¼›</code></td>
</tr>
<tr>
<td><code>[self didChangeValueForKeyï¼š@â€œ isExecutingâ€];</code></td>
</tr>
<tr>
<td><code>[self didChangeValueForKeyï¼š@â€œ isFinishedâ€]ï¼›</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å°†ranItè®¾ç½®ä¸ºYESï¼Œä»¥é˜²æ­¢æ“ä½œ</code></td>
</tr>
<tr>
<td><code>//å°†æ¥å†æ¬¡ä¼ é€’ç»™æ­¤æ–¹æ³•ã€‚</code></td>
</tr>
<tr>
<td><code>ranIt =æ˜¯ï¼›</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>è¿”å›žranIt;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<h6 id="å–æ¶ˆæ“ä½œ"><a href="#å–æ¶ˆæ“ä½œ" class="headerlink" title="å–æ¶ˆæ“ä½œ"></a>å–æ¶ˆæ“ä½œ</h6><p>ä¸€æ—¦æ·»åŠ åˆ°æ“ä½œé˜Ÿåˆ—ä¸­ï¼Œæ“ä½œå¯¹è±¡å°†æœ‰æ•ˆåœ°å½’é˜Ÿåˆ—æ‰€æœ‰ï¼Œå¹¶ä¸”æ— æ³•åˆ é™¤ã€‚ä½¿æ“ä½œå‡ºé˜Ÿçš„å”¯ä¸€æ–¹æ³•æ˜¯å–æ¶ˆæ“ä½œã€‚æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨å•ä¸ªæ“ä½œå¯¹è±¡çš„<code>cancel</code>æ–¹æ³•æ¥å–æ¶ˆå®ƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨<code>cancelAllOperations</code>é˜Ÿåˆ—å¯¹è±¡çš„æ–¹æ³•æ¥å–æ¶ˆé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ“ä½œå¯¹è±¡ã€‚</p>
<p>ä»…å½“ç¡®å®šä¸å†éœ€è¦æ“ä½œæ—¶ï¼Œæ‰åº”å–æ¶ˆæ“ä½œã€‚å‘å‡ºå–æ¶ˆå‘½ä»¤ä¼šå°†æ“ä½œå¯¹è±¡ç½®äºŽâ€œå·²å–æ¶ˆâ€çŠ¶æ€ï¼Œè¿™å°†é˜»æ­¢å…¶è¿è¡Œã€‚ç”±äºŽå–æ¶ˆçš„æ“ä½œä»è¢«è®¤ä¸ºæ˜¯â€œå®Œæˆâ€çš„ï¼Œå› æ­¤ä¾èµ–äºŽè¯¥æ“ä½œçš„å¯¹è±¡å°†æ”¶åˆ°é€‚å½“çš„ KVO é€šçŸ¥ä»¥æ¸…é™¤è¯¥ä¾èµ–å…³ç³»ã€‚å› æ­¤ï¼Œæ›´å¸¸è§çš„æ˜¯å“åº”æŸäº›é‡å¤§äº‹ä»¶æ¥å–æ¶ˆæ‰€æœ‰æŽ’é˜Ÿçš„æ“ä½œï¼Œä¾‹å¦‚åº”ç”¨ç¨‹åºé€€å‡ºæˆ–ç”¨æˆ·æ˜Žç¡®è¦æ±‚å–æ¶ˆï¼Œè€Œä¸æ˜¯æœ‰é€‰æ‹©åœ°å–æ¶ˆæ“ä½œã€‚</p>
<h6 id="ç­‰å¾…æ“ä½œå®Œæˆ"><a href="#ç­‰å¾…æ“ä½œå®Œæˆ" class="headerlink" title="ç­‰å¾…æ“ä½œå®Œæˆ"></a>ç­‰å¾…æ“ä½œå®Œæˆ</h6><p>ä¸ºäº†èŽ·å¾—æœ€ä½³æ€§èƒ½ï¼Œæ‚¨åº”å°†æ“ä½œè®¾è®¡ä¸ºå°½å¯èƒ½å¼‚æ­¥ï¼Œä½¿åº”ç”¨ç¨‹åºåœ¨æ‰§è¡Œæ“ä½œæ—¶å¯ä»¥è‡ªç”±æ‰§è¡Œå…¶ä»–å·¥ä½œã€‚å¦‚æžœåˆ›å»ºæ“ä½œçš„ä»£ç ä¹Ÿå¤„ç†è¯¥æ“ä½œçš„ç»“æžœï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>waitUntilFinished</code>æ–¹æ³•<code>NSOperation</code>æ¥é˜»æ­¢è¯¥ä»£ç ï¼Œç›´åˆ°æ“ä½œå®Œæˆã€‚ä½†æ˜¯ï¼Œé€šå¸¸ï¼Œå¦‚æžœå¯ä»¥å¸®åŠ©ï¼Œæœ€å¥½é¿å…è°ƒç”¨æ­¤æ–¹æ³•ã€‚é˜»å¡žå½“å‰çº¿ç¨‹å¯èƒ½æ˜¯ä¸€ä¸ªæ–¹ä¾¿çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å®ƒçš„ç¡®åœ¨ä»£ç ä¸­å¼•å…¥äº†æ›´å¤šçš„åºåˆ—åŒ–ï¼Œå¹¶é™åˆ¶äº†å¹¶å‘çš„æ€»é‡ã€‚</p>
<p><strong>é‡è¦ï¼š</strong> æ°¸è¿œä¸è¦ç­‰å¾…åº”ç”¨ç¨‹åºä¸»çº¿ç¨‹ä¸­çš„æ“ä½œã€‚æ‚¨åªèƒ½ä»Žè¾…åŠ©çº¿ç¨‹æˆ–å…¶ä»–æ“ä½œä¸­æ‰§è¡Œæ­¤æ“ä½œã€‚é˜»å¡žä¸»çº¿ç¨‹ä¼šé˜»æ­¢æ‚¨çš„åº”ç”¨ç¨‹åºå“åº”ç”¨æˆ·äº‹ä»¶ï¼Œå¹¶å¯èƒ½ä½¿æ‚¨çš„åº”ç”¨ç¨‹åºæ˜¾ç¤ºä¸ºæ— å“åº”ã€‚</p>
<p>é™¤äº†ç­‰å¾…å•ä¸ªæ“ä½œå®Œæˆä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥é€šè¿‡è°ƒç”¨çš„<code>waitUntilAllOperationsAreFinished</code>æ–¹æ³•æ¥ç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ“ä½œ<code>NSOperationQueue</code>ã€‚ç­‰å¾…æ•´ä¸ªé˜Ÿåˆ—ç»“æŸæ—¶ï¼Œè¯·æ³¨æ„æ‚¨çš„åº”ç”¨ç¨‹åºçš„å…¶ä»–çº¿ç¨‹ä»å¯ä»¥å‘é˜Ÿåˆ—æ·»åŠ æ“ä½œï¼Œä»Žè€Œå»¶é•¿äº†ç­‰å¾…æ—¶é—´ã€‚</p>
<h6 id="æŒ‚èµ·å’Œæ¢å¤é˜Ÿåˆ—"><a href="#æŒ‚èµ·å’Œæ¢å¤é˜Ÿåˆ—" class="headerlink" title="æŒ‚èµ·å’Œæ¢å¤é˜Ÿåˆ—"></a>æŒ‚èµ·å’Œæ¢å¤é˜Ÿåˆ—</h6><p>å¦‚æžœè¦æš‚æ—¶åœæ­¢æ“ä½œçš„æ‰§è¡Œï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>setSuspended:</code>æ–¹æ³•æš‚åœç›¸åº”çš„æ“ä½œé˜Ÿåˆ—ã€‚æš‚åœé˜Ÿåˆ—ä¸ä¼šå¯¼è‡´å·²ç»æ‰§è¡Œçš„æ“ä½œåœ¨å…¶ä»»åŠ¡ä¸­é—´æš‚åœã€‚å®ƒåªæ˜¯é˜²æ­¢æ–°æ“ä½œè¢«å®‰æŽ’æ‰§è¡Œã€‚æ‚¨å¯èƒ½ä¼šæš‚åœé˜Ÿåˆ—ä»¥å“åº”ç”¨æˆ·æš‚åœä»»ä½•æ­£åœ¨è¿›è¡Œçš„å·¥ä½œçš„è¯·æ±‚ï¼Œå› ä¸ºæœŸæœ›ç”¨æˆ·æœ€ç»ˆå¯èƒ½å¸Œæœ›æ¢å¤è¯¥å·¥ä½œã€‚</p>
<h2 id="è°ƒåº¦é˜Ÿåˆ—-1"><a href="#è°ƒåº¦é˜Ÿåˆ—-1" class="headerlink" title="è°ƒåº¦é˜Ÿåˆ—"></a>è°ƒåº¦é˜Ÿåˆ—</h2><p>å¤§ä¸­å¤®è°ƒåº¦ï¼ˆGCDï¼‰è°ƒåº¦é˜Ÿåˆ—æ˜¯æ‰§è¡Œä»»åŠ¡çš„å¼ºå¤§å·¥å…·ã€‚è°ƒåº¦é˜Ÿåˆ—ä½¿æ‚¨å¯ä»¥ç›¸å¯¹äºŽè°ƒç”¨è€…å¼‚æ­¥æˆ–åŒæ­¥æ‰§è¡Œä»»æ„ä»£ç å—ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è°ƒåº¦é˜Ÿåˆ—æ¥æ‰§è¡Œå‡ ä¹Žåœ¨å•ç‹¬çš„çº¿ç¨‹ä¸Šæ‰§è¡Œè¿‡çš„æ‰€æœ‰ä»»åŠ¡ã€‚è°ƒåº¦é˜Ÿåˆ—çš„ä¼˜ç‚¹æ˜¯ï¼Œä¸Žç›¸åº”çš„çº¿ç¨‹ä»£ç ç›¸æ¯”ï¼Œå®ƒä»¬æ›´æ˜“äºŽä½¿ç”¨å¹¶ä¸”åœ¨æ‰§è¡Œè¿™äº›ä»»åŠ¡æ—¶æ•ˆçŽ‡æ›´é«˜ã€‚</p>
<p>æœ¬ç« ä»‹ç»äº†åˆ†æ´¾é˜Ÿåˆ—ï¼Œä»¥åŠæœ‰å…³å¦‚ä½•åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒä»¬æ‰§è¡Œå¸¸è§„ä»»åŠ¡çš„ä¿¡æ¯ã€‚å¦‚æžœè¦ç”¨è°ƒåº¦é˜Ÿåˆ—æ›¿æ¢çŽ°æœ‰çš„çº¿ç¨‹ä»£ç ï¼Œå¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/ThreadMigration/ThreadMigration.html#//apple_ref/doc/uid/TP40008091-CH105-SW1">ã€Šä»Žçº¿ç¨‹è¿ç§»ã€‹ä¸­</a>æ‰¾åˆ°ä¸€äº›å…¶ä»–æŠ€å·§ã€‚</p>
<h4 id="å…³äºŽè°ƒåº¦é˜Ÿåˆ—"><a href="#å…³äºŽè°ƒåº¦é˜Ÿåˆ—" class="headerlink" title="å…³äºŽè°ƒåº¦é˜Ÿåˆ—"></a>å…³äºŽè°ƒåº¦é˜Ÿåˆ—</h4><p>è°ƒåº¦é˜Ÿåˆ—æ˜¯åœ¨åº”ç”¨ç¨‹åºä¸­å¼‚æ­¥å¹¶å‘æ‰§è¡Œä»»åŠ¡çš„ç®€ä¾¿æ–¹æ³•ã€‚ä¸€ä¸ª<em>ä»»åŠ¡</em>å¾ˆç®€å•ï¼Œå°±æ˜¯ä½ çš„åº”ç”¨ç¨‹åºéœ€è¦æ‰§è¡Œä¸€äº›å·¥ä½œã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å®šä¹‰ä»»åŠ¡æ¥æ‰§è¡Œä¸€äº›è®¡ç®—ï¼Œåˆ›å»ºæˆ–ä¿®æ”¹æ•°æ®ç»“æž„ï¼Œå¤„ç†ä»Žæ–‡ä»¶ä¸­è¯»å–çš„æŸäº›æ•°æ®æˆ–ä»»ä½•å…¶ä»–äº‹ç‰©ã€‚é€šè¿‡å°†ç›¸åº”çš„ä»£ç æ”¾åœ¨å‡½æ•°æˆ–å—å¯¹è±¡å†…å¹¶å°†å…¶æ·»åŠ åˆ°è°ƒåº¦é˜Ÿåˆ—ä¸­ï¼Œå¯ä»¥å®šä¹‰ä»»åŠ¡ã€‚</p>
<p>è°ƒåº¦é˜Ÿåˆ—æ˜¯ä¸€ä¸ªç±»ä¼¼å¯¹è±¡çš„ç»“æž„ï¼Œç”¨äºŽç®¡ç†æ‚¨æäº¤ç»™å®ƒçš„ä»»åŠ¡ã€‚æ‰€æœ‰è°ƒåº¦é˜Ÿåˆ—å‡ä¸ºå…ˆè¿›å…ˆå‡ºæ•°æ®ç»“æž„ã€‚å› æ­¤ï¼Œæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å§‹ç»ˆä»¥ä¸Žæ·»åŠ ä»»åŠ¡ç›¸åŒçš„é¡ºåºå¯åŠ¨ã€‚GCD è‡ªåŠ¨ä¸ºæ‚¨æä¾›äº†ä¸€äº›è°ƒåº¦é˜Ÿåˆ—ï¼Œä½†æ‚¨å¯ä»¥ä¸ºç‰¹å®šç›®çš„åˆ›å»ºå…¶ä»–è°ƒåº¦é˜Ÿåˆ—ã€‚è¡¨ 3-1 åˆ—å‡ºäº†å¯ç”¨äºŽæ‚¨çš„åº”ç”¨ç¨‹åºçš„è°ƒåº¦é˜Ÿåˆ—çš„ç±»åž‹ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚</p>
<table>
<thead>
<tr>
<th align="left">ç±»åž‹</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">åºåˆ—å·</td>
<td align="left">ä¸²è¡Œé˜Ÿåˆ—ï¼ˆä¹Ÿç§°ä¸º<em>ä¸“ç”¨è°ƒåº¦é˜Ÿåˆ—</em>ï¼‰æŒ‰æ·»åŠ åˆ°é˜Ÿåˆ—çš„é¡ºåºä¸€æ¬¡æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚å½“å‰æ‰§è¡Œçš„ä»»åŠ¡åœ¨åˆ†æ´¾é˜Ÿåˆ—ç®¡ç†çš„ä¸åŒçº¿ç¨‹ï¼ˆéšä»»åŠ¡çš„ä¸åŒè€Œä¸åŒï¼‰ä¸Šè¿è¡Œã€‚ä¸²è¡Œé˜Ÿåˆ—é€šå¸¸ç”¨äºŽåŒæ­¥å¯¹ç‰¹å®šèµ„æºçš„è®¿é—®ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºä»»æ„æ•°é‡çš„ä¸²è¡Œé˜Ÿåˆ—ï¼Œå¹¶ä¸”æ¯ä¸ªé˜Ÿåˆ—ç›¸å¯¹äºŽæ‰€æœ‰å…¶ä»–é˜Ÿåˆ—å¯ä»¥åŒæ—¶è¿è¡Œã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æžœåˆ›å»ºå››ä¸ªä¸²è¡Œé˜Ÿåˆ—ï¼Œåˆ™æ¯ä¸ªé˜Ÿåˆ—ä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œä½†æ˜¯æœ€å¤šä»å¯ä»¥åŒæ—¶æ‰§è¡Œå››ä¸ªä»»åŠ¡ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¸€ä¸ªã€‚æœ‰å…³å¦‚ä½•åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—çš„ä¿¡æ¯ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW6">åˆ›å»ºä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—</a>ã€‚</td>
</tr>
<tr>
<td align="left">åŒæ—¶</td>
<td align="left">å¹¶å‘é˜Ÿåˆ—ï¼ˆä¹Ÿç§°ä¸º<em>å…¨å±€è°ƒåº¦é˜Ÿåˆ—çš„ä¸€ç§</em>ï¼‰å¯ä»¥å¹¶å‘æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡ï¼Œä½†æ˜¯ä»»åŠ¡ä»ç„¶æŒ‰ç…§å®ƒä»¬æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„é¡ºåºå¯åŠ¨ã€‚å½“å‰æ‰§è¡Œçš„ä»»åŠ¡åœ¨åˆ†æ´¾é˜Ÿåˆ—ç®¡ç†çš„ä¸åŒçº¿ç¨‹ä¸Šè¿è¡Œã€‚åœ¨ä»»ä½•ç»™å®šç‚¹æ‰§è¡Œçš„ä»»åŠ¡çš„ç¡®åˆ‡æ•°é‡æ˜¯å¯å˜çš„ï¼Œå¹¶ä¸”å–å†³äºŽç³»ç»Ÿæ¡ä»¶ã€‚åœ¨ iOS 5 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡æŒ‡å®š<code>DISPATCH_QUEUE_CONCURRENT</code>ä½œä¸ºé˜Ÿåˆ—ç±»åž‹æ¥è‡ªå·±åˆ›å»ºå¹¶å‘è°ƒåº¦é˜Ÿåˆ—ã€‚å¦å¤–ï¼Œæœ‰å››ä¸ªé¢„å®šä¹‰çš„å…¨å±€å¹¶å‘é˜Ÿåˆ—ä¾›æ‚¨çš„åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚æœ‰å…³å¦‚ä½•èŽ·å–å…¨å±€å¹¶å‘é˜Ÿåˆ—çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW5">èŽ·å–å…¨å±€å¹¶å‘è°ƒåº¦é˜Ÿåˆ—</a>ã€‚</td>
</tr>
<tr>
<td align="left">ä¸»è°ƒåº¦é˜Ÿåˆ—</td>
<td align="left">ä¸»è°ƒåº¦é˜Ÿåˆ—æ˜¯å…¨å±€å¯ç”¨çš„ä¸²è¡Œé˜Ÿåˆ—ï¼Œå¯åœ¨åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œä»»åŠ¡ã€‚è¯¥é˜Ÿåˆ—ä¸Žåº”ç”¨ç¨‹åºçš„è¿è¡Œå¾ªçŽ¯ï¼ˆå¦‚æžœå­˜åœ¨ï¼‰ä¸€èµ·å·¥ä½œï¼Œä»¥ä½¿æŽ’é˜Ÿä»»åŠ¡çš„æ‰§è¡Œä¸Žé™„åŠ åˆ°è¿è¡Œå¾ªçŽ¯çš„å…¶ä»–äº‹ä»¶æºçš„æ‰§è¡Œäº¤ç»‡åœ¨ä¸€èµ·ã€‚å› ä¸ºå®ƒåœ¨åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ä¸Šè¿è¡Œï¼Œæ‰€ä»¥é€šå¸¸å°†å…¶ç”¨ä½œåº”ç”¨ç¨‹åºçš„å…³é”®åŒæ­¥ç‚¹ã€‚å°½ç®¡æ‚¨æ— éœ€åˆ›å»ºä¸»è°ƒåº¦é˜Ÿåˆ—ï¼Œä½†ä»éœ€è¦ç¡®ä¿åº”ç”¨ç¨‹åºé€‚å½“åœ°è€—å°½å®ƒã€‚æœ‰å…³å¦‚ä½•ç®¡ç†æ­¤é˜Ÿåˆ—çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW15">åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œä»»åŠ¡</a>ã€‚</td>
</tr>
</tbody></table>
<p>å½“æ¶‰åŠåˆ°å‘åº”ç”¨ç¨‹åºæ·»åŠ å¹¶å‘æ—¶ï¼Œåˆ†æ´¾é˜Ÿåˆ—æä¾›äº†ä¸€äº›ä¼˜äºŽçº¿ç¨‹çš„ä¼˜ç‚¹ã€‚æœ€ç›´æŽ¥çš„å¥½å¤„æ˜¯å·¥ä½œé˜Ÿåˆ—ç¼–ç¨‹æ¨¡åž‹çš„ç®€å•æ€§ã€‚ä½¿ç”¨çº¿ç¨‹ï¼Œæ‚¨å¿…é¡»ä¸ºè¦æ‰§è¡Œçš„å·¥ä½œä»¥åŠçº¿ç¨‹æœ¬èº«çš„åˆ›å»ºå’Œç®¡ç†ç¼–å†™ä»£ç ã€‚è°ƒåº¦é˜Ÿåˆ—ä½¿æ‚¨å¯ä»¥ä¸“æ³¨äºŽå®žé™…è¦æ‰§è¡Œçš„å·¥ä½œï¼Œè€Œä¸å¿…æ‹…å¿ƒçº¿ç¨‹çš„åˆ›å»ºå’Œç®¡ç†ã€‚è€Œæ˜¯ç”±ç³»ç»Ÿä¸ºæ‚¨å¤„ç†æ‰€æœ‰çº¿ç¨‹çš„åˆ›å»ºå’Œç®¡ç†ã€‚ä¼˜ç‚¹æ˜¯è¯¥ç³»ç»Ÿæ¯”ä»»ä½•å•ä¸ªåº”ç”¨ç¨‹åºéƒ½èƒ½å¤Ÿæ›´æœ‰æ•ˆåœ°ç®¡ç†çº¿ç¨‹ã€‚ç³»ç»Ÿå¯ä»¥æ ¹æ®å¯ç”¨èµ„æºå’Œå½“å‰ç³»ç»ŸçŠ¶å†µåŠ¨æ€æ‰©å±•çº¿ç¨‹æ•°é‡ã€‚æ­¤å¤–ï¼Œ</p>
<p>å°½ç®¡æ‚¨å¯èƒ½è®¤ä¸ºå¾ˆéš¾ä¸ºè°ƒåº¦é˜Ÿåˆ—é‡å†™ä»£ç ï¼Œä½†æ˜¯ä¸ºè°ƒåº¦é˜Ÿåˆ—ç¼–å†™ä»£ç é€šå¸¸æ¯”ä¸ºçº¿ç¨‹ç¼–å†™ä»£ç å®¹æ˜“ã€‚ç¼–å†™ä»£ç çš„å…³é”®æ˜¯è®¾è®¡ç‹¬ç«‹ä¸”èƒ½å¤Ÿå¼‚æ­¥è¿è¡Œçš„ä»»åŠ¡ã€‚ï¼ˆå®žé™…ä¸Šï¼Œè¿™å¯¹äºŽçº¿ç¨‹å’Œè°ƒåº¦é˜Ÿåˆ—éƒ½æ˜¯æ­£ç¡®çš„ã€‚ï¼‰ä½†æ˜¯ï¼Œè°ƒåº¦é˜Ÿåˆ—å…·æœ‰ä¼˜åŠ¿çš„æ˜¯å¯é¢„æµ‹æ€§ã€‚å¦‚æžœæ‚¨æœ‰ä¸¤ä¸ªä»»åŠ¡è®¿é—®ç›¸åŒçš„å…±äº«èµ„æºä½†åœ¨ä¸åŒçš„çº¿ç¨‹ä¸Šè¿è¡Œï¼Œåˆ™æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥é¦–å…ˆä¿®æ”¹èµ„æºï¼Œå¹¶ä¸”æ‚¨éœ€è¦ä½¿ç”¨é”æ¥ç¡®ä¿è¿™ä¸¤ä¸ªä»»åŠ¡ä¸ä¼šåŒæ—¶ä¿®æ”¹è¯¥èµ„æºã€‚ä½¿ç”¨è°ƒåº¦é˜Ÿåˆ—ï¼Œæ‚¨å¯ä»¥å°†ä¸¤ä¸ªä»»åŠ¡éƒ½æ·»åŠ åˆ°ä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—ä¸­ï¼Œä»¥ç¡®ä¿åœ¨ä»»ä½•ç»™å®šæ—¶é—´åªæœ‰ä¸€ä¸ªä»»åŠ¡ä¿®æ”¹äº†èµ„æºã€‚</p>
<p>å°½ç®¡æ‚¨å¯èƒ½æ­£ç¡®åœ°æŒ‡å‡ºäº†åœ¨ä¸²è¡Œé˜Ÿåˆ—ä¸­è¿è¡Œçš„ä¸¤ä¸ªä»»åŠ¡ä¸èƒ½åŒæ—¶è¿è¡Œï¼Œä½†æ˜¯æ‚¨å¿…é¡»è®°ä½ï¼Œå¦‚æžœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œé”å®šï¼Œåˆ™çº¿ç¨‹æä¾›çš„ä»»ä½•å¹¶å‘æ€§éƒ½ä¼šä¸¢å¤±æˆ–æ˜¾ç€å‡å°‘ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œçº¿ç¨‹æ¨¡åž‹éœ€è¦åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å ç”¨å†…æ ¸å’Œç”¨æˆ·ç©ºé—´å†…å­˜ã€‚è°ƒåº¦é˜Ÿåˆ—ä¸ä¼šä¸ºå®ƒä»¬çš„çº¿ç¨‹æ”¯ä»˜ç›¸åŒçš„å†…å­˜æŸå¤±ï¼Œå¹¶ä¸”å®ƒä»¬ä½¿ç”¨çš„çº¿ç¨‹å°†ä¿æŒç¹å¿™å¹¶ä¸”ä¸ä¼šè¢«é˜»å¡žã€‚</p>
<p>å…³äºŽè°ƒåº¦é˜Ÿåˆ—ï¼Œéœ€è¦è®°ä½çš„å…¶ä»–ä¸€äº›å…³é”®ç‚¹åŒ…æ‹¬ï¼š</p>
<ul>
<li>è°ƒåº¦é˜Ÿåˆ—ç›¸å¯¹äºŽå…¶ä»–è°ƒåº¦é˜Ÿåˆ—åŒæ—¶æ‰§è¡Œå…¶ä»»åŠ¡ã€‚ä»»åŠ¡çš„åºåˆ—åŒ–ä»…é™äºŽå•ä¸ªè°ƒåº¦é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</li>
<li>ç³»ç»Ÿç¡®å®šä»»ä½•ä¸€æ¬¡æ‰§è¡Œçš„ä»»åŠ¡æ€»æ•°ã€‚å› æ­¤ï¼Œåœ¨ 100 ä¸ªä¸åŒçš„é˜Ÿåˆ—ä¸­å…·æœ‰ 100 ä¸ªä»»åŠ¡çš„åº”ç”¨ç¨‹åºå¯èƒ½ä¸ä¼šå¹¶å‘æ‰§è¡Œæ‰€æœ‰è¿™äº›ä»»åŠ¡ï¼ˆé™¤éžå®ƒå…·æœ‰ 100 ä¸ªæˆ–æ›´å¤šä¸ªæœ‰æ•ˆå†…æ ¸ï¼‰ã€‚</li>
<li>é€‰æ‹©è¦å¯åŠ¨çš„æ–°ä»»åŠ¡æ—¶ï¼Œç³»ç»Ÿä¼šè€ƒè™‘é˜Ÿåˆ—ä¼˜å…ˆçº§ã€‚æœ‰å…³å¦‚ä½•è®¾ç½®ä¸²è¡Œé˜Ÿåˆ—çš„ä¼˜å…ˆçº§çš„ä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW7">ä¸º</a>é˜Ÿåˆ—<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW7">æä¾›æ¸…ç†åŠŸèƒ½</a>ã€‚</li>
<li>é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡åœ¨æ·»åŠ åˆ°é˜Ÿåˆ—æ—¶å¿…é¡»å‡†å¤‡å°±ç»ªæ‰èƒ½æ‰§è¡Œã€‚ï¼ˆå¦‚æžœæ‚¨ä»¥å‰ä½¿ç”¨è¿‡ Cocoa æ“ä½œå¯¹è±¡ï¼Œè¯·æ³¨æ„ï¼Œæ­¤è¡Œä¸ºä¸åŒäºŽæ¨¡åž‹æ“ä½œä½¿ç”¨çš„è¡Œä¸ºã€‚ï¼‰</li>
<li>ä¸“ç”¨è°ƒåº¦é˜Ÿåˆ—æ˜¯å¼•ç”¨è®¡æ•°çš„å¯¹è±¡ã€‚è¯·æ³¨æ„ï¼Œé™¤äº†å°†é˜Ÿåˆ—ä¿ç•™åœ¨æ‚¨è‡ªå·±çš„ä»£ç ä¸­ä¹‹å¤–ï¼Œè¿˜å¯ä»¥å°†è°ƒåº¦æºé™„åŠ åˆ°é˜Ÿåˆ—å¹¶å¢žåŠ å…¶ä¿ç•™è®¡æ•°ã€‚å› æ­¤ï¼Œæ‚¨å¿…é¡»ç¡®ä¿å–æ¶ˆæ‰€æœ‰è°ƒåº¦æºï¼Œå¹¶é€šè¿‡é€‚å½“çš„é‡Šæ”¾è°ƒç”¨å¹³è¡¡æ‰€æœ‰ä¿ç•™è°ƒç”¨ã€‚æœ‰å…³ä¿ç•™å’Œé‡Šæ”¾é˜Ÿåˆ—çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW11">è°ƒåº¦é˜Ÿåˆ—çš„å†…å­˜ç®¡ç†</a>ã€‚æœ‰å…³è°ƒåº¦æºçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW12">å…³äºŽè°ƒåº¦æº</a>ã€‚</li>
</ul>
<p>æœ‰å…³ç”¨äºŽæ“ä½œè°ƒåº¦é˜Ÿåˆ—çš„æŽ¥å£çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<em>Grand Central Dispatchï¼ˆGCDï¼‰å‚è€ƒ</em>ã€‚</p>
<h4 id="é˜Ÿåˆ—ç›¸å…³æŠ€æœ¯"><a href="#é˜Ÿåˆ—ç›¸å…³æŠ€æœ¯" class="headerlink" title="é˜Ÿåˆ—ç›¸å…³æŠ€æœ¯"></a>é˜Ÿåˆ—ç›¸å…³æŠ€æœ¯</h4><p>é™¤äº†è°ƒåº¦é˜Ÿåˆ—ï¼ŒGrand Central Dispatch è¿˜æä¾›äº†å‡ ç§ä½¿ç”¨é˜Ÿåˆ—çš„æŠ€æœ¯æ¥å¸®åŠ©æ‚¨ç®¡ç†ä»£ç ã€‚è¡¨ 3-2 åˆ—å‡ºäº†è¿™äº›æŠ€æœ¯ï¼Œå¹¶æä¾›äº†æŒ‡å‘æ‚¨å¯ä»¥æ‰¾åˆ°æœ‰å…³å®ƒä»¬çš„æ›´å¤šä¿¡æ¯çš„é“¾æŽ¥ã€‚</p>
<table>
<thead>
<tr>
<th align="left">æŠ€æœ¯</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">æ´¾é£ç»„</td>
<td align="left">è°ƒåº¦ç»„æ˜¯ä¸€ç§ç›‘è§†ä¸€ç»„å—å¯¹è±¡æ˜¯å¦å®Œæˆçš„æ–¹æ³•ã€‚ï¼ˆæ‚¨å¯ä»¥æ ¹æ®éœ€è¦åŒæ­¥æˆ–å¼‚æ­¥ç›‘è§†è¿™äº›å—ã€‚ï¼‰ç»„ä¸ºä¾èµ–äºŽå…¶ä»–ä»»åŠ¡å®Œæˆçš„ä»£ç æä¾›äº†ä¸€ç§æœ‰ç”¨çš„åŒæ­¥æœºåˆ¶ã€‚æœ‰å…³ä½¿ç”¨ç»„çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW25">ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ç»„</a>ã€‚</td>
</tr>
<tr>
<td align="left">è°ƒåº¦ä¿¡å·é‡</td>
<td align="left">è°ƒåº¦ä¿¡å·é‡ä¸Žä¼ ç»Ÿä¿¡å·é‡ç›¸ä¼¼ï¼Œä½†é€šå¸¸æ›´ä¸ºæœ‰æ•ˆã€‚ä»…å½“ç”±äºŽä¿¡å·é‡ä¸å¯ç”¨è€Œéœ€è¦é˜»å¡žè°ƒç”¨çº¿ç¨‹æ—¶ï¼Œè°ƒåº¦ä¿¡å·é‡æ‰è°ƒç”¨å†…æ ¸ã€‚å¦‚æžœä¿¡å·ç¯å¯ç”¨ï¼Œåˆ™ä¸è¿›è¡Œå†…æ ¸è°ƒç”¨ã€‚æœ‰å…³å¦‚ä½•ä½¿ç”¨è°ƒåº¦ä¿¡å·é‡çš„ç¤ºä¾‹ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW24">ä½¿ç”¨è°ƒåº¦ä¿¡å·é‡æ¥è°ƒèŠ‚æœ‰é™èµ„æºçš„ä½¿ç”¨</a>ã€‚</td>
</tr>
<tr>
<td align="left">æ´¾é£æ¥æº</td>
<td align="left">è°ƒåº¦æºå“åº”äºŽç‰¹å®šç±»åž‹çš„ç³»ç»Ÿäº‹ä»¶è€Œç”Ÿæˆé€šçŸ¥ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è°ƒåº¦æºæ¥ç›‘è§†äº‹ä»¶ï¼Œä¾‹å¦‚æµç¨‹é€šçŸ¥ï¼Œä¿¡å·å’Œæè¿°ç¬¦äº‹ä»¶ã€‚å‘ç”Ÿäº‹ä»¶æ—¶ï¼Œè°ƒåº¦æºå°†æ‚¨çš„ä»»åŠ¡ä»£ç å¼‚æ­¥æäº¤åˆ°æŒ‡å®šçš„è°ƒåº¦é˜Ÿåˆ—è¿›è¡Œå¤„ç†ã€‚æœ‰å…³åˆ›å»ºå’Œä½¿ç”¨è°ƒåº¦æºçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW1">è°ƒåº¦æº</a>ã€‚</td>
</tr>
</tbody></table>
<h4 id="ä½¿ç”¨å—å®žçŽ°ä»»åŠ¡"><a href="#ä½¿ç”¨å—å®žçŽ°ä»»åŠ¡" class="headerlink" title="ä½¿ç”¨å—å®žçŽ°ä»»åŠ¡"></a>ä½¿ç”¨å—å®žçŽ°ä»»åŠ¡</h4><p>å—å¯¹è±¡æ˜¯ä¸€ç§åŸºäºŽ C çš„è¯­è¨€åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ Cï¼Œ Objective-C å’Œ C ++ä»£ç ä¸­ä½¿ç”¨ã€‚å—ä½¿å®šä¹‰ä¸€ä¸ªç‹¬ç«‹çš„å·¥ä½œå•å…ƒå˜å¾—å®¹æ˜“ã€‚å°½ç®¡å®ƒä»¬çœ‹èµ·æ¥ç±»ä¼¼äºŽå‡½æ•°æŒ‡é’ˆï¼Œä½†å®žé™…ä¸Šæ˜¯ç”±ç±»ä¼¼äºŽå¯¹è±¡çš„åŸºç¡€æ•°æ®ç»“æž„è¡¨ç¤ºä¸€ä¸ªå—ï¼Œå¹¶ç”±ç¼–è¯‘å™¨ä¸ºæ‚¨åˆ›å»ºå’Œç®¡ç†è¯¥å—ã€‚ç¼–è¯‘å™¨æ‰“åŒ…æ‚¨æä¾›çš„ä»£ç ï¼ˆä»¥åŠæ‰€æœ‰ç›¸å…³æ•°æ®ï¼‰ï¼Œå¹¶å°†å…¶å°è£…ä¸ºå¯å­˜åœ¨äºŽå †ä¸­å¹¶åœ¨åº”ç”¨ç¨‹åºä¸­ä¼ é€’çš„å½¢å¼ã€‚</p>
<p>å—çš„ä¸»è¦ä¼˜ç‚¹ä¹‹ä¸€æ˜¯å®ƒä»¬èƒ½å¤Ÿä½¿ç”¨å…¶è¯æ³•èŒƒå›´ä¹‹å¤–çš„å˜é‡ã€‚å½“æ‚¨åœ¨å‡½æ•°æˆ–æ–¹æ³•ä¸­å®šä¹‰ä¸€ä¸ªå—æ—¶ï¼Œè¯¥å—åœ¨æŸäº›æ–¹é¢å¯ä»¥å……å½“ä¼ ç»Ÿä»£ç å—ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå—å¯ä»¥è¯»å–åœ¨çˆ¶ä½œç”¨åŸŸä¸­å®šä¹‰çš„å˜é‡çš„å€¼ã€‚å—è®¿é—®çš„å˜é‡è¢«å¤åˆ¶åˆ°å †ä¸Šçš„å—æ•°æ®ç»“æž„ä¸­ï¼Œä»¥ä¾¿å—ç¨åŽå¯ä»¥è®¿é—®å®ƒä»¬ã€‚å°†å—æ·»åŠ åˆ°è°ƒåº¦é˜Ÿåˆ—æ—¶ï¼Œé€šå¸¸å¿…é¡»å°†è¿™äº›å€¼ä¿ç•™ä¸ºåªè¯»æ ¼å¼ã€‚ä½†æ˜¯ï¼ŒåŒæ­¥æ‰§è¡Œçš„å—ä¹Ÿå¯ä»¥ä½¿ç”¨å¸¦æœ‰<code>__block</code>å…³é”®å­—å‰ç¼€çš„å˜é‡ï¼Œä»¥å°†æ•°æ®è¿”å›žåˆ°çˆ¶çº§çš„è°ƒç”¨èŒƒå›´ã€‚</p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ç±»ä¼¼äºŽå‡½æ•°æŒ‡é’ˆçš„è¯­æ³•æ¥å£°æ˜Žä¸Žä»£ç å†…è”çš„å—ã€‚å—å’Œå‡½æ•°æŒ‡é’ˆä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äºŽï¼Œå—åå‰é¢å¸¦æœ‰è„±å­—ç¬¦å·ï¼ˆ<code>^</code>ï¼‰è€Œä¸æ˜¯æ˜Ÿå·ï¼ˆ<code>*</code>ï¼‰ã€‚åƒå‡½æ•°æŒ‡é’ˆä¸€æ ·ï¼Œæ‚¨å¯ä»¥å°†å‚æ•°ä¼ é€’ç»™å—å¹¶ä»Žä¸­æŽ¥æ”¶è¿”å›žå€¼ã€‚æ¸…å• 3-1 æ˜¾ç¤ºäº†å¦‚ä½•åœ¨ä»£ç ä¸­åŒæ­¥å£°æ˜Žå’Œæ‰§è¡Œå—ã€‚è¯¥å˜é‡<code>aBlock</code>å£°æ˜Žä¸ºé‡‡ç”¨å•ä¸ªæ•´æ•°å‚æ•°ä¸”ä¸è¿”å›žä»»ä½•å€¼çš„å—ã€‚ç„¶åŽå°†ä¸Žè¯¥åŽŸåž‹åŒ¹é…çš„å®žé™…å—åˆ†é…ç»™<code>aBlock</code>å¹¶å£°æ˜Žä¸ºå†…è”ã€‚æœ€åŽä¸€è¡Œç«‹å³æ‰§è¡Œè¯¥å—ï¼Œå°†æŒ‡å®šçš„æ•´æ•°æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºä¸­ã€‚</p>
<p><strong>æ¸…å• 3-1</strong> ä¸€ä¸ªç®€å•çš„å—ç¤ºä¾‹</p>
<table>
<thead>
<tr>
<th><code>int x = 123;</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>æ•´æ•°y = 456;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å—å£°æ˜Žå’Œèµ‹å€¼</code></td>
</tr>
<tr>
<td><code>æ— æ•ˆï¼ˆ^ aBlockï¼‰ï¼ˆintï¼‰= ^ï¼ˆint zï¼‰{</code></td>
</tr>
<tr>
<td><code>printfï¼ˆâ€œï¼…dï¼…dï¼…d \ nâ€ï¼Œxï¼Œyï¼Œzï¼‰;</code></td>
</tr>
<tr>
<td><code>};</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//æ‰§è¡Œå—</code></td>
</tr>
<tr>
<td><code>aBlockï¼ˆ789ï¼‰; //æ‰“å°ï¼š123456789</code></td>
</tr>
</tbody></table>
<p>ä»¥ä¸‹æ˜¯è®¾è®¡æ¨¡å—æ—¶åº”è€ƒè™‘çš„ä¸€äº›å…³é”®å‡†åˆ™çš„æ‘˜è¦ï¼š</p>
<ul>
<li>å¯¹äºŽè®¡åˆ’ä½¿ç”¨åˆ†æ´¾é˜Ÿåˆ—å¼‚æ­¥æ‰§è¡Œçš„å—ï¼Œå¯ä»¥ä»Žçˆ¶å‡½æ•°æˆ–æ–¹æ³•ä¸­æ•èŽ·æ ‡é‡å˜é‡å¹¶å°†å…¶ç”¨äºŽå—ä¸­ï¼Œè¿™æ˜¯å®‰å…¨çš„ã€‚ä½†æ˜¯ï¼Œæ‚¨ä¸åº”å°è¯•æ•èŽ·ç”±è°ƒç”¨ä¸Šä¸‹æ–‡åˆ†é…å’Œåˆ é™¤çš„å¤§åž‹ç»“æž„æˆ–å…¶ä»–åŸºäºŽæŒ‡é’ˆçš„å˜é‡ã€‚åœ¨æ‚¨çš„å—æ‰§è¡Œæ—¶ï¼Œè¯¥æŒ‡é’ˆå¼•ç”¨çš„å†…å­˜å¯èƒ½ä¼šæ¶ˆå¤±ã€‚å½“ç„¶ï¼Œè‡ªå·±åˆ†é…å†…å­˜ï¼ˆæˆ–å¯¹è±¡ï¼‰å¹¶å°†è¯¥å†…å­˜çš„æ‰€æœ‰æƒæ˜Žç¡®ç§»äº¤ç»™è¯¥å—æ˜¯å®‰å…¨çš„ã€‚</li>
<li>è°ƒåº¦é˜Ÿåˆ—å¤åˆ¶æ·»åŠ åˆ°å…¶ä¸­çš„å—ï¼Œå¹¶åœ¨å®Œæˆæ‰§è¡Œæ—¶é‡Šæ”¾å—ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨å°†å—æ·»åŠ åˆ°é˜Ÿåˆ—ä¹‹å‰ï¼Œæ— éœ€æ˜¾å¼å¤åˆ¶å—ã€‚</li>
<li>å°½ç®¡åœ¨æ‰§è¡Œå°ä»»åŠ¡æ—¶ï¼Œé˜Ÿåˆ—æ¯”åŽŸå§‹çº¿ç¨‹æ›´æœ‰æ•ˆï¼Œä½†æ˜¯åˆ›å»ºå—å¹¶åœ¨é˜Ÿåˆ—ä¸Šæ‰§è¡Œå®ƒä»¬ä»ç„¶æœ‰å¼€é”€ã€‚å¦‚æžœä¸€ä¸ªå—çš„å·¥ä½œé‡å¤ªå°‘ï¼Œåˆ™ä»¥å†…è”æ–¹å¼æ‰§è¡Œå®ƒæ¯”å°†å…¶åˆ†é…åˆ°é˜Ÿåˆ—ä¸­è¦ä¾¿å®œã€‚åˆ¤æ–­æŸä¸ªå—æ˜¯å¦å·¥ä½œé‡å¤ªå°‘çš„æ–¹æ³•æ˜¯ä½¿ç”¨æ€§èƒ½å·¥å…·æ”¶é›†æ¯ä¸ªè·¯å¾„çš„æŒ‡æ ‡å¹¶è¿›è¡Œæ¯”è¾ƒã€‚</li>
<li>ä¸è¦ç¼“å­˜ç›¸å¯¹äºŽåŸºç¡€çº¿ç¨‹çš„æ•°æ®ï¼Œå¹¶å¸Œæœ›å¯ä»¥ä»Žå…¶ä»–å—è®¿é—®è¯¥æ•°æ®ã€‚å¦‚æžœåŒä¸€é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡éœ€è¦å…±äº«æ•°æ®ï¼Œè¯·æ”¹ç”¨åˆ†æ´¾é˜Ÿåˆ—çš„ä¸Šä¸‹æ–‡æŒ‡é’ˆå­˜å‚¨æ•°æ®ã€‚æœ‰å…³å¦‚ä½•è®¿é—®è°ƒåº¦é˜Ÿåˆ—çš„ä¸Šä¸‹æ–‡æ•°æ®çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ä½¿ç”¨é˜Ÿåˆ—<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW13">å­˜å‚¨è‡ªå®šä¹‰ä¸Šä¸‹æ–‡ä¿¡æ¯</a>ã€‚</li>
<li>å¦‚æžœæ‚¨çš„å—åˆ›å»ºäº†å¤šä¸ª Objective-C å¯¹è±¡ï¼Œåˆ™å¯èƒ½éœ€è¦å°†éƒ¨åˆ†ä»£ç çš„ä»£ç å°è£…åœ¨@autorelease å—ä¸­ï¼Œä»¥å¤„ç†è¿™äº›å¯¹è±¡çš„å†…å­˜ç®¡ç†ã€‚å°½ç®¡ GCD è°ƒåº¦é˜Ÿåˆ—å…·æœ‰è‡ªå·±çš„è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œä½†å®ƒä»¬ä¸ä¿è¯è¿™äº›æ± ä½•æ—¶è€—å°½ã€‚å¦‚æžœæ‚¨çš„åº”ç”¨ç¨‹åºå—å†…å­˜é™åˆ¶ï¼Œåˆ™åˆ›å»ºè‡ªå·±çš„è‡ªåŠ¨é‡Šæ”¾æ± å¯è®©æ‚¨ä»¥æ›´è§„åˆ™çš„æ—¶é—´é—´éš”é‡Šæ”¾è‡ªåŠ¨é‡Šæ”¾å¯¹è±¡çš„å†…å­˜ã€‚</li>
</ul>
<p>æœ‰å…³å—çš„æ›´å¤šä¿¡æ¯ï¼ŒåŒ…æ‹¬å¦‚ä½•å£°æ˜Žå’Œä½¿ç”¨å®ƒä»¬ï¼Œè¯·å‚è§*<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Blocks/Articles/00_Introduction.html#//apple_ref/doc/uid/TP40007502">å—ç¼–ç¨‹ä¸»é¢˜</a>*ã€‚æœ‰å…³å¦‚ä½•å°†å—æ·»åŠ åˆ°è°ƒåº¦é˜Ÿåˆ—ä¸­çš„ä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW20">å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­</a>ã€‚</p>
<h4 id="åˆ›å»ºå’Œç®¡ç†è°ƒåº¦é˜Ÿåˆ—"><a href="#åˆ›å»ºå’Œç®¡ç†è°ƒåº¦é˜Ÿåˆ—" class="headerlink" title="åˆ›å»ºå’Œç®¡ç†è°ƒåº¦é˜Ÿåˆ—"></a>åˆ›å»ºå’Œç®¡ç†è°ƒåº¦é˜Ÿåˆ—</h4><p>åœ¨å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¹‹å‰ï¼Œå¿…é¡»ç¡®å®šè¦ä½¿ç”¨çš„é˜Ÿåˆ—ç±»åž‹ä»¥åŠæ‰“ç®—å¦‚ä½•ä½¿ç”¨å®ƒã€‚è°ƒåº¦é˜Ÿåˆ—å¯ä»¥ä¸²è¡Œæˆ–å¹¶è¡Œæ‰§è¡Œä»»åŠ¡ã€‚å¦å¤–ï¼Œå¦‚æžœæ‚¨å¯¹é˜Ÿåˆ—æœ‰ç‰¹å®šçš„ç”¨é€”ï¼Œåˆ™å¯ä»¥ç›¸åº”åœ°é…ç½®é˜Ÿåˆ—å±žæ€§ã€‚ä»¥ä¸‹å„èŠ‚è¯´æ˜Žå¦‚ä½•åˆ›å»ºè°ƒåº¦é˜Ÿåˆ—å¹¶é…ç½®å®ƒä»¬ä»¥ä¾›ä½¿ç”¨ã€‚</p>
<h6 id="èŽ·å–å…¨å±€å¹¶å‘è°ƒåº¦é˜Ÿåˆ—"><a href="#èŽ·å–å…¨å±€å¹¶å‘è°ƒåº¦é˜Ÿåˆ—" class="headerlink" title="èŽ·å–å…¨å±€å¹¶å‘è°ƒåº¦é˜Ÿåˆ—"></a>èŽ·å–å…¨å±€å¹¶å‘è°ƒåº¦é˜Ÿåˆ—</h6><p>å½“æ‚¨æœ‰å¤šä¸ªå¯ä»¥å¹¶è¡Œè¿è¡Œçš„ä»»åŠ¡æ—¶ï¼Œå¹¶å‘è°ƒåº¦é˜Ÿåˆ—å¾ˆæœ‰ç”¨ã€‚å¹¶å‘é˜Ÿåˆ—ä»ç„¶æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå› ä¸ºå®ƒæŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºä½¿ä»»åŠ¡å‡ºé˜Ÿã€‚ä½†æ˜¯ï¼Œå¹¶å‘é˜Ÿåˆ—å¯èƒ½ä¼šåœ¨å…¶ä»–å…ˆå‰ä»»åŠ¡å®Œæˆä¹‹å‰ä½¿å…¶ä»–ä»»åŠ¡å‡ºé˜Ÿã€‚å¹¶å‘é˜Ÿåˆ—åœ¨ä»»ä½•ç»™å®šæ—¶åˆ»æ‰§è¡Œçš„å®žé™…ä»»åŠ¡æ•°æ˜¯å¯å˜çš„ï¼Œå¹¶ä¸”å¯ä»¥éšç€åº”ç”¨ç¨‹åºæ¡ä»¶çš„å˜åŒ–è€ŒåŠ¨æ€å˜åŒ–ã€‚è®¸å¤šå› ç´ ä¼šå½±å“å¹¶å‘é˜Ÿåˆ—æ‰§è¡Œçš„ä»»åŠ¡æ•°é‡ï¼ŒåŒ…æ‹¬å¯ç”¨æ ¸å¿ƒçš„æ•°é‡ï¼Œå…¶ä»–è¿›ç¨‹æ­£åœ¨å®Œæˆçš„å·¥ä½œé‡ä»¥åŠå…¶ä»–ä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—ä¸­ä»»åŠ¡çš„æ•°é‡å’Œä¼˜å…ˆçº§ã€‚</p>
<p>ç³»ç»Ÿä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºæä¾›å››ä¸ªå¹¶å‘è°ƒåº¦é˜Ÿåˆ—ã€‚è¿™äº›é˜Ÿåˆ—å¯¹äºŽåº”ç”¨ç¨‹åºæ˜¯å…¨å±€çš„ï¼Œä»…æŒ‰ä¼˜å…ˆçº§è¿›è¡ŒåŒºåˆ†ã€‚å› ä¸ºå®ƒä»¬æ˜¯å…¨å±€çš„ï¼Œæ‰€ä»¥æ‚¨æ— éœ€æ˜¾å¼åˆ›å»ºå®ƒä»¬ã€‚ç›¸åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>dispatch_get_global_queue</code>å‡½æ•°æ¥è¯·æ±‚é˜Ÿåˆ—ä¹‹ä¸€ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch_queue_t aQueue = dispatch_get_global_queueï¼ˆDISPATCH_QUEUE_PRIORITY_DEFAULTï¼Œ0ï¼‰;</span><br></pre></td></tr></tbody></table></figure>

<p>é™¤äº†èŽ·å–é»˜è®¤çš„å¹¶å‘é˜Ÿåˆ—å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å°†<code>DISPATCH_QUEUE_PRIORITY_HIGH</code>å’Œ<code>DISPATCH_QUEUE_PRIORITY_LOW</code>å¸¸é‡ä¼ é€’ç»™å‡½æ•°æ¥èŽ·å–é«˜ä¼˜å…ˆçº§å’Œä½Žä¼˜å…ˆçº§çº§åˆ«çš„é˜Ÿåˆ—ï¼Œæˆ–è€…é€šè¿‡ä¼ é€’å¸¸é‡æ¥èŽ·å–èƒŒæ™¯é˜Ÿåˆ—<code>DISPATCH_QUEUE_PRIORITY_BACKGROUND</code>ã€‚å¦‚æ‚¨æ‰€æ–™ï¼Œé«˜ä¼˜å…ˆçº§å¹¶å‘é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ¯”é»˜è®¤é˜Ÿåˆ—å’Œä½Žä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å…ˆæ‰§è¡Œã€‚åŒæ ·ï¼Œé»˜è®¤é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡åœ¨ä½Žä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ä¹‹å‰æ‰§è¡Œã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong> è¯¥<code>dispatch_get_global_queue</code>å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ä¿ç•™ç»™ä»¥åŽçš„æ‰©å±•ã€‚çŽ°åœ¨ï¼Œæ‚¨åº”è¯¥å§‹ç»ˆé€šè¿‡<code>0</code>æ­¤å‚æ•°ã€‚</p>
<p>å°½ç®¡è°ƒåº¦é˜Ÿåˆ—æ˜¯å¼•ç”¨è®¡æ•°çš„å¯¹è±¡ï¼Œä½†æ˜¯æ‚¨æ— éœ€ä¿ç•™å’Œé‡Šæ”¾å…¨å±€å¹¶å‘é˜Ÿåˆ—ã€‚å› ä¸ºå®ƒä»¬å¯¹äºŽæ‚¨çš„åº”ç”¨ç¨‹åºæ˜¯å…¨å±€çš„ï¼Œæ‰€ä»¥å°†å¿½ç•¥å¯¹è¿™äº›é˜Ÿåˆ—çš„ä¿ç•™å’Œé‡Šæ”¾è°ƒç”¨ã€‚å› æ­¤ï¼Œæ‚¨ä¸éœ€è¦å­˜å‚¨å¯¹è¿™äº›é˜Ÿåˆ—çš„å¼•ç”¨ã€‚<code>dispatch_get_global_queue</code>åªè¦éœ€è¦å¼•ç”¨å…¶ä¸­ä¹‹ä¸€ï¼Œå°±å¯ä»¥è°ƒç”¨è¯¥å‡½æ•°ã€‚</p>
<h6 id="åˆ›å»ºä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—"><a href="#åˆ›å»ºä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—" class="headerlink" title="åˆ›å»ºä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—"></a>åˆ›å»ºä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—</h6><p>å½“æ‚¨å¸Œæœ›ä»»åŠ¡ä»¥ç‰¹å®šé¡ºåºæ‰§è¡Œæ—¶ï¼Œä¸²è¡Œé˜Ÿåˆ—å¾ˆæœ‰ç”¨ã€‚ä¸²è¡Œé˜Ÿåˆ—ä¸€æ¬¡åªæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸”æ€»æ˜¯ä»Žé˜Ÿåˆ—çš„å¼€å¤´æ‹‰ä»»åŠ¡ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸²è¡Œé˜Ÿåˆ—è€Œä¸æ˜¯é”æ¥ä¿æŠ¤å…±äº«èµ„æºæˆ–å¯å˜æ•°æ®ç»“æž„ã€‚ä¸Žé”ä¸åŒï¼Œä¸²è¡Œé˜Ÿåˆ—å¯ç¡®ä¿ä»»åŠ¡ä»¥å¯é¢„æµ‹çš„é¡ºåºæ‰§è¡Œã€‚è€Œä¸”ï¼Œåªè¦æ‚¨å¼‚æ­¥åœ°å°†ä»»åŠ¡æäº¤åˆ°ä¸²è¡Œé˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—å°±æ°¸è¿œä¸ä¼šæ­»é”ã€‚</p>
<p>ä¸Žä¸ºæ‚¨åˆ›å»ºçš„å¹¶å‘é˜Ÿåˆ—ä¸åŒï¼Œæ‚¨å¿…é¡»æ˜¾å¼åˆ›å»ºå’Œç®¡ç†è¦ä½¿ç”¨çš„ä»»ä½•ä¸²è¡Œé˜Ÿåˆ—ã€‚æ‚¨å¯ä»¥ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºåˆ›å»ºä»»æ„æ•°é‡çš„ä¸²è¡Œé˜Ÿåˆ—ï¼Œä½†åº”é¿å…åˆ›å»ºå¤§é‡ä¸²è¡Œé˜Ÿåˆ—ï¼Œè¿™ä»…ä»…æ˜¯ä¸ºäº†åŒæ—¶æ‰§è¡Œå°½å¯èƒ½å¤šçš„ä»»åŠ¡ã€‚å¦‚æžœè¦åŒæ—¶æ‰§è¡Œå¤§é‡ä»»åŠ¡ï¼Œè¯·å°†å…¶æäº¤åˆ°å…¨å±€å¹¶å‘é˜Ÿåˆ—ä¹‹ä¸€ã€‚åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—æ—¶ï¼Œè¯·å°è¯•ç¡®å®šæ¯ä¸ªé˜Ÿåˆ—çš„ç”¨é€”ï¼Œä¾‹å¦‚ä¿æŠ¤èµ„æºæˆ–åŒæ­¥åº”ç”¨ç¨‹åºçš„æŸäº›å…³é”®è¡Œä¸ºã€‚</p>
<p>æ¸…å• 3-2 æ˜¾ç¤ºäº†åˆ›å»ºè‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—æ‰€éœ€çš„æ­¥éª¤ã€‚è¯¥<code>dispatch_queue_create</code>å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼šé˜Ÿåˆ—åç§°å’Œä¸€ç»„é˜Ÿåˆ—å±žæ€§ã€‚è°ƒè¯•å™¨å’Œæ€§èƒ½å·¥å…·æ˜¾ç¤ºé˜Ÿåˆ—åç§°ï¼Œä»¥å¸®åŠ©æ‚¨è·Ÿè¸ªä»»åŠ¡çš„æ‰§è¡Œæ–¹å¼ã€‚é˜Ÿåˆ—å±žæ€§ä¿ç•™ä¾›å°†æ¥ä½¿ç”¨ï¼Œåº”ä¸º<code>NULL</code>ã€‚</p>
<p><strong>æ¸…å• 3-2</strong> åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸²è¡Œé˜Ÿåˆ—</p>
<table>
<thead>
<tr>
<th><code>dispatch_queue_té˜Ÿåˆ—ï¼›</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>é˜Ÿåˆ—= dispatch_queue_createï¼ˆâ€œ com.example.MyQueueâ€ï¼ŒNULLï¼‰;</code></td>
</tr>
</tbody></table>
<p>é™¤äº†æ‚¨åˆ›å»ºçš„ä»»ä½•è‡ªå®šä¹‰é˜Ÿåˆ—ä¹‹å¤–ï¼Œç³»ç»Ÿè¿˜ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—å¹¶å°†å…¶ç»‘å®šåˆ°åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ã€‚æœ‰å…³èŽ·å–ä¸»çº¿ç¨‹é˜Ÿåˆ—çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW3">åœ¨è¿è¡Œæ—¶èŽ·å–å…¬å…±é˜Ÿåˆ—</a>ã€‚</p>
<h6 id="åœ¨è¿è¡Œæ—¶èŽ·å–é€šç”¨é˜Ÿåˆ—"><a href="#åœ¨è¿è¡Œæ—¶èŽ·å–é€šç”¨é˜Ÿåˆ—" class="headerlink" title="åœ¨è¿è¡Œæ—¶èŽ·å–é€šç”¨é˜Ÿåˆ—"></a>åœ¨è¿è¡Œæ—¶èŽ·å–é€šç”¨é˜Ÿåˆ—</h6><p>Grand Central Dispatch æä¾›çš„åŠŸèƒ½ä½¿æ‚¨å¯ä»¥ä»Žåº”ç”¨ç¨‹åºè®¿é—®å‡ ä¸ªå¸¸è§çš„è°ƒåº¦é˜Ÿåˆ—ï¼š</p>
<ul>
<li>ä½¿ç”¨è¯¥<code>dispatch_get_current_queue</code>åŠŸèƒ½è¿›è¡Œè°ƒè¯•æˆ–æµ‹è¯•å½“å‰é˜Ÿåˆ—çš„èº«ä»½ã€‚ä»Žä¸€ä¸ªå—å¯¹è±¡å†…éƒ¨è°ƒç”¨è¯¥å‡½æ•°å°†è¿”å›žè¯¥å—å·²æäº¤åˆ°çš„é˜Ÿåˆ—ï¼ˆçŽ°åœ¨å¤§æ¦‚åœ¨è¯¥é˜Ÿåˆ—ä¸Šè¿è¡Œï¼‰ã€‚ä»Žå—å¤–éƒ¨è°ƒç”¨æ­¤å‡½æ•°å°†ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºè¿”å›žé»˜è®¤çš„å¹¶å‘é˜Ÿåˆ—ã€‚</li>
<li>ä½¿ç”¨è¯¥<code>dispatch_get_main_queue</code>å‡½æ•°èŽ·å–ä¸Žåº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹å…³è”çš„ä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—ã€‚æ­¤é˜Ÿåˆ—æ˜¯ä¸º Cocoa åº”ç”¨ç¨‹åºä»¥åŠåœ¨ä¸»çº¿ç¨‹ä¸Šè°ƒç”¨è¯¥<code>dispatch_main</code>å‡½æ•°æˆ–é…ç½®è¿è¡Œå¾ªçŽ¯ï¼ˆä½¿ç”¨<code>CFRunLoopRef</code>ç±»åž‹æˆ–<code>NSRunLoop</code>å¯¹è±¡ï¼‰çš„åº”ç”¨ç¨‹åºè‡ªåŠ¨åˆ›å»ºçš„ã€‚</li>
<li>ä½¿ç”¨è¯¥<code>dispatch_get_global_queue</code>å‡½æ•°èŽ·å–ä»»ä½•å…±äº«çš„å¹¶å‘é˜Ÿåˆ—ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW5">èŽ·å–å…¨å±€å¹¶å‘è°ƒåº¦é˜Ÿåˆ—</a>ã€‚</li>
</ul>
<h6 id="è°ƒåº¦é˜Ÿåˆ—çš„å†…å­˜ç®¡ç†"><a href="#è°ƒåº¦é˜Ÿåˆ—çš„å†…å­˜ç®¡ç†" class="headerlink" title="è°ƒåº¦é˜Ÿåˆ—çš„å†…å­˜ç®¡ç†"></a>è°ƒåº¦é˜Ÿåˆ—çš„å†…å­˜ç®¡ç†</h6><p>è°ƒåº¦é˜Ÿåˆ—å’Œå…¶ä»–è°ƒåº¦å¯¹è±¡æ˜¯å¼•ç”¨è®¡æ•°çš„æ•°æ®ç±»åž‹ã€‚åˆ›å»ºä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—æ—¶ï¼Œå®ƒçš„åˆå§‹å¼•ç”¨è®¡æ•°ä¸º 1ã€‚å¯ä»¥ä½¿ç”¨<code>dispatch_retain</code>å’Œ<code>dispatch_release</code>å‡½æ•°æ ¹æ®éœ€è¦å¢žåŠ å’Œå‡å°‘å¼•ç”¨è®¡æ•°ã€‚å½“é˜Ÿåˆ—çš„å¼•ç”¨è®¡æ•°è¾¾åˆ°é›¶æ—¶ï¼Œç³»ç»Ÿå¼‚æ­¥å–æ¶ˆåˆ†é…è¯¥é˜Ÿåˆ—ã€‚</p>
<p>ä¿ç•™å’Œé‡Šæ”¾è°ƒåº¦å¯¹è±¡ï¼ˆä¾‹å¦‚é˜Ÿåˆ—ï¼‰å¾ˆé‡è¦ï¼Œä»¥ç¡®ä¿å®ƒä»¬åœ¨ä½¿ç”¨æ—¶ä»ä¿ç•™åœ¨å†…å­˜ä¸­ã€‚ä¸Žå†…å­˜ç®¡ç†çš„ Cocoa å¯¹è±¡ä¸€æ ·ï¼Œä¸€èˆ¬è§„åˆ™æ˜¯ï¼Œå¦‚æžœè®¡åˆ’ä½¿ç”¨ä¼ é€’ç»™ä»£ç çš„é˜Ÿåˆ—ï¼Œåˆ™åº”åœ¨ä½¿ç”¨è¯¥é˜Ÿåˆ—ä¹‹å‰ä¿ç•™è¯¥é˜Ÿåˆ—ï¼Œå¹¶åœ¨ä¸å†éœ€è¦æ—¶é‡Šæ”¾å®ƒã€‚è¿™ç§åŸºæœ¬æ¨¡å¼å¯ç¡®ä¿é˜Ÿåˆ—åœ¨æ‚¨ä½¿ç”¨æœŸé—´ä¸€ç›´ä¿ç•™åœ¨å†…å­˜ä¸­ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong> æ‚¨ä¸éœ€è¦ä¿ç•™æˆ–é‡Šæ”¾ä»»ä½•å…¨å±€è°ƒåº¦é˜Ÿåˆ—ï¼ŒåŒ…æ‹¬å¹¶å‘è°ƒåº¦é˜Ÿåˆ—æˆ–ä¸»è°ƒåº¦é˜Ÿåˆ—ã€‚ä¿ç•™æˆ–é‡Šæ”¾é˜Ÿåˆ—çš„ä»»ä½•å°è¯•éƒ½å°†è¢«å¿½ç•¥ã€‚</p>
<p>å³ä½¿å®žçŽ°åžƒåœ¾æ”¶é›†çš„åº”ç”¨ç¨‹åºï¼Œæ‚¨ä»ç„¶å¿…é¡»ä¿ç•™å¹¶é‡Šæ”¾æ‚¨çš„è°ƒåº¦é˜Ÿåˆ—å’Œå…¶ä»–è°ƒåº¦å¯¹è±¡ã€‚Grand Central Dispatch ä¸æ”¯æŒåžƒåœ¾å›žæ”¶æ¨¡åž‹æ¥å›žæ”¶å†…å­˜ã€‚</p>
<h6 id="ä½¿ç”¨é˜Ÿåˆ—å­˜å‚¨è‡ªå®šä¹‰ä¸Šä¸‹æ–‡ä¿¡æ¯"><a href="#ä½¿ç”¨é˜Ÿåˆ—å­˜å‚¨è‡ªå®šä¹‰ä¸Šä¸‹æ–‡ä¿¡æ¯" class="headerlink" title="ä½¿ç”¨é˜Ÿåˆ—å­˜å‚¨è‡ªå®šä¹‰ä¸Šä¸‹æ–‡ä¿¡æ¯"></a>ä½¿ç”¨é˜Ÿåˆ—å­˜å‚¨è‡ªå®šä¹‰ä¸Šä¸‹æ–‡ä¿¡æ¯</h6><p>æ‰€æœ‰è°ƒåº¦å¯¹è±¡ï¼ˆåŒ…æ‹¬è°ƒåº¦é˜Ÿåˆ—ï¼‰éƒ½å…è®¸æ‚¨å°†è‡ªå®šä¹‰ä¸Šä¸‹æ–‡æ•°æ®ä¸Žè¯¥å¯¹è±¡ç›¸å…³è”ã€‚è¦åœ¨ç»™å®šå¯¹è±¡ä¸Šè®¾ç½®å¹¶èŽ·å–æ­¤æ•°æ®ï¼Œè¯·ä½¿ç”¨<code>dispatch_set_context</code>å’Œ<code>dispatch_get_context</code>å‡½æ•°ã€‚ç³»ç»Ÿä¸ä¼šä»¥ä»»ä½•æ–¹å¼ä½¿ç”¨æ‚¨çš„è‡ªå®šä¹‰æ•°æ®ï¼Œè¿™å–å†³äºŽæ‚¨åœ¨é€‚å½“çš„æ—¶é—´åˆ†é…å’Œå–æ¶ˆåˆ†é…æ•°æ®ã€‚</p>
<p>å¯¹äºŽé˜Ÿåˆ—ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸Šä¸‹æ–‡æ•°æ®æ¥å­˜å‚¨æŒ‡å‘ Objective-C å¯¹è±¡æˆ–å…¶ä»–æ•°æ®ç»“æž„çš„æŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆæˆ–æ•°æ®ç»“æž„æœ‰åŠ©äºŽè¯†åˆ«é˜Ÿåˆ—æˆ–å…¶åœ¨ä»£ç ä¸­çš„é¢„æœŸç”¨é€”ã€‚æ‚¨å¯ä»¥ä½¿ç”¨é˜Ÿåˆ—çš„ç»ˆç»“å™¨å‡½æ•°åœ¨é‡Šæ”¾ä¸Šä¸‹æ–‡æ•°æ®ä¹‹å‰ä»Žé˜Ÿåˆ—ä¸­å–æ¶ˆåˆ†é…ï¼ˆæˆ–å–æ¶ˆå…³è”ï¼‰æ‚¨çš„ä¸Šä¸‹æ–‡æ•°æ®ã€‚<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW8">æ¸…å• 3-3</a>ç»™å‡ºäº†å¦‚ä½•ç¼–å†™ä¸€ä¸ªç»ˆç»“å™¨å‡½æ•°æ¥æ¸…é™¤é˜Ÿåˆ—ä¸Šä¸‹æ–‡æ•°æ®çš„ç¤ºä¾‹ã€‚</p>
<h6 id="æä¾›é˜Ÿåˆ—çš„æ¸…ç†åŠŸèƒ½"><a href="#æä¾›é˜Ÿåˆ—çš„æ¸…ç†åŠŸèƒ½" class="headerlink" title="æä¾›é˜Ÿåˆ—çš„æ¸…ç†åŠŸèƒ½"></a>æä¾›é˜Ÿåˆ—çš„æ¸…ç†åŠŸèƒ½</h6><p>åˆ›å»ºä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—åŽï¼Œå¯ä»¥é™„åŠ ç»ˆç»“å™¨å‡½æ•°ï¼Œä»¥åœ¨é‡Šæ”¾é˜Ÿåˆ—æ—¶æ‰§è¡Œä»»ä½•è‡ªå®šä¹‰æ¸…é™¤ã€‚è°ƒåº¦é˜Ÿåˆ—æ˜¯å¼•ç”¨è®¡æ•°çš„å¯¹è±¡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥<code>dispatch_set_finalizer_f</code>å‡½æ•°æŒ‡å®šå½“é˜Ÿåˆ—çš„å¼•ç”¨è®¡æ•°è¾¾åˆ°é›¶æ—¶è¦æ‰§è¡Œçš„å‡½æ•°ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ­¤å‡½æ•°æ¸…é™¤ä¸Žé˜Ÿåˆ—å…³è”çš„ä¸Šä¸‹æ–‡æ•°æ®ï¼Œå¹¶ä¸”ä»…å½“ä¸Šä¸‹æ–‡æŒ‡é’ˆä¸æ˜¯æ—¶æ‰è°ƒç”¨è¯¥å‡½æ•°<code>NULL</code>ã€‚</p>
<p>æ¸…å• 3-3 æ˜¾ç¤ºäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ç»ˆç»“å™¨å‡½æ•°å’Œä¸€ä¸ªåˆ›å»ºé˜Ÿåˆ—å¹¶å®‰è£…è¯¥ç»ˆç»“å™¨çš„å‡½æ•°ã€‚é˜Ÿåˆ—ä½¿ç”¨ç»ˆç»“å™¨åŠŸèƒ½é‡Šæ”¾å­˜å‚¨åœ¨é˜Ÿåˆ—ä¸Šä¸‹æ–‡æŒ‡é’ˆä¸­çš„æ•°æ®ã€‚ï¼ˆä»Žä»£ç å¼•ç”¨çš„<code>myInitializeDataContextFunction</code>å’Œ<code>myCleanUpDataContextFunction</code>å‡½æ•°æ˜¯è‡ªå®šä¹‰å‡½æ•°ï¼Œæ‚¨å°†æä¾›è¿™äº›å‡½æ•°æ¥åˆå§‹åŒ–å’Œæ¸…é™¤æ•°æ®ç»“æž„æœ¬èº«çš„å†…å®¹ã€‚ï¼‰ä¼ é€’ç»™ finalizer å‡½æ•°çš„ä¸Šä¸‹æ–‡æŒ‡é’ˆåŒ…å«ä¸Žé˜Ÿåˆ—å…³è”çš„æ•°æ®å¯¹è±¡ã€‚</p>
<p><strong>æ¸…å• 3-3</strong> å®‰è£…é˜Ÿåˆ—æ¸…é™¤åŠŸèƒ½</p>
<table>
<thead>
<tr>
<th><code>æ— æ•ˆmyFinalizerFunctionï¼ˆæ— æ•ˆ*ä¸Šä¸‹æ–‡ï¼‰</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>MyDataContext * theData =ï¼ˆMyDataContext *ï¼‰ä¸Šä¸‹æ–‡;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//æ¸…ç†ç»“æž„çš„å†…å®¹</code></td>
</tr>
<tr>
<td><code>myCleanUpDataContextFunctionï¼ˆtheDataï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//çŽ°åœ¨é‡Šæ”¾ç»“æž„æœ¬èº«ã€‚</code></td>
</tr>
<tr>
<td><code>å…è´¹ï¼ˆtheDataï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>dispatch_queue_t createMyQueueï¼ˆï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>MyDataContext *æ•°æ®=ï¼ˆMyDataContext *ï¼‰mallocï¼ˆsizeofï¼ˆMyDataContextï¼‰ï¼‰;</code></td>
</tr>
<tr>
<td><code>myInitializeDataContextFunctionï¼ˆdataï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//åˆ›å»ºé˜Ÿåˆ—å¹¶è®¾ç½®ä¸Šä¸‹æ–‡æ•°æ®ã€‚</code></td>
</tr>
<tr>
<td><code>dispatch_queue_t serialQueue = dispatch_queue_createï¼ˆâ€œ com.example.CriticalTaskQueueâ€ï¼ŒNULLï¼‰;</code></td>
</tr>
<tr>
<td><code>dispatch_set_contextï¼ˆserialQueueï¼Œdataï¼‰;</code></td>
</tr>
<tr>
<td><code>dispatch_set_finalizer_fï¼ˆserialQueueï¼Œï¼†myFinalizerFunctionï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>è¿”å›žserialQueue;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<h4 id="å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—"><a href="#å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—" class="headerlink" title="å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—"></a>å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—</h4><p>è¦æ‰§è¡Œä»»åŠ¡ï¼Œå¿…é¡»å°†å…¶åˆ†æ´¾åˆ°é€‚å½“çš„åˆ†æ´¾é˜Ÿåˆ—ã€‚æ‚¨å¯ä»¥åŒæ­¥æˆ–å¼‚æ­¥åˆ†é…ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥å•ä¸ªæˆ–æˆç»„åˆ†é…ä»»åŠ¡ã€‚è¿›å…¥é˜Ÿåˆ—åŽï¼Œé‰´äºŽé˜Ÿåˆ—çš„çº¦æŸå’Œé˜Ÿåˆ—ä¸­å·²æœ‰çš„ä»»åŠ¡ï¼Œè¯¥é˜Ÿåˆ—å°†è´Ÿè´£å°½å¿«æ‰§è¡Œæ‚¨çš„ä»»åŠ¡ã€‚æœ¬èŠ‚ä»‹ç»äº†ä¸€äº›å°†ä»»åŠ¡åˆ†é…åˆ°é˜Ÿåˆ—çš„æŠ€æœ¯ï¼Œå¹¶ä»‹ç»äº†æ¯ç§æ–¹æ³•çš„ä¼˜ç‚¹ã€‚</p>
<h6 id="å°†å•ä¸ªä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—"><a href="#å°†å•ä¸ªä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—" class="headerlink" title="å°†å•ä¸ªä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—"></a>å°†å•ä¸ªä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—</h6><p>æœ‰ä¸¤ç§å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—çš„æ–¹æ³•ï¼šå¼‚æ­¥æˆ–åŒæ­¥ã€‚å¦‚æžœå¯èƒ½ï¼Œä¸ŽåŒæ­¥æ–¹æ³•ç›¸æ¯”ï¼Œé¦–é€‰ä½¿ç”¨<code>dispatch_async</code>å’Œ<code>dispatch_async_f</code>å‡½æ•°è¿›è¡Œå¼‚æ­¥æ‰§è¡Œã€‚å°†å—å¯¹è±¡æˆ–å‡½æ•°æ·»åŠ åˆ°é˜Ÿåˆ—æ—¶ï¼Œæ— æ³•çŸ¥é“è¯¥ä»£ç ä½•æ—¶æ‰§è¡Œã€‚ç»“æžœï¼Œå¼‚æ­¥æ·»åŠ å—æˆ–å‡½æ•°ä½¿æ‚¨å¯ä»¥è°ƒåº¦ä»£ç çš„æ‰§è¡Œï¼Œå¹¶ç»§ç»­ä»Žè°ƒç”¨çº¿ç¨‹æ‰§è¡Œå…¶ä»–å·¥ä½œã€‚å¦‚æžœæ‚¨æ˜¯ä»Žåº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ä¸­è°ƒåº¦ä»»åŠ¡çš„ï¼Œé‚£ä¹ˆè¿™å°¤å…¶é‡è¦-å¯èƒ½æ˜¯å“åº”æŸäº›ç”¨æˆ·äº‹ä»¶ã€‚</p>
<p>å°½ç®¡æ‚¨åº”è¯¥å°½å¯èƒ½å¼‚æ­¥åœ°æ·»åŠ ä»»åŠ¡ï¼Œä½†æ˜¯æœ‰æ—¶ä»ç„¶éœ€è¦åŒæ­¥æ·»åŠ ä»»åŠ¡ä»¥é˜²æ­¢å‡ºçŽ°ç«žäº‰æƒ…å†µæˆ–å…¶ä»–åŒæ­¥é”™è¯¯ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨<code>dispatch_sync</code>å’Œ<code>dispatch_sync_f</code>å‡½æ•°å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚è¿™äº›å‡½æ•°å°†é˜»æ­¢å½“å‰æ‰§è¡Œçº¿ç¨‹ï¼Œç›´åˆ°æŒ‡å®šä»»åŠ¡å®Œæˆæ‰§è¡Œä¸ºæ­¢ã€‚</p>
<p><strong>é‡è¦è¯´æ˜Žï¼š</strong> åˆ‡å‹¿åœ¨è®¡åˆ’ä¼ é€’ç»™è¯¥å‡½æ•°çš„é˜Ÿåˆ—ä¸­æ‰§è¡Œçš„ä»»åŠ¡ä¸­è°ƒç”¨<code>dispatch_sync</code>or <code>dispatch_sync_f</code>å‡½æ•°ã€‚è¿™å¯¹äºŽä¿è¯æ­»é”çš„ä¸²è¡Œé˜Ÿåˆ—ç‰¹åˆ«é‡è¦ï¼Œä½†å¯¹äºŽå¹¶å‘é˜Ÿåˆ—ä¹Ÿåº”é¿å…ã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•ä½¿ç”¨åŸºäºŽå—çš„å˜ä½“å¼‚æ­¥å’ŒåŒæ­¥åœ°è°ƒåº¦ä»»åŠ¡ï¼š</p>
<table>
<thead>
<tr>
<th><code>dispatch_queue_t myCustomQueue;</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>myCustomQueue = dispatch_queue_createï¼ˆâ€œ com.example.MyCustomQueueâ€ï¼ŒNULLï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>dispatch_asyncï¼ˆmyCustomQueueï¼Œ^ {</code></td>
</tr>
<tr>
<td><code>printfï¼ˆâ€œåœ¨è¿™é‡Œåšä¸€äº›å·¥ä½œã€‚\ nâ€ï¼‰;</code></td>
</tr>
<tr>
<td><code>}ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>printfï¼ˆâ€œç¬¬ä¸€ä¸ªå—å¯èƒ½å·²ç»è¿è¡Œï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰è¿è¡Œã€‚\ nâ€ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>dispatch_syncï¼ˆmyCustomQueueï¼Œ^ {</code></td>
</tr>
<tr>
<td><code>printfï¼ˆâ€œåœ¨è¿™é‡Œåšæ›´å¤šçš„å·¥ä½œã€‚\ nâ€ï¼‰;</code></td>
</tr>
<tr>
<td><code>}ï¼‰;</code></td>
</tr>
<tr>
<td><code>printfï¼ˆâ€œä¸¤ä¸ªå—éƒ½å·²å®Œæˆã€‚\ nâ€ï¼‰;</code></td>
</tr>
</tbody></table>
<h6 id="å®Œæˆä»»åŠ¡åŽæ‰§è¡Œè¡¥å…¨"><a href="#å®Œæˆä»»åŠ¡åŽæ‰§è¡Œè¡¥å…¨" class="headerlink" title="å®Œæˆä»»åŠ¡åŽæ‰§è¡Œè¡¥å…¨"></a>å®Œæˆä»»åŠ¡åŽæ‰§è¡Œè¡¥å…¨</h6><p>å°±å…¶æ€§è´¨è€Œè¨€ï¼Œåˆ†æ´¾åˆ°é˜Ÿåˆ—çš„ä»»åŠ¡ç‹¬ç«‹äºŽåˆ›å»ºä»»åŠ¡çš„ä»£ç è¿è¡Œã€‚ä½†æ˜¯ï¼Œå½“ä»»åŠ¡å®ŒæˆåŽï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå¯èƒ½ä»å¸Œæœ›å¾—åˆ°è¯¥äº‹å®žçš„é€šçŸ¥ï¼Œä»¥ä¾¿å¯ä»¥åˆå¹¶ç»“æžœã€‚åœ¨ä¼ ç»Ÿçš„å¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å›žè°ƒæœºåˆ¶æ¥æ‰§è¡Œæ­¤æ“ä½œï¼Œä½†æ˜¯å¯¹äºŽè°ƒåº¦é˜Ÿåˆ—ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®Œæˆå—ã€‚</p>
<p>å®Œæˆå—åªæ˜¯æ‚¨åœ¨åŽŸå§‹ä»»åŠ¡ç»“æŸæ—¶åˆ†æ´¾åˆ°é˜Ÿåˆ—çš„å¦ä¸€æ®µä»£ç ã€‚è°ƒç”¨ä»£ç é€šå¸¸åœ¨å¯åŠ¨ä»»åŠ¡æ—¶å°†å®Œæˆå—ä½œä¸ºå‚æ•°æä¾›ã€‚ä»»åŠ¡ä»£ç è¦åšçš„å°±æ˜¯åœ¨å®Œæˆå·¥ä½œåŽå°†æŒ‡å®šçš„å—æˆ–å‡½æ•°æäº¤åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ã€‚</p>
<p>æ¸…å• 3-4 æ˜¾ç¤ºäº†ä½¿ç”¨ blocks å®žçŽ°çš„å¹³å‡å‡½æ•°ã€‚å¹³å‡å‡½æ•°çš„æœ€åŽä¸¤ä¸ªå‚æ•°å…è®¸è°ƒç”¨è€…æŒ‡å®šåœ¨æŠ¥å‘Šç»“æžœæ—¶è¦ä½¿ç”¨çš„é˜Ÿåˆ—å’Œå—ã€‚åœ¨æ±‚å¹³å‡å€¼å‡½æ•°çš„å€¼ä¹‹åŽï¼Œå®ƒå°†ç»“æžœä¼ é€’åˆ°æŒ‡å®šçš„å—å¹¶å°†å…¶åˆ†æ´¾åˆ°é˜Ÿåˆ—ã€‚ä¸ºäº†é˜²æ­¢è¿‡æ—©é‡Šæ”¾é˜Ÿåˆ—ï¼Œè‡³å…³é‡è¦çš„æ˜¯é¦–å…ˆä¿ç•™è¯¥é˜Ÿåˆ—ï¼Œå¹¶åœ¨åˆ†æ´¾å®Œæˆå—åŽå°†å…¶é‡Šæ”¾ã€‚</p>
<p><strong>æ¸…å• 3-4</strong> åœ¨ä»»åŠ¡æ‰§è¡ŒåŽæ‰§è¡Œå®Œæˆå›žè°ƒ</p>
<table>
<thead>
<tr>
<th><code>void average_asyncï¼ˆint * dataï¼Œsize_t lenï¼Œ</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>dispatch_queue_té˜Ÿåˆ—ï¼Œæ— æ•ˆï¼ˆ^ blockï¼‰ï¼ˆintï¼‰ï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//ä¿ç•™ç”¨æˆ·æä¾›çš„é˜Ÿåˆ—</code></td>
</tr>
<tr>
<td><code>//ç¡®ä¿å®ƒåœ¨å®Œæˆä¹‹å‰ä¸ä¼šæ¶ˆå¤±</code></td>
</tr>
<tr>
<td><code>//å¯ä»¥è°ƒç”¨å—ã€‚</code></td>
</tr>
<tr>
<td><code>dispatch_retainï¼ˆqueueï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//åœ¨é»˜è®¤çš„å¹¶å‘é˜Ÿåˆ—ä¸Šè¿›è¡Œå·¥ä½œï¼Œç„¶åŽ</code></td>
</tr>
<tr>
<td><code>//ç”¨ç»“æžœè°ƒç”¨ç”¨æˆ·æä¾›çš„å—ã€‚</code></td>
</tr>
<tr>
<td><code>dispatch_asyncï¼ˆdispatch_get_global_queueï¼ˆDISPATCH_QUEUE_PRIORITY_DEFAULTï¼Œ0ï¼‰ï¼Œ^ {</code></td>
</tr>
<tr>
<td><code>int avg = averageï¼ˆdataï¼Œlenï¼‰;</code></td>
</tr>
<tr>
<td><code>dispatch_asyncï¼ˆqueueï¼Œ^ {blockï¼ˆavgï¼‰;}ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å®ŒæˆåŽé‡Šæ”¾ç”¨æˆ·æä¾›çš„é˜Ÿåˆ—</code></td>
</tr>
<tr>
<td><code>dispatch_releaseï¼ˆqueueï¼‰;</code></td>
</tr>
<tr>
<td><code>}ï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<h6 id="åŒæ—¶æ‰§è¡Œå¾ªçŽ¯è¿­ä»£"><a href="#åŒæ—¶æ‰§è¡Œå¾ªçŽ¯è¿­ä»£" class="headerlink" title="åŒæ—¶æ‰§è¡Œå¾ªçŽ¯è¿­ä»£"></a>åŒæ—¶æ‰§è¡Œå¾ªçŽ¯è¿­ä»£</h6><p>å¹¶å‘è°ƒåº¦é˜Ÿåˆ—å¯èƒ½ä¼šæé«˜æ€§èƒ½çš„ä¸€ä¸ªåœ°æ–¹æ˜¯æ‚¨çš„å¾ªçŽ¯æ‰§è¡Œå›ºå®šæ•°é‡çš„è¿­ä»£ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æœ‰ä¸€ä¸ª<code>for</code>å¾ªçŽ¯ï¼Œè¯¥å¾ªçŽ¯åœ¨æ¯æ¬¡å¾ªçŽ¯è¿­ä»£ä¸­éƒ½å®Œæˆäº†ä¸€äº›å·¥ä½œï¼š</p>
<table>
<thead>
<tr>
<th>`å¯¹äºŽï¼ˆi = 0; i</th>
</tr>
</thead>
<tbody><tr>
<td><code>printfï¼ˆâ€œï¼…u \ nâ€ï¼Œiï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>å¦‚æžœåœ¨æ¯æ¬¡è¿­ä»£è¿‡ç¨‹ä¸­æ‰§è¡Œçš„å·¥ä½œä¸Žåœ¨æ‰€æœ‰å…¶ä»–è¿­ä»£è¿‡ç¨‹ä¸­æ‰§è¡Œçš„å·¥ä½œä¸åŒï¼Œå¹¶ä¸”æ¯ä¸ªè¿žç»­å¾ªçŽ¯çš„å®Œæˆé¡ºåºå¹¶ä¸é‡è¦ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>dispatch_apply</code>æˆ–<code>dispatch_apply_f</code>å‡½æ•°çš„è°ƒç”¨æ¥æ›¿æ¢å¾ªçŽ¯ã€‚è¿™äº›å‡½æ•°ä¸ºæ¯æ¬¡å¾ªçŽ¯è¿­ä»£å°†æŒ‡å®šçš„å—æˆ–å‡½æ•°æäº¤åˆ°é˜Ÿåˆ—ä¸€æ¬¡ã€‚å› æ­¤ï¼Œå½“è°ƒåº¦åˆ°å¹¶å‘é˜Ÿåˆ—æ—¶ï¼Œå¯ä»¥åŒæ—¶æ‰§è¡Œå¤šä¸ªå¾ªçŽ¯è¿­ä»£ã€‚</p>
<p>æ‚¨å¯ä»¥åœ¨è°ƒç”¨<code>dispatch_apply</code>æˆ–æ—¶æŒ‡å®šä¸²è¡Œé˜Ÿåˆ—æˆ–å¹¶å‘é˜Ÿåˆ—<code>dispatch_apply_f</code>ã€‚ä¼ é€’å¹¶å‘é˜Ÿåˆ—ä½¿æ‚¨å¯ä»¥åŒæ—¶æ‰§è¡Œå¤šä¸ªå¾ªçŽ¯è¿­ä»£ï¼Œè¿™æ˜¯ä½¿ç”¨è¿™äº›åŠŸèƒ½çš„æœ€å¸¸ç”¨æ–¹æ³•ã€‚å°½ç®¡ä½¿ç”¨ä¸²è¡Œé˜Ÿåˆ—æ˜¯å…è®¸çš„ï¼Œå¹¶ä¸”å¯ä»¥ä¸ºæ‚¨çš„ä»£ç åšæ­£ç¡®çš„äº‹ï¼Œä½†æ˜¯ä½¿ç”¨è¿™ç§é˜Ÿåˆ—ä¸Žå°†å¾ªçŽ¯ä¿ç•™åœ¨åŽŸå¤„ç›¸æ¯”å¹¶æ²¡æœ‰çœŸæ­£çš„æ€§èƒ½ä¼˜åŠ¿ã€‚</p>
<p><strong>é‡è¦è¯´æ˜Žï¼š</strong> å’Œå¸¸è§„<code>for</code>å¾ªçŽ¯ä¸€æ ·ï¼Œ<code>dispatch_apply</code>and <code>dispatch_apply_f</code>å‡½æ•°ç›´åˆ°æ‰€æœ‰å¾ªçŽ¯è¿­ä»£å®ŒæˆåŽæ‰è¿”å›žã€‚å› æ­¤ï¼Œå½“ä»Žå·²ç»ä»Žé˜Ÿåˆ—ä¸Šä¸‹æ–‡æ‰§è¡Œçš„ä»£ç ä¸­è°ƒç”¨å®ƒä»¬æ—¶ï¼Œåº”è¯¥å°å¿ƒã€‚å¦‚æžœæ‚¨ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°çš„é˜Ÿåˆ—æ˜¯ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ï¼Œå¹¶ä¸”ä¸Žæ‰§è¡Œå½“å‰ä»£ç çš„é˜Ÿåˆ—ç›¸åŒï¼Œåˆ™è°ƒç”¨è¿™äº›å‡½æ•°å°†ä½¿é˜Ÿåˆ—æ­»é”ã€‚</p>
<p>å› ä¸ºå®ƒä»¬æœ‰æ•ˆåœ°é˜»å¡žäº†å½“å‰çº¿ç¨‹ï¼Œæ‰€ä»¥ä»Žä¸»çº¿ç¨‹è°ƒç”¨è¿™äº›å‡½æ•°æ—¶ä¹Ÿåº”å°å¿ƒï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½é˜»æ­¢äº‹ä»¶å¤„ç†å¾ªçŽ¯åŠæ—¶å“åº”äº‹ä»¶ã€‚å¦‚æžœæ‚¨çš„å¾ªçŽ¯ä»£ç éœ€è¦å¤§é‡çš„å¤„ç†æ—¶é—´ï¼Œåˆ™å¯èƒ½éœ€è¦ä»Žå…¶ä»–çº¿ç¨‹è°ƒç”¨è¿™äº›å‡½æ•°ã€‚</p>
<p>æ¸…å• 3-5 æ˜¾ç¤ºäº†å¦‚ä½•<code>for</code>ç”¨<code>dispatch_apply</code>è¯­æ³•æ›¿æ¢å‰é¢çš„å¾ªçŽ¯ã€‚ä¼ é€’ç»™<code>dispatch_apply</code>å‡½æ•°çš„å—å¿…é¡»åŒ…å«ä¸€ä¸ªæ ‡è¯†å½“å‰å¾ªçŽ¯è¿­ä»£çš„å‚æ•°ã€‚æ‰§è¡Œè¯¥å—æ—¶ï¼Œæ­¤å‚æ•°çš„å€¼<code>0</code>ç”¨äºŽç¬¬ä¸€æ¬¡è¿­ä»£ï¼Œ<code>1</code>ç”¨äºŽç¬¬äºŒæ¬¡è¿­ä»£ï¼Œä¾æ­¤ç±»æŽ¨ã€‚æœ€åŽä¸€æ¬¡è¿­ä»£çš„å‚æ•°å€¼æ˜¯<code>count - 1</code>ï¼Œå…¶ä¸­<code>count</code>æ˜¯è¿­ä»£çš„æ€»æ•°ã€‚</p>
<p><strong>æ¸…å• 3-5 åŒæ—¶</strong> æ‰§è¡Œ<code>for</code>å¾ªçŽ¯çš„è¿­ä»£</p>
<table>
<thead>
<tr>
<th><code>dispatch_queue_té˜Ÿåˆ—= dispatch_get_global_queueï¼ˆDISPATCH_QUEUE_PRIORITY_DEFAULTï¼Œ0ï¼‰;</code></th>
</tr>
</thead>
<tbody><tr>
<td>``</td>
</tr>
<tr>
<td><code>dispatch_applyï¼ˆcountï¼Œqueueï¼Œ^ï¼ˆsize_t iï¼‰{</code></td>
</tr>
<tr>
<td><code>printfï¼ˆâ€œï¼…u \ nâ€ï¼Œiï¼‰;</code></td>
</tr>
<tr>
<td><code>}ï¼‰;</code></td>
</tr>
</tbody></table>
<p>æ‚¨åº”è¯¥ç¡®ä¿æ‚¨çš„ä»»åŠ¡ä»£ç åœ¨æ¯æ¬¡è¿­ä»£ä¸­éƒ½è¿›è¡Œåˆç†çš„å·¥ä½œé‡ã€‚ä¸Žæ‚¨è°ƒåº¦åˆ°é˜Ÿåˆ—ä¸­çš„ä»»ä½•å—æˆ–å‡½æ•°ä¸€æ ·ï¼Œå®‰æŽ’è¯¥ä»£ç æ‰§è¡Œçš„å¼€é”€ã€‚å¦‚æžœå¾ªçŽ¯çš„æ¯æ¬¡è¿­ä»£ä»…æ‰§è¡Œå°‘é‡å·¥ä½œï¼Œåˆ™è°ƒåº¦ä»£ç çš„å¼€é”€å¯èƒ½ä¼šè¶…è¿‡å°†å…¶åˆ†æ´¾åˆ°é˜Ÿåˆ—å¯èƒ½å¸¦æ¥çš„æ€§èƒ½æ”¶ç›Šã€‚å¦‚æžœåœ¨æµ‹è¯•æœŸé—´å‘çŽ°è¿™æ˜¯æ­£ç¡®çš„ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è·¨æ­¥æ¥å¢žåŠ æ¯æ¬¡å¾ªçŽ¯è¿­ä»£æœŸé—´æ‰§è¡Œçš„å·¥ä½œé‡ã€‚é€šè¿‡è·¨æ­¥ï¼Œæ‚¨å¯ä»¥å°†åŽŸå§‹å¾ªçŽ¯çš„å¤šä¸ªè¿­ä»£ç»„åˆåˆ°ä¸€ä¸ªå—ä¸­ï¼Œå¹¶æŒ‰æ¯”ä¾‹å‡å°‘è¿­ä»£è®¡æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæ‚¨æœ€åˆæ‰§è¡Œ 100 æ¬¡è¿­ä»£ï¼Œä½†å†³å®šä½¿ç”¨ 4 çš„æ­¥å¹…ï¼Œåˆ™çŽ°åœ¨ä»Žæ¯ä¸ªå—æ‰§è¡Œ 4 æ¬¡å¾ªçŽ¯è¿­ä»£ï¼Œæ‚¨çš„è¿­ä»£è®¡æ•°ä¸º 25ã€‚<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/ThreadMigration/ThreadMigration.html#//apple_ref/doc/uid/TP40008091-CH105-SW2">å¾ªçŽ¯ä»£ç çš„æ”¹è¿›</a>ã€‚</p>
<h6 id="åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œä»»åŠ¡"><a href="#åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œä»»åŠ¡" class="headerlink" title="åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œä»»åŠ¡"></a>åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œä»»åŠ¡</h6><p>Grand Central Dispatch æä¾›äº†ä¸€ä¸ªç‰¹æ®Šçš„è°ƒåº¦é˜Ÿåˆ—ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥é˜Ÿåˆ—åœ¨åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œä»»åŠ¡ã€‚è¯¥é˜Ÿåˆ—æ˜¯ä¸ºæ‰€æœ‰åº”ç”¨ç¨‹åºè‡ªåŠ¨æä¾›çš„ï¼Œå¹¶ç”±åœ¨å…¶ä¸»çº¿ç¨‹ä¸Šè®¾ç½®è¿è¡Œå¾ªçŽ¯ï¼ˆç”±<code>CFRunLoopRef</code>ç±»åž‹æˆ–<code>NSRunLoop</code>å¯¹è±¡ç®¡ç†ï¼‰çš„ä»»ä½•åº”ç”¨ç¨‹åºè‡ªåŠ¨è€—å°½ã€‚å¦‚æžœæ‚¨ä¸æ˜¯è¦åˆ›å»º Cocoa åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”ä¸æƒ³æ˜¾å¼è®¾ç½®è¿è¡Œå¾ªçŽ¯ï¼Œåˆ™å¿…é¡»è°ƒç”¨è¯¥<code>dispatch_main</code>å‡½æ•°ä»¥æ˜¾å¼æ¶ˆè€—ä¸»è°ƒåº¦é˜Ÿåˆ—ã€‚æ‚¨ä»ç„¶å¯ä»¥å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œä½†æ˜¯å¦‚æžœä¸è°ƒç”¨æ­¤å‡½æ•°ï¼Œåˆ™è¿™äº›ä»»åŠ¡å°†æ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚</p>
<p>æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨è¯¥<code>dispatch_get_main_queue</code>å‡½æ•°æ¥èŽ·å–åº”ç”¨ç¨‹åºä¸»çº¿ç¨‹çš„è°ƒåº¦é˜Ÿåˆ—ã€‚æ·»åŠ åˆ°æ­¤é˜Ÿåˆ—çš„ä»»åŠ¡åœ¨ä¸»çº¿ç¨‹æœ¬èº«ä¸Šä¸²è¡Œæ‰§è¡Œã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥å°†æ­¤é˜Ÿåˆ—ç”¨ä½œåœ¨åº”ç”¨ç¨‹åºå…¶ä»–éƒ¨åˆ†ä¸­å®Œæˆå·¥ä½œçš„åŒæ­¥ç‚¹ã€‚</p>
<h6 id="åœ¨ä»»åŠ¡ä¸­ä½¿ç”¨-Objective-C-å¯¹è±¡"><a href="#åœ¨ä»»åŠ¡ä¸­ä½¿ç”¨-Objective-C-å¯¹è±¡" class="headerlink" title="åœ¨ä»»åŠ¡ä¸­ä½¿ç”¨ Objective-C å¯¹è±¡"></a>åœ¨ä»»åŠ¡ä¸­ä½¿ç”¨ Objective-C å¯¹è±¡</h6><p>GCD ä¸º Cocoa å†…å­˜ç®¡ç†æŠ€æœ¯æä¾›äº†å†…ç½®æ”¯æŒï¼Œå› æ­¤æ‚¨å¯ä»¥åœ¨æäº¤ç»™åˆ†æ´¾é˜Ÿåˆ—çš„å—ä¸­è‡ªç”±ä½¿ç”¨ Objective-C å¯¹è±¡ã€‚æ¯ä¸ªè°ƒåº¦é˜Ÿåˆ—éƒ½ç»´æŠ¤è‡ªå·±çš„è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œä»¥ç¡®ä¿è‡ªåŠ¨é‡Šæ”¾çš„å¯¹è±¡åœ¨æŸä¸ªæ—¶åˆ»è¢«é‡Šæ”¾ï¼›é˜Ÿåˆ—ä¸ä¿è¯å®ƒä»¬å®žé™…é‡Šæ”¾è¿™äº›å¯¹è±¡çš„æ—¶é—´ã€‚</p>
<p>å¦‚æžœæ‚¨çš„åº”ç”¨ç¨‹åºå—å†…å­˜é™åˆ¶ï¼Œå¹¶ä¸”æ‚¨çš„å—åˆ›å»ºäº†å¤šä¸ªè‡ªåŠ¨é‡Šæ”¾çš„å¯¹è±¡ï¼Œåˆ™åˆ›å»ºè‡ªå·±çš„è‡ªåŠ¨é‡Šæ”¾æ± æ˜¯ç¡®ä¿åŠæ—¶é‡Šæ”¾å¯¹è±¡çš„å”¯ä¸€æ–¹æ³•ã€‚å¦‚æžœæ‚¨çš„å—åˆ›å»ºäº†æ•°ç™¾ä¸ªå¯¹è±¡ï¼Œåˆ™å¯èƒ½è¦åˆ›å»ºå¤šä¸ªè‡ªåŠ¨é‡Šæ”¾æ± æˆ–å®šæœŸæŽ’ç©ºæ± ã€‚</p>
<p>æœ‰å…³è‡ªåŠ¨é‡Šæ”¾æ± å’Œ Objective-C å†…å­˜ç®¡ç†çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ã€Š_<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/MemoryMgmt/Articles/MemoryMgmt.html#//apple_ref/doc/uid/10000011i">é«˜çº§å†…å­˜ç®¡ç†ç¼–ç¨‹æŒ‡å—ã€‹</a>_ã€‚</p>
<h4 id="æŒ‚èµ·å’Œæ¢å¤é˜Ÿåˆ—-1"><a href="#æŒ‚èµ·å’Œæ¢å¤é˜Ÿåˆ—-1" class="headerlink" title="æŒ‚èµ·å’Œæ¢å¤é˜Ÿåˆ—"></a>æŒ‚èµ·å’Œæ¢å¤é˜Ÿåˆ—</h4><p>æ‚¨å¯ä»¥é€šè¿‡æŒ‚èµ·é˜Ÿåˆ—æ¥é˜»æ­¢é˜Ÿåˆ—ä¸´æ—¶æ‰§è¡Œå—å¯¹è±¡ã€‚æ‚¨å¯ä»¥ä½¿ç”¨<code>dispatch_suspend</code>å‡½æ•°æŒ‚èµ·è°ƒåº¦é˜Ÿåˆ—ï¼Œç„¶åŽä½¿ç”¨å‡½æ•°æ¥æ¢å¤å®ƒ<code>dispatch_resume</code>ã€‚è°ƒç”¨<code>dispatch_suspend</code>å¢žåŠ é˜Ÿåˆ—çš„æŒ‚èµ·å¼•ç”¨è®¡æ•°ï¼Œè°ƒç”¨<code>dispatch_resume</code>å‡å°‘å¼•ç”¨è®¡æ•°ã€‚å½“å¼•ç”¨è®¡æ•°å¤§äºŽé›¶æ—¶ï¼Œé˜Ÿåˆ—ä¿æŒæŒ‚èµ·çŠ¶æ€ã€‚å› æ­¤ï¼Œæ‚¨å¿…é¡»å¹³è¡¡æ‰€æœ‰æŒ‚èµ·çš„è°ƒç”¨ä¸ŽåŒ¹é…çš„æ¢å¤è°ƒç”¨ï¼Œä»¥æ¢å¤å¤„ç†å—ã€‚</p>
<p><strong>é‡è¦ï¼š</strong> æŒ‚èµ·å’Œæ¢å¤è°ƒç”¨æ˜¯å¼‚æ­¥çš„ï¼Œä»…åœ¨æ‰§è¡Œå—ä¹‹é—´ç”Ÿæ•ˆã€‚æŒ‚èµ·é˜Ÿåˆ—ä¸ä¼šå¯¼è‡´å·²ç»æ‰§è¡Œçš„å—åœæ­¢ã€‚</p>
<h4 id="ä½¿ç”¨è°ƒåº¦ä¿¡å·é‡æ¥è°ƒèŠ‚æœ‰é™èµ„æºçš„ä½¿ç”¨"><a href="#ä½¿ç”¨è°ƒåº¦ä¿¡å·é‡æ¥è°ƒèŠ‚æœ‰é™èµ„æºçš„ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨è°ƒåº¦ä¿¡å·é‡æ¥è°ƒèŠ‚æœ‰é™èµ„æºçš„ä½¿ç”¨"></a>ä½¿ç”¨è°ƒåº¦ä¿¡å·é‡æ¥è°ƒèŠ‚æœ‰é™èµ„æºçš„ä½¿ç”¨</h4><p>å¦‚æžœè¦æäº¤ç»™åˆ†æ´¾é˜Ÿåˆ—çš„ä»»åŠ¡è®¿é—®æŸäº›æœ‰é™èµ„æºï¼Œåˆ™å¯èƒ½è¦ä½¿ç”¨åˆ†æ´¾ä¿¡å·é‡æ¥è°ƒèŠ‚åŒæ—¶è®¿é—®è¯¥èµ„æºçš„ä»»åŠ¡æ•°ã€‚è°ƒåº¦ä¿¡å·é‡çš„å·¥ä½œæ–¹å¼ç±»ä¼¼äºŽå¸¸è§„ä¿¡å·é‡ï¼Œä½†æœ‰ä¸€ä¸ªä¾‹å¤–ã€‚å½“èµ„æºå¯ç”¨æ—¶ï¼ŒèŽ·å–è°ƒåº¦ä¿¡å·çš„æ—¶é—´æ¯”èŽ·å–ä¼ ç»Ÿç³»ç»Ÿä¿¡å·çš„æ—¶é—´è¦å°‘ã€‚è¿™æ˜¯å› ä¸ºå¯¹äºŽè¿™ç§ç‰¹æ®Šæƒ…å†µï¼ŒGrand Central Dispatch ä¸ä¼šè°ƒç”¨å†…æ ¸ã€‚å®ƒå”¯ä¸€è°ƒç”¨å†…æ ¸çš„æ—¶é—´æ˜¯å½“èµ„æºä¸å¯ç”¨æ—¶ï¼Œç³»ç»Ÿéœ€è¦åœæ”¾çº¿ç¨‹ï¼Œç›´åˆ°å‘ä¿¡å·ä¸ºæ­¢ã€‚</p>
<p>ä½¿ç”¨è°ƒåº¦ä¿¡å·é‡çš„è¯­ä¹‰å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ›å»ºä¿¡å·é‡ï¼ˆä½¿ç”¨<code>dispatch_semaphore_create</code>å‡½æ•°ï¼‰æ—¶ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªæ­£æ•´æ•°ï¼ŒæŒ‡ç¤ºå¯ç”¨èµ„æºçš„æ•°é‡ã€‚</li>
<li>åœ¨æ¯ä¸ªä»»åŠ¡ä¸­ï¼Œå‘¼å«<code>dispatch_semaphore_wait</code>ä»¥ç­‰å¾…ä¿¡å·é‡ã€‚</li>
<li>ç­‰å¾…è°ƒç”¨è¿”å›žæ—¶ï¼ŒèŽ·å–èµ„æºå¹¶è¿›è¡Œå·¥ä½œã€‚</li>
<li>å¤„ç†å®Œèµ„æºåŽï¼Œè¯·é‡Šæ”¾è¯¥èµ„æºå¹¶é€šè¿‡è°ƒç”¨è¯¥<code>dispatch_semaphore_signal</code>å‡½æ•°æ¥æŒ‡ç¤ºä¿¡å·é‡ã€‚</li>
</ol>
<p>æœ‰å…³è¿™äº›æ­¥éª¤å¦‚ä½•å·¥ä½œçš„ç¤ºä¾‹ï¼Œè¯·è€ƒè™‘åœ¨ç³»ç»Ÿä¸Šä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦ã€‚æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½å¯ä»¥ä½¿ç”¨æœ‰é™æ•°é‡çš„æ–‡ä»¶æè¿°ç¬¦ã€‚å¦‚æžœæ‚¨æœ‰ä¸€ä¸ªå¤„ç†å¤§é‡æ–‡ä»¶çš„ä»»åŠ¡ï¼Œé‚£ä¹ˆæ‚¨ä¸æƒ³ä¸€æ¬¡æ‰“å¼€è¿™ä¹ˆå¤šæ–‡ä»¶è€Œå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦ç”¨å°½ã€‚ç›¸åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¿¡å·é‡æ¥é™åˆ¶æ–‡ä»¶å¤„ç†ä»£ç åœ¨ä»»ä½•æ—¶å€™ä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡ã€‚æ‚¨å°†åˆå¹¶åˆ°ä»»åŠ¡ä¸­çš„åŸºæœ¬ä»£ç å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th><code>//åˆ›å»ºä¿¡å·é‡ï¼ŒæŒ‡å®šåˆå§‹æ± å¤§å°</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>dispatch_semaphore_t fd_sema = dispatch_semaphore_createï¼ˆgetdtablesizeï¼ˆï¼‰/ 2ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//ç­‰å¾…ä¸€ä¸ªå…è´¹çš„æ–‡ä»¶æè¿°ç¬¦</code></td>
</tr>
<tr>
<td><code>dispatch_semaphore_waitï¼ˆfd_semaï¼ŒDISPATCH_TIME_FOREVERï¼‰;</code></td>
</tr>
<tr>
<td><code>fd = openï¼ˆâ€œ / etc / servicesâ€ï¼ŒO_RDONLYï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å®ŒæˆåŽé‡Šæ”¾æ–‡ä»¶æè¿°ç¬¦</code></td>
</tr>
<tr>
<td><code>å…³é—­ï¼ˆFDï¼‰;</code></td>
</tr>
<tr>
<td><code>dispatch_semaphore_signalï¼ˆfd_semaï¼‰;</code></td>
</tr>
</tbody></table>
<p>åˆ›å»ºä¿¡å·é‡æ—¶ï¼Œè¯·æŒ‡å®šå¯ç”¨èµ„æºçš„æ•°é‡ã€‚è¯¥å€¼æˆä¸ºä¿¡å·é‡çš„åˆå§‹è®¡æ•°å˜é‡ã€‚æ¯æ¬¡æ‚¨ç­‰å¾…ä¿¡å·é‡æ—¶ï¼Œè¯¥<code>dispatch_semaphore_wait</code>å‡½æ•°éƒ½ä¼šå°†å˜é‡ count å‡ 1ã€‚å¦‚æžœç»“æžœå€¼ä¸ºè´Ÿï¼Œåˆ™è¯¥å‡½æ•°å‘Šè¯‰å†…æ ¸é˜»å¡žæ‚¨çš„çº¿ç¨‹ã€‚å¦ä¸€æ–¹é¢ï¼Œè¯¥<code>dispatch_semaphore_signal</code>å‡½æ•°å°† count å˜é‡å¢žåŠ  1 ä»¥æŒ‡ç¤ºèµ„æºå·²é‡Šæ”¾ã€‚å¦‚æžœæœ‰ä»»åŠ¡è¢«é˜»å¡žå¹¶ç­‰å¾…èµ„æºï¼Œåˆ™éšåŽå…¶ä¸­ä¸€ä¸ªå°†è¢«è§£é™¤é˜»å¡žå¹¶è¢«å…è®¸æ‰§è¡Œå…¶å·¥ä½œã€‚</p>
<h4 id="ç­‰å¾…æŽ’é˜Ÿçš„ä»»åŠ¡ç»„"><a href="#ç­‰å¾…æŽ’é˜Ÿçš„ä»»åŠ¡ç»„" class="headerlink" title="ç­‰å¾…æŽ’é˜Ÿçš„ä»»åŠ¡ç»„"></a>ç­‰å¾…æŽ’é˜Ÿçš„ä»»åŠ¡ç»„</h4><p>è°ƒåº¦ç»„æ˜¯ä¸€ç§é˜»å¡žçº¿ç¨‹çš„æ–¹æ³•ï¼Œç›´åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡å®Œæˆæ‰§è¡Œã€‚æ‚¨å¯ä»¥åœ¨æ‰€æœ‰æŒ‡å®šä»»åŠ¡å®Œæˆä¹‹å‰æ— æ³•å–å¾—è¿›å±•çš„åœ°æ–¹ä½¿ç”¨æ­¤è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œåœ¨åˆ†æ´¾äº†å¤šä¸ªä»»åŠ¡ä»¥è®¡ç®—ä¸€äº›æ•°æ®ä¹‹åŽï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç»„æ¥ç­‰å¾…è¿™äº›ä»»åŠ¡ï¼Œç„¶åŽåœ¨å®Œæˆæ—¶å¤„ç†ç»“æžœã€‚ä½¿ç”¨è°ƒåº¦ç»„çš„å¦ä¸€ç§æ–¹æ³•æ˜¯æ›¿ä»£çº¿ç¨‹è¿žæŽ¥ã€‚æ‚¨å¯ä»¥å°†ç›¸åº”çš„ä»»åŠ¡æ·»åŠ åˆ°è°ƒåº¦ç»„ä¸­ï¼Œç„¶åŽç­‰å¾…æ•´ä¸ªç»„ï¼Œè€Œä¸æ˜¯å¯åŠ¨å‡ ä¸ªå­çº¿ç¨‹ç„¶åŽå†ä¸Žæ¯ä¸ªå­çº¿ç¨‹è”æŽ¥ã€‚</p>
<p>æ¸…å• 3-6 æ˜¾ç¤ºäº†å»ºç«‹ç»„ï¼Œå‘å…¶åˆ†æ´¾ä»»åŠ¡å¹¶ç­‰å¾…ç»“æžœçš„åŸºæœ¬è¿‡ç¨‹ã€‚<code>dispatch_async</code>æ‚¨å¯ä»¥ä½¿ç”¨<code>dispatch_group_async</code>å‡½æ•°ä»£æ›¿ä½¿ç”¨è¯¥å‡½æ•°å°†ä»»åŠ¡è°ƒåº¦åˆ°é˜Ÿåˆ—ã€‚æ­¤åŠŸèƒ½å°†ä»»åŠ¡ä¸Žç»„å…³è”ï¼Œå¹¶å°†å…¶æŽ’é˜Ÿç­‰å¾…æ‰§è¡Œã€‚è¦ç­‰å¾…ä¸€ç»„ä»»åŠ¡å®Œæˆï¼Œè¯·ä½¿ç”¨è¯¥<code>dispatch_group_wait</code>å‡½æ•°ï¼Œä¼ å…¥é€‚å½“çš„ç»„ã€‚</p>
<p><strong>æ¸…å• 3-6</strong> ç­‰å¾…å¼‚æ­¥ä»»åŠ¡</p>
<table>
<thead>
<tr>
<th><code>dispatch_queue_té˜Ÿåˆ—= dispatch_get_global_queueï¼ˆDISPATCH_QUEUE_PRIORITY_DEFAULTï¼Œ0ï¼‰;</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>dispatch_group_tç»„= dispatch_group_createï¼ˆï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å°†ä»»åŠ¡æ·»åŠ åˆ°ç»„</code></td>
</tr>
<tr>
<td><code>dispatch_group_asyncï¼ˆgroupï¼Œqueueï¼Œ^ {</code></td>
</tr>
<tr>
<td><code>//ä¸€äº›å¼‚æ­¥å·¥ä½œ</code></td>
</tr>
<tr>
<td><code>}ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//åœ¨ä»»åŠ¡æ‰§è¡Œæ—¶åšå…¶ä»–å·¥ä½œã€‚</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å¦‚æžœæ— æ³•å†å–å¾—è¿›æ­¥ï¼Œ</code></td>
</tr>
<tr>
<td><code>//ç­‰å¾…ç»„é˜»æ­¢å½“å‰çº¿ç¨‹ã€‚</code></td>
</tr>
<tr>
<td><code>dispatch_group_waitï¼ˆgroupï¼ŒDISPATCH_TIME_FOREVERï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//ä¸å†éœ€è¦è¯¥ç»„æ—¶ï¼Œå°†å…¶é‡Šæ”¾ã€‚</code></td>
</tr>
<tr>
<td><code>dispatch_releaseï¼ˆgroupï¼‰;</code></td>
</tr>
</tbody></table>
<h4 id="è°ƒåº¦é˜Ÿåˆ—å’Œçº¿ç¨‹å®‰å…¨"><a href="#è°ƒåº¦é˜Ÿåˆ—å’Œçº¿ç¨‹å®‰å…¨" class="headerlink" title="è°ƒåº¦é˜Ÿåˆ—å’Œçº¿ç¨‹å®‰å…¨"></a>è°ƒåº¦é˜Ÿåˆ—å’Œçº¿ç¨‹å®‰å…¨</h4><p>åœ¨è°ƒåº¦é˜Ÿåˆ—çš„ä¸Šä¸‹æ–‡ä¸­è°ˆè®ºçº¿ç¨‹å®‰å…¨æ€§ä¼¼ä¹Žå¾ˆå¥‡æ€ªï¼Œä½†æ˜¯çº¿ç¨‹å®‰å…¨æ€§ä»ç„¶æ˜¯ä¸€ä¸ªç›¸å…³ä¸»é¢˜ã€‚æ¯å½“æ‚¨åœ¨åº”ç”¨ç¨‹åºä¸­å®žçŽ°å¹¶å‘æ—¶ï¼Œæ‚¨åº”è¯¥äº†è§£ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>è°ƒåº¦é˜Ÿåˆ—æœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ¢å¥è¯è¯´ï¼Œæ‚¨å¯ä»¥ä»Žç³»ç»Ÿä¸Šçš„ä»»ä½•çº¿ç¨‹å°†ä»»åŠ¡æäº¤åˆ°è°ƒåº¦é˜Ÿåˆ—ï¼Œè€Œæ— éœ€å…ˆèŽ·å–é”æˆ–åŒæ­¥å¯¹è¯¥é˜Ÿåˆ—çš„è®¿é—®ã€‚</li>
<li>ä¸è¦<code>dispatch_sync</code>ä»Žä¼ é€’ç»™å‡½æ•°è°ƒç”¨çš„åŒä¸€é˜Ÿåˆ—ä¸­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ä¸­è°ƒç”¨å‡½æ•°ã€‚è¿™æ ·åšå°†æ­»é”é˜Ÿåˆ—ã€‚å¦‚æžœéœ€è¦åˆ†æ´¾åˆ°å½“å‰é˜Ÿåˆ—ï¼Œè¯·ä½¿ç”¨<code>dispatch_async</code>å‡½æ•°å¼‚æ­¥è¿›è¡Œã€‚</li>
<li>é¿å…ä»Žæäº¤åˆ°è°ƒåº¦é˜Ÿåˆ—çš„ä»»åŠ¡ä¸­èŽ·å–é”å®šã€‚å°½ç®¡å¯ä»¥å®‰å…¨åœ°ä»Žä»»åŠ¡ä¸­ä½¿ç”¨é”ï¼Œä½†æ˜¯å½“æ‚¨èŽ·å–é”æ—¶ï¼Œå¦‚æžœè¯¥é”ä¸å¯ç”¨ï¼Œåˆ™å¯èƒ½ä¼šå®Œå…¨é˜»å¡žä¸²è¡Œé˜Ÿåˆ—ã€‚åŒæ ·ï¼Œå¯¹äºŽå¹¶å‘é˜Ÿåˆ—ï¼Œç­‰å¾…é”å¯èƒ½ä¼šé˜»æ­¢å…¶ä»–ä»»åŠ¡æ‰§è¡Œã€‚å¦‚æžœéœ€è¦åŒæ­¥éƒ¨åˆ†ä»£ç ï¼Œè¯·ä½¿ç”¨ä¸²è¡Œåˆ†æ´¾é˜Ÿåˆ—è€Œä¸æ˜¯é”ã€‚</li>
<li>å°½ç®¡æ‚¨å¯ä»¥èŽ·å¾—æœ‰å…³è¿è¡Œä»»åŠ¡çš„åŸºç¡€çº¿ç¨‹çš„ä¿¡æ¯ï¼Œä½†æœ€å¥½é¿å…è¿™æ ·åšã€‚æœ‰å…³è°ƒåº¦é˜Ÿåˆ—ä¸Žçº¿ç¨‹çš„å…¼å®¹æ€§çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/ThreadMigration/ThreadMigration.html#//apple_ref/doc/uid/TP40008091-CH105-SW18">ä¸Ž POSIX çº¿ç¨‹çš„å…¼å®¹æ€§</a>ã€‚</li>
</ul>
<p>æœ‰å…³å¦‚ä½•æ›´æ”¹çŽ°æœ‰çº¿ç¨‹ä»£ç ä»¥ä½¿ç”¨è°ƒåº¦é˜Ÿåˆ—çš„å…¶ä»–æç¤ºï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/ThreadMigration/ThreadMigration.html#//apple_ref/doc/uid/TP40008091-CH105-SW1">ã€Šä»Žçº¿ç¨‹è¿ç§»ã€‹</a>ã€‚</p>
<h2 id="æ´¾é£æ¥æº-1"><a href="#æ´¾é£æ¥æº-1" class="headerlink" title="æ´¾é£æ¥æº"></a>æ´¾é£æ¥æº</h2><p>æ¯å½“æ‚¨ä¸ŽåŸºç¡€ç³»ç»Ÿè¿›è¡Œäº¤äº’æ—¶ï¼Œæ‚¨éƒ½å¿…é¡»ä¸ºè¯¥ä»»åŠ¡åšå¥½å‡†å¤‡è€ŒèŠ±è´¹å¤§é‡æ—¶é—´ã€‚è°ƒç”¨å†…æ ¸æˆ–å…¶ä»–ç³»ç»Ÿå±‚æ¶‰åŠä¸Šä¸‹æ–‡çš„æ›´æ”¹ï¼Œä¸Žæ‚¨è‡ªå·±çš„è¿›ç¨‹ä¸­å‘ç”Ÿçš„è°ƒç”¨ç›¸æ¯”ï¼Œæ›´æ”¹æˆæœ¬ç›¸å½“é«˜ã€‚ç»“æžœï¼Œè®¸å¤šç³»ç»Ÿåº“æä¾›äº†å¼‚æ­¥æŽ¥å£ï¼Œä»¥ä½¿æ‚¨çš„ä»£ç å¯ä»¥å‘ç³»ç»Ÿæäº¤è¯·æ±‚ï¼Œå¹¶åœ¨å¤„ç†è¯¥è¯·æ±‚æ—¶ç»§ç»­æ‰§è¡Œå…¶ä»–å·¥ä½œã€‚é€šè¿‡å…è®¸æ‚¨æäº¤è¯·æ±‚å¹¶ä½¿ç”¨å—å’Œè°ƒåº¦é˜Ÿåˆ—å°†ç»“æžœæŠ¥å‘Šå›žä»£ç ï¼ŒGrand Central Dispatch ä»¥æ­¤ä¸€èˆ¬è¡Œä¸ºä¸ºåŸºç¡€ã€‚</p>
<h4 id="å…³äºŽè°ƒåº¦æº"><a href="#å…³äºŽè°ƒåº¦æº" class="headerlink" title="å…³äºŽè°ƒåº¦æº"></a>å…³äºŽè°ƒåº¦æº</h4><p>ç”²<em>è°ƒåº¦æº</em>æ˜¯ä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»åž‹çš„åæ ‡ç‰¹å®šä½Žå±‚ç³»ç»Ÿäº‹ä»¶çš„å¤„ç†ã€‚å¤§ä¸­å¤®è°ƒåº¦æ”¯æŒä»¥ä¸‹ç±»åž‹çš„è°ƒåº¦æºï¼š</p>
<ul>
<li><em>è®¡æ—¶å™¨è°ƒåº¦æº</em>ç”Ÿæˆå®šæœŸé€šçŸ¥ã€‚</li>
<li>UNIX ä¿¡å·åˆ°è¾¾æ—¶ï¼Œ<em>ä¿¡å·åˆ†å‘æºä¼š</em>é€šçŸ¥æ‚¨ã€‚</li>
<li><em>æè¿°ç¬¦æºä¼š</em>é€šçŸ¥æ‚¨å„ç§åŸºäºŽæ–‡ä»¶å’Œå¥—æŽ¥å­—çš„æ“ä½œï¼Œä¾‹å¦‚ï¼š<ul>
<li>å½“æ•°æ®å¯ä¾›è¯»å–æ—¶</li>
<li>ä½•æ—¶å¯ä»¥å†™å…¥æ•°æ®</li>
<li>åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­åˆ é™¤ï¼Œç§»åŠ¨æˆ–é‡å‘½åæ–‡ä»¶æ—¶</li>
<li>æ–‡ä»¶å…ƒä¿¡æ¯æ›´æ”¹æ—¶</li>
</ul>
</li>
<li><em>æµç¨‹è°ƒåº¦æºä¼š</em>é€šçŸ¥æ‚¨ä¸Žæµç¨‹ç›¸å…³çš„äº‹ä»¶ï¼Œä¾‹å¦‚ï¼š<ul>
<li>è¿›ç¨‹é€€å‡ºæ—¶</li>
<li>å½“æµç¨‹å‘å‡ºå‘¼å«<code>fork</code>æˆ–<code>exec</code>å‘¼å«ç±»åž‹æ—¶</li>
<li>å½“ä¿¡å·ä¼ é€’åˆ°è¿‡ç¨‹æ—¶</li>
</ul>
</li>
<li><em>Mach ç«¯å£è°ƒåº¦æºä¼š</em>é€šçŸ¥æ‚¨ä¸Ž Mach ç›¸å…³çš„äº‹ä»¶ã€‚</li>
<li><em>è‡ªå®šä¹‰è°ƒåº¦æº</em>æ˜¯æ‚¨å®šä¹‰å¹¶è§¦å‘è‡ªå·±çš„æºã€‚</li>
</ul>
<p>è°ƒåº¦æºæ›¿æ¢äº†é€šå¸¸ç”¨äºŽå¤„ç†ç³»ç»Ÿç›¸å…³äº‹ä»¶çš„å¼‚æ­¥å›žè°ƒå‡½æ•°ã€‚é…ç½®è°ƒåº¦æºæ—¶ï¼Œå¯ä»¥æŒ‡å®šè¦ç›‘è§†çš„äº‹ä»¶ä»¥åŠç”¨äºŽå¤„ç†è¿™äº›äº‹ä»¶çš„è°ƒåº¦é˜Ÿåˆ—å’Œä»£ç ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å—å¯¹è±¡æˆ–åŠŸèƒ½æŒ‡å®šä»£ç ã€‚å½“æ„Ÿå…´è¶£çš„äº‹ä»¶åˆ°è¾¾æ—¶ï¼Œè°ƒåº¦æºå°†æ‚¨çš„å—æˆ–å‡½æ•°æäº¤åˆ°æŒ‡å®šçš„è°ƒåº¦é˜Ÿåˆ—ä»¥æ‰§è¡Œã€‚</p>
<p>ä¸Žæ‚¨æ‰‹åŠ¨æäº¤åˆ°é˜Ÿåˆ—çš„ä»»åŠ¡ä¸åŒï¼Œè°ƒåº¦æºä¸ºåº”ç”¨ç¨‹åºæä¾›äº†è¿žç»­çš„äº‹ä»¶æºã€‚è°ƒåº¦æºå°†ä¸€ç›´é™„åŠ åˆ°å…¶è°ƒåº¦é˜Ÿåˆ—ï¼Œç›´åˆ°æ‚¨æ˜Žç¡®å–æ¶ˆå®ƒä¸ºæ­¢ã€‚é™„åŠ åŽï¼Œæ— è®ºä½•æ—¶å‘ç”Ÿç›¸åº”äº‹ä»¶ï¼Œå®ƒéƒ½ä¼šå°†å…¶å…³è”çš„ä»»åŠ¡ä»£ç æäº¤åˆ°è°ƒåº¦é˜Ÿåˆ—ã€‚æŸäº›äº‹ä»¶ï¼ˆä¾‹å¦‚è®¡æ—¶å™¨äº‹ä»¶ï¼‰ä»¥å›ºå®šçš„é—´éš”å‘ç”Ÿï¼Œä½†å¤§å¤šæ•°ä»…åœ¨ç‰¹å®šæ¡ä»¶å‡ºçŽ°æ—¶æ‰å¶å°”å‘ç”Ÿã€‚å› æ­¤ï¼Œè°ƒåº¦æºä¿ç•™å…¶å…³è”çš„è°ƒåº¦é˜Ÿåˆ—ï¼Œä»¥é˜²æ­¢åœ¨äº‹ä»¶å¯èƒ½ä»æœªå†³æ—¶è¿‡æ—©åœ°å°†å…¶é‡Šæ”¾ã€‚</p>
<p>ä¸ºäº†é˜²æ­¢äº‹ä»¶ç§¯åŽ‹åœ¨è°ƒåº¦é˜Ÿåˆ—ä¸­ï¼Œè°ƒåº¦æºå®žæ–½äº‹ä»¶åˆå¹¶æ–¹æ¡ˆã€‚å¦‚æžœæ–°äº‹ä»¶åˆ°è¾¾å‰ä¸€ä¸ªäº‹ä»¶çš„äº‹ä»¶å¤„ç†ç¨‹åºä¹‹å‰å·²ç»å‡ºé˜Ÿå¹¶æ‰§è¡Œï¼Œåˆ™è°ƒåº¦æºå°†æ–°äº‹ä»¶æ•°æ®ä¸­çš„æ•°æ®ä¸Žæ—§äº‹ä»¶ä¸­çš„æ•°æ®åˆå¹¶ã€‚æ ¹æ®äº‹ä»¶çš„ç±»åž‹ï¼Œåˆå¹¶å¯èƒ½ä¼šæ›¿æ¢æ—§äº‹ä»¶æˆ–æ›´æ–°å…¶æŒæœ‰çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼ŒåŸºäºŽä¿¡å·çš„è°ƒåº¦æºä»…æä¾›æœ‰å…³æœ€æ–°ä¿¡å·çš„ä¿¡æ¯ï¼Œè€Œä¸”è¿˜æŠ¥å‘Šè‡ªä»Žä¸Šæ¬¡è°ƒç”¨äº‹ä»¶å¤„ç†ç¨‹åºä»¥æ¥å·²ä¼ é€’äº†å¤šå°‘æ€»ä¿¡å·ã€‚</p>
<h4 id="åˆ›å»ºè°ƒåº¦æº"><a href="#åˆ›å»ºè°ƒåº¦æº" class="headerlink" title="åˆ›å»ºè°ƒåº¦æº"></a>åˆ›å»ºè°ƒåº¦æº</h4><p>åˆ›å»ºè°ƒåº¦æºæ¶‰åŠåˆ›å»ºäº‹ä»¶æºå’Œè°ƒåº¦æºæœ¬èº«ã€‚äº‹ä»¶çš„æ¥æºæ˜¯å¤„ç†äº‹ä»¶æ‰€éœ€çš„ä»»ä½•æœ¬æœºæ•°æ®ç»“æž„ã€‚ä¾‹å¦‚ï¼Œå¯¹äºŽåŸºäºŽæè¿°ç¬¦çš„è°ƒåº¦æºï¼Œæ‚¨å°†éœ€è¦æ‰“å¼€æè¿°ç¬¦ï¼Œè€Œå¯¹äºŽåŸºäºŽè¿›ç¨‹çš„æºï¼Œåˆ™éœ€è¦èŽ·å–ç›®æ ‡ç¨‹åºçš„è¿›ç¨‹ IDã€‚æœ‰äº†äº‹ä»¶æºåŽï¼Œå°±å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹å¼åˆ›å»ºç›¸åº”çš„è°ƒåº¦æºï¼š</p>
<ol>
<li>ä½¿ç”¨<code>dispatch_source_create</code>å‡½æ•°åˆ›å»ºè°ƒåº¦æºã€‚</li>
<li>é…ç½®è°ƒåº¦æºï¼š<ul>
<li>å°†äº‹ä»¶å¤„ç†ç¨‹åºåˆ†é…ç»™è°ƒåº¦æºï¼›è¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW13">ç¼–å†™å’Œå®‰è£…äº‹ä»¶å¤„ç†ç¨‹åº</a>ã€‚</li>
<li>å¯¹äºŽè®¡æ—¶å™¨æºï¼Œä½¿ç”¨<code>dispatch_source_set_timer</code>åŠŸèƒ½è®¾ç½®è®¡æ—¶å™¨ä¿¡æ¯ï¼›è¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW2">åˆ›å»ºè®¡æ—¶å™¨</a>ã€‚</li>
</ul>
</li>
<li>ï¼ˆå¯é€‰ï¼‰å°†å–æ¶ˆå¤„ç†ç¨‹åºåˆ†é…ç»™è°ƒåº¦æºï¼›è¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW14">å®‰è£…å–æ¶ˆå¤„ç†ç¨‹åº</a>ã€‚</li>
<li>è°ƒç”¨è¯¥<code>dispatch_resume</code>å‡½æ•°ä»¥å¼€å§‹å¤„ç†äº‹ä»¶ï¼›è¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW8">æš‚åœå’Œæ¢å¤æ´¾é£æº</a>ã€‚</li>
</ol>
<p>ç”±äºŽè°ƒåº¦æºåœ¨ä½¿ç”¨å‰éœ€è¦è¿›è¡Œä¸€äº›å…¶ä»–é…ç½®ï¼Œå› æ­¤è¯¥<code>dispatch_source_create</code>å‡½æ•°ä»¥æŒ‚èµ·çŠ¶æ€è¿”å›žè°ƒåº¦æºã€‚æŒ‚èµ·æ—¶ï¼Œè°ƒåº¦æºå°†æŽ¥æ”¶äº‹ä»¶ï¼Œä½†ä¸å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚è¿™ä½¿æ‚¨æœ‰æ—¶é—´å®‰è£…äº‹ä»¶å¤„ç†ç¨‹åºå¹¶æ‰§è¡Œå¤„ç†å®žé™…äº‹ä»¶æ‰€éœ€çš„ä»»ä½•å…¶ä»–é…ç½®ã€‚</p>
<p>ä»¥ä¸‹å„èŠ‚å‘æ‚¨å±•ç¤ºå¦‚ä½•é…ç½®è°ƒåº¦æºçš„å„ä¸ªæ–¹é¢ã€‚æœ‰å…³æ˜¾ç¤ºå¦‚ä½•é…ç½®ç‰¹å®šç±»åž‹çš„è°ƒåº¦æºçš„è¯¦ç»†ç¤ºä¾‹ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW22">è°ƒåº¦æºç¤ºä¾‹</a>ã€‚æœ‰å…³ç”¨äºŽåˆ›å»ºå’Œé…ç½®è°ƒåº¦æºçš„åŠŸèƒ½çš„å…¶ä»–ä¿¡æ¯ï¼Œè¯·å‚é˜…ã€Š_Grand Central Dispatchï¼ˆGCDï¼‰å‚è€ƒã€‹_ã€‚</p>
<h6 id="ç¼–å†™å’Œå®‰è£…äº‹ä»¶å¤„ç†ç¨‹åº"><a href="#ç¼–å†™å’Œå®‰è£…äº‹ä»¶å¤„ç†ç¨‹åº" class="headerlink" title="ç¼–å†™å’Œå®‰è£…äº‹ä»¶å¤„ç†ç¨‹åº"></a>ç¼–å†™å’Œå®‰è£…äº‹ä»¶å¤„ç†ç¨‹åº</h6><p>è¦å¤„ç†ç”±è°ƒåº¦æºç”Ÿæˆçš„äº‹ä»¶ï¼Œå¿…é¡»å®šä¹‰äº‹ä»¶å¤„ç†ç¨‹åºä»¥å¤„ç†è¿™äº›äº‹ä»¶ã€‚äº‹ä»¶å¤„ç†ç¨‹åºæ˜¯æ‚¨ä½¿ç”¨æˆ–å‡½æ•°å®‰è£…åœ¨è°ƒåº¦æºä¸Šçš„å‡½æ•°æˆ–å—å¯¹è±¡ã€‚å½“äº‹ä»¶åˆ°è¾¾æ—¶ï¼Œè°ƒåº¦æºå°†æ‚¨çš„äº‹ä»¶å¤„ç†ç¨‹åºæäº¤åˆ°æŒ‡å®šçš„è°ƒåº¦é˜Ÿåˆ—ä»¥è¿›è¡Œå¤„ç†ã€‚<code>dispatch_source_set_event_handler``dispatch_source_set_event_handler_f</code></p>
<p>äº‹ä»¶å¤„ç†ç¨‹åºçš„ä¸»ä½“è´Ÿè´£å¤„ç†ä»»ä½•åˆ°è¾¾çš„äº‹ä»¶ã€‚å¦‚æžœäº‹ä»¶å¤„ç†ç¨‹åºå·²ç»æŽ’é˜Ÿï¼Œå¹¶åœ¨æ–°äº‹ä»¶åˆ°è¾¾æ—¶ç­‰å¾…å¤„ç†äº‹ä»¶ï¼Œåˆ™è°ƒåº¦æºå°†ä¸¤ä¸ªäº‹ä»¶åˆå¹¶ã€‚äº‹ä»¶å¤„ç†ç¨‹åºé€šå¸¸åªçœ‹åˆ°æœ‰å…³æœ€æ–°äº‹ä»¶çš„ä¿¡æ¯ï¼Œä½†æ˜¯æ ¹æ®è°ƒåº¦æºçš„ç±»åž‹ï¼Œäº‹ä»¶å¤„ç†ç¨‹åºä¹Ÿå¯èƒ½èƒ½å¤ŸèŽ·å–æœ‰å…³å‘ç”Ÿå¹¶åˆå¹¶çš„å…¶ä»–äº‹ä»¶çš„ä¿¡æ¯ã€‚å¦‚æžœåœ¨äº‹ä»¶å¤„ç†ç¨‹åºå¼€å§‹æ‰§è¡Œä¹‹åŽåˆ°è¾¾ä¸€ä¸ªæˆ–å¤šä¸ªæ–°äº‹ä»¶ï¼Œåˆ™è°ƒåº¦æºå°†ä¿ç•™è¿™äº›äº‹ä»¶ï¼Œç›´åˆ°å½“å‰äº‹ä»¶å¤„ç†ç¨‹åºå®Œæˆæ‰§è¡Œä¸ºæ­¢ã€‚æ­¤æ—¶ï¼Œå®ƒå°†ä½¿ç”¨æ–°äº‹ä»¶å†æ¬¡å°†äº‹ä»¶å¤„ç†ç¨‹åºæäº¤åˆ°é˜Ÿåˆ—ã€‚</p>
<p>åŸºäºŽå‡½æ•°çš„äº‹ä»¶å¤„ç†ç¨‹åºé‡‡ç”¨å•ä¸ªä¸Šä¸‹æ–‡æŒ‡é’ˆï¼Œå…¶ä¸­åŒ…å«è°ƒåº¦æºå¯¹è±¡ï¼Œå¹¶ä¸”ä¸è¿”å›žä»»ä½•å€¼ã€‚åŸºäºŽå—çš„äº‹ä»¶å¤„ç†ç¨‹åºä¸å¸¦å‚æ•°ï¼Œä¹Ÿæ²¡æœ‰è¿”å›žå€¼ã€‚</p>
<table>
<thead>
<tr>
<th><code>//åŸºäºŽå—çš„äº‹ä»¶å¤„ç†ç¨‹åº</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>æ— æ•ˆï¼ˆ^ dispatch_block_tï¼‰ï¼ˆæ— æ•ˆï¼‰</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//åŸºäºŽå‡½æ•°çš„äº‹ä»¶å¤„ç†ç¨‹åº</code></td>
</tr>
<tr>
<td><code>æ— æ•ˆï¼ˆ* dispatch_function_tï¼‰ï¼ˆæ— æ•ˆ*ï¼‰</code></td>
</tr>
</tbody></table>
<p>åœ¨äº‹ä»¶å¤„ç†ç¨‹åºå†…éƒ¨ï¼Œæ‚¨å¯ä»¥ä»Žè°ƒåº¦æºæœ¬èº«èŽ·å–æœ‰å…³ç»™å®šäº‹ä»¶çš„ä¿¡æ¯ã€‚å°½ç®¡å°†åŸºäºŽå‡½æ•°çš„äº‹ä»¶å¤„ç†ç¨‹åºä½œä¸ºå‚æ•°ä¼ é€’ç»™è°ƒåº¦æºçš„æŒ‡é’ˆï¼Œä½†æ˜¯åŸºäºŽå—çš„äº‹ä»¶å¤„ç†ç¨‹åºå¿…é¡»è‡ªå·±æ•èŽ·è¯¥æŒ‡é’ˆã€‚æ‚¨å¯ä»¥é€šè¿‡æ­£å¸¸å¼•ç”¨åŒ…å«è°ƒåº¦æºçš„å˜é‡æ¥ä¸ºæ‚¨çš„å—æ‰§è¡Œæ­¤æ“ä½œã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç ç‰‡æ®µæ•èŽ·äº†<code>source</code>åœ¨å—èŒƒå›´ä¹‹å¤–å£°æ˜Žçš„å˜é‡ã€‚</p>
<table>
<thead>
<tr>
<th><code>dispatch_source_t source = dispatch_source_createï¼ˆDISPATCH_SOURCE_TYPE_READï¼Œ</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>myDescriptorï¼Œ0ï¼ŒmyQueueï¼‰ï¼›</code></td>
</tr>
<tr>
<td><code>dispatch_source_set_event_handlerï¼ˆsourceï¼Œ^ {</code></td>
</tr>
<tr>
<td><code>//ä»Žæ•èŽ·çš„æºå˜é‡ä¸­èŽ·å–ä¸€äº›æ•°æ®</code></td>
</tr>
<tr>
<td><code>//æ¥è‡ªçˆ¶ä¸Šä¸‹æ–‡ã€‚</code></td>
</tr>
<tr>
<td><code>ä¼°è®¡çš„size_t = dispatch_source_get_dataï¼ˆsourceï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//ç»§ç»­é˜…è¯»æè¿°ç¬¦...</code></td>
</tr>
<tr>
<td><code>}ï¼‰;</code></td>
</tr>
<tr>
<td><code>dispatch_resumeï¼ˆæºï¼‰;</code></td>
</tr>
</tbody></table>
<p>é€šå¸¸ä¼šåœ¨å—å†…éƒ¨æ•èŽ·å˜é‡ï¼Œä»¥å®žçŽ°æ›´å¤§çš„çµæ´»æ€§å’ŒåŠ¨æ€æ€§ã€‚å½“ç„¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ•èŽ·çš„å˜é‡åœ¨å—å†…æ˜¯åªè¯»çš„ã€‚å°½ç®¡å—åŠŸèƒ½æä¾›äº†åœ¨ç‰¹å®šæƒ…å†µä¸‹ä¿®æ”¹æ•èŽ·çš„å˜é‡çš„æ”¯æŒï¼Œä½†æ‚¨ä¸åº”åœ¨ä¸Žåˆ†æ´¾æºå…³è”çš„äº‹ä»¶å¤„ç†ç¨‹åºä¸­å°è¯•è¿™æ ·åšã€‚è°ƒåº¦æºå§‹ç»ˆå¼‚æ­¥æ‰§è¡Œå…¶äº‹ä»¶å¤„ç†ç¨‹åºï¼Œå› æ­¤æ•èŽ·çš„æ‰€æœ‰å˜é‡çš„å®šä¹‰èŒƒå›´å¯èƒ½åœ¨äº‹ä»¶å¤„ç†ç¨‹åºæ‰§è¡Œæ—¶å°±æ¶ˆå¤±äº†ã€‚æœ‰å…³å¦‚ä½•åœ¨å—å†…æ•èŽ·å’Œä½¿ç”¨å˜é‡çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§*<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Blocks/Articles/00_Introduction.html#//apple_ref/doc/uid/TP40007502">å—ç¼–ç¨‹ä¸»é¢˜</a>*ã€‚</p>
<p>è¡¨ 4-1 åˆ—å‡ºäº†å¯ä»¥ä»Žäº‹ä»¶å¤„ç†ç¨‹åºä»£ç ä¸­è°ƒç”¨ä»¥èŽ·å–æœ‰å…³äº‹ä»¶çš„ä¿¡æ¯çš„åŠŸèƒ½ã€‚</p>
<table>
<thead>
<tr>
<th align="left">åŠŸèƒ½</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>dispatch_source_get_handle</code></td>
<td align="left">æ­¤å‡½æ•°è¿”å›žè°ƒåº¦æºç®¡ç†çš„åŸºç¡€ç³»ç»Ÿæ•°æ®ç±»åž‹ã€‚å¯¹äºŽæè¿°ç¬¦è°ƒåº¦æºï¼Œæ­¤å‡½æ•°è¿”å›žä¸€ä¸ª<code>int</code>åŒ…å«ä¸Žè°ƒåº¦æºå…³è”çš„æè¿°ç¬¦çš„ç±»åž‹ã€‚å¯¹äºŽä¿¡å·åˆ†é…æºï¼Œæ­¤å‡½æ•°è¿”å›žä¸€ä¸ª<code>int</code>ç±»åž‹ï¼Œè¯¥ç±»åž‹åŒ…å«æœ€è¿‘äº‹ä»¶çš„ä¿¡å·ç¼–å·ã€‚å¯¹äºŽæµç¨‹è°ƒåº¦æºï¼Œæ­¤å‡½æ•°è¿”å›ž<code>pid_t</code>è¦ç›‘è§†çš„æµç¨‹çš„æ•°æ®ç»“æž„ã€‚å¯¹äºŽé©¬èµ«ç«¯å£åˆ†é…æºï¼Œæ­¤å‡½æ•°è¿”å›ž<code>mach_port_t</code>æ•°æ®ç»“æž„ã€‚å¯¹äºŽå…¶ä»–è°ƒåº¦æºï¼Œæ­¤å‡½æ•°è¿”å›žçš„å€¼æ˜¯ä¸ç¡®å®šçš„ã€‚</td>
</tr>
<tr>
<td align="left"><code>dispatch_source_get_data</code></td>
<td align="left">æ­¤å‡½æ•°è¿”å›žä¸Žäº‹ä»¶å…³è”çš„æ‰€æœ‰æœªå†³æ•°æ®ã€‚å¯¹äºŽä»Žæ–‡ä»¶è¯»å–æ•°æ®çš„æè¿°ç¬¦è°ƒåº¦æºï¼Œæ­¤å‡½æ•°è¿”å›žå¯è¯»å–çš„å­—èŠ‚æ•°ã€‚å¯¹äºŽå°†æ•°æ®å†™å…¥æ–‡ä»¶çš„æè¿°ç¬¦åˆ†æ´¾æºï¼Œå¦‚æžœæœ‰å¯ç”¨çš„å†™å…¥ç©ºé—´ï¼Œåˆ™æ­¤å‡½æ•°è¿”å›žæ­£æ•´æ•°ã€‚å¯¹äºŽç›‘è§†æ–‡ä»¶ç³»ç»Ÿæ´»åŠ¨çš„æè¿°ç¬¦åˆ†å‘æºï¼Œæ­¤å‡½æ•°è¿”å›žä¸€ä¸ªå¸¸é‡ï¼ŒæŒ‡ç¤ºå‘ç”Ÿçš„äº‹ä»¶çš„ç±»åž‹ã€‚æœ‰å…³å¸¸é‡çš„åˆ—è¡¨ï¼Œè¯·å‚è§<code>dispatch_source_vnode_flags_t</code>æžšä¸¾ç±»åž‹ã€‚å¯¹äºŽæµç¨‹è°ƒåº¦æºï¼Œæ­¤å‡½æ•°è¿”å›žä¸€ä¸ªå¸¸é‡ï¼ŒæŒ‡ç¤ºå‘ç”Ÿçš„äº‹ä»¶çš„ç±»åž‹ã€‚æœ‰å…³å¸¸é‡çš„åˆ—è¡¨ï¼Œè¯·å‚è§<code>dispatch_source_proc_flags_t</code>æžšä¸¾ç±»åž‹ã€‚å¯¹äºŽ Mach ç«¯å£è°ƒåº¦æºï¼Œæ­¤å‡½æ•°è¿”å›žä¸€ä¸ªå¸¸é‡ï¼ŒæŒ‡ç¤ºå‘ç”Ÿçš„äº‹ä»¶çš„ç±»åž‹ã€‚æœ‰å…³å¸¸é‡çš„åˆ—è¡¨ï¼Œè¯·å‚è§<code>dispatch_source_machport_flags_t</code>æžšä¸¾ç±»åž‹ã€‚å¯¹äºŽè‡ªå®šä¹‰è°ƒåº¦æºï¼Œæ­¤å‡½æ•°è¿”å›žä»ŽçŽ°æœ‰æ•°æ®åˆ›å»ºçš„æ–°æ•°æ®å€¼ä»¥åŠä¼ é€’ç»™è¯¥<code>dispatch_source_merge_data</code>å‡½æ•°çš„æ–°æ•°æ®ã€‚</td>
</tr>
<tr>
<td align="left"><code>dispatch_source_get_mask</code></td>
<td align="left">æ­¤å‡½æ•°è¿”å›žç”¨äºŽåˆ›å»ºè°ƒåº¦æºçš„äº‹ä»¶æ ‡å¿—ã€‚å¯¹äºŽæµç¨‹è°ƒåº¦æºï¼Œæ­¤å‡½æ•°è¿”å›žè°ƒåº¦æºæŽ¥æ”¶çš„äº‹ä»¶çš„æŽ©ç ã€‚æœ‰å…³å¸¸é‡çš„åˆ—è¡¨ï¼Œè¯·å‚è§<code>dispatch_source_proc_flags_t</code>æžšä¸¾ç±»åž‹ã€‚å¯¹äºŽå…·æœ‰å‘é€æƒé™çš„ Mach ç«¯å£è°ƒåº¦æºï¼Œæ­¤å‡½æ•°è¿”å›žæ‰€éœ€äº‹ä»¶çš„æŽ©ç ã€‚æœ‰å…³å¸¸é‡çš„åˆ—è¡¨ï¼Œè¯·å‚è§<code>dispatch_source_mach_send_flags_t</code>æžšä¸¾ç±»åž‹ã€‚å¯¹äºŽè‡ªå®šä¹‰ OR è°ƒåº¦æºï¼Œæ­¤å‡½æ•°è¿”å›žç”¨äºŽåˆå¹¶æ•°æ®å€¼çš„æŽ©ç ã€‚</td>
</tr>
</tbody></table>
<p>æœ‰å…³å¦‚ä½•ä¸ºç‰¹å®šç±»åž‹çš„è°ƒåº¦æºç¼–å†™å’Œå®‰è£…äº‹ä»¶å¤„ç†ç¨‹åºçš„<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW22">ç¤ºä¾‹</a>ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW22">è°ƒåº¦æºç¤ºä¾‹</a>ã€‚</p>
<h6 id="å®‰è£…å–æ¶ˆå¤„ç†ç¨‹åº"><a href="#å®‰è£…å–æ¶ˆå¤„ç†ç¨‹åº" class="headerlink" title="å®‰è£…å–æ¶ˆå¤„ç†ç¨‹åº"></a>å®‰è£…å–æ¶ˆå¤„ç†ç¨‹åº</h6><p>å–æ¶ˆå¤„ç†ç¨‹åºç”¨äºŽåœ¨å‘å¸ƒæºä¹‹å‰å¯¹å…¶è¿›è¡Œæ¸…ç†ã€‚å¯¹äºŽå¤§å¤šæ•°ç±»åž‹çš„è°ƒåº¦æºï¼Œå–æ¶ˆå¤„ç†ç¨‹åºæ˜¯å¯é€‰çš„ï¼Œå¹¶ä¸”ä»…å½“æ‚¨æœ‰ä¸€äº›ä¸Žè°ƒåº¦æºç›¸å…³è”çš„è‡ªå®šä¹‰è¡Œä¸ºä¹Ÿéœ€è¦æ›´æ–°æ—¶æ‰éœ€è¦å–æ¶ˆå¤„ç†ç¨‹åºã€‚ä½†æ˜¯ï¼Œå¯¹äºŽä½¿ç”¨æè¿°ç¬¦æˆ– Mach ç«¯å£çš„è°ƒåº¦æºï¼Œå¿…é¡»æä¾›å–æ¶ˆå¤„ç†ç¨‹åºä»¥å…³é—­æè¿°ç¬¦æˆ–é‡Šæ”¾ Mach ç«¯å£ã€‚å¦åˆ™ï¼Œç”±äºŽä»£ç æˆ–ç³»ç»Ÿå…¶ä»–éƒ¨åˆ†æ— æ„è¯†åœ°é‡ç”¨äº†é‚£äº›ç»“æž„ï¼Œå¯èƒ½å¯¼è‡´ä»£ç ä¸­çš„ç»†å¾®é”™è¯¯ã€‚</p>
<p>æ‚¨å¯ä»¥éšæ—¶å®‰è£…å–æ¶ˆå¤„ç†ç¨‹åºï¼Œä½†é€šå¸¸åœ¨åˆ›å»ºè°ƒåº¦æºæ—¶ä¼šè¿™æ ·åšã€‚æ‚¨å¯ä»¥ä½¿ç”¨<code>dispatch_source_set_cancel_handler</code>æˆ–<code>dispatch_source_set_cancel_handler_f</code>å‡½æ•°æ¥å®‰è£…å–æ¶ˆå¤„ç†ç¨‹åºï¼Œå…·ä½“å–å†³äºŽæ‚¨æ˜¯è¦åœ¨å®žçŽ°ä¸­ä½¿ç”¨å—å¯¹è±¡è¿˜æ˜¯å‡½æ•°ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸€ä¸ªç®€å•çš„å–æ¶ˆå¤„ç†ç¨‹åºï¼Œè¯¥å¤„ç†ç¨‹åºå…³é—­äº†ä¸ºè°ƒåº¦æºæ‰“å¼€çš„æè¿°ç¬¦ã€‚è¯¥<code>fd</code>å˜é‡æ˜¯åŒ…å«æè¿°ç¬¦çš„æ•èŽ·å˜é‡ã€‚</p>
<table>
<thead>
<tr>
<th><code>dispatch_source_set_cancel_handlerï¼ˆmySourceï¼Œ^ {</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>å…³é—­ï¼ˆFDï¼‰; //å…³é—­å…ˆå‰æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</code></td>
</tr>
<tr>
<td><code>}ï¼‰;</code></td>
</tr>
</tbody></table>
<p>è¦æŸ¥çœ‹ä½¿ç”¨å–æ¶ˆå¤„ç†ç¨‹åºçš„è°ƒåº¦æºçš„å®Œæ•´ä»£ç ç¤ºä¾‹ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW6">ä»Žæè¿°ç¬¦è¯»å–æ•°æ®</a>ã€‚</p>
<h6 id="æ›´æ”¹ç›®æ ‡é˜Ÿåˆ—"><a href="#æ›´æ”¹ç›®æ ‡é˜Ÿåˆ—" class="headerlink" title="æ›´æ”¹ç›®æ ‡é˜Ÿåˆ—"></a>æ›´æ”¹ç›®æ ‡é˜Ÿåˆ—</h6><p>å°½ç®¡åœ¨åˆ›å»ºè°ƒåº¦æºæ—¶æŒ‡å®šäº†è¦åœ¨å…¶ä¸Šè¿è¡Œäº‹ä»¶å’Œå–æ¶ˆå¤„ç†ç¨‹åºçš„é˜Ÿåˆ—ï¼Œä½†æ˜¯æ‚¨å¯ä»¥éšæ—¶ä½¿ç”¨è¯¥<code>dispatch_set_target_queue</code>å‡½æ•°æ¥æ›´æ”¹è¯¥é˜Ÿåˆ—ã€‚æ‚¨å¯ä»¥è¿™æ ·åšæ¥æ›´æ”¹å¤„ç†åˆ†å‘æºäº‹ä»¶çš„ä¼˜å…ˆçº§ã€‚</p>
<p>æ›´æ”¹è°ƒåº¦æºçš„é˜Ÿåˆ—æ˜¯å¼‚æ­¥æ“ä½œï¼Œè°ƒåº¦æºä¼šå°½æœ€å¤§åŠªåŠ›å°½å¿«è¿›è¡Œæ›´æ”¹ã€‚å¦‚æžœäº‹ä»¶å¤„ç†ç¨‹åºå·²ç»åœ¨é˜Ÿåˆ—ä¸­å¹¶ç­‰å¾…å¤„ç†ï¼Œå®ƒå°†åœ¨å‰ä¸€ä¸ªé˜Ÿåˆ—ä¸Šæ‰§è¡Œã€‚ä½†æ˜¯ï¼Œå¤§çº¦åœ¨æ‚¨è¿›è¡Œæ›´æ”¹æ—¶åˆ°è¾¾çš„å…¶ä»–äº‹ä»¶å¯ä»¥åœ¨ä»»ä¸€é˜Ÿåˆ—ä¸­å¤„ç†ã€‚</p>
<h6 id="å°†è‡ªå®šä¹‰æ•°æ®ä¸Žè°ƒåº¦æºå…³è”"><a href="#å°†è‡ªå®šä¹‰æ•°æ®ä¸Žè°ƒåº¦æºå…³è”" class="headerlink" title="å°†è‡ªå®šä¹‰æ•°æ®ä¸Žè°ƒåº¦æºå…³è”"></a>å°†è‡ªå®šä¹‰æ•°æ®ä¸Žè°ƒåº¦æºå…³è”</h6><p>ä¸Ž Grand Central Dispatch ä¸­çš„è®¸å¤šå…¶ä»–æ•°æ®ç±»åž‹ä¸€æ ·ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥<code>dispatch_set_context</code>åŠŸèƒ½å°†è‡ªå®šä¹‰æ•°æ®ä¸Žè°ƒåº¦æºç›¸å…³è”ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸Šä¸‹æ–‡æŒ‡é’ˆå­˜å‚¨äº‹ä»¶å¤„ç†ç¨‹åºå¤„ç†äº‹ä»¶æ‰€éœ€çš„ä»»ä½•æ•°æ®ã€‚å¦‚æžœä½ å­˜å‚¨åœ¨ä¸Šä¸‹æ–‡æŒ‡é’ˆä»»ä½•è‡ªå®šä¹‰æ•°æ®ï¼Œæ‚¨è¿˜åº”è¯¥å®‰è£…çš„å–æ¶ˆå¤„ç†ç¨‹åºï¼ˆå¦‚ä¸­æ‰€è¿°<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW14">å®‰è£…å–æ¶ˆå¤„ç†ç¨‹åº</a>æ¥é‡Šæ”¾æ•°æ®æ—¶ï¼Œä¸å†éœ€è¦æ´¾é£æºï¼‰ã€‚</p>
<p>å¦‚æžœä½¿ç”¨ blocks å®žçŽ°äº‹ä»¶å¤„ç†ç¨‹åºï¼Œåˆ™è¿˜å¯ä»¥æ•èŽ·å±€éƒ¨å˜é‡å¹¶åœ¨åŸºäºŽå—çš„ä»£ç ä¸­ä½¿ç”¨å®ƒä»¬ã€‚å°½ç®¡è¿™å¯ä»¥å‡è½»å°†æ•°æ®å­˜å‚¨åœ¨è°ƒåº¦æºçš„ä¸Šä¸‹æ–‡æŒ‡é’ˆä¸­çš„éœ€è¦ï¼Œä½†æ‚¨åº”å§‹ç»ˆè°¨æ…Žä½¿ç”¨æ­¤åŠŸèƒ½ã€‚å› ä¸ºè°ƒåº¦æºå¯èƒ½åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­å­˜åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œæ‰€ä»¥åœ¨æ•èŽ·åŒ…å«æŒ‡é’ˆçš„å˜é‡æ—¶åº”æ ¼å¤–å°å¿ƒã€‚å¦‚æžœå¯ä»¥éšæ—¶é‡Šæ”¾æŒ‡é’ˆæ‰€æŒ‡å‘çš„æ•°æ®ï¼Œåˆ™åº”è¯¥å¤åˆ¶æ•°æ®æˆ–ä¿ç•™æ•°æ®ä»¥é˜²æ­¢å‘ç”Ÿè¿™ç§æƒ…å†µã€‚æ— è®ºå“ªç§æƒ…å†µï¼Œæ‚¨éƒ½éœ€è¦æä¾›ä¸€ä¸ªå–æ¶ˆå¤„ç†ç¨‹åºï¼Œä»¥ä¾¿ä»¥åŽé‡Šæ”¾æ•°æ®ã€‚</p>
<h6 id="è°ƒåº¦æºçš„å†…å­˜ç®¡ç†"><a href="#è°ƒåº¦æºçš„å†…å­˜ç®¡ç†" class="headerlink" title="è°ƒåº¦æºçš„å†…å­˜ç®¡ç†"></a>è°ƒåº¦æºçš„å†…å­˜ç®¡ç†</h6><p>ä¸Žå…¶ä»–è°ƒåº¦å¯¹è±¡ä¸€æ ·ï¼Œè°ƒåº¦æºä¹Ÿæ˜¯å¼•ç”¨è®¡æ•°çš„æ•°æ®ç±»åž‹ã€‚è°ƒåº¦æºçš„åˆå§‹å¼•ç”¨è®¡æ•°ä¸º 1ï¼Œå¯ä»¥ä½¿ç”¨<code>dispatch_retain</code>å’Œ<code>dispatch_release</code>å‡½æ•°ä¿ç•™å’Œé‡Šæ”¾è¯¥è°ƒåº¦æºã€‚å½“é˜Ÿåˆ—çš„å¼•ç”¨è®¡æ•°è¾¾åˆ°é›¶æ—¶ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨å–æ¶ˆåˆ†é…è°ƒåº¦æºæ•°æ®ç»“æž„ã€‚</p>
<p>ç”±äºŽä½¿ç”¨äº†å®ƒä»¬çš„æ–¹å¼ï¼Œå¯ä»¥åœ¨è°ƒåº¦æºæœ¬èº«å†…éƒ¨æˆ–å¤–éƒ¨ç®¡ç†è°ƒåº¦æºçš„æ‰€æœ‰æƒã€‚æœ‰äº†å¤–éƒ¨æ‰€æœ‰æƒï¼Œå¦ä¸€ä¸ªå¯¹è±¡æˆ–ä»£ç æ®µå°±æ‹¥æœ‰äº†è°ƒåº¦æºçš„æ‰€æœ‰æƒï¼Œå¹¶è´Ÿè´£åœ¨ä¸å†éœ€è¦æ—¶é‡Šæ”¾å®ƒã€‚å¯¹äºŽå†…éƒ¨æ‰€æœ‰æƒï¼Œè°ƒåº¦æºæ‹¥æœ‰è‡ªå·±ï¼Œå¹¶è´Ÿè´£åœ¨é€‚å½“çš„æ—¶é—´é‡Šæ”¾è‡ªå·±ã€‚å°½ç®¡å¤–éƒ¨æ‰€æœ‰æƒå¾ˆå¸¸è§ï¼Œä½†æ˜¯åœ¨è¦åˆ›å»ºè‡ªä¸»è°ƒåº¦æºå¹¶è®©å…¶ç®¡ç†ä»£ç çš„æŸäº›è¡Œä¸ºè€Œæ— éœ€ä»»ä½•è¿›ä¸€æ­¥äº¤äº’çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å†…éƒ¨æ‰€æœ‰æƒã€‚ä¾‹å¦‚ï¼Œå¦‚æžœè°ƒåº¦æºè¢«è®¾è®¡ä¸ºå“åº”å•ä¸ªå…¨å±€äº‹ä»¶ï¼Œåˆ™å¯ä»¥è®©å®ƒå¤„ç†è¯¥äº‹ä»¶ç„¶åŽç«‹å³é€€å‡ºã€‚</p>
<h4 id="è°ƒåº¦æºç¤ºä¾‹"><a href="#è°ƒåº¦æºç¤ºä¾‹" class="headerlink" title="è°ƒåº¦æºç¤ºä¾‹"></a>è°ƒåº¦æºç¤ºä¾‹</h4><p>ä»¥ä¸‹å„èŠ‚è¯´æ˜Žå¦‚ä½•åˆ›å»ºå’Œé…ç½®ä¸€äº›æ›´å¸¸ç”¨çš„è°ƒåº¦æºã€‚æœ‰å…³é…ç½®ç‰¹å®šç±»åž‹çš„è°ƒåº¦æºçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<em>Grand Central Dispatchï¼ˆGCDï¼‰å‚è€ƒ</em>ã€‚</p>
<h6 id="åˆ›å»ºä¸€ä¸ªè®¡æ—¶å™¨"><a href="#åˆ›å»ºä¸€ä¸ªè®¡æ—¶å™¨" class="headerlink" title="åˆ›å»ºä¸€ä¸ªè®¡æ—¶å™¨"></a>åˆ›å»ºä¸€ä¸ªè®¡æ—¶å™¨</h6><p>è®¡æ—¶å™¨åˆ†æ´¾æºæŒ‰è§„åˆ™çš„åŸºäºŽæ—¶é—´çš„é—´éš”ç”Ÿæˆäº‹ä»¶ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è®¡æ—¶å™¨æ¥å¯åŠ¨éœ€è¦å®šæœŸæ‰§è¡Œçš„ç‰¹å®šä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œæ¸¸æˆå’Œå…¶ä»–å›¾å½¢å¯†é›†åž‹åº”ç”¨ç¨‹åºå¯èƒ½ä½¿ç”¨è®¡æ—¶å™¨æ¥å¯åŠ¨å±å¹•æˆ–åŠ¨ç”»æ›´æ–°ã€‚æ‚¨è¿˜å¯ä»¥è®¾ç½®è®¡æ—¶å™¨å¹¶ä½¿ç”¨äº§ç”Ÿçš„äº‹ä»¶æ¥æ£€æŸ¥é¢‘ç¹æ›´æ–°çš„æœåŠ¡å™¨ä¸Šçš„æ–°ä¿¡æ¯ã€‚</p>
<p>æ‰€æœ‰è®¡æ—¶å™¨åˆ†æ´¾æºéƒ½æ˜¯é—´éš”è®¡æ—¶å™¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦åˆ›å»ºï¼Œå®ƒä»¬å°±ä¼šä»¥æ‚¨æŒ‡å®šçš„é—´éš”ä¼ é€’å¸¸è§„äº‹ä»¶ã€‚åˆ›å»ºè®¡æ—¶å™¨åˆ†æ´¾æºæ—¶ï¼Œå¿…é¡»æŒ‡å®šçš„å€¼ä¹‹ä¸€æ˜¯å›žæ—‹å€¼ï¼Œä»¥ä½¿ç³»ç»Ÿå¯¹è®¡æ—¶å™¨äº‹ä»¶çš„æœŸæœ›ç²¾åº¦æœ‰æ‰€äº†è§£ã€‚Leeway çš„ä»·å€¼ä½¿ç³»ç»Ÿåœ¨ç®¡ç†ç”µæºå’Œå”¤é†’å†…æ ¸æ–¹é¢å…·æœ‰ä¸€å®šçš„çµæ´»æ€§ã€‚ä¾‹å¦‚ï¼Œç³»ç»Ÿå¯ä»¥ä½¿ç”¨ä½™é‡å€¼æ¥æå‰æˆ–å»¶è¿Ÿç‚¹ç«æ—¶é—´ï¼Œå¹¶ä½¿å®ƒä¸Žå…¶ä»–ç³»ç»Ÿäº‹ä»¶æ›´å¥½åœ°ä¿æŒä¸€è‡´ã€‚å› æ­¤ï¼Œæ‚¨åº”å°½å¯èƒ½ä¸ºè‡ªå·±çš„è®¡æ—¶å™¨æŒ‡å®šä¸€ä¸ªå›žç¨‹å€¼ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong> å³ä½¿æ‚¨æŒ‡å®šçš„å›žç¨‹å€¼ä¸º 0ï¼Œä¹Ÿæ°¸è¿œä¸è¦æœŸæœ›è®¡æ—¶å™¨åœ¨æ‚¨è¦æ±‚çš„ç¡®åˆ‡çº³ç§’æ—¶è§¦å‘ã€‚è¯¥ç³»ç»Ÿä¼šå°½åŠ›æ»¡è¶³æ‚¨çš„éœ€æ±‚ï¼Œä½†ä¸èƒ½ä¿è¯å‡†ç¡®çš„ç‚¹ç«æ—¶é—´ã€‚</p>
<p>å½“è®¡ç®—æœºè¿›å…¥ç¡çœ çŠ¶æ€æ—¶ï¼Œæ‰€æœ‰è®¡æ—¶å™¨åˆ†æ´¾æºéƒ½å°†è¢«æŒ‚èµ·ã€‚å½“è®¡ç®—æœºå”¤é†’æ—¶ï¼Œè¿™äº›è®¡æ—¶å™¨åˆ†æ´¾æºä¹Ÿä¼šè‡ªåŠ¨å”¤é†’ã€‚æ ¹æ®è®¡æ—¶å™¨çš„é…ç½®ï¼Œè¿™ç§æ€§è´¨çš„æš‚åœå¯èƒ½ä¼šå½±å“è®¡æ—¶å™¨çš„ä¸‹ä¸€æ¬¡è§¦å‘æ—¶é—´ã€‚å¦‚æžœä½¿ç”¨<code>dispatch_time</code>å‡½æ•°æˆ–<code>DISPATCH_TIME_NOW</code>å¸¸é‡è®¾ç½®è®¡æ—¶å™¨åˆ†æ´¾æºï¼Œåˆ™è®¡æ—¶å™¨åˆ†æ´¾æºå°†ä½¿ç”¨é»˜è®¤ç³»ç»Ÿæ—¶é’Ÿæ¥ç¡®å®šä½•æ—¶è§¦å‘ã€‚ä½†æ˜¯ï¼Œè®¡ç®—æœºç¡çœ æ—¶é»˜è®¤æ—¶é’Ÿä¸ä¼šæå‰ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå½“æ‚¨ä½¿ç”¨<code>dispatch_walltime</code>åŠŸèƒ½ï¼Œè®¡æ—¶å™¨åˆ†æ´¾æºå°†å…¶è§¦å‘æ—¶é—´è·Ÿè¸ªåˆ°æŒ‚é’Ÿæ—¶é—´ã€‚åŽä¸€ä¸ªé€‰é¡¹é€šå¸¸é€‚ç”¨äºŽè§¦å‘é—´éš”ç›¸å¯¹è¾ƒå¤§çš„è®¡æ—¶å™¨ï¼Œå› ä¸ºå®ƒå¯ä»¥é˜²æ­¢äº‹ä»¶æ—¶é—´ä¹‹é—´çš„æ¼‚ç§»è¿‡å¤§ã€‚</p>
<p>æ¸…å• 4-1 å±•ç¤ºäº†ä¸€ä¸ªè®¡æ—¶å™¨çš„ç¤ºä¾‹ï¼Œè¯¥è®¡æ—¶å™¨æ¯ 30 ç§’è§¦å‘ä¸€æ¬¡ï¼Œå›žæ—‹å€¼ä¸º 1 ç§’ã€‚å› ä¸ºè®¡æ—¶å™¨é—´éš”ç›¸å¯¹è¾ƒå¤§ï¼Œæ‰€ä»¥ä½¿ç”¨è¯¥<code>dispatch_walltime</code>å‡½æ•°åˆ›å»ºäº†è°ƒåº¦æºã€‚è®¡æ—¶å™¨çš„ç¬¬ä¸€æ¬¡è§¦å‘ç«‹å³å‘ç”Ÿï¼ŒéšåŽçš„äº‹ä»¶æ¯ 30 ç§’åˆ°è¾¾ä¸€æ¬¡ã€‚è¯¥<code>MyPeriodicTask</code>å’Œ<code>MyStoreTimer</code>ç¬¦å·ä»£è¡¨çš„è‡ªå®šä¹‰åŠŸèƒ½ï¼Œä½ ä¼šå†™å®žæ–½å®šæ—¶è¡Œä¸ºï¼Œå¹¶å­˜å‚¨åœ¨åº”ç”¨ç¨‹åºä¸­çš„æ•°æ®ç»“æž„çš„å®šæ—¶å™¨åœ°æ–¹ã€‚</p>
<p><strong>æ¸…å• 4-1</strong> åˆ›å»ºè®¡æ—¶å™¨åˆ†æ´¾æº</p>
<table>
<thead>
<tr>
<th><code>dispatch_source_t CreateDispatchTimerï¼ˆuint64_tæ—¶é—´é—´éš”ï¼Œ</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>uint64_t leewayï¼Œ</code></td>
</tr>
<tr>
<td><code>dispatch_queue_té˜Ÿåˆ—ï¼Œ</code></td>
</tr>
<tr>
<td><code>dispatch_block_tå—ï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>dispatch_source_tè®¡æ—¶å™¨= dispatch_source_createï¼ˆDISPATCH_SOURCE_TYPE_TIMERï¼Œ</code></td>
</tr>
<tr>
<td><code>0ï¼Œ0ï¼Œé˜Ÿåˆ—ï¼‰ï¼›</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆå®šæ—¶å™¨ï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>dispatch_source_set_timerï¼ˆtimerï¼Œdispatch_walltimeï¼ˆNULLï¼Œ0ï¼‰ï¼Œintervalï¼Œleewayï¼‰;</code></td>
</tr>
<tr>
<td><code>dispatch_source_set_event_handlerï¼ˆtimerï¼Œblockï¼‰;</code></td>
</tr>
<tr>
<td><code>dispatch_resumeï¼ˆtimerï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>è¿”å›žè®¡æ—¶å™¨ï¼›</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>æ— æ•ˆçš„MyCreateTimerï¼ˆï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>dispatch_source_t aTimer = CreateDispatchTimerï¼ˆ30ull * NSEC_PER_SECï¼Œ</code></td>
</tr>
<tr>
<td><code>1ull * NSEC_PER_SECï¼Œ</code></td>
</tr>
<tr>
<td><code>dispatch_get_main_queueï¼ˆï¼‰ï¼Œ</code></td>
</tr>
<tr>
<td><code>^ {MyPeriodicTaskï¼ˆï¼‰; }ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å°†å…¶å­˜å‚¨åœ¨ä»¥åŽçš„åœ°æ–¹ã€‚</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆaTimerï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>MyStoreTimerï¼ˆaTimerï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
</tbody></table>
<p>å°½ç®¡åˆ›å»ºè®¡æ—¶å™¨åˆ†æ´¾æºæ˜¯æŽ¥æ”¶åŸºäºŽæ—¶é—´çš„äº‹ä»¶çš„ä¸»è¦æ–¹æ³•ï¼Œä½†æ˜¯è¿˜æœ‰å…¶ä»–å¯ç”¨é€‰é¡¹ã€‚å¦‚æžœè¦åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”åŽæ‰§è¡Œä¸€æ¬¡å—ï¼Œå¯ä»¥ä½¿ç”¨<code>dispatch_after</code>æˆ–<code>dispatch_after_f</code>å‡½æ•°ã€‚è¯¥å‡½æ•°çš„è¡Œä¸ºä¸Žè¯¥<code>dispatch_async</code>å‡½æ•°éžå¸¸ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºŽï¼Œå®ƒå…è®¸æ‚¨æŒ‡å®šå°†å—æäº¤åˆ°é˜Ÿåˆ—çš„æ—¶é—´å€¼ã€‚å¯ä»¥æ ¹æ®éœ€è¦å°†æ—¶é—´å€¼æŒ‡å®šä¸ºç›¸å¯¹æˆ–ç»å¯¹æ—¶é—´å€¼ã€‚</p>
<h6 id="ä»Žæè¿°ç¬¦è¯»å–æ•°æ®"><a href="#ä»Žæè¿°ç¬¦è¯»å–æ•°æ®" class="headerlink" title="ä»Žæè¿°ç¬¦è¯»å–æ•°æ®"></a>ä»Žæè¿°ç¬¦è¯»å–æ•°æ®</h6><p>è¦ä»Žæ–‡ä»¶æˆ–å¥—æŽ¥å­—è¯»å–æ•°æ®ï¼Œå¿…é¡»æ‰“å¼€æ–‡ä»¶æˆ–å¥—æŽ¥å­—å¹¶åˆ›å»ºç±»åž‹çš„è°ƒåº¦æº<code>DISPATCH_SOURCE_TYPE_READ</code>ã€‚æ‚¨æŒ‡å®šçš„äº‹ä»¶å¤„ç†ç¨‹åºåº”è¯¥èƒ½å¤Ÿè¯»å–å’Œå¤„ç†æ–‡ä»¶æè¿°ç¬¦çš„å†…å®¹ã€‚å¯¹äºŽæ–‡ä»¶ï¼Œè¿™ç›¸å½“äºŽè¯»å–æ–‡ä»¶æ•°æ®ï¼ˆæˆ–è¯¥æ•°æ®çš„å­é›†ï¼‰å¹¶ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºåˆ›å»ºé€‚å½“çš„æ•°æ®ç»“æž„ã€‚å¯¹äºŽç½‘ç»œå¥—æŽ¥å­—ï¼Œè¿™æ¶‰åŠå¤„ç†æ–°æŽ¥æ”¶åˆ°çš„ç½‘ç»œæ•°æ®ã€‚</p>
<p>æ¯å½“è¯»å–æ•°æ®æ—¶ï¼Œéƒ½åº”å§‹ç»ˆå°†æè¿°ç¬¦é…ç½®ä¸ºä½¿ç”¨éžé˜»å¡žæ“ä½œã€‚å°½ç®¡æ‚¨å¯ä»¥ä½¿ç”¨è¯¥<code>dispatch_source_get_data</code>å‡½æ•°æŸ¥çœ‹å¯è¯»å–çš„æ•°æ®é‡ï¼Œä½†è¯¥å‡½æ•°è¿”å›žçš„æ•°å­—å¯èƒ½ä¼šåœ¨è°ƒç”¨æ—¶é—´å’Œå®žé™…è¯»å–æ•°æ®çš„æ—¶é—´ä¹‹é—´å‘ç”Ÿå˜åŒ–ã€‚å¦‚æžœåŸºç¡€æ–‡ä»¶è¢«æˆªæ–­æˆ–å‘ç”Ÿç½‘ç»œé”™è¯¯ï¼Œåˆ™ä»Žé˜»æ­¢å½“å‰çº¿ç¨‹çš„æè¿°ç¬¦è¯»å–å°†ä½¿äº‹ä»¶å¤„ç†ç¨‹åºåœæ»žåœ¨æ‰§è¡Œä¸­ï¼Œå¹¶é˜»æ­¢è°ƒåº¦é˜Ÿåˆ—è°ƒåº¦å…¶ä»–ä»»åŠ¡ã€‚å¯¹äºŽä¸²è¡Œé˜Ÿåˆ—ï¼Œè¿™å¯èƒ½ä¼šæ­»é”æ‚¨çš„é˜Ÿåˆ—ï¼Œç”šè‡³å¯¹äºŽå¹¶å‘é˜Ÿåˆ—ï¼Œè¿™ä¹Ÿä¼šå‡å°‘å¯ä»¥å¯åŠ¨çš„æ–°ä»»åŠ¡çš„æ•°é‡ã€‚</p>
<p>æ¸…å• 4-2 æ˜¾ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹å°†è°ƒåº¦æºé…ç½®ä¸ºä»Žæ–‡ä»¶è¯»å–æ•°æ®ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œäº‹ä»¶å¤„ç†ç¨‹åºå°†æŒ‡å®šæ–‡ä»¶çš„å…¨éƒ¨å†…å®¹è¯»å–åˆ°ç¼“å†²åŒºä¸­ï¼Œå¹¶è°ƒç”¨è‡ªå®šä¹‰å‡½æ•°ï¼ˆæ‚¨å°†åœ¨è‡ªå·±çš„ä»£ç ä¸­å®šä¹‰ï¼‰ä»¥å¤„ç†æ•°æ®ã€‚ï¼ˆæ­¤å‡½æ•°çš„è°ƒç”¨è€…å°†åœ¨è¯»å–æ“ä½œå®ŒæˆåŽä½¿ç”¨è¿”å›žçš„åˆ†æ´¾æºå°†å…¶å–æ¶ˆã€‚ï¼‰ä¸ºç¡®ä¿åœ¨æ²¡æœ‰è¦è¯»å–çš„æ•°æ®æ—¶åˆ†æ´¾é˜Ÿåˆ—ä¸ä¼šä¸å¿…è¦åœ°é˜»å¡žï¼Œæ­¤ç¤ºä¾‹ä½¿ç”¨æ­¤<code>fcntl</code>å‡½æ•°æ¥é…ç½®æ–‡ä»¶æè¿°ç¬¦ä»¥æ‰§è¡Œéžé˜»å¡žæ“ä½œã€‚å®‰è£…åœ¨è°ƒåº¦æºä¸Šçš„å–æ¶ˆå¤„ç†ç¨‹åºå¯ç¡®ä¿åœ¨è¯»å–æ•°æ®åŽå…³é—­æ–‡ä»¶æè¿°ç¬¦ã€‚</p>
<p><strong>æ¸…å• 4-2</strong> ä»Žæ–‡ä»¶è¯»å–æ•°æ®</p>
<table>
<thead>
<tr>
<th><code>dispatch_source_t ProcessContentsOfFileï¼ˆconst char *æ–‡ä»¶åï¼‰</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//å‡†å¤‡è¦è¯»å–çš„æ–‡ä»¶ã€‚</code></td>
</tr>
<tr>
<td><code>int fd = openï¼ˆæ–‡ä»¶åï¼ŒO_RDONLYï¼‰;</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆfd == -1ï¼‰</code></td>
</tr>
<tr>
<td><code>è¿”å›žNULL;</code></td>
</tr>
<tr>
<td><code>fcntlï¼ˆfdï¼ŒF_SETFLï¼ŒO_NONBLOCKï¼‰; //é¿å…é˜»å¡žè¯»å–æ“ä½œ</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>dispatch_queue_té˜Ÿåˆ—= dispatch_get_global_queueï¼ˆDISPATCH_QUEUE_PRIORITY_DEFAULTï¼Œ0ï¼‰;</code></td>
</tr>
<tr>
<td><code>dispatch_source_t readSource = dispatch_source_createï¼ˆDISPATCH_SOURCE_TYPE_READï¼Œ</code></td>
</tr>
<tr>
<td><code>fdï¼Œ0ï¼Œé˜Ÿåˆ—ï¼‰;</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆï¼readSourceï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>å…³é—­ï¼ˆFDï¼‰;</code></td>
</tr>
<tr>
<td><code>è¿”å›žNULL;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å®‰è£…äº‹ä»¶å¤„ç†ç¨‹åº</code></td>
</tr>
<tr>
<td><code>dispatch_source_set_event_handlerï¼ˆreadSourceï¼Œ^ {</code></td>
</tr>
<tr>
<td><code>ä¼°è®¡çš„size_t = dispatch_source_get_dataï¼ˆreadSourceï¼‰+ 1;</code></td>
</tr>
<tr>
<td><code>//å°†æ•°æ®è¯»å…¥æ–‡æœ¬ç¼“å†²åŒºã€‚</code></td>
</tr>
<tr>
<td><code>char *ç¼“å†²åŒº=ï¼ˆchar *ï¼‰mallocï¼ˆä¼°è®¡ï¼‰;</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆç¼“å†²åŒºï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>ssize_t actual = readï¼ˆfdï¼Œbufferï¼Œï¼ˆestimatedï¼‰ï¼‰;</code></td>
</tr>
<tr>
<td><code>å¸ƒå°”å€¼å®Œæˆ= MyProcessFileDataï¼ˆç¼“å†²åŒºï¼Œå®žé™…ï¼‰; //å¤„ç†æ•°æ®ã€‚</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å®ŒæˆåŽé‡Šæ”¾ç¼“å†²åŒºã€‚</code></td>
</tr>
<tr>
<td><code>å…è´¹ï¼ˆç¼“å†²åŒºï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å¦‚æžœæ²¡æœ‰æ›´å¤šæ•°æ®ï¼Œè¯·å–æ¶ˆæºã€‚</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆå®Œæˆï¼‰</code></td>
</tr>
<tr>
<td><code>dispatch_source_cancelï¼ˆreadSourceï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>}ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å®‰è£…å–æ¶ˆå¤„ç†ç¨‹åº</code></td>
</tr>
<tr>
<td><code>dispatch_source_set_cancel_handlerï¼ˆreadSourceï¼Œ^ {closeï¼ˆfdï¼‰;}ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å¼€å§‹è¯»å–æ–‡ä»¶ã€‚</code></td>
</tr>
<tr>
<td><code>dispatch_resumeï¼ˆreadSourceï¼‰;</code></td>
</tr>
<tr>
<td><code>è¿”å›žreadSource;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œè‡ªå®šä¹‰<code>MyProcessFileData</code>å‡½æ•°ç¡®å®šä½•æ—¶å·²è¯»å–è¶³å¤Ÿçš„æ–‡ä»¶æ•°æ®ä»¥åŠå¯ä»¥å–æ¶ˆè°ƒåº¦æºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé…ç½®ä¸ºä»Žæè¿°ç¬¦è¯»å–çš„è°ƒåº¦æºåœ¨ä»æœ‰æ•°æ®éœ€è¦è¯»å–çš„æƒ…å†µä¸‹é‡å¤è°ƒåº¦å…¶äº‹ä»¶å¤„ç†ç¨‹åºã€‚å¦‚æžœå¥—æŽ¥å­—è¿žæŽ¥å…³é—­æˆ–åˆ°è¾¾æ–‡ä»¶æœ«å°¾ï¼Œåˆ™è°ƒåº¦æºå°†è‡ªåŠ¨åœæ­¢è°ƒåº¦äº‹ä»¶å¤„ç†ç¨‹åºã€‚å¦‚æžœæ‚¨çŸ¥é“è‡ªå·±ä¸éœ€è¦è°ƒåº¦æºï¼Œåˆ™å¯ä»¥ç›´æŽ¥å–æ¶ˆå®ƒã€‚</p>
<h6 id="å°†æ•°æ®å†™å…¥æè¿°ç¬¦"><a href="#å°†æ•°æ®å†™å…¥æè¿°ç¬¦" class="headerlink" title="å°†æ•°æ®å†™å…¥æè¿°ç¬¦"></a>å°†æ•°æ®å†™å…¥æè¿°ç¬¦</h6><p>å°†æ•°æ®å†™å…¥æ–‡ä»¶æˆ–å¥—æŽ¥å­—çš„è¿‡ç¨‹ä¸Žè¯»å–æ•°æ®çš„è¿‡ç¨‹éžå¸¸ç›¸ä¼¼ã€‚é…ç½®ç”¨äºŽå†™æ“ä½œçš„æè¿°ç¬¦åŽï¼Œæ‚¨å°†åˆ›å»ºç±»åž‹çš„è°ƒåº¦æº<code>DISPATCH_SOURCE_TYPE_WRITE</code>ã€‚åˆ›å»ºè¯¥è°ƒåº¦æºåŽï¼Œç³»ç»Ÿå°†è°ƒç”¨äº‹ä»¶å¤„ç†ç¨‹åºï¼Œä½¿å…¶æœ‰æœºä¼šå¼€å§‹å°†æ•°æ®å†™å…¥æ–‡ä»¶æˆ–å¥—æŽ¥å­—ã€‚å®Œæˆæ•°æ®å†™å…¥åŽï¼Œè¯·ä½¿ç”¨è¯¥<code>dispatch_source_cancel</code>åŠŸèƒ½å–æ¶ˆè°ƒåº¦æºã€‚</p>
<p>æ¯å½“å†™å…¥æ•°æ®æ—¶ï¼Œéƒ½åº”å§‹ç»ˆå°†æ–‡ä»¶æè¿°ç¬¦é…ç½®ä¸ºä½¿ç”¨éžé˜»å¡žæ“ä½œã€‚å°½ç®¡å¯ä»¥ä½¿ç”¨è¯¥<code>dispatch_source_get_data</code>å‡½æ•°æŸ¥çœ‹æœ‰å¤šå°‘ç©ºé—´å¯ç”¨äºŽå†™å…¥ï¼Œä½†æ˜¯è¯¥å‡½æ•°è¿”å›žçš„å€¼ä»…æ˜¯å»ºè®®æ€§çš„ï¼Œå¹¶ä¸”å¯èƒ½åœ¨è°ƒç”¨æ—¶é—´å’Œå®žé™…å†™å…¥æ•°æ®çš„æ—¶é—´ä¹‹é—´å‘ç”Ÿå˜åŒ–ã€‚å¦‚æžœå‘ç”Ÿé”™è¯¯ï¼Œå°†æ•°æ®å†™å…¥é˜»å¡žæ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¼šä½¿äº‹ä»¶å¤„ç†ç¨‹åºåœæ»žåœ¨æ‰§è¡Œä¸­ï¼Œå¹¶é˜»æ­¢è°ƒåº¦é˜Ÿåˆ—è°ƒåº¦å…¶ä»–ä»»åŠ¡ã€‚å¯¹äºŽä¸²è¡Œé˜Ÿåˆ—ï¼Œè¿™å¯èƒ½ä¼šæ­»é”æ‚¨çš„é˜Ÿåˆ—ï¼Œç”šè‡³å¯¹äºŽå¹¶å‘é˜Ÿåˆ—ï¼Œè¿™ä¹Ÿä¼šå‡å°‘å¯ä»¥å¯åŠ¨çš„æ–°ä»»åŠ¡çš„æ•°é‡ã€‚</p>
<p>æ¸…å• 4-3 æ˜¾ç¤ºäº†ä½¿ç”¨è°ƒåº¦æºå°†æ•°æ®å†™å…¥æ–‡ä»¶çš„åŸºæœ¬æ–¹æ³•ã€‚åˆ›å»ºæ–°æ–‡ä»¶åŽï¼Œæ­¤å‡½æ•°å°†ç»“æžœæ–‡ä»¶æè¿°ç¬¦ä¼ é€’åˆ°å…¶äº‹ä»¶å¤„ç†ç¨‹åºã€‚è¯¥<code>MyGetData</code>å‡½æ•°æä¾›äº†æ”¾å…¥æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œæ‚¨å¯ä»¥å°†å…¶æ›¿æ¢ä¸ºç”Ÿæˆæ–‡ä»¶æ•°æ®æ‰€éœ€çš„ä»»ä½•ä»£ç ã€‚å°†æ•°æ®å†™å…¥æ–‡ä»¶åŽï¼Œäº‹ä»¶å¤„ç†ç¨‹åºå°†å–æ¶ˆè°ƒåº¦æºï¼Œä»¥é˜²æ­¢å†æ¬¡è°ƒç”¨è¯¥è°ƒåº¦æºã€‚ç„¶åŽï¼Œè°ƒåº¦æºçš„æ‰€æœ‰è€…å°†è´Ÿè´£é‡Šæ”¾å®ƒã€‚</p>
<p><strong>æ¸…å• 4-3</strong> å°†æ•°æ®å†™å…¥æ–‡ä»¶</p>
<table>
<thead>
<tr>
<th><code>dispatch_source_t WriteDataToFileï¼ˆconst char *æ–‡ä»¶åï¼‰</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td>`int fd = openï¼ˆfilenameï¼ŒO_WRONLY</td>
</tr>
<tr>
<td>`ï¼ˆS_IRUSR</td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆfd == -1ï¼‰</code></td>
</tr>
<tr>
<td><code>è¿”å›žNULL;</code></td>
</tr>
<tr>
<td><code>fcntlï¼ˆfdï¼ŒF_SETFLï¼‰; //åœ¨å†™å…¥æœŸé—´é˜»å¡žã€‚</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>dispatch_queue_té˜Ÿåˆ—= dispatch_get_global_queueï¼ˆDISPATCH_QUEUE_PRIORITY_DEFAULTï¼Œ0ï¼‰;</code></td>
</tr>
<tr>
<td><code>dispatch_source_t writeSource = dispatch_source_createï¼ˆDISPATCH_SOURCE_TYPE_WRITEï¼Œ</code></td>
</tr>
<tr>
<td><code>fdï¼Œ0ï¼Œé˜Ÿåˆ—ï¼‰;</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆï¼writeSourceï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>å…³é—­ï¼ˆFDï¼‰;</code></td>
</tr>
<tr>
<td><code>è¿”å›žNULL;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>dispatch_source_set_event_handlerï¼ˆwriteSourceï¼Œ^ {</code></td>
</tr>
<tr>
<td><code>size_t bufferSize = MyGetDataSizeï¼ˆï¼‰;</code></td>
</tr>
<tr>
<td><code>void * buffer = mallocï¼ˆbufferSizeï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>size_tå®žé™…= MyGetDataï¼ˆç¼“å†²åŒºï¼ŒbufferSizeï¼‰;</code></td>
</tr>
<tr>
<td><code>å†™ï¼ˆfdï¼Œç¼“å†²åŒºï¼Œå®žé™…ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>å…è´¹ï¼ˆç¼“å†²åŒºï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å®ŒæˆåŽå–æ¶ˆå¹¶é‡Šæ”¾è°ƒåº¦æºã€‚</code></td>
</tr>
<tr>
<td><code>dispatch_source_cancelï¼ˆwriteSourceï¼‰;</code></td>
</tr>
<tr>
<td><code>}ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>dispatch_source_set_cancel_handlerï¼ˆwriteSourceï¼Œ^ {closeï¼ˆfdï¼‰;}ï¼‰;</code></td>
</tr>
<tr>
<td><code>dispatch_resumeï¼ˆwriteSourceï¼‰;</code></td>
</tr>
<tr>
<td><code>è¿”å›žï¼ˆwriteSourceï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<h6 id="ç›‘è§†æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡"><a href="#ç›‘è§†æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡" class="headerlink" title="ç›‘è§†æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡"></a>ç›‘è§†æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡</h6><p>å¦‚æžœè¦ç›‘è§†æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡çš„æ›´æ”¹ï¼Œåˆ™å¯ä»¥è®¾ç½®ç±»åž‹çš„è°ƒåº¦æº<code>DISPATCH_SOURCE_TYPE_VNODE</code>ã€‚å½“æ–‡ä»¶è¢«åˆ é™¤ï¼Œå†™å…¥æˆ–é‡å‘½åæ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§ç±»åž‹çš„è°ƒåº¦æºæ¥æŽ¥æ”¶é€šçŸ¥ã€‚å½“æ–‡ä»¶çš„ç‰¹å®šç±»åž‹çš„å…ƒä¿¡æ¯ï¼ˆä¾‹å¦‚æ–‡ä»¶çš„å¤§å°å’Œé“¾æŽ¥æ•°ï¼‰å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨å®ƒæ¥å‘å‡ºè­¦æŠ¥ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong> å½“æºæœ¬èº«æ­£åœ¨å¤„ç†äº‹ä»¶æ—¶ï¼Œæ‚¨ä¸ºè°ƒåº¦æºæŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦å¿…é¡»ä¿æŒæ‰“å¼€çŠ¶æ€ã€‚</p>
<p>æ¸…å• 4-4 æ˜¾ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹ç›‘è§†æ–‡ä»¶çš„åç§°æ›´æ”¹å¹¶åœ¨æ–‡ä»¶æ›´æ”¹æ—¶æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è¡Œä¸ºã€‚ï¼ˆæ‚¨å°†æä¾›å®žé™…çš„è¡Œä¸ºæ¥ä»£æ›¿<code>MyUpdateFileName</code>ç¤ºä¾‹ä¸­æ‰€è°ƒç”¨çš„å‡½æ•°ã€‚ï¼‰ç”±äºŽå·²ä¸ºè°ƒåº¦æºä¸“é—¨æ‰“å¼€äº†æè¿°ç¬¦ï¼Œæ‰€ä»¥è°ƒåº¦æºåŒ…æ‹¬ä¸€ä¸ªå–æ¶ˆå¤„ç†ç¨‹åºï¼Œç”¨äºŽå…³é—­æè¿°ç¬¦ã€‚å› ä¸ºè¯¥ç¤ºä¾‹åˆ›å»ºçš„æ–‡ä»¶æè¿°ç¬¦ä¸ŽåŸºç¡€æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡ç›¸å…³è”ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨æ­¤ç›¸åŒçš„è°ƒåº¦æºæ¥æ£€æµ‹ä»»æ„æ•°é‡çš„æ–‡ä»¶åæ›´æ”¹ã€‚</p>
<p><strong>æ¸…å• 4-4</strong> ç›‘è§†æ–‡ä»¶åæ›´æ”¹</p>
<table>
<thead>
<tr>
<th><code>dispatch_source_t MonitorNameChangesToFileï¼ˆconst char *æ–‡ä»¶åï¼‰</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>int fd = openï¼ˆæ–‡ä»¶åï¼ŒO_EVTONLYï¼‰;</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆfd == -1ï¼‰</code></td>
</tr>
<tr>
<td><code>è¿”å›žNULL;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>dispatch_queue_té˜Ÿåˆ—= dispatch_get_global_queueï¼ˆDISPATCH_QUEUE_PRIORITY_DEFAULTï¼Œ0ï¼‰;</code></td>
</tr>
<tr>
<td><code>dispatch_source_t source = dispatch_source_createï¼ˆDISPATCH_SOURCE_TYPE_VNODEï¼Œ</code></td>
</tr>
<tr>
<td><code>fdï¼ŒDISPATCH_VNODE_RENAMEï¼Œé˜Ÿåˆ—ï¼‰ï¼›</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆæ¥æºï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//å¤åˆ¶æ–‡ä»¶åä»¥ä¾›ä»¥åŽä½¿ç”¨ã€‚</code></td>
</tr>
<tr>
<td><code>int length = strlenï¼ˆæ–‡ä»¶åï¼‰;</code></td>
</tr>
<tr>
<td><code>char * newString =ï¼ˆchar *ï¼‰mallocï¼ˆé•¿åº¦+1ï¼‰;</code></td>
</tr>
<tr>
<td><code>newString = strcpyï¼ˆnewStringï¼Œæ–‡ä»¶åï¼‰;</code></td>
</tr>
<tr>
<td><code>dispatch_set_contextï¼ˆsourceï¼ŒnewStringï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å®‰è£…äº‹ä»¶å¤„ç†ç¨‹åºä»¥å¤„ç†åç§°æ›´æ”¹</code></td>
</tr>
<tr>
<td><code>dispatch_source_set_event_handlerï¼ˆsourceï¼Œ^ {</code></td>
</tr>
<tr>
<td><code>const char * oldFilename =ï¼ˆchar *ï¼‰dispatch_get_contextï¼ˆæºï¼‰;</code></td>
</tr>
<tr>
<td><code>MyUpdateFileNameï¼ˆoldFilenameï¼Œfdï¼‰;</code></td>
</tr>
<tr>
<td><code>}ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å®‰è£…å–æ¶ˆå¤„ç†ç¨‹åºä»¥é‡Šæ”¾æè¿°ç¬¦</code></td>
</tr>
<tr>
<td><code>//å’Œå­˜å‚¨çš„å­—ç¬¦ä¸²ã€‚</code></td>
</tr>
<tr>
<td><code>dispatch_source_set_cancel_handlerï¼ˆæ¥æºï¼Œ^ {</code></td>
</tr>
<tr>
<td><code>char * fileStr =ï¼ˆchar *ï¼‰dispatch_get_contextï¼ˆæºï¼‰;</code></td>
</tr>
<tr>
<td><code>freeï¼ˆfileStrï¼‰;</code></td>
</tr>
<tr>
<td><code>å…³é—­ï¼ˆFDï¼‰;</code></td>
</tr>
<tr>
<td><code>}ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å¼€å§‹å¤„ç†äº‹ä»¶ã€‚</code></td>
</tr>
<tr>
<td><code>dispatch_resumeï¼ˆæºï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>å…¶ä»–</code></td>
</tr>
<tr>
<td><code>å…³é—­ï¼ˆFDï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>è¿”å›žæº</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<h6 id="ç›‘æŽ§ä¿¡å·"><a href="#ç›‘æŽ§ä¿¡å·" class="headerlink" title="ç›‘æŽ§ä¿¡å·"></a>ç›‘æŽ§ä¿¡å·</h6><p>UNIX ä¿¡å·å…è®¸ä»Žå…¶åŸŸå¤–éƒ¨æ“çºµåº”ç”¨ç¨‹åºã€‚åº”ç”¨ç¨‹åºå¯ä»¥æŽ¥æ”¶è®¸å¤šä¸åŒç±»åž‹çš„ä¿¡å·ï¼ŒèŒƒå›´ä»Žä¸å¯æ¢å¤çš„é”™è¯¯ï¼ˆä¾‹å¦‚éžæ³•æŒ‡ä»¤ï¼‰åˆ°æœ‰å…³é‡è¦ä¿¡æ¯çš„é€šçŸ¥ï¼ˆä¾‹å¦‚å­è¿›ç¨‹é€€å‡ºæ—¶ï¼‰ã€‚ä¼ ç»Ÿä¸Šï¼Œåº”ç”¨ç¨‹åºä½¿ç”¨è¯¥<code>sigaction</code>åŠŸèƒ½æ¥å®‰è£…ä¿¡å·å¤„ç†ç¨‹åºåŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½åœ¨ä¿¡å·åˆ°è¾¾åŽç«‹å³è¿›è¡ŒåŒæ­¥å¤„ç†ã€‚å¦‚æžœæ‚¨åªæƒ³æ”¶åˆ°ä¿¡å·åˆ°è¾¾çš„é€šçŸ¥ï¼Œè€Œå®žé™…ä¸Šå´ä¸æƒ³å¤„ç†è¯¥ä¿¡å·ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä¿¡å·åˆ†é…æºæ¥å¼‚æ­¥å¤„ç†ä¿¡å·ã€‚</p>
<p>ä¿¡å·åˆ†å‘æºä¸èƒ½æ›¿ä»£æ‚¨ä½¿ç”¨è¯¥<code>sigaction</code>åŠŸèƒ½å®‰è£…çš„åŒæ­¥ä¿¡å·å¤„ç†ç¨‹åºã€‚åŒæ­¥ä¿¡å·å¤„ç†ç¨‹åºå®žé™…ä¸Šå¯ä»¥æ•èŽ·ä¿¡å·å¹¶é˜²æ­¢å…¶ç»ˆæ­¢æ‚¨çš„åº”ç”¨ç¨‹åºã€‚ä¿¡å·åˆ†å‘æºå…è®¸æ‚¨ä»…ç›‘è§†ä¿¡å·çš„åˆ°è¾¾ã€‚æ­¤å¤–ï¼Œæ‚¨ä¸èƒ½ä½¿ç”¨ä¿¡å·åˆ†å‘æºæ¥æ£€ç´¢æ‰€æœ‰ç±»åž‹çš„ä¿¡å·ã€‚ç‰¹åˆ«æ˜¯ï¼Œä½ ä¸èƒ½ç”¨å®ƒä»¬æ¥ç›‘æŽ§<code>SIGILL</code>ï¼Œ<code>SIGBUS</code>ä»¥åŠ<code>SIGSEGV</code>ä¿¡å·ã€‚</p>
<p>å› ä¸ºä¿¡å·è°ƒåº¦æºåœ¨è°ƒåº¦é˜Ÿåˆ—ä¸Šå¼‚æ­¥æ‰§è¡Œï¼Œæ‰€ä»¥å®ƒä»¬ä¸å—ä¸ŽåŒæ­¥ä¿¡å·å¤„ç†ç¨‹åºç›¸åŒçš„é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä»Žä¿¡å·åˆ†é…æºçš„äº‹ä»¶å¤„ç†ç¨‹åºè°ƒç”¨çš„å‡½æ•°æ²¡æœ‰ä»»ä½•é™åˆ¶ã€‚è¿™ç§çµæ´»æ€§çš„æŠ˜è¡·æ˜¯ï¼Œåœ¨ä¿¡å·åˆ°è¾¾çš„æ—¶é—´ä¸Žè°ƒåº¦æºçš„äº‹ä»¶å¤„ç†ç¨‹åºè¢«è°ƒç”¨ä¹‹é—´çš„å»¶è¿Ÿå¯èƒ½ä¼šæœ‰æ‰€å¢žåŠ ã€‚</p>
<p>æ¸…å• 4-5 æ˜¾ç¤ºäº†å¦‚ä½•é…ç½®ä¿¡å·åˆ†å‘æºæ¥å¤„ç†<code>SIGHUP</code>ä¿¡å·ã€‚è°ƒåº¦æºçš„äº‹ä»¶å¤„ç†ç¨‹åºè°ƒç”¨è¯¥<code>MyProcessSIGHUP</code>å‡½æ•°ï¼Œæ‚¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­å°†å…¶æ›¿æ¢ä¸ºç”¨äºŽå¤„ç†ä¿¡å·çš„ä»£ç ã€‚</p>
<p><strong>æ¸…å• 4-5</strong> å®‰è£…ä¸€ä¸ªç›‘è§†ä¿¡å·çš„å—</p>
<table>
<thead>
<tr>
<th><code>æ— æ•ˆInstallSignalHandlerï¼ˆï¼‰</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>//ç¡®ä¿ä¿¡å·ä¸ä¼šç»ˆæ­¢åº”ç”¨ç¨‹åºã€‚</code></td>
</tr>
<tr>
<td><code>ä¿¡å·ï¼ˆSIGHUPï¼ŒSIG_IGNï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>dispatch_queue_té˜Ÿåˆ—= dispatch_get_global_queueï¼ˆDISPATCH_QUEUE_PRIORITY_DEFAULTï¼Œ0ï¼‰;</code></td>
</tr>
<tr>
<td><code>dispatch_source_t source = dispatch_source_createï¼ˆDISPATCH_SOURCE_TYPE_SIGNALï¼ŒSIGHUPï¼Œ0ï¼Œé˜Ÿåˆ—ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆæ¥æºï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>dispatch_source_set_event_handlerï¼ˆsourceï¼Œ^ {</code></td>
</tr>
<tr>
<td><code>MyProcessSIGHUPï¼ˆï¼‰;</code></td>
</tr>
<tr>
<td><code>}ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>//å¼€å§‹å¤„ç†ä¿¡å·</code></td>
</tr>
<tr>
<td><code>dispatch_resumeï¼ˆæºï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>å¦‚æžœæ‚¨æ­£åœ¨ä¸ºè‡ªå®šä¹‰æ¡†æž¶å¼€å‘ä»£ç ï¼Œåˆ™ä½¿ç”¨ä¿¡å·åˆ†å‘æºçš„ä¼˜ç‚¹æ˜¯æ‚¨çš„ä»£ç å¯ä»¥ç‹¬ç«‹äºŽä¸Žå…¶é“¾æŽ¥çš„ä»»ä½•åº”ç”¨ç¨‹åºç›‘è§†ä¿¡å·ã€‚ä¿¡å·è°ƒåº¦æºä¸ä¼šå¹²æ‰°åº”ç”¨ç¨‹åºå¯èƒ½å·²å®‰è£…çš„å…¶ä»–è°ƒåº¦æºæˆ–ä»»ä½•åŒæ­¥ä¿¡å·å¤„ç†ç¨‹åºã€‚</p>
<p>æœ‰å…³å®žçŽ°åŒæ­¥ä¿¡å·å¤„ç†ç¨‹åºçš„æ›´å¤šä¿¡æ¯ï¼Œä»¥åŠä¿¡å·åç§°çš„åˆ—è¡¨ï¼Œè¯·å‚è§<code>signal</code>æ‰‹å†Œé¡µã€‚</p>
<h6 id="ç›‘æŽ§è¿‡ç¨‹"><a href="#ç›‘æŽ§è¿‡ç¨‹" class="headerlink" title="ç›‘æŽ§è¿‡ç¨‹"></a>ç›‘æŽ§è¿‡ç¨‹</h6><p>æµç¨‹è°ƒåº¦æºä½¿æ‚¨å¯ä»¥ç›‘è§†ç‰¹å®šæµç¨‹çš„è¡Œä¸ºå¹¶åšå‡ºé€‚å½“å“åº”ã€‚çˆ¶è¿›ç¨‹å¯èƒ½ä½¿ç”¨è¿™ç§ç±»åž‹çš„è°ƒåº¦æºæ¥ç›‘è§†å®ƒåˆ›å»ºçš„ä»»ä½•å­è¿›ç¨‹ã€‚ä¾‹å¦‚ï¼Œçˆ¶è¿›ç¨‹å¯ä»¥ä½¿ç”¨å®ƒæ¥ç›‘è§†å­è¿›ç¨‹çš„æ­»äº¡ã€‚åŒæ ·ï¼Œå­è¿›ç¨‹å¯ä»¥ä½¿ç”¨å®ƒæ¥ç›‘è§†å…¶çˆ¶è¿›ç¨‹å¹¶åœ¨çˆ¶è¿›ç¨‹é€€å‡ºæ—¶é€€å‡ºã€‚</p>
<p>æ¸…å• 4-6 æ˜¾ç¤ºäº†å®‰è£…è°ƒåº¦æºä»¥ç›‘è§†çˆ¶è¿›ç¨‹ç»ˆæ­¢çš„æ­¥éª¤ã€‚å½“çˆ¶è¿›ç¨‹æ­»äº¡æ—¶ï¼Œè°ƒåº¦æºå°†è®¾ç½®ä¸€äº›å†…éƒ¨çŠ¶æ€ä¿¡æ¯ï¼Œä»¥ä½¿å­è¿›ç¨‹çŸ¥é“åº”è¯¥é€€å‡ºã€‚ï¼ˆæ‚¨è‡ªå·±çš„åº”ç”¨ç¨‹åºå°†éœ€è¦å®žçŽ°<code>MySetAppExitFlag</code>ä¸ºç»ˆæ­¢è®¾ç½®é€‚å½“æ ‡å¿—çš„åŠŸèƒ½ã€‚ï¼‰ç”±äºŽè°ƒåº¦æºæ˜¯è‡ªåŠ¨è¿è¡Œçš„ï¼Œå› æ­¤æ‹¥æœ‰è‡ªå·±çš„èµ„æºï¼Œå› æ­¤å®ƒåœ¨é¢„æœŸç¨‹åºå…³é—­æ—¶ä¹Ÿä¼šå–æ¶ˆå¹¶é‡Šæ”¾è‡ªèº«ã€‚</p>
<p><strong>æ¸…å• 4-6</strong> ç›‘è§†çˆ¶è¿›ç¨‹çš„æ­»äº¡</p>
<table>
<thead>
<tr>
<th><code>void MonitorParentProcessï¼ˆï¼‰</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>pid_t parentPID = getppidï¼ˆï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>dispatch_queue_té˜Ÿåˆ—= dispatch_get_global_queueï¼ˆDISPATCH_QUEUE_PRIORITY_DEFAULTï¼Œ0ï¼‰;</code></td>
</tr>
<tr>
<td><code>dispatch_source_t source = dispatch_source_createï¼ˆDISPATCH_SOURCE_TYPE_PROCï¼Œ</code></td>
</tr>
<tr>
<td><code>parentPIDï¼ŒDISPATCH_PROC_EXITï¼Œé˜Ÿåˆ—ï¼‰ï¼›</code></td>
</tr>
<tr>
<td><code>å¦‚æžœï¼ˆæ¥æºï¼‰</code></td>
</tr>
<tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>dispatch_source_set_event_handlerï¼ˆsourceï¼Œ^ {</code></td>
</tr>
<tr>
<td><code>MySetAppExitFlagï¼ˆï¼‰;</code></td>
</tr>
<tr>
<td><code>dispatch_source_cancelï¼ˆsourceï¼‰;</code></td>
</tr>
<tr>
<td><code>dispatch_releaseï¼ˆæºä»£ç ï¼‰;</code></td>
</tr>
<tr>
<td><code>}ï¼‰;</code></td>
</tr>
<tr>
<td><code>dispatch_resumeï¼ˆæºï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<h4 id="å–æ¶ˆæ´¾é£æº"><a href="#å–æ¶ˆæ´¾é£æº" class="headerlink" title="å–æ¶ˆæ´¾é£æº"></a>å–æ¶ˆæ´¾é£æº</h4><p>è°ƒåº¦æºå°†ä¿æŒæ´»åŠ¨çŠ¶æ€ï¼Œç›´åˆ°æ‚¨ä½¿ç”¨è¯¥<code>dispatch_source_cancel</code>åŠŸèƒ½æ˜Žç¡®å–æ¶ˆå®ƒä»¬ä¸ºæ­¢ã€‚å–æ¶ˆè°ƒåº¦æºå°†åœæ­¢æ–°äº‹ä»¶çš„ä¼ é€’ï¼Œå¹¶ä¸”æ— æ³•æ’¤æ¶ˆã€‚å› æ­¤ï¼Œé€šå¸¸æ‚¨å–æ¶ˆè°ƒåº¦æºï¼Œç„¶åŽç«‹å³é‡Šæ”¾å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th><code>void RemoveDispatchSourceï¼ˆdispatch_source_t mySourceï¼‰</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>{</code></td>
</tr>
<tr>
<td><code>dispatch_source_cancelï¼ˆmySourceï¼‰;</code></td>
</tr>
<tr>
<td><code>dispatch_releaseï¼ˆmySourceï¼‰;</code></td>
</tr>
<tr>
<td><code>}</code></td>
</tr>
</tbody></table>
<p>å–æ¶ˆè°ƒåº¦æºæ˜¯å¼‚æ­¥æ“ä½œã€‚å°½ç®¡åœ¨è°ƒç”¨<code>dispatch_source_cancel</code>å‡½æ•°åŽæ²¡æœ‰ä»»ä½•æ–°äº‹ä»¶è¢«å¤„ç†ï¼Œä½†æ˜¯è°ƒåº¦æºå·²ç»å¤„ç†çš„äº‹ä»¶å°†ç»§ç»­è¢«å¤„ç†ã€‚å®Œæˆä»»ä½•æœ€ç»ˆäº‹ä»¶çš„å¤„ç†åŽï¼Œå¦‚æžœå­˜åœ¨ä¸€ä¸ªæ´¾å‘æºï¼Œåˆ™æ´¾å‘æºæ‰§è¡Œå…¶å–æ¶ˆå¤„ç†ç¨‹åºã€‚</p>
<p>å–æ¶ˆå¤„ç†ç¨‹åºæ˜¯æ‚¨é‡Šæ”¾å†…å­˜æˆ–æ¸…ç†ä»£è¡¨è°ƒåº¦æºèŽ·å–çš„ä»»ä½•èµ„æºçš„æœºä¼šã€‚å¦‚æžœæ‚¨çš„è°ƒåº¦æºä½¿ç”¨æè¿°ç¬¦æˆ–é©¬èµ«ç«¯å£ï¼Œåˆ™å¿…é¡»æä¾›å–æ¶ˆå¤„ç†ç¨‹åºä»¥å…³é—­æè¿°ç¬¦æˆ–åœ¨å‘ç”Ÿå–æ¶ˆæ—¶é”€æ¯ç«¯å£ã€‚å…¶ä»–ç±»åž‹çš„è°ƒåº¦æºä¸éœ€è¦å–æ¶ˆå¤„ç†ç¨‹åºï¼Œä½†æ˜¯å¦‚æžœå°†ä»»ä½•å†…å­˜æˆ–æ•°æ®ä¸Žè°ƒåº¦æºå…³è”ï¼Œæ‚¨ä»åº”æä¾›å–æ¶ˆå¤„ç†ç¨‹åºã€‚ä¾‹å¦‚ï¼Œå¦‚æžœå°†æ•°æ®å­˜å‚¨åœ¨è°ƒåº¦æºçš„ä¸Šä¸‹æ–‡æŒ‡é’ˆä¸­ï¼Œåˆ™åº”æä¾›ä¸€ä¸ªã€‚æœ‰å…³å–æ¶ˆå¤„ç†ç¨‹åºçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW14">å®‰è£…å–æ¶ˆå¤„ç†ç¨‹åº</a>ã€‚</p>
<h4 id="æŒ‚èµ·å’Œæ¢å¤æ´¾é£æº"><a href="#æŒ‚èµ·å’Œæ¢å¤æ´¾é£æº" class="headerlink" title="æŒ‚èµ·å’Œæ¢å¤æ´¾é£æº"></a>æŒ‚èµ·å’Œæ¢å¤æ´¾é£æº</h4><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>dispatch_suspend</code>å’Œ<code>dispatch_resume</code>æ–¹æ³•ä¸´æ—¶æš‚åœå’Œæ¢å¤åˆ†å‘æºäº‹ä»¶çš„ä¼ é€’ã€‚è¿™äº›æ–¹æ³•å¢žåŠ å’Œå‡å°‘è°ƒåº¦å¯¹è±¡çš„æŒ‚èµ·è®¡æ•°ã€‚å› æ­¤ï¼Œåœ¨æ¢å¤äº‹ä»¶ä¼ é€’ä¹‹å‰ï¼Œæ‚¨å¿…é¡»åœ¨<code>dispatch_suspend</code>ä¸Žæ¯ä¸ªå‘¼å«ä¹‹é—´æ‰¾åˆ°ä¸€ä¸ªä¸Žä¹‹åŒ¹é…çš„å‘¼å«<code>dispatch_resume</code>ã€‚</p>
<p>å½“æ‚¨æŒ‚èµ·è°ƒåº¦æºæ—¶ï¼Œè¯¥è°ƒåº¦æºè¢«æŒ‚èµ·æ—¶å‘ç”Ÿçš„ä»»ä½•äº‹ä»¶éƒ½å°†è¢«ç´¯ç§¯ï¼Œç›´åˆ°æ¢å¤é˜Ÿåˆ—ä¸ºæ­¢ã€‚å½“é˜Ÿåˆ—æ¢å¤æ—¶ï¼Œè€Œä¸æ˜¯ä¼ é€’æ‰€æœ‰äº‹ä»¶ï¼Œè€Œæ˜¯åœ¨ä¼ é€’ä¹‹å‰å°†äº‹ä»¶åˆå¹¶ä¸ºå•ä¸ªäº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæ‚¨æ­£åœ¨ç›‘è§†æ–‡ä»¶ä¸­çš„åç§°æ›´æ”¹ï¼Œåˆ™ä¼ é€’çš„äº‹ä»¶å°†ä»…åŒ…æ‹¬å§“æ°æ›´æ”¹ã€‚ä»¥è¿™ç§æ–¹å¼åˆå¹¶äº‹ä»¶å¯ä»¥é˜²æ­¢å®ƒä»¬åœ¨é˜Ÿåˆ—ä¸­å»ºç«‹ï¼Œå¹¶åœ¨å·¥ä½œæ¢å¤æ—¶ä½¿æ‚¨çš„åº”ç”¨ç¨‹åºä¸å ªé‡è´Ÿã€‚</p>
<h2 id="è¿œç¦»çº¿ç¨‹-1"><a href="#è¿œç¦»çº¿ç¨‹-1" class="headerlink" title="è¿œç¦»çº¿ç¨‹"></a>è¿œç¦»çº¿ç¨‹</h2><p>æœ‰å¤šç§æ–¹æ³•å¯ä»¥ä½¿çŽ°æœ‰çš„çº¿ç¨‹ä»£ç é€‚åº”ä½¿ç”¨ Grand Central Dispatch å’Œæ“ä½œå¯¹è±¡çš„ä¼˜åŠ¿ã€‚å°½ç®¡å¹¶éžåœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½å¯èƒ½è¿œç¦»çº¿ç¨‹ï¼Œä½†æ˜¯åœ¨æ‚¨è¿›è¡Œåˆ‡æ¢çš„åœ°æ–¹ï¼Œæ€§èƒ½ï¼ˆä»¥åŠä»£ç çš„ç®€å•æ€§ï¼‰å¯ä»¥æ˜¾ç€æé«˜ã€‚ç‰¹åˆ«æ˜¯ï¼Œä½¿ç”¨è°ƒåº¦é˜Ÿåˆ—å’Œæ“ä½œé˜Ÿåˆ—è€Œä¸æ˜¯çº¿ç¨‹å…·æœ‰å¤šä¸ªä¼˜ç‚¹ï¼š</p>
<ul>
<li>å®ƒå‡å°‘äº†æ‚¨çš„åº”ç”¨ç¨‹åºä¸ºå°†çº¿ç¨‹å †æ ˆå­˜å‚¨åœ¨åº”ç”¨ç¨‹åºçš„å†…å­˜ç©ºé—´ä¸­è€Œä»˜å‡ºçš„å†…å­˜æŸå¤±ã€‚</li>
<li>å®ƒæ¶ˆé™¤äº†åˆ›å»ºå’Œé…ç½®çº¿ç¨‹æ‰€éœ€çš„ä»£ç ã€‚</li>
<li>å®ƒæ¶ˆé™¤äº†ç®¡ç†å’Œè°ƒåº¦çº¿ç¨‹ä¸Šçš„å·¥ä½œæ‰€éœ€çš„ä»£ç ã€‚</li>
<li>å®ƒç®€åŒ–äº†æ‚¨å¿…é¡»ç¼–å†™çš„ä»£ç ã€‚</li>
</ul>
<p>æœ¬ç« æä¾›æœ‰å…³å¦‚ä½•æ›¿æ¢çŽ°æœ‰çš„åŸºäºŽçº¿ç¨‹çš„ä»£ç ä»¥åŠå¦‚ä½•ä½¿ç”¨åˆ†æ´¾é˜Ÿåˆ—å’Œæ“ä½œé˜Ÿåˆ—æ¥å®žçŽ°ç›¸åŒç±»åž‹è¡Œä¸ºçš„æç¤ºå’Œå‡†åˆ™ã€‚</p>
<h4 id="ç”¨è°ƒåº¦é˜Ÿåˆ—æ›¿æ¢çº¿ç¨‹"><a href="#ç”¨è°ƒåº¦é˜Ÿåˆ—æ›¿æ¢çº¿ç¨‹" class="headerlink" title="ç”¨è°ƒåº¦é˜Ÿåˆ—æ›¿æ¢çº¿ç¨‹"></a>ç”¨è°ƒåº¦é˜Ÿåˆ—æ›¿æ¢çº¿ç¨‹</h4><p>è¦äº†è§£å¦‚ä½•ç”¨è°ƒåº¦é˜Ÿåˆ—æ›¿æ¢çº¿ç¨‹ï¼Œè¯·é¦–å…ˆè€ƒè™‘æ‚¨ä»Šå¤©åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çº¿ç¨‹çš„ä¸€äº›æ–¹å¼ï¼š</p>
<ul>
<li><strong>å•ä»»åŠ¡çº¿ç¨‹</strong>ã€‚åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶åœ¨ä»»åŠ¡å®ŒæˆåŽé‡Šæ”¾çº¿ç¨‹ã€‚</li>
<li><strong>å·¥ä½œè€…çº¿ç¨‹</strong>ã€‚åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªå·¥ä½œçº¿ç¨‹ï¼Œå¹¶ä¸ºæ¯ä¸ªçº¿ç¨‹è®°ä½ç‰¹å®šçš„ä»»åŠ¡ã€‚å®šæœŸå°†ä»»åŠ¡åˆ†é…ç»™æ¯ä¸ªçº¿ç¨‹ã€‚</li>
<li><strong>çº¿ç¨‹æ± </strong>ã€‚åˆ›å»ºä¸€ä¸ªé€šç”¨çº¿ç¨‹æ± ï¼Œå¹¶ä¸ºæ¯ä¸ªçº¿ç¨‹å»ºç«‹è¿è¡Œå¾ªçŽ¯ã€‚å½“æ‚¨æœ‰ä»»åŠ¡è¦æ‰§è¡Œæ—¶ï¼Œè¯·ä»Žæ± ä¸­èŽ·å–ä¸€ä¸ªçº¿ç¨‹ï¼Œç„¶åŽå°†ä»»åŠ¡åˆ†æ´¾ç»™è¯¥çº¿ç¨‹ã€‚å¦‚æžœæ²¡æœ‰å¯ç”¨çº¿ç¨‹ï¼Œåˆ™å°†ä»»åŠ¡æŽ’é˜Ÿå¹¶ç­‰å¾…çº¿ç¨‹å¯ç”¨ã€‚</li>
</ul>
<p>å°½ç®¡è¿™äº›æŠ€æœ¯çœ‹ä¼¼æˆªç„¶ä¸åŒï¼Œä½†å®ƒä»¬å®žé™…ä¸Šåªæ˜¯ç›¸åŒåŽŸç†çš„å˜ä½“ã€‚åœ¨æ¯ç§æƒ…å†µä¸‹ï¼Œéƒ½ä½¿ç”¨çº¿ç¨‹æ¥è¿è¡Œåº”ç”¨ç¨‹åºå¿…é¡»æ‰§è¡Œçš„æŸäº›ä»»åŠ¡ã€‚å®ƒä»¬ä¹‹é—´çš„å”¯ä¸€åŒºåˆ«æ˜¯ç”¨äºŽç®¡ç†çº¿ç¨‹å’Œä»»åŠ¡æŽ’é˜Ÿçš„ä»£ç ã€‚ä½¿ç”¨è°ƒåº¦é˜Ÿåˆ—å’Œæ“ä½œé˜Ÿåˆ—ï¼Œæ‚¨å¯ä»¥æ¶ˆé™¤æ‰€æœ‰çº¿ç¨‹å’Œçº¿ç¨‹é€šä¿¡ä»£ç ï¼Œè€Œåªä¸“æ³¨äºŽè¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚</p>
<p>å¦‚æžœæ‚¨æ­£åœ¨ä½¿ç”¨ä¸Šè¿°çº¿ç¨‹æ¨¡åž‹ä¹‹ä¸€ï¼Œåˆ™åº”è¯¥å·²ç»å¯¹åº”ç”¨ç¨‹åºæ‰§è¡Œçš„ä»»åŠ¡ç±»åž‹æœ‰ä¸€ä¸ªå¾ˆå¥½çš„äº†è§£ã€‚ä¸Žå…¶å°†ä»»åŠ¡æäº¤ç»™æ‚¨çš„è‡ªå®šä¹‰çº¿ç¨‹ä¹‹ä¸€ï¼Œä¸å¦‚å°†è¯¥ä»»åŠ¡å°è£…åœ¨ä¸€ä¸ªæ“ä½œå¯¹è±¡æˆ–ä¸€ä¸ªå—å¯¹è±¡ä¸­ï¼Œç„¶åŽå°†å…¶åˆ†æ´¾åˆ°é€‚å½“çš„é˜Ÿåˆ—ä¸­ã€‚å¯¹äºŽä¸æ˜¯ç‰¹åˆ«æœ‰äº‰è®®çš„ä»»åŠ¡ï¼ˆå³ä¸å¸¦é”çš„ä»»åŠ¡ï¼‰ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿè¿›è¡Œä»¥ä¸‹ç›´æŽ¥æ›¿æ¢ï¼š</p>
<ul>
<li>å¯¹äºŽå•ä¸ªä»»åŠ¡çº¿ç¨‹ï¼Œå°†ä»»åŠ¡å°è£…åœ¨å—æˆ–æ“ä½œå¯¹è±¡ä¸­ï¼Œç„¶åŽå°†å…¶æäº¤åˆ°å¹¶å‘é˜Ÿåˆ—ã€‚</li>
<li>å¯¹äºŽè¾…åŠ©çº¿ç¨‹ï¼Œæ‚¨éœ€è¦ç¡®å®šæ˜¯ä½¿ç”¨ä¸²è¡Œé˜Ÿåˆ—è¿˜æ˜¯å¹¶å‘é˜Ÿåˆ—ã€‚å¦‚æžœä½¿ç”¨å·¥ä½œçº¿ç¨‹æ¥åŒæ­¥ç‰¹å®šä»»åŠ¡é›†çš„æ‰§è¡Œï¼Œè¯·ä½¿ç”¨ä¸²è¡Œé˜Ÿåˆ—ã€‚å¦‚æžœç¡®å®žä½¿ç”¨å·¥ä½œçº¿ç¨‹æ‰§è¡Œæ²¡æœ‰ç›¸äº’ä¾èµ–æ€§çš„ä»»æ„ä»»åŠ¡ï¼Œè¯·ä½¿ç”¨å¹¶å‘é˜Ÿåˆ—ã€‚</li>
<li>å¯¹äºŽçº¿ç¨‹æ± ï¼Œå°†æ‚¨çš„ä»»åŠ¡å°è£…åœ¨ä¸€ä¸ªå—æˆ–æ“ä½œå¯¹è±¡ä¸­ï¼Œç„¶åŽå°†å®ƒä»¬åˆ†æ´¾åˆ°å¹¶å‘é˜Ÿåˆ—ä¸­ä»¥æ‰§è¡Œã€‚</li>
</ul>
<p>å½“ç„¶ï¼Œåƒè¿™æ ·çš„ç®€å•æ›¿æ¢ä¸ä¸€å®šåœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½æœ‰æ•ˆã€‚å¦‚æžœæ‚¨æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡äº‰ç”¨å…±äº«èµ„æºï¼Œåˆ™ç†æƒ³çš„è§£å†³æ–¹æ¡ˆæ˜¯å°è¯•é¦–å…ˆåˆ é™¤æˆ–æœ€å°åŒ–è¯¥äº‰ç”¨ã€‚å¦‚æžœæœ‰ä¸€äº›æ–¹æ³•å¯ä»¥é‡æž„æˆ–é‡æ–°æž„é€ ä»£ç ä»¥æ¶ˆé™¤å¯¹å…±äº«èµ„æºçš„ç›¸äº’ä¾èµ–ï¼Œé‚£å½“ç„¶æ˜¯å¯å–çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æžœè¿™æ ·åšæ˜¯ä¸å¯èƒ½çš„æˆ–æ•ˆçŽ‡å¯èƒ½è¾ƒä½Žï¼Œåˆ™ä»ç„¶å¯ä»¥åˆ©ç”¨é˜Ÿåˆ—çš„æ–¹æ³•ã€‚é˜Ÿåˆ—çš„ä¸€å¤§ä¼˜ç‚¹æ˜¯å®ƒä»¬æä¾›äº†ä¸€ç§æ›´å¯é¢„æµ‹çš„æ–¹å¼æ¥æ‰§è¡Œä»£ç ã€‚è¿™ç§å¯é¢„æµ‹æ€§æ„å‘³ç€ï¼Œä»æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥åœ¨ä¸ä½¿ç”¨é”æˆ–å…¶ä»–é‡é‡çº§åŒæ­¥æœºåˆ¶çš„æƒ…å†µä¸‹åŒæ­¥ä»£ç çš„æ‰§è¡Œã€‚é™¤äº†ä½¿ç”¨é”ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨é˜Ÿåˆ—æ¥æ‰§è¡Œè®¸å¤šç›¸åŒçš„ä»»åŠ¡ï¼š</p>
<ul>
<li>å¦‚æžœæ‚¨æœ‰å¿…é¡»æŒ‰ç‰¹å®šé¡ºåºæ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¯·å°†å…¶æäº¤åˆ°ä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—ã€‚å¦‚æžœæ‚¨æ›´å–œæ¬¢ä½¿ç”¨æ“ä½œé˜Ÿåˆ—ï¼Œè¯·ä½¿ç”¨æ“ä½œå¯¹è±¡ä¾èµ–æ€§æ¥ç¡®ä¿è¿™äº›å¯¹è±¡ä»¥ç‰¹å®šé¡ºåºæ‰§è¡Œã€‚</li>
<li>å¦‚æžœå½“å‰æ­£åœ¨ä½¿ç”¨é”æ¥ä¿æŠ¤å…±äº«èµ„æºï¼Œè¯·åˆ›å»ºä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ä»¥æ‰§è¡Œä»»ä½•ä¿®æ”¹è¯¥èµ„æºçš„ä»»åŠ¡ã€‚ç„¶åŽï¼Œä¸²è¡Œé˜Ÿåˆ—å°†æ‚¨çŽ°æœ‰çš„é”æ›¿æ¢ä¸ºåŒæ­¥æœºåˆ¶ã€‚æœ‰å…³æ‘†è„±é”çš„æ›´å¤šä¿¡æ¯æŠ€æœ¯ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/ThreadMigration/ThreadMigration.html#//apple_ref/doc/uid/TP40008091-CH105-SW3">æ¶ˆé™¤åŸºäºŽé”çš„ä»£ç </a>ã€‚</li>
<li>å¦‚æžœä½¿ç”¨çº¿ç¨‹è¿žæŽ¥ç­‰å¾…åŽå°ä»»åŠ¡å®Œæˆï¼Œè¯·è€ƒè™‘æ”¹ç”¨è°ƒåº¦ç»„ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <code>NSBlockOperation</code>å¯¹è±¡æˆ–æ“ä½œå¯¹è±¡ä¾èµ–é¡¹æ¥å®žçŽ°ç±»ä¼¼çš„ç»„å®Œæˆè¡Œä¸ºã€‚æœ‰å…³å¦‚ä½•è·Ÿè¸ªæ‰§è¡Œä»»åŠ¡ç»„çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/ThreadMigration/ThreadMigration.html#//apple_ref/doc/uid/TP40008091-CH105-SW6">æ›¿æ¢çº¿ç¨‹è”æŽ¥</a>ã€‚</li>
<li>å¦‚æžœæ‚¨ä½¿ç”¨ç”Ÿäº§è€…ï¼æ¶ˆè´¹è€…ç®—æ³•æ¥ç®¡ç†æœ‰é™çš„èµ„æºæ± ï¼Œè¯·è€ƒè™‘å°†æ‚¨çš„å®žçŽ°<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/ThreadMigration/ThreadMigration.html#//apple_ref/doc/uid/TP40008091-CH105-SW7">æ›´æ”¹ä¸ºâ€œæ›´æ”¹ç”Ÿäº§è€…ï¼æ¶ˆè´¹è€…å®žçŽ°â€ä¸­æ˜¾ç¤ºçš„æ–¹æ³•</a>ã€‚</li>
<li>å¦‚æžœæ‚¨æ­£åœ¨ä½¿ç”¨çº¿ç¨‹ä»Žæè¿°ç¬¦è¯»å–å’Œå†™å…¥ï¼Œæˆ–ç›‘è§†æ–‡ä»¶æ“ä½œï¼Œè¯·æŒ‰ç…§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW1">Dispatch Sources ä¸­çš„</a>è¯´æ˜Žä½¿ç”¨<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW1">è°ƒåº¦æº</a>ã€‚</li>
</ul>
<p>é‡è¦çš„æ˜¯è¦è®°ä½ï¼Œé˜Ÿåˆ—ä¸æ˜¯æ›¿æ¢çº¿ç¨‹çš„çµä¸¹å¦™è¯ã€‚é˜Ÿåˆ—æä¾›çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡åž‹é€‚åˆäºŽå»¶è¿Ÿä¸æˆé—®é¢˜çš„æƒ…å†µã€‚å³ä½¿é˜Ÿåˆ—æä¾›äº†é…ç½®é˜Ÿåˆ—ä¸­ä»»åŠ¡æ‰§è¡Œä¼˜å…ˆçº§çš„æ–¹æ³•ï¼Œä½†æ˜¯è¾ƒé«˜çš„æ‰§è¡Œä¼˜å…ˆçº§ä¹Ÿä¸èƒ½ä¿è¯åœ¨ç‰¹å®šæ—¶é—´æ‰§è¡Œä»»åŠ¡ã€‚å› æ­¤ï¼Œåœ¨éœ€è¦æœ€å°å»¶è¿Ÿçš„æƒ…å†µä¸‹ï¼Œä¾‹å¦‚åœ¨éŸ³é¢‘å’Œè§†é¢‘æ’­æ”¾ä¸­ï¼Œçº¿ç¨‹ä»ç„¶æ˜¯æ›´åˆé€‚çš„é€‰æ‹©ã€‚</p>
<h4 id="æ¶ˆé™¤åŸºäºŽé”çš„ä»£ç "><a href="#æ¶ˆé™¤åŸºäºŽé”çš„ä»£ç " class="headerlink" title="æ¶ˆé™¤åŸºäºŽé”çš„ä»£ç "></a>æ¶ˆé™¤åŸºäºŽé”çš„ä»£ç </h4><p>å¯¹äºŽçº¿ç¨‹ä»£ç ï¼Œé”æ˜¯åŒæ­¥å¯¹çº¿ç¨‹ä¹‹é—´å…±äº«çš„èµ„æºçš„è®¿é—®çš„ä¼ ç»Ÿæ–¹æ³•ä¹‹ä¸€ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨é”æ˜¯æœ‰ä»£ä»·çš„ã€‚å³ä½¿åœ¨æ— äº‰è®®çš„æƒ…å†µä¸‹ï¼Œå§‹ç»ˆä¼šå› é”å®šè€Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚å¹¶ä¸”åœ¨æœ‰äº‰è®®çš„æƒ…å†µä¸‹ï¼Œåœ¨ç­‰å¾…é‡Šæ”¾é”çš„åŒæ—¶ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹æœ‰å¯èƒ½åœ¨ä¸ç¡®å®šçš„æ—¶é—´å†…é˜»å¡žã€‚</p>
<p>ç”¨é˜Ÿåˆ—æ›¿æ¢åŸºäºŽé”çš„ä»£ç å¯ä»¥æ¶ˆé™¤è®¸å¤šä¸Žé”ç›¸å…³çš„æƒ©ç½šï¼Œè¿˜å¯ä»¥ç®€åŒ–å‰©ä½™çš„ä»£ç ã€‚æ‚¨å¯ä»¥ä½¿ç”¨åˆ›å»ºé˜Ÿåˆ—æ¥åºåˆ—åŒ–è®¿é—®è¯¥èµ„æºçš„ä»»åŠ¡ï¼Œè€Œä¸å¿…ä½¿ç”¨é”æ¥ä¿æŠ¤å…±äº«èµ„æºã€‚é˜Ÿåˆ—ä¸ä¼šæ–½åŠ ä¸Žé”ç›¸åŒçš„æƒ©ç½šã€‚ä¾‹å¦‚ï¼ŒæŽ’é˜Ÿä»»åŠ¡ä¸éœ€è¦é™·å…¥å†…æ ¸å³å¯èŽ·å–äº’æ–¥é‡ã€‚</p>
<p>åœ¨å¯¹ä»»åŠ¡è¿›è¡ŒæŽ’é˜Ÿæ—¶ï¼Œæ‚¨å¿…é¡»åšå‡ºçš„ä¸»è¦å†³å®šæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥è¿›è¡Œã€‚å¼‚æ­¥æäº¤ä»»åŠ¡å¯ä»¥ä½¿å½“å‰çº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡æ—¶ç»§ç»­è¿è¡Œã€‚åŒæ­¥æäº¤ä»»åŠ¡ä¼šé˜»å¡žå½“å‰çº¿ç¨‹ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆã€‚è¿™ä¸¤ä¸ªé€‰é¡¹éƒ½æœ‰é€‚å½“çš„ç”¨é€”ï¼Œå°½ç®¡åœ¨å¯èƒ½çš„æƒ…å†µä¸‹å¼‚æ­¥æäº¤ä»»åŠ¡æ— ç–‘æ˜¯æœ‰åˆ©çš„ã€‚</p>
<p>ä»¥ä¸‹å„èŠ‚è¯´æ˜Žå¦‚ä½•ç”¨ç­‰æ•ˆçš„åŸºäºŽé˜Ÿåˆ—çš„ä»£ç æ›¿æ¢çŽ°æœ‰çš„åŸºäºŽé”çš„ä»£ç ã€‚</p>
<h6 id="å®žçŽ°å¼‚æ­¥é”"><a href="#å®žçŽ°å¼‚æ­¥é”" class="headerlink" title="å®žçŽ°å¼‚æ­¥é”"></a>å®žçŽ°å¼‚æ­¥é”</h6><p>å¼‚æ­¥é”å®šæ˜¯ä¸€ç§ä¿æŠ¤å…±äº«èµ„æºè€Œåˆä¸ä¼šé˜»æ­¢ä»»ä½•ä¿®æ”¹è¯¥èµ„æºçš„ä»£ç çš„æ–¹æ³•ã€‚å½“éœ€è¦ä¿®æ”¹æ•°æ®ç»“æž„æ—¶ï¼Œæ‚¨å¯èƒ½ä¼šä½¿ç”¨å¼‚æ­¥é”ï¼Œè¿™æ˜¯ä»£ç æ­£åœ¨æ‰§è¡Œçš„å…¶ä»–ä¸€äº›å·¥ä½œçš„å‰¯ä½œç”¨ã€‚ä½¿ç”¨ä¼ ç»Ÿçº¿ç¨‹ï¼Œé€šå¸¸å®žçŽ°æ­¤ä»£ç çš„æ–¹å¼æ˜¯å¯¹å…±äº«èµ„æºè¿›è¡Œé”å®šï¼Œè¿›è¡Œå¿…è¦çš„æ›´æ”¹ï¼Œé‡Šæ”¾è¯¥é”å®šï¼Œç„¶åŽç»§ç»­æ‰§è¡Œä»»åŠ¡çš„ä¸»è¦éƒ¨åˆ†ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨è°ƒåº¦é˜Ÿåˆ—ï¼Œè°ƒç”¨ä»£ç å¯ä»¥å¼‚æ­¥è¿›è¡Œä¿®æ”¹ï¼Œè€Œæ— éœ€ç­‰å¾…è¿™äº›æ›´æ”¹å®Œæˆã€‚</p>
<p>æ¸…å• 5-1 æ˜¾ç¤ºäº†ä¸€ä¸ªå¼‚æ­¥é”å®žçŽ°çš„ç¤ºä¾‹ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå—ä¿æŠ¤çš„èµ„æºå®šä¹‰äº†è‡ªå·±çš„ä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—ã€‚è°ƒç”¨ä»£ç å‘è¯¥é˜Ÿåˆ—æäº¤ä¸€ä¸ªå—å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«éœ€è¦å¯¹èµ„æºè¿›è¡Œçš„ä¿®æ”¹ã€‚ç”±äºŽé˜Ÿåˆ—æœ¬èº«æ˜¯ä¸²è¡Œæ‰§è¡Œå—çš„ï¼Œå› æ­¤å¯ä»¥ç¡®ä¿å¯¹èµ„æºçš„æ›´æ”¹æŒ‰ç…§æŽ¥æ”¶åˆ°çš„é¡ºåºè¿›è¡Œã€‚ä½†æ˜¯ï¼Œç”±äºŽä»»åŠ¡æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œå› æ­¤è°ƒç”¨çº¿ç¨‹ä¸ä¼šé˜»å¡žã€‚</p>
<p><strong>æ¸…å• 5-1</strong> å¼‚æ­¥ä¿®æ”¹å—ä¿æŠ¤çš„èµ„æº</p>
<table>
<thead>
<tr>
<th><code>dispatch_asyncï¼ˆobj-&gt; serial_queueï¼Œ^ {</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>//å…³é”®éƒ¨åˆ†</code></td>
</tr>
<tr>
<td><code>}ï¼‰;</code></td>
</tr>
</tbody></table>
<h6 id="åŒæ­¥æ‰§è¡Œå…³é”®éƒ¨åˆ†"><a href="#åŒæ­¥æ‰§è¡Œå…³é”®éƒ¨åˆ†" class="headerlink" title="åŒæ­¥æ‰§è¡Œå…³é”®éƒ¨åˆ†"></a>åŒæ­¥æ‰§è¡Œå…³é”®éƒ¨åˆ†</h6><p>å¦‚æžœåœ¨ç»™å®šä»»åŠ¡å®Œæˆä¹‹å‰å½“å‰ä»£ç æ— æ³•ç»§ç»­ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>dispatch_sync</code>å‡½æ•°åŒæ­¥æäº¤ä»»åŠ¡ã€‚æ­¤å‡½æ•°å°†ä»»åŠ¡æ·»åŠ åˆ°è°ƒåº¦é˜Ÿåˆ—ï¼Œç„¶åŽé˜»å¡žå½“å‰çº¿ç¨‹ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆæ‰§è¡Œã€‚åˆ†æ´¾é˜Ÿåˆ—æœ¬èº«å¯ä»¥æ˜¯ä¸²è¡Œæˆ–å¹¶å‘é˜Ÿåˆ—ï¼Œå…·ä½“å–å†³äºŽæ‚¨çš„éœ€æ±‚ã€‚ç”±äºŽæ­¤å‡½æ•°ä¼šé˜»æ­¢å½“å‰çº¿ç¨‹ï¼Œå› æ­¤ï¼Œä»…åº”åœ¨å¿…è¦æ—¶ä½¿ç”¨å®ƒã€‚æ¸…å• 5-2 æ˜¾ç¤ºäº†ä½¿ç”¨æ¥åŒ…è£…ä»£ç çš„å…³é”®éƒ¨åˆ†çš„æŠ€æœ¯<code>dispatch_sync</code>ã€‚</p>
<p><strong>æ¸…å• 5-2</strong> åŒæ­¥è¿è¡Œå…³é”®éƒ¨åˆ†</p>
<table>
<thead>
<tr>
<th><code>dispatch_syncï¼ˆmy_queueï¼Œ^ {</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>//å…³é”®éƒ¨åˆ†</code></td>
</tr>
<tr>
<td><code>}ï¼‰;</code></td>
</tr>
</tbody></table>
<p>å¦‚æžœæ‚¨å·²ç»åœ¨ä½¿ç”¨ä¸²è¡Œé˜Ÿåˆ—æ¥ä¿æŠ¤å…±äº«èµ„æºï¼Œåˆ™ä¸Žå¼‚æ­¥åˆ†å‘ç›¸æ¯”ï¼ŒåŒæ­¥åˆ†æ´¾åˆ°è¯¥é˜Ÿåˆ—ä¸ä¼šæ›´å¤šåœ°ä¿æŠ¤å…±äº«èµ„æºã€‚åŒæ­¥åˆ†æ´¾çš„å”¯ä¸€åŽŸå› æ˜¯é˜²æ­¢å½“å‰ä»£ç åœ¨å…³é”®éƒ¨åˆ†ç»“æŸä¹‹å‰ç»§ç»­æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæ‚¨æƒ³ä»Žå…±äº«èµ„æºä¸­èŽ·å–ä¸€äº›ä»·å€¼å¹¶ç«‹å³ä½¿ç”¨å®ƒï¼Œåˆ™éœ€è¦åŒæ­¥è°ƒåº¦ã€‚å¦‚æžœå½“å‰ä»£ç ä¸éœ€è¦ç­‰å¾…å…³é”®éƒ¨åˆ†å®Œæˆï¼Œæˆ–è€…å¯ä»¥ç®€å•åœ°å°†å…¶ä»–åŽç»­ä»»åŠ¡æäº¤åˆ°åŒä¸€ä¸²è¡Œé˜Ÿåˆ—ï¼Œåˆ™é€šå¸¸é¦–é€‰å¼‚æ­¥æäº¤ã€‚</p>
<h4 id="æ”¹è¿›å¾ªçŽ¯ä»£ç "><a href="#æ”¹è¿›å¾ªçŽ¯ä»£ç " class="headerlink" title="æ”¹è¿›å¾ªçŽ¯ä»£ç "></a>æ”¹è¿›å¾ªçŽ¯ä»£ç </h4><p>å¦‚æžœæ‚¨çš„ä»£ç å…·æœ‰å¾ªçŽ¯ï¼Œå¹¶ä¸”æ¯æ¬¡å¾ªçŽ¯æ‰§è¡Œçš„å·¥ä½œéƒ½ä¸Žå…¶ä»–è¿­ä»£ä¸­å®Œæˆçš„å·¥ä½œæ— å…³ï¼Œåˆ™å¯ä»¥è€ƒè™‘ä½¿ç”¨<code>dispatch_apply</code>or <code>dispatch_apply_f</code>å‡½æ•°é‡æ–°å®žçŽ°è¯¥å¾ªçŽ¯ä»£ç ã€‚è¿™äº›å‡½æ•°å°†å¾ªçŽ¯çš„æ¯æ¬¡è¿­ä»£åˆ†åˆ«æäº¤ç»™è°ƒåº¦é˜Ÿåˆ—è¿›è¡Œå¤„ç†ã€‚ä¸Žå¹¶å‘é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œæ­¤åŠŸèƒ½ä½¿æ‚¨å¯ä»¥åŒæ—¶æ‰§è¡Œå¾ªçŽ¯çš„å¤šæ¬¡è¿­ä»£ã€‚</p>
<p>è¯¥<code>dispatch_apply</code>å’Œ<code>dispatch_apply_f</code>åŠŸèƒ½æ˜¯é˜»æ­¢æ‰§è¡Œçš„å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰çš„å¾ªçŽ¯è¿­ä»£æ˜¯å®Œå…¨åŒæ­¥çš„å‡½æ•°è°ƒç”¨ã€‚å½“æäº¤åˆ°å¹¶å‘é˜Ÿåˆ—æ—¶ï¼Œä¸èƒ½ä¿è¯å¾ªçŽ¯è¿­ä»£çš„æ‰§è¡Œé¡ºåºã€‚è¿è¡Œæ¯æ¬¡è¿­ä»£çš„çº¿ç¨‹å¯èƒ½ä¼šé˜»å¡žå¹¶å¯¼è‡´ç»™å®šçš„è¿­ä»£åœ¨å…¶å‘¨å›´çš„å…¶ä»–çº¿ç¨‹ä¹‹å‰æˆ–ä¹‹åŽå®Œæˆã€‚å› æ­¤ï¼Œç”¨äºŽæ¯æ¬¡å¾ªçŽ¯è¿­ä»£çš„å—å¯¹è±¡æˆ–å‡½æ•°å¿…é¡»æ˜¯å¯é‡å…¥çš„ã€‚</p>
<p>æ¸…å• 5-3 æ˜¾ç¤ºäº†å¦‚ä½•<code>for</code>ç”¨åŸºäºŽæ´¾é£çš„ç­‰æ•ˆé¡¹æ›¿æ¢å¾ªçŽ¯ã€‚æ‚¨ä¼ é€’ç»™çš„å—æˆ–å‡½æ•°<code>dispatch_apply</code>æˆ–<code>dispatch_apply_f</code>å¿…é¡»é‡‡ç”¨æŒ‡ç¤ºå½“å‰å¾ªçŽ¯è¿­ä»£çš„æ•´æ•°å€¼ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä»£ç ä»…å°†å½“å‰å¾ªçŽ¯å·æ‰“å°åˆ°æŽ§åˆ¶å°ã€‚</p>
<p><strong>æ¸…å• 5-3</strong><code>for</code>ä¸è·¨æ­¥åœ° æ›¿æ¢å¾ªçŽ¯</p>
<table>
<thead>
<tr>
<th><code>é˜Ÿåˆ—= dispatch_get_global_queueï¼ˆDISPATCH_QUEUE_PRIORITY_DEFAULTï¼Œ0ï¼‰;</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>dispatch_applyï¼ˆcountï¼Œqueueï¼Œ^ï¼ˆsize_t iï¼‰{</code></td>
</tr>
<tr>
<td><code>printfï¼ˆâ€œï¼…u \ nâ€ï¼Œiï¼‰;</code></td>
</tr>
<tr>
<td><code>}ï¼‰;</code></td>
</tr>
</tbody></table>
<p>å°½ç®¡å‰é¢çš„ç¤ºä¾‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œä½†æ˜¯å®ƒæ¼”ç¤ºäº†ä½¿ç”¨åˆ†æ´¾é˜Ÿåˆ—æ›¿æ¢å¾ªçŽ¯çš„åŸºæœ¬æŠ€æœ¯ã€‚å°½ç®¡è¿™å¯èƒ½æ˜¯æé«˜åŸºäºŽå¾ªçŽ¯çš„ä»£ç æ€§èƒ½çš„å¥½æ–¹æ³•ï¼Œä½†ä»å¿…é¡»è°¨æ…Žåœ°ä½¿ç”¨æ­¤æŠ€æœ¯ã€‚å°½ç®¡åˆ†æ´¾é˜Ÿåˆ—çš„å¼€é”€éžå¸¸ä½Žï¼Œä½†æ˜¯åœ¨çº¿ç¨‹ä¸Šå®‰æŽ’æ¯æ¬¡å¾ªçŽ¯è¿­ä»£ä»ç„¶æœ‰æˆæœ¬ã€‚å› æ­¤ï¼Œæ‚¨åº”è¯¥ç¡®ä¿æ‚¨çš„å¾ªçŽ¯ä»£ç èƒ½å¤Ÿå®Œæˆè¶³å¤Ÿçš„å·¥ä½œä»¥ä¿è¯æˆæœ¬ã€‚æ‚¨åˆ°åº•éœ€è¦åšå¤šå°‘å·¥ä½œï¼Œè¿™æ˜¯æ‚¨å¿…é¡»ä½¿ç”¨æ€§èƒ½å·¥å…·æ¥è¡¡é‡çš„ã€‚</p>
<p>ä¸€ç§å¢žåŠ æ¯æ¬¡å¾ªçŽ¯è¿­ä»£ä¸­çš„å·¥ä½œé‡çš„ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨è·¨æ­¥ã€‚è·¨æ­¥æ—¶ï¼Œæ‚¨å¯ä»¥é‡å†™å—ä»£ç ä»¥æ‰§è¡ŒåŽŸå§‹å¾ªçŽ¯çš„å¤šæ¬¡è¿­ä»£ã€‚ç„¶åŽï¼Œæ‚¨å¯ä»¥<code>dispatch_apply</code>æŒ‰æ¯”ä¾‹å‡å°‘ä¸ºå‡½æ•°æŒ‡å®šçš„è®¡æ•°å€¼ã€‚æ¸…å• 5-4 æ˜¾ç¤ºäº†å¦‚ä½•å®žçŽ°<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/ThreadMigration/ThreadMigration.html#//apple_ref/doc/uid/TP40008091-CH105-SW5">æ¸…å• 5-3</a>æ‰€ç¤ºçš„å¾ªçŽ¯ä»£ç çš„è·¨æ­¥ã€‚åœ¨æ¸…å• 5-4 ä¸­ï¼Œè¯¥å—è°ƒç”¨è¯¥<code>printf</code>è¯­å¥çš„æ¬¡æ•°ä¸Žæ­¥å¹…å€¼çš„æ¬¡æ•°ç›¸åŒï¼Œåœ¨æœ¬ä¾‹ä¸­ä¸º 137ã€‚ï¼ˆå®žé™…æ­¥å¹…å€¼åº”æ ¹æ®ä»£ç æ‰€å®Œæˆçš„å·¥ä½œè¿›è¡Œé…ç½®ã€‚ï¼‰å½“å°†è¿­ä»£æ€»æ•°é™¤ä»¥æ­¥å¹…å€¼æ—¶ï¼Œä¼šå‰©ä¸‹ä½™æ•°ï¼Œä»»ä½•ä½™ä¸‹çš„è¿­ä»£éƒ½å°†å†…è”æ‰§è¡Œã€‚</p>
<p><strong>æ¸…å• 5-4</strong> åœ¨å·²è°ƒåº¦çš„ for å¾ªçŽ¯ä¸­æ·»åŠ è·¨æ­¥</p>
<table>
<thead>
<tr>
<th><code>å›½é™…æ­¥å¹…= 137;</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>dispatch_queue_té˜Ÿåˆ—= dispatch_get_global_queueï¼ˆDISPATCH_QUEUE_PRIORITY_DEFAULTï¼Œ0ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>dispatch_applyï¼ˆè®¡æ•°/æ­¥å¹…ï¼Œé˜Ÿåˆ—ï¼Œ^ï¼ˆsize_t idxï¼‰{</code></td>
</tr>
<tr>
<td><code>size_t j = idx *æ­¥å¹…ï¼›</code></td>
</tr>
<tr>
<td><code>size_t j_stop = j +æ­¥å¹…ï¼›</code></td>
</tr>
<tr>
<td><code>åš{</code></td>
</tr>
<tr>
<td><code>printfï¼ˆâ€œï¼…u \ nâ€ï¼Œï¼ˆunsigned intï¼‰j ++ï¼‰;</code></td>
</tr>
<tr>
<td>` }åŒæ—¶ï¼ˆj</td>
</tr>
<tr>
<td><code>}ï¼‰;</code></td>
</tr>
<tr>
<td>``</td>
</tr>
<tr>
<td><code>size_t i;</code></td>
</tr>
<tr>
<td><code>å¯¹äºŽï¼ˆi =è®¡æ•°-ï¼ˆè®¡æ•°ï¼…æ­¥å¹…ï¼‰; i &lt;è®¡æ•°; i ++ï¼‰</code></td>
</tr>
<tr>
<td><code>printfï¼ˆâ€œï¼…u \ nâ€ï¼Œï¼ˆunsigned intï¼‰iï¼‰;</code></td>
</tr>
</tbody></table>
<p>ä½¿ç”¨è·¨æ­¥æœ‰ä¸€å®šçš„æ€§èƒ½ä¼˜åŠ¿ã€‚ç‰¹åˆ«æ˜¯ï¼Œç›¸å¯¹äºŽè·¨åº¦ï¼Œå½“å¾ªçŽ¯è¿­ä»£çš„åŽŸå§‹æ•°é‡è¾ƒé«˜æ—¶ï¼Œè·¨åº¦ä¼šå¸¦æ¥å¥½å¤„ã€‚åŒæ—¶åˆ†æ´¾æ›´å°‘çš„å—æ„å‘³ç€æ¯”åˆ†æ´¾å®ƒä»¬èŠ±è´¹æ›´å¤šçš„æ—¶é—´æ¥æ‰§è¡Œé‚£äº›å—çš„ä»£ç ã€‚ä½†æ˜¯ï¼Œä¸Žä»»ä½•æ€§èƒ½æŒ‡æ ‡ä¸€æ ·ï¼Œæ‚¨å¯èƒ½å¿…é¡»ä½¿ç”¨è·¨æ­¥å€¼æ‰èƒ½æ‰¾åˆ°ä»£ç çš„æœ€æœ‰æ•ˆå€¼ã€‚</p>
<h4 id="æ›¿æ¢çº¿ç¨‹è¿žæŽ¥"><a href="#æ›¿æ¢çº¿ç¨‹è¿žæŽ¥" class="headerlink" title="æ›¿æ¢çº¿ç¨‹è¿žæŽ¥"></a>æ›¿æ¢çº¿ç¨‹è¿žæŽ¥</h4><p>çº¿ç¨‹è¿žæŽ¥å…è®¸æ‚¨ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ï¼Œç„¶åŽè®©å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°è¿™äº›çº¿ç¨‹å®Œæˆã€‚ä¸ºäº†å®žçŽ°çº¿ç¨‹è¿žæŽ¥ï¼Œçˆ¶çº§å°†å­çº¿ç¨‹åˆ›å»ºä¸º<em>å¯è¿žæŽ¥çº¿ç¨‹</em>ã€‚å¦‚æžœçˆ¶çº§åœ¨æ²¡æœ‰å­çº¿ç¨‹çš„ç»“æžœçš„æƒ…å†µä¸‹æ— æ³•å–å¾—è¿›å±•æ—¶ï¼Œå®ƒå°†ä¸Žå­çº§ä¸€èµ·åŠ å…¥ã€‚æ­¤è¿‡ç¨‹å°†é˜»å¡žçˆ¶çº¿ç¨‹ï¼Œç›´åˆ°å­çº¿ç¨‹å®Œæˆå…¶ä»»åŠ¡å¹¶é€€å‡ºä¸ºæ­¢ï¼Œæ­¤æ—¶ï¼Œçˆ¶çº¿ç¨‹å¯ä»¥ä»Žå­çº¿ç¨‹æ”¶é›†ç»“æžœå¹¶ç»§ç»­è‡ªå·±çš„å·¥ä½œã€‚å¦‚æžœçˆ¶çº§éœ€è¦ä¸Žå¤šä¸ªå­çº¿ç¨‹è”æŽ¥ï¼Œåˆ™ä¸€æ¬¡è”æŽ¥ä¸€ä¸ªã€‚</p>
<p>è°ƒåº¦ç»„æä¾›çš„è¯­ä¹‰ç±»ä¼¼äºŽçº¿ç¨‹è”æŽ¥çš„è¯­ä¹‰ï¼Œä½†å…·æœ‰ä¸€äº›å…¶ä»–ä¼˜ç‚¹ã€‚åƒçº¿ç¨‹è¿žæŽ¥ä¸€æ ·ï¼Œè°ƒåº¦ç»„æ˜¯çº¿ç¨‹é˜»å¡žç›´åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªå­ä»»åŠ¡å®Œæˆæ‰§è¡Œçš„ä¸€ç§æ–¹å¼ã€‚ä¸Žçº¿ç¨‹è¿žæŽ¥ä¸åŒï¼Œè°ƒåº¦ç»„åŒæ—¶ç­‰å¾…å…¶æ‰€æœ‰å­ä»»åŠ¡ã€‚å¹¶ä¸”ç”±äºŽè°ƒåº¦ç»„ä½¿ç”¨è°ƒåº¦é˜Ÿåˆ—æ‰§è¡Œå·¥ä½œï¼Œå› æ­¤å®ƒä»¬éžå¸¸é«˜æ•ˆã€‚</p>
<p>è¦ä½¿ç”¨è°ƒåº¦ç»„æ¥æ‰§è¡Œå¯è¿žæŽ¥çº¿ç¨‹æ‰§è¡Œçš„ç›¸åŒå·¥ä½œï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li>ä½¿ç”¨<code>dispatch_group_create</code>å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„è°ƒåº¦ç»„ã€‚</li>
<li>ä½¿ç”¨<code>dispatch_group_async</code>æˆ–<code>dispatch_group_async_f</code>å‡½æ•°å°†ä»»åŠ¡æ·»åŠ åˆ°ç»„ä¸­ã€‚æäº¤ç»™ç»„çš„æ¯ä¸ªä»»åŠ¡ä»£è¡¨æ‚¨é€šå¸¸åœ¨å¯è¿žæŽ¥çº¿ç¨‹ä¸Šæ‰§è¡Œçš„å·¥ä½œã€‚</li>
<li>å½“å½“å‰çº¿ç¨‹æ— æ³•å†è¿›è¡Œä»»ä½•è½¬å‘æ—¶ï¼Œè¯·è°ƒç”¨è¯¥<code>dispatch_group_wait</code>å‡½æ•°ä»¥ç­‰å¾…è¯¥ç»„ã€‚è¯¥åŠŸèƒ½å°†é˜»å¡žå½“å‰çº¿ç¨‹ï¼Œç›´åˆ°è¯¥ç»„ä¸­çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆæ‰§è¡Œä¸ºæ­¢ã€‚</li>
</ol>
<p>å¦‚æžœä½¿ç”¨æ“ä½œå¯¹è±¡æ¥å®žçŽ°ä»»åŠ¡ï¼Œåˆ™è¿˜å¯ä»¥ä½¿ç”¨ä¾èµ–é¡¹æ¥å®žçŽ°çº¿ç¨‹è”æŽ¥ã€‚æ— éœ€è®©çˆ¶çº¿ç¨‹ç­‰å¾…ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡å®Œæˆï¼Œæ‚¨å¯ä»¥å°†çˆ¶ä»£ç ç§»åŠ¨åˆ°æ“ä½œå¯¹è±¡ã€‚ç„¶åŽï¼Œæ‚¨å°†åœ¨çˆ¶æ“ä½œå¯¹è±¡å’Œä»»æ„æ•°é‡çš„å­æ“ä½œå¯¹è±¡ä¹‹é—´å»ºç«‹ä¾èµ–å…³ç³»ï¼Œä»¥å»ºç«‹å¯è¿žæŽ¥çº¿ç¨‹é€šå¸¸æ‰§è¡Œçš„å·¥ä½œã€‚ä¾èµ–äºŽå…¶ä»–æ“ä½œå¯¹è±¡ä¼šé˜»æ­¢çˆ¶æ“ä½œå¯¹è±¡åœ¨æ‰€æœ‰æ“ä½œå®Œæˆä¹‹å‰æ‰§è¡Œã€‚</p>
<p>æœ‰å…³å¦‚ä½•ä½¿ç”¨è°ƒåº¦ç»„çš„ç¤ºä¾‹ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW25">ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ç»„</a>ã€‚æœ‰å…³åœ¨æ“ä½œå¯¹è±¡ä¹‹é—´è®¾ç½®ä¾èµ–å…³ç³»çš„ä¿¡æ¯ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationObjects/OperationObjects.html#//apple_ref/doc/uid/TP40008091-CH101-SW17">é…ç½®äº’æ“ä½œä¾èµ–å…³ç³»</a>ã€‚</p>
<h4 id="æ›´æ”¹ç”Ÿäº§è€…-æ¶ˆè´¹è€…å®žæ–½"><a href="#æ›´æ”¹ç”Ÿäº§è€…-æ¶ˆè´¹è€…å®žæ–½" class="headerlink" title="æ›´æ”¹ç”Ÿäº§è€…-æ¶ˆè´¹è€…å®žæ–½"></a>æ›´æ”¹ç”Ÿäº§è€…-æ¶ˆè´¹è€…å®žæ–½</h4><p>ç”Ÿäº§è€…ï¼æ¶ˆè´¹è€…æ¨¡åž‹ä½¿æ‚¨å¯ä»¥ç®¡ç†æœ‰é™æ•°é‡çš„åŠ¨æ€äº§ç”Ÿçš„èµ„æºã€‚ç”Ÿäº§è€…åˆ›å»ºæ–°èµ„æºï¼ˆæˆ–å·¥ä½œï¼‰æ—¶ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆè´¹è€…ç­‰å¾…è¿™äº›èµ„æºï¼ˆæˆ–å·¥ä½œï¼‰å‡†å¤‡å°±ç»ªå¹¶åœ¨ä½¿ç”¨æ—¶æ¶ˆè´¹å®ƒä»¬ã€‚å®žçŽ°ç”Ÿäº§è€…ï¼æ¶ˆè´¹è€…æ¨¡åž‹çš„å…¸åž‹æœºåˆ¶æ˜¯æ¡ä»¶æˆ–ä¿¡å·é‡ã€‚</p>
<p>ä½¿ç”¨æ¡ä»¶ï¼Œç”Ÿäº§è€…çº¿ç¨‹é€šå¸¸æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li>é”å®šä¸Žæ¡ä»¶å…³è”çš„äº’æ–¥é”ï¼ˆä½¿ç”¨<code>pthread_mutex_lock</code>ï¼‰ã€‚</li>
<li>ç”Ÿäº§è¦æ¶ˆè€—çš„èµ„æºæˆ–å·¥ä½œã€‚</li>
<li>å‘æ¡ä»¶å˜é‡å‘å‡ºè¦æ¶ˆè€—ä¸€äº›ä¸œè¥¿çš„ä¿¡å·ï¼ˆä½¿ç”¨<code>pthread_cond_signal</code>ï¼‰</li>
<li>è§£é”äº’æ–¥é”ï¼ˆä½¿ç”¨<code>pthread_mutex_unlock</code>ï¼‰ã€‚</li>
</ol>
<p>åè¿‡æ¥ï¼Œç›¸åº”çš„ä½¿ç”¨è€…çº¿ç¨‹æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li>é”å®šä¸Žæ¡ä»¶å…³è”çš„äº’æ–¥é”ï¼ˆä½¿ç”¨<code>pthread_mutex_lock</code>ï¼‰ã€‚</li>
<li>è®¾ç½®<code>while</code>å¾ªçŽ¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š<ol>
<li>æ£€æŸ¥æ˜¯å¦ç¡®å®žæœ‰å·¥ä½œè¦åšã€‚</li>
<li>å¦‚æžœæ²¡æœ‰å·¥ä½œè¦åšï¼ˆæˆ–æ²¡æœ‰å¯ç”¨èµ„æºï¼‰ï¼Œè¯·è°ƒç”¨<code>pthread_cond_wait</code>ä»¥é˜»å¡žå½“å‰çº¿ç¨‹ï¼Œç›´åˆ°å‡ºçŽ°ç›¸åº”çš„ä¿¡å·ä¸ºæ­¢ã€‚</li>
</ol>
</li>
<li>èŽ·å–åˆ¶ä½œäººæä¾›çš„ä½œå“ï¼ˆæˆ–èµ„æºï¼‰ã€‚</li>
<li>è§£é”äº’æ–¥é”ï¼ˆä½¿ç”¨<code>pthread_mutex_unlock</code>ï¼‰ã€‚</li>
<li>å¤„ç†å·¥ä½œã€‚</li>
</ol>
<p>ä½¿ç”¨è°ƒåº¦é˜Ÿåˆ—ï¼Œæ‚¨å¯ä»¥å°†ç”Ÿäº§è€…å’Œä½¿ç”¨è€…å®žçŽ°ç®€åŒ–ä¸ºä¸€ä¸ªè°ƒç”¨ï¼š</p>
<table>
<thead>
<tr>
<th><code>dispatch_asyncï¼ˆqueueï¼Œ^ {</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>//å¤„ç†å·¥ä½œé¡¹ã€‚</code></td>
</tr>
<tr>
<td><code>}ï¼‰;</code></td>
</tr>
</tbody></table>
<p>å½“æ‚¨çš„ç”Ÿäº§è€…æœ‰å·¥ä½œè¦åšæ—¶ï¼Œå®ƒè¦åšçš„å°±æ˜¯å°†å·¥ä½œæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¹¶è®©é˜Ÿåˆ—å¤„ç†è¯¥é¡¹ç›®ã€‚å‰é¢ä»£ç ä¸­å”¯ä¸€æ›´æ”¹çš„éƒ¨åˆ†æ˜¯é˜Ÿåˆ—ç±»åž‹ã€‚å¦‚æžœç”Ÿäº§è€…ç”Ÿæˆçš„ä»»åŠ¡éœ€è¦æŒ‰ç‰¹å®šé¡ºåºæ‰§è¡Œï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä¸²è¡Œé˜Ÿåˆ—ã€‚å¦‚æžœç”Ÿäº§è€…ç”Ÿæˆçš„ä»»åŠ¡å¯ä»¥åŒæ—¶æ‰§è¡Œï¼Œåˆ™å¯ä»¥å°†å®ƒä»¬æ·»åŠ åˆ°å¹¶å‘é˜Ÿåˆ—ä¸­ï¼Œå¹¶è®©ç³»ç»ŸåŒæ—¶æ‰§è¡Œå°½å¯èƒ½å¤šçš„ä»»åŠ¡ã€‚</p>
<h4 id="æ›¿æ¢ä¿¡å·é‡ä»£ç "><a href="#æ›¿æ¢ä¿¡å·é‡ä»£ç " class="headerlink" title="æ›¿æ¢ä¿¡å·é‡ä»£ç "></a>æ›¿æ¢ä¿¡å·é‡ä»£ç </h4><p>å¦‚æžœå½“å‰æ­£åœ¨ä½¿ç”¨ä¿¡å·é‡æ¥é™åˆ¶å¯¹å…±äº«èµ„æºçš„è®¿é—®ï¼Œåˆ™åº”è€ƒè™‘ä½¿ç”¨è°ƒåº¦ä¿¡å·é‡ã€‚ä¼ ç»Ÿçš„ä¿¡å·é‡å§‹ç»ˆè¦æ±‚è°ƒç”¨å†…æ ¸æ¥æµ‹è¯•ä¿¡å·é‡ã€‚ç›¸åï¼Œè°ƒåº¦ä¿¡å·é‡ä¼šåœ¨ç”¨æˆ·ç©ºé—´ä¸­å¿«é€Ÿæµ‹è¯•ä¿¡å·é‡çŠ¶æ€ï¼Œå¹¶ä»…åœ¨æµ‹è¯•å¤±è´¥å¹¶ä¸”éœ€è¦é˜»å¡žè°ƒç”¨çº¿ç¨‹æ—¶æ‰æ•èŽ·åˆ°å†…æ ¸ä¸­ã€‚è¿™ç§æƒ…å†µå¯¼è‡´åœ¨æ²¡æœ‰äº‰è®®çš„æƒ…å†µä¸‹ï¼Œè°ƒåº¦ä¿¡å·é‡æ¯”ä¼ ç»Ÿä¿¡å·é‡å¿«å¾—å¤šã€‚ä½†æ˜¯ï¼Œåœ¨æ‰€æœ‰å…¶ä»–æ–¹é¢ï¼Œè°ƒåº¦ä¿¡å·é‡æä¾›çš„è¡Œä¸ºä¸Žä¼ ç»Ÿä¿¡å·é‡ç›¸åŒã€‚</p>
<p>æœ‰å…³å¦‚ä½•ä½¿ç”¨è°ƒåº¦ä¿¡å·é‡çš„ç¤ºä¾‹ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW24">ä½¿ç”¨è°ƒåº¦ä¿¡å·é‡æ¥è°ƒèŠ‚æœ‰é™èµ„æºçš„ä½¿ç”¨</a>ã€‚</p>
<h4 id="æ›¿æ¢è¿è¡Œå¾ªçŽ¯ä»£ç "><a href="#æ›¿æ¢è¿è¡Œå¾ªçŽ¯ä»£ç " class="headerlink" title="æ›¿æ¢è¿è¡Œå¾ªçŽ¯ä»£ç "></a>æ›¿æ¢è¿è¡Œå¾ªçŽ¯ä»£ç </h4><p>å¦‚æžœæ‚¨ä½¿ç”¨è¿è¡Œå¾ªçŽ¯æ¥ç®¡ç†åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œçš„å·¥ä½œï¼Œåˆ™å¯èƒ½ä¼šå‘çŽ°é˜Ÿåˆ—çš„å®žçŽ°å’Œç»´æŠ¤æ›´åŠ ç®€å•ã€‚è®¾ç½®è‡ªå®šä¹‰è¿è¡Œå¾ªçŽ¯æ¶‰åŠè®¾ç½®åŸºç¡€çº¿ç¨‹å’Œè¿è¡Œå¾ªçŽ¯æœ¬èº«ã€‚è¿è¡Œå¾ªçŽ¯ä»£ç åŒ…æ‹¬è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªè¿è¡Œå¾ªçŽ¯æºä»¥åŠç¼–å†™å›žè°ƒä»¥å¤„ç†åˆ°è¾¾è¿™äº›æºçš„äº‹ä»¶ã€‚é™¤äº†å®Œæˆæ‰€æœ‰å·¥ä½œä¹‹å¤–ï¼Œæ‚¨åªéœ€åˆ›å»ºä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—å¹¶å°†ä»»åŠ¡åˆ†æ´¾ç»™å®ƒå³å¯ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥ç”¨ä¸€è¡Œä»£ç æ›¿æ¢æ‰€æœ‰çº¿ç¨‹å’Œè¿è¡Œå¾ªçŽ¯åˆ›å»ºä»£ç ï¼š</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch_queue_t myNewRunLoop = dispatch_queue_createï¼ˆâ€œ com.apple.MyQueueâ€ï¼ŒNULLï¼‰;</span><br></pre></td></tr></tbody></table></figure>

<p>å› ä¸ºé˜Ÿåˆ—è‡ªåŠ¨æ‰§è¡Œæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ä»»åŠ¡ï¼Œæ‰€ä»¥ä¸éœ€è¦é¢å¤–çš„ä»£ç æ¥ç®¡ç†é˜Ÿåˆ—ã€‚æ‚¨ä¸å¿…åˆ›å»ºæˆ–é…ç½®çº¿ç¨‹ï¼Œä¹Ÿä¸å¿…åˆ›å»ºæˆ–é™„åŠ ä»»ä½•è¿è¡Œå¾ªçŽ¯æºã€‚æ­¤å¤–ï¼Œæ‚¨åªéœ€åœ¨é˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡å³å¯æ‰§è¡Œæ–°çš„å·¥ä½œç±»åž‹ã€‚è¦å¯¹è¿è¡Œå¾ªçŽ¯æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œæ‚¨å°†éœ€è¦ä¿®æ”¹çŽ°æœ‰çš„è¿è¡Œå¾ªçŽ¯æºæˆ–åˆ›å»ºä¸€ä¸ªæ–°çš„æºæ¥å¤„ç†æ–°æ•°æ®ã€‚</p>
<p>è¿è¡Œå¾ªçŽ¯çš„ä¸€ç§å¸¸è§é…ç½®æ˜¯å¤„ç†å¼‚æ­¥åˆ°è¾¾ç½‘ç»œå¥—æŽ¥å­—çš„æ•°æ®ã€‚æ‚¨å¯ä»¥å°†è°ƒåº¦æºé™„åŠ åˆ°æ‰€éœ€çš„é˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯ä¸ºæ­¤ç±»åž‹çš„è¡Œä¸ºé…ç½®è¿è¡Œå¾ªçŽ¯ã€‚ä¸Žä¼ ç»Ÿçš„è¿è¡Œå¾ªçŽ¯æºç›¸æ¯”ï¼Œè°ƒåº¦æºè¿˜æä¾›äº†æ›´å¤šçš„æ•°æ®å¤„ç†é€‰é¡¹ã€‚é™¤äº†å¤„ç†è®¡æ—¶å™¨å’Œç½‘ç»œç«¯å£äº‹ä»¶ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨è°ƒåº¦æºæ¥è¯»å–å’Œå†™å…¥æ–‡ä»¶ï¼Œç›‘è§†æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡ï¼Œç›‘è§†è¿›ç¨‹å’Œç›‘è§†ä¿¡å·ã€‚æ‚¨ç”šè‡³å¯ä»¥å®šä¹‰è‡ªå®šä¹‰è°ƒåº¦æºï¼Œå¹¶ä»Žä»£ç çš„å…¶ä»–éƒ¨åˆ†å¼‚æ­¥è§¦å‘å®ƒä»¬ã€‚æœ‰å…³è®¾ç½®è°ƒåº¦æºçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW1">è°ƒåº¦æº</a>ã€‚</p>
<h4 id="ä¸Ž-POSIX-çº¿ç¨‹çš„å…¼å®¹æ€§"><a href="#ä¸Ž-POSIX-çº¿ç¨‹çš„å…¼å®¹æ€§" class="headerlink" title="ä¸Ž POSIX çº¿ç¨‹çš„å…¼å®¹æ€§"></a>ä¸Ž POSIX çº¿ç¨‹çš„å…¼å®¹æ€§</h4><p>å› ä¸º Grand Central Dispatch ç®¡ç†ç€æ‚¨æä¾›çš„ä»»åŠ¡å’Œè¿è¡Œè¿™äº›ä»»åŠ¡çš„çº¿ç¨‹ä¹‹é—´çš„å…³ç³»ï¼Œæ‰€ä»¥é€šå¸¸åº”è¯¥é¿å…ä»Žä»»åŠ¡ä»£ç ä¸­è°ƒç”¨ POSIX çº¿ç¨‹ä¾‹ç¨‹ã€‚å¦‚æžœç¡®å®žç”±äºŽæŸç§åŽŸå› éœ€è¦è°ƒç”¨å®ƒä»¬ï¼Œåˆ™åº”éžå¸¸è°¨æ…Žåœ°è°ƒç”¨å“ªäº›ä¾‹ç¨‹ã€‚æœ¬èŠ‚å‘æ‚¨è¯´æ˜Žåœ¨æŽ’é˜Ÿçš„ä»»åŠ¡ä¸­å“ªäº›ä¾‹ç¨‹å¯ä»¥å®‰å…¨è°ƒç”¨ï¼Œå“ªäº›ä¾‹ç¨‹ä¸å®‰å…¨ã€‚è¯¥åˆ—è¡¨å¹¶ä¸å®Œæ•´ï¼Œä½†æ˜¯åº”è¯¥å‘Šè¯‰æ‚¨ä»€ä¹ˆæ˜¯å®‰å…¨çš„ï¼Œä»€ä¹ˆä¸æ˜¯ã€‚</p>
<p>é€šå¸¸ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºä¸å¾—åˆ é™¤æˆ–å˜å¼‚æœªåˆ›å»ºçš„å¯¹è±¡æˆ–æ•°æ®ç»“æž„ã€‚å› æ­¤ï¼Œä½¿ç”¨åˆ†æ´¾é˜Ÿåˆ—æ‰§è¡Œçš„å—å¯¹è±¡ä¸å¾—è°ƒç”¨ä»¥ä¸‹å‡½æ•°ï¼š</p>
<ul>
<li><code>pthread_detach</code></li>
<li><code>pthread_cancel</code></li>
<li><code>pthread_join</code></li>
<li><code>pthread_kill</code></li>
<li><code>pthread_exit</code></li>
</ul>
<p>å°½ç®¡å¯ä»¥åœ¨ä»»åŠ¡è¿è¡Œæ—¶ä¿®æ”¹çº¿ç¨‹çš„çŠ¶æ€ï¼Œä½†æ˜¯å¿…é¡»åœ¨ä»»åŠ¡è¿”å›žä¹‹å‰å°†çº¿ç¨‹è¿”å›žåˆ°å…¶åŽŸå§‹çŠ¶æ€ã€‚å› æ­¤ï¼Œåªè¦å°†çº¿ç¨‹è¿”å›žåˆ°å…¶åŽŸå§‹çŠ¶æ€ï¼Œå°±å¯ä»¥å®‰å…¨åœ°è°ƒç”¨ä»¥ä¸‹å‡½æ•°ï¼š</p>
<ul>
<li><code>pthread_setcancelstate</code></li>
<li><code>pthread_setcanceltype</code></li>
<li><code>pthread_setschedparam</code></li>
<li><code>pthread_sigmask</code></li>
<li><code>pthread_setspecific</code></li>
</ul>
<p>ç”¨äºŽæ‰§è¡Œç»™å®šå—çš„åŸºç¡€çº¿ç¨‹å¯ä»¥åœ¨è°ƒç”¨ä¹‹é—´å˜åŒ–ã€‚å› æ­¤ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºä¸åº”ä¾èµ–ä»¥ä¸‹å‡½æ•°ï¼Œè¿™äº›å‡½æ•°åœ¨å—è°ƒç”¨ä¹‹é—´è¿”å›žå¯é¢„æµ‹çš„ç»“æžœï¼š</p>
<ul>
<li><code>pthread_self</code></li>
<li><code>pthread_getschedparam</code></li>
<li><code>pthread_get_stacksize_np</code></li>
<li><code>pthread_get_stackaddr_np</code></li>
<li><code>pthread_mach_thread_np</code></li>
<li><code>pthread_from_mach_thread_np</code></li>
<li><code>pthread_getspecific</code></li>
</ul>
<p><strong>é‡è¦æç¤ºï¼š</strong> å—å¿…é¡»æ•èŽ·å¹¶æŠ‘åˆ¶å…¶ä¸­æŠ›å‡ºçš„ä»»ä½•è¯­è¨€çº§å¼‚å¸¸ã€‚åœ¨æ‰§è¡Œå—æœŸé—´å‘ç”Ÿçš„å…¶ä»–é”™è¯¯åº”ç±»ä¼¼åœ°ç”±è¯¥å—å¤„ç†æˆ–ç”¨äºŽé€šçŸ¥åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ã€‚</p>
<h2 id="è¯æ±‡è¡¨"><a href="#è¯æ±‡è¡¨" class="headerlink" title="è¯æ±‡è¡¨"></a>è¯æ±‡è¡¨</h2><ul>
<li>åº”ç”¨</li>
</ul>
<p>ä¸€ç§ç‰¹å®šçš„<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Glossary/Glossary.html#//apple_ref/doc/uid/TP40008091-CH104-SW13">ç¨‹åº</a>æ ·å¼ï¼Œå‘ç”¨æˆ·æ˜¾ç¤ºå›¾å½¢ç•Œé¢ã€‚</p>
<ul>
<li>å¼‚æ­¥è®¾è®¡æ–¹æ³•</li>
</ul>
<p>å›´ç»•å¯ä»¥ä¸Žåº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹æˆ–å…¶ä»–æ‰§è¡Œçº¿ç¨‹åŒæ—¶è¿è¡Œçš„ä»£ç å—ç»„ç»‡åº”ç”¨ç¨‹åºçš„åŽŸç†ã€‚å¼‚æ­¥ä»»åŠ¡ç”±ä¸€ä¸ªçº¿ç¨‹å¯åŠ¨ï¼Œä½†å®žé™…ä¸Šåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸Šè¿è¡Œï¼Œä»Žè€Œåˆ©ç”¨äº†é¢å¤–çš„å¤„ç†å™¨èµ„æºæ¥æ›´å¿«åœ°å®Œæˆå…¶å·¥ä½œã€‚</p>
<ul>
<li>å—å¯¹è±¡</li>
</ul>
<p>ä¸€ä¸ª AC ç»“æž„ï¼Œç”¨äºŽå°è£…å†…è”ä»£ç å’Œæ•°æ®ï¼Œä»¥ä¾¿ä»¥åŽå¯ä»¥æ‰§è¡Œã€‚æ‚¨å¯ä»¥ä½¿ç”¨å—æ¥å°è£…è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡å¯ä»¥å†…è”åœ¨å½“å‰çº¿ç¨‹ä¸­ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åˆ†æ´¾é˜Ÿåˆ—åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§*<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Blocks/Articles/00_Introduction.html#//apple_ref/doc/uid/TP40007502">å—ç¼–ç¨‹ä¸»é¢˜</a>*ã€‚</p>
<ul>
<li>å¹¶å‘æ“ä½œ</li>
</ul>
<p><code>start</code>åœ¨è°ƒç”¨å…¶æ–¹æ³•çš„çº¿ç¨‹ä¸­æœªæ‰§è¡Œå…¶ä»»åŠ¡çš„æ“ä½œå¯¹è±¡ã€‚å¹¶å‘æ“ä½œé€šå¸¸ä¼šå»ºç«‹è‡ªå·±çš„çº¿ç¨‹æˆ–è°ƒç”¨ä¸€ä¸ªæŽ¥å£ï¼Œè¯¥æŽ¥å£ä¼šå»ºç«‹ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥æ‰§è¡Œå·¥ä½œã€‚</p>
<ul>
<li>å¥åº·ï¼‰çŠ¶å†µ</li>
</ul>
<p>ç”¨äºŽåŒæ­¥å¯¹èµ„æºçš„è®¿é—®çš„æž„é€ ã€‚åœ¨å…¶ä»–æ¡ä»¶æ˜Žç¡®æŒ‡ç¤ºæ¡ä»¶ä¹‹å‰ï¼Œä¸å…è®¸ç­‰å¾…æ¡ä»¶çš„çº¿ç¨‹ç»§ç»­è¿›è¡Œã€‚</p>
<ul>
<li>å…³é”®éƒ¨åˆ†</li>
</ul>
<p>ä¸€æ¬¡åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œçš„ä¸€éƒ¨åˆ†ä»£ç ã€‚</p>
<ul>
<li>è‡ªè®¢æ¥æº</li>
</ul>
<p>ç”²<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Glossary/Glossary.html#//apple_ref/doc/uid/TP40008091-CH104-SW19">è°ƒåº¦æº</a>ç”¨äºŽè¿‡ç¨‹åº”ç”¨å®šä¹‰çš„äº‹ä»¶ã€‚å®šåˆ¶æºè°ƒç”¨å®šåˆ¶äº‹ä»¶å¤„ç†ç¨‹åºä»¥å“åº”åº”ç”¨ç¨‹åºç”Ÿæˆçš„äº‹ä»¶ã€‚</p>
<ul>
<li>æè¿°ç¬¦</li>
</ul>
<p>ç”¨äºŽè®¿é—®æ–‡ä»¶ï¼Œå¥—æŽ¥å­—æˆ–å…¶ä»–ç³»ç»Ÿèµ„æºçš„æŠ½è±¡æ ‡è¯†ç¬¦ã€‚</p>
<ul>
<li>è°ƒåº¦é˜Ÿåˆ—</li>
</ul>
<p>æ‚¨ç”¨äºŽæ‰§è¡Œåº”ç”¨ç¨‹åºä»»åŠ¡çš„<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Glossary/Glossary.html#//apple_ref/doc/uid/TP40008091-CH104-SW23">Grand Central Dispatchï¼ˆGCDï¼‰</a>ç»“æž„ã€‚GCD å®šä¹‰äº†åˆ†æ´¾é˜Ÿåˆ—ä»¥ä¸²è¡Œæˆ–å¹¶è¡Œæ‰§è¡Œä»»åŠ¡ã€‚</p>
<ul>
<li>æ´¾é£æº</li>
</ul>
<p>æ‚¨åˆ›å»ºçš„ç”¨æ¥å¤„ç†ä¸Žç³»ç»Ÿç›¸å…³çš„äº‹ä»¶çš„<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Glossary/Glossary.html#//apple_ref/doc/uid/TP40008091-CH104-SW23">Grand Central Dispatchï¼ˆGCDï¼‰</a>æ•°æ®ç»“æž„ã€‚</p>
<ul>
<li>æè¿°ç¬¦åˆ†å‘æº</li>
</ul>
<p>ä¸€ä¸ª<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Glossary/Glossary.html#//apple_ref/doc/uid/TP40008091-CH104-SW19">è°ƒåº¦æº</a>ç”¨æ¥å¤„ç†æ–‡ä»¶ç›¸å…³çš„äº‹ä»¶ã€‚å½“æ–‡ä»¶æ•°æ®å¯ç”¨äºŽè¯»å–æˆ–å†™å…¥æˆ–å“åº”æ–‡ä»¶ç³»ç»Ÿæ›´æ”¹æ—¶ï¼Œæ–‡ä»¶æè¿°ç¬¦æºå°†è°ƒç”¨æ‚¨çš„è‡ªå®šä¹‰äº‹ä»¶å¤„ç†ç¨‹åºã€‚</p>
<ul>
<li>åŠ¨æ€å…±äº«åº“</li>
</ul>
<p>äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¯åŠ¨æ€åŠ è½½åˆ°åº”ç”¨ç¨‹åºçš„è¿›ç¨‹ç©ºé—´ä¸­ï¼Œè€Œä¸æ˜¯ä½œä¸ºåº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶çš„ä¸€éƒ¨åˆ†é™æ€é“¾æŽ¥ã€‚</p>
<ul>
<li>æž„æž¶</li>
</ul>
<p>ä¸€ç§æ†ç»‘åŒ…ï¼Œå®ƒå°†åŠ¨æ€å…±äº«åº“ä¸Žæ”¯æŒè¯¥åº“çš„èµ„æºå’Œå¤´æ–‡ä»¶æ‰“åŒ…åœ¨ä¸€èµ·ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ã€Š_<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPFrameworks/Frameworks.html#//apple_ref/doc/uid/10000183i">Framework ç¼–ç¨‹æŒ‡å—ã€‹</a>_ã€‚</p>
<ul>
<li>å…¨å±€è°ƒåº¦é˜Ÿåˆ—</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Glossary/Glossary.html#//apple_ref/doc/uid/TP40008091-CH104-SW23">Grand Central Dispatchï¼ˆGCDï¼‰</a>è‡ªåŠ¨ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæä¾›ä¸€ä¸ª<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Glossary/Glossary.html#//apple_ref/doc/uid/TP40008091-CH104-SW9">è°ƒåº¦é˜Ÿåˆ—</a>ã€‚æ‚¨ä¸å¿…è‡ªå·±åˆ›å»ºå…¨å±€é˜Ÿåˆ—ï¼Œä¹Ÿä¸å¿…ä¿ç•™æˆ–é‡Šæ”¾å®ƒä»¬ã€‚è€Œæ˜¯ä½¿ç”¨ç³»ç»Ÿæä¾›çš„åŠŸèƒ½æ£€ç´¢å®ƒä»¬ã€‚</p>
<ul>
<li>å¤§ä¸­å¤®æ´¾é£ï¼ˆGCDï¼‰</li>
</ul>
<p>åŒæ—¶æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡çš„æŠ€æœ¯ã€‚GCD åœ¨ OS X v10.6 å’Œæ›´é«˜ç‰ˆæœ¬ä»¥åŠ iOS 4.0 å’Œæ›´é«˜ç‰ˆæœ¬ä¸­å¯ç”¨ã€‚</p>
<ul>
<li>è¾“å…¥æº</li>
</ul>
<p>çº¿ç¨‹çš„å¼‚æ­¥äº‹ä»¶çš„æºã€‚è¾“å…¥æºå¯ä»¥åŸºäºŽç«¯å£ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨è§¦å‘ï¼Œå¹¶ä¸”å¿…é¡»é™„åŠ åˆ°çº¿ç¨‹çš„è¿è¡Œå¾ªçŽ¯ä¸­ã€‚</p>
<ul>
<li>å¯è¿žæŽ¥çº¿ç¨‹</li>
</ul>
<p>ç»ˆæ­¢åŽä¸ä¼šç«‹å³å›žæ”¶å…¶èµ„æºçš„çº¿ç¨‹ã€‚å¿…é¡»å…ˆæ˜¾å¼åœ°åˆ†ç¦»å¯è¿žæŽ¥çº¿ç¨‹ï¼Œå¦åˆ™å¿…é¡»ç”±å¦ä¸€ä¸ªçº¿ç¨‹å°†å…¶è¿žæŽ¥ï¼Œæ‰èƒ½å›žæ”¶èµ„æºã€‚å¯è¿žæŽ¥çº¿ç¨‹ä¸ºä¸Žå®ƒä»¬è¿žæŽ¥çš„çº¿ç¨‹æä¾›è¿”å›žå€¼ã€‚</p>
<ul>
<li>å›¾ä¹¦é¦†</li>
</ul>
<p>ç”¨äºŽç›‘è§†ä½Žçº§ç³»ç»Ÿäº‹ä»¶çš„ UNIX åŠŸèƒ½ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ <code>kqueue</code>æ‰‹å†Œé¡µã€‚</p>
<ul>
<li>é©¬èµ«æ¸¯è°ƒåº¦æº</li>
</ul>
<p>ä¸€ä¸ª<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Glossary/Glossary.html#//apple_ref/doc/uid/TP40008091-CH104-SW19">è°ƒåº¦æº</a>ç”¨æ¥åˆ°è¾¾ä¸€ä¸ª Mach ç«¯å£ä¸Šå¤„ç†äº‹ä»¶ã€‚</p>
<ul>
<li>ä¸»çº¿</li>
</ul>
<p>åˆ›å»ºå…¶æ‹¥æœ‰è¿›ç¨‹æ—¶åˆ›å»ºçš„ä¸€ç§ç‰¹æ®Šç±»åž‹çš„<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Glossary/Glossary.html#//apple_ref/doc/uid/TP40008091-CH104-SW1">çº¿ç¨‹</a>ã€‚å½“ç¨‹åºçš„ä¸»çº¿ç¨‹é€€å‡ºæ—¶ï¼Œè¯¥è¿‡ç¨‹ç»“æŸã€‚</p>
<ul>
<li>äº’æ–¥ä½“</li>
</ul>
<p>æä¾›äº’æ–¥è®¿é—®å…±äº«èµ„æºçš„é”ã€‚äº’æ–¥é”ä¸€æ¬¡åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€‚å°è¯•èŽ·å–ç”±å…¶ä»–çº¿ç¨‹æŒæœ‰çš„äº’æ–¥é”ä¼šä½¿å½“å‰çº¿ç¨‹è¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œç›´åˆ°æœ€ç»ˆèŽ·å–è¯¥é”ä¸ºæ­¢ã€‚</p>
<ul>
<li>å¼€æ”¾è®¡ç®—è¯­è¨€ï¼ˆOpenCLï¼‰</li>
</ul>
<p>ä¸€ç§åŸºäºŽæ ‡å‡†çš„æŠ€æœ¯ï¼Œç”¨äºŽåœ¨è®¡ç®—æœºçš„å›¾å½¢å¤„ç†å™¨ä¸Šæ‰§è¡Œé€šç”¨è®¡ç®—ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…*<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Performance/Conceptual/OpenCL_MacProgGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40008312">ã€Š Mac ç‰ˆ OpenCL ç¼–ç¨‹æŒ‡å—ã€‹</a>*ã€‚</p>
<ul>
<li>æ“ä½œå¯¹è±¡</li>
</ul>
<p><code>NSOperation</code>ç±»çš„å®žä¾‹ã€‚æ“ä½œå¯¹è±¡å°†ä¸Žä»»åŠ¡å…³è”çš„ä»£ç å’Œæ•°æ®åŒ…è£…åˆ°å¯æ‰§è¡Œå•å…ƒä¸­ã€‚</p>
<ul>
<li>æ“ä½œé˜Ÿåˆ—</li>
</ul>
<p><code>NSOperationQueue</code>ç±»çš„å®žä¾‹ã€‚æ“ä½œé˜Ÿåˆ—ç®¡ç†æ“ä½œå¯¹è±¡çš„æ‰§è¡Œã€‚</p>
<ul>
<li>ç§äººè°ƒåº¦é˜Ÿåˆ—</li>
</ul>
<p>ä¸€ä¸ª<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Glossary/Glossary.html#//apple_ref/doc/uid/TP40008091-CH104-SW9">è°ƒåº¦é˜Ÿåˆ—</a>æ‚¨åˆ›å»ºï¼Œä¿å­˜ï¼Œå¹¶æ˜Žç¡®é‡Šæ”¾ã€‚</p>
<ul>
<li>å¤„ç†</li>
</ul>
<p>åº”ç”¨ç¨‹åºæˆ–ç¨‹åºçš„è¿è¡Œæ—¶å®žä¾‹ã€‚è¿›ç¨‹å…·æœ‰è‡ªå·±çš„è™šæ‹Ÿå†…å­˜ç©ºé—´å’Œç³»ç»Ÿèµ„æºï¼ˆåŒ…æ‹¬ç«¯å£æƒé™ï¼‰ï¼Œä¸Žåˆ†é…ç»™å…¶ä»–ç¨‹åºçš„èµ„æºæ— å…³ã€‚ä¸€ä¸ªè¿›ç¨‹å§‹ç»ˆè‡³å°‘åŒ…å«ä¸€ä¸ªçº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„é™„åŠ çº¿ç¨‹ã€‚</p>
<ul>
<li>æµç¨‹è°ƒåº¦æº</li>
</ul>
<p>ä¸€ä¸ª<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Glossary/Glossary.html#//apple_ref/doc/uid/TP40008091-CH104-SW19">è°ƒåº¦æº</a>ç”¨äºŽå¤„ç†è¿›ç¨‹ç›¸å…³çš„äº‹ä»¶ã€‚æµç¨‹æºè°ƒç”¨æ‚¨çš„è‡ªå®šä¹‰äº‹ä»¶å¤„ç†ç¨‹åºï¼Œä»¥å“åº”å¯¹æŒ‡å®šæµç¨‹çš„æ›´æ”¹ã€‚</p>
<ul>
<li>ç¨‹åº</li>
</ul>
<p>å¯ä»¥è¿è¡Œä»£ç å’Œèµ„æºä»¥æ‰§è¡ŒæŸäº›ä»»åŠ¡çš„ç»„åˆã€‚ç¨‹åºæ— éœ€å…·æœ‰å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼Œå°½ç®¡å›¾å½¢åº”ç”¨ç¨‹åºä¹Ÿè¢«è§†ä¸ºç¨‹åºã€‚</p>
<ul>
<li>å¯æŠ˜è¿”</li>
</ul>
<p>å·²ç»åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸Šè¿è¡Œçš„æ–°çº¿ç¨‹ä¸Šå¯ä»¥å®‰å…¨åœ°å¯åŠ¨çš„ä»£ç ã€‚</p>
<ul>
<li>è¿è¡Œå¾ªçŽ¯</li>
</ul>
<p>äº‹ä»¶å¤„ç†å¾ªçŽ¯ï¼Œåœ¨æ­¤å¾ªçŽ¯ä¸­ï¼Œäº‹ä»¶è¢«æŽ¥æ”¶å¹¶è°ƒåº¦åˆ°é€‚å½“çš„å¤„ç†ç¨‹åºã€‚</p>
<ul>
<li>è¿è¡Œå¾ªçŽ¯æ¨¡å¼</li>
</ul>
<p>ä¸Žç‰¹å®šåç§°å…³è”çš„è¾“å…¥æºï¼Œè®¡æ—¶å™¨æºå’Œè¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨çš„é›†åˆã€‚å½“ä»¥ç‰¹å®šçš„â€œæ¨¡å¼â€è¿è¡Œæ—¶ï¼Œè¿è¡Œå¾ªçŽ¯ä»…ç›‘è§†ä¸Žè¯¥æ¨¡å¼å…³è”çš„æºå’Œè§‚å¯Ÿè€…ã€‚</p>
<ul>
<li>è¿è¡Œå¾ªçŽ¯å¯¹è±¡</li>
</ul>
<p><code>NSRunLoop</code>ç±»æˆ–<code>CFRunLoopRef</code>ä¸é€æ˜Žç±»åž‹çš„å®žä¾‹ã€‚è¿™äº›å¯¹è±¡æä¾›äº†ç”¨äºŽåœ¨çº¿ç¨‹ä¸­å®žçŽ°äº‹ä»¶å¤„ç†å¾ªçŽ¯çš„æŽ¥å£ã€‚</p>
<ul>
<li>è¿è¡Œå¾ªçŽ¯è§‚å¯Ÿå™¨</li>
</ul>
<p>è¿è¡Œå¾ªçŽ¯æ‰§è¡Œçš„ä¸åŒé˜¶æ®µä¸­çš„é€šçŸ¥çš„æŽ¥æ”¶è€…ã€‚</p>
<ul>
<li>ä¿¡å·</li>
</ul>
<p>å—ä¿æŠ¤çš„å˜é‡ï¼Œç”¨äºŽé™åˆ¶å¯¹å…±äº«èµ„æºçš„è®¿é—®ã€‚äº’æ–¥é‡å’Œæ¡ä»¶éƒ½æ˜¯ä¿¡å·ç¯çš„ä¸åŒç±»åž‹ã€‚</p>
<ul>
<li>ä¿¡å·</li>
</ul>
<p>ä¸€ç§ç”¨äºŽä»Žå…¶åŸŸå¤–éƒ¨æ“çºµè¿›ç¨‹çš„ UNIX æœºåˆ¶ã€‚ç³»ç»Ÿä½¿ç”¨ä¿¡å·å°†é‡è¦æ¶ˆæ¯ä¼ é€’ç»™åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚åº”ç”¨ç¨‹åºæ˜¯å¦æ‰§è¡Œäº†éžæ³•æŒ‡ä»¤ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<code>signal</code>æ‰‹å†Œé¡µã€‚</p>
<ul>
<li>ä¿¡å·åˆ†é…æº</li>
</ul>
<p>ç”²<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Glossary/Glossary.html#//apple_ref/doc/uid/TP40008091-CH104-SW19">è°ƒåº¦æº</a>ç”¨äºŽå¤„ç† UNIX ä¿¡å·ã€‚æ¯å½“è¿›ç¨‹æ”¶åˆ° UNIX ä¿¡å·æ—¶ï¼Œä¿¡å·æºå°±ä¼šè°ƒç”¨æ‚¨çš„è‡ªå®šä¹‰äº‹ä»¶å¤„ç†ç¨‹åºã€‚</p>
<ul>
<li>ä»»åŠ¡</li>
</ul>
<p>è¦æ‰§è¡Œçš„å·¥ä½œé‡ã€‚å°½ç®¡æŸäº›æŠ€æœ¯ï¼ˆæœ€è‘—åçš„æ˜¯ Carbon Multiprocessing Servicesï¼‰ä»¥ä¸åŒçš„æ–¹å¼ä½¿ç”¨è¯¥æœ¯è¯­ï¼Œä½†é¦–é€‰ç”¨æ³•æ˜¯ä½œä¸ºæŠ½è±¡æ¦‚å¿µï¼ŒæŒ‡ç¤ºè¦æ‰§è¡Œçš„å·¥ä½œé‡ã€‚</p>
<ul>
<li>çº¿</li>
</ul>
<p>æµç¨‹ä¸­çš„æ‰§è¡Œæµç¨‹ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å †æ ˆç©ºé—´ï¼Œä½†åœ¨åŒä¸€è¿›ç¨‹ä¸­ä¸Žå…¶ä»–çº¿ç¨‹å…±äº«å†…å­˜ã€‚</p>
<ul>
<li>è®¡æ—¶å™¨è°ƒåº¦æº</li>
</ul>
<p>ä¸€ä¸ª<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Glossary/Glossary.html#//apple_ref/doc/uid/TP40008091-CH104-SW19">è°ƒåº¦æº</a>ç”¨äºŽå¤„ç†å‘¨æœŸæ€§äº‹ä»¶ã€‚è®¡æ—¶å™¨æºä¼šå®šæœŸï¼ˆåŸºäºŽæ—¶é—´ï¼‰è°ƒç”¨è‡ªå®šä¹‰äº‹ä»¶å¤„ç†ç¨‹åºã€‚</p>
<p>æœ‰å…³ POSIX çº¿ç¨‹å’Œæœ¬èŠ‚ä¸­æåˆ°çš„åŠŸèƒ½çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<code>pthread</code>æ‰‹å†Œé¡µã€‚</p>
<h2 id="æ–‡æ¡£ä¿®è®¢åŽ†å²"><a href="#æ–‡æ¡£ä¿®è®¢åŽ†å²" class="headerlink" title="æ–‡æ¡£ä¿®è®¢åŽ†å²"></a>æ–‡æ¡£ä¿®è®¢åŽ†å²</h2><p>ä¸‹è¡¨æè¿°äº†å¯¹â€œ <em>å¹¶å‘ç¼–ç¨‹æŒ‡å—â€</em>çš„æ›´æ”¹ã€‚</p>
<table>
<thead>
<tr>
<th><strong>æ—¥æœŸ</strong></th>
<th><strong>ç¬”è®°</strong></th>
</tr>
</thead>
<tbody><tr>
<td>2012-12-13</td>
<td>æ›´æ­£äº†è°ƒåº¦é˜Ÿåˆ—çš„è¯´æ˜Žã€‚</td>
</tr>
<tr>
<td>2012-07-17</td>
<td>åˆ é™¤äº†æœ‰å…³è‡ªåŠ¨é‡Šæ”¾æ± åœ¨æ“ä½œä¸­çš„ä½¿ç”¨æƒ…å†µçš„è¿‡æ—¶ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td>2011-01-19</td>
<td>æ›´æ–°äº†ç”¨äºŽæ‰‹åŠ¨æ‰§è¡Œæ“ä½œçš„ä»£ç ä»¥æ­£ç¡®å¤„ç†å–æ¶ˆã€‚</td>
</tr>
<tr>
<td></td>
<td>æ·»åŠ äº†æœ‰å…³å°† Objective-C å¯¹è±¡ä¸Žè°ƒåº¦é˜Ÿåˆ—ç»“åˆä½¿ç”¨çš„ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td>2010-04-13</td>
<td>æ›´æ–°ä»¥åæ˜ å¯¹ iOS çš„æ”¯æŒã€‚</td>
</tr>
<tr>
<td>2009-08-07</td>
<td>æ›´æ­£äº†éžå¹¶è¡Œæ“ä½œå¯¹è±¡ç¤ºä¾‹çš„å¯åŠ¨æ–¹æ³•ã€‚</td>
</tr>
<tr>
<td>2009-05-22</td>
<td>æ–°æ–‡æ¡£æè¿°äº†ç”¨äºŽä»¥å¹¶è¡Œæ–¹å¼æ‰§è¡Œå¤šä¸ªä»£ç è·¯å¾„çš„æŠ€æœ¯ã€‚</td>
</tr>
</tbody></table>

    </div>

    
    
    
      
  <div class="popular-posts-header">Related Posts</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/Threading-Programming-Guide/" rel="bookmark">Threading Programming Guide</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/ios-7-programming-cookbook/" rel="bookmark">iOS 7 Programming Cookbook</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/Pull-to-Refresh-UIViewController-in-iOS/" rel="bookmark">Pull to Refresh UIViewController in iOS</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/iOS-CI-Jenkins-Phabricator-Slack/" rel="bookmark">iOS CI (Jenkins + Phabricator + Slack)</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/View-blurred-after-CGAffineTransformMakeRotation/" rel="bookmark">View blurred after CGAffineTransformMakeRotation</a></div>
    </li>
  </ul>


    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me ðŸ‘¨â€ðŸ’» a coffee â˜•ï¸</div>
  <button onclick="document.querySelector('.post-reward').classList.toggle('active');">
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/wechat.png" alt="LeiHao WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/alipay.png" alt="LeiHao Alipay">
        <span>Alipay</span>
      </div>
      <div>
        <img src="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/bitcoin.png" alt="LeiHao Bitcoin">
        <span>Bitcoin</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/ios/" rel="tag"># iOS</a>
              <a href="/tags/interview/" rel="tag"># Interview</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/The-Graveyard-Book/" rel="prev" title="The Graveyard Book">
                  <i class="fa fa-chevron-left"></i> The Graveyard Book
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/Threading-Programming-Guide/" rel="next" title="Threading Programming Guide">
                  Threading Programming Guide <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
  
  
  



      
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  Â© 2012 â€“ 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-laptop-code"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LeiHao</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Symbols count total">436k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">6:36</span>
  </span>
</div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>


  




  












  








  

  

  






<script src="/bundle.js"></script><script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://Artwalk.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
;

  var disqus_config = function() {
    this.page.url = "https://leihao0.github.io/Concurrency-Programming-Guide/";
    this.page.identifier = "Concurrency-Programming-Guide/";
    this.page.title = "Concurrency Programming Guide";
    };
  NexT.utils.loadComments('#disqus_thread', () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://Artwalk.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script></body></html>