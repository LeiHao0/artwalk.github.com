<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/en/images/logo-192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/en/images/logo-192.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/en/images/logo.png">
  <link rel="mask-icon" href="/en/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="rbaH_zC-qBwXaawJ10Mno3FHzv9HRFHGFdXx2f1BwyI">

<link rel="stylesheet" href="/en/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.0/css/all.min.css">

<script data-ad-client="ca-pub-2317298287519457" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"leihao0.github.io","root":"/en/","scheme":"Pisces","version":"8.0.1","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="research content   Read NTFS MFT  Construction of the hash table  System path of the file  GUI and worker threads  Multiple search methods  MFC interface   research plan   Early-April-Mid-April to det">
<meta property="og:type" content="article">
<meta property="og:title" content="The principle conjecture and realization of Everything">
<meta property="og:url" content="https://leihao0.github.io/en/QSearch/index.html">
<meta property="og:site_name" content="LeiHao&#39;s Blog">
<meta property="og:description" content="research content   Read NTFS MFT  Construction of the hash table  System path of the file  GUI and worker threads  Multiple search methods  MFC interface   research plan   Early-April-Mid-April to det">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/QSearch_00.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/QSearch_01.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/QSearch_02.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/QSearch_04.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/QSearch_03.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/QSearch_06.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/QSearch_05.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/QSearch_06.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/QSearch_07.jpg">
<meta property="article:published_time" content="2012-05-26T14:44:42.000Z">
<meta property="article:modified_time" content="2020-12-20T23:53:07.980Z">
<meta property="article:author" content="LeiHao">
<meta property="article:tag" content="Programming">
<meta property="article:tag" content="Everything">
<meta property="article:tag" content="NTFS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/QSearch_00.jpg">


<link rel="canonical" href="https://leihao0.github.io/en/QSearch/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>The principle conjecture and realization of Everything | LeiHao's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-159363268-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-159363268-1');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?25f016f633270b8e0baf56c4fe6f2dc1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/en/atom.xml" title="LeiHao's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/en/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">LeiHao's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/en/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-rss">

    <a href="/en/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Fast-location-of-NTFS-disk-files"><span class="nav-number">1.</span> <span class="nav-text">Fast location of NTFS disk files</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Introduction"><span class="nav-number">1.1.</span> <span class="nav-text">1 Introduction</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Brief-introduction-to-NTFS"><span class="nav-number">1.2.</span> <span class="nav-text">2 Brief introduction to NTFS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-NTFS"><span class="nav-number">1.2.1.</span> <span class="nav-text">2.1 NTFS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-Current-situation"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.2 Current situation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Preparation"><span class="nav-number">1.3.</span> <span class="nav-text">3 Preparation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-Design-ideas"><span class="nav-number">1.3.1.</span> <span class="nav-text">3.1 Design ideas</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-What-is-USN"><span class="nav-number">1.3.2.</span> <span class="nav-text">3.2 What is USN</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-Why-is-it-fast"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.3 Why is it fast</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-Environment"><span class="nav-number">1.3.4.</span> <span class="nav-text">3.4 Environment</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Implementation-of-the-program"><span class="nav-number">1.4.</span> <span class="nav-text">4 Implementation of the program</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-Read-USN"><span class="nav-number">1.4.1.</span> <span class="nav-text">4.1 Read USN</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-1-Determine-the-disk-format"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">4.1.1 Determine the disk format</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-2-Get-drive-disk-handle"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">4.1.2 Get drive disk handle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-3-Initialize-USN-log"><span class="nav-number">1.4.1.3.</span> <span class="nav-text">4.1.3 Initialize USN log</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-4-Get-USN-log-information"><span class="nav-number">1.4.1.4.</span> <span class="nav-text">4.1.4 Get USN log information</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-5-Obtaining-USN-Journal-file-information"><span class="nav-number">1.4.1.5.</span> <span class="nav-text">4.1.5 Obtaining USN Journal file information</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-6-Delete-USN-log-file"><span class="nav-number">1.4.1.6.</span> <span class="nav-text">4.1.6 Delete USN log file</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-7-Results-of-enumerating-all-files"><span class="nav-number">1.4.1.7.</span> <span class="nav-text">4.1.7 Results of enumerating all files</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-Build-search-data"><span class="nav-number">1.4.2.</span> <span class="nav-text">4.2 Build search data</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-1-Construct-Vector"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">4.2.1 Construct Vector</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2-Building-a-hash-table"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">4.2.2 Building a hash table</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-3-Insert-data"><span class="nav-number">1.4.2.3.</span> <span class="nav-text">4.2.3 Insert data:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-Interface"><span class="nav-number">1.4.3.</span> <span class="nav-text">4.3 Interface</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-1-KISS-principle"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">4.3.1 KISS principle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-2-Function"><span class="nav-number">1.4.3.2.</span> <span class="nav-text">4.3.2 Function</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-Join-thread"><span class="nav-number">1.4.4.</span> <span class="nav-text">4.4 Join thread</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-1-Why-join-threads"><span class="nav-number">1.4.4.1.</span> <span class="nav-text">4.4.1 Why join threads</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-2-Start-a-Worker-thread-in-MFC"><span class="nav-number">1.4.4.2.</span> <span class="nav-text">4.4.2 Start a Worker thread in MFC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-3-Minimize-to-the-notification-area"><span class="nav-number">1.4.4.3.</span> <span class="nav-text">4.4.3 Minimize to the notification area</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-Find"><span class="nav-number">1.4.5.</span> <span class="nav-text">4.5 Find</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-1-Wildcard"><span class="nav-number">1.4.5.1.</span> <span class="nav-text">4.5.1 Wildcard</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-2-Case-order"><span class="nav-number">1.4.5.2.</span> <span class="nav-text">4.5.2 Case, order</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-3-User-privacy-and-system-path"><span class="nav-number">1.4.5.3.</span> <span class="nav-text">4.5.3 User privacy and system path</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-4-Implementation"><span class="nav-number">1.4.5.4.</span> <span class="nav-text">4.5.4 Implementation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-5-Path-output"><span class="nav-number">1.4.5.5.</span> <span class="nav-text">4.5.5 Path output</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-Complexity-analysis"><span class="nav-number">1.5.</span> <span class="nav-text">5 Complexity analysis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-Time-complexity"><span class="nav-number">1.5.1.</span> <span class="nav-text">5.1 Time complexity</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-Space-complexity"><span class="nav-number">1.5.2.</span> <span class="nav-text">5.2 Space complexity</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-Problems-encountered"><span class="nav-number">1.6.</span> <span class="nav-text">6 Problems encountered</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-Unable-to-initialize-USN-file"><span class="nav-number">1.6.1.</span> <span class="nav-text">6.1 Unable to initialize USN file</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-The-problem-of-wchar-and-char-under-unicode"><span class="nav-number">1.6.2.</span> <span class="nav-text">6.2 The problem of wchar and char under unicode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-ifdef-position-problem"><span class="nav-number">1.6.3.</span> <span class="nav-text">6.3 #ifdef position problem</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-Parameter-transfer"><span class="nav-number">1.6.4.</span> <span class="nav-text">6.4 Parameter transfer</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-small-optimizations"><span class="nav-number">1.7.</span> <span class="nav-text">7 small optimizations</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-Reading-speed"><span class="nav-number">1.7.1.</span> <span class="nav-text">7.1 Reading speed</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-Open-file-method"><span class="nav-number">1.7.2.</span> <span class="nav-text">7.2 Open file method</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-Progress-bar"><span class="nav-number">1.7.3.</span> <span class="nav-text">7.3 Progress bar</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-Conclusion"><span class="nav-number">2.</span> <span class="nav-text">8 Conclusion</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#references"><span class="nav-number">3.</span> <span class="nav-text">references</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#English-summary"><span class="nav-number">4.</span> <span class="nav-text">English summary</span></a></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">LeiHao</p>
  <div class="site-description" itemprop="description">😃😃😃</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/en/archives/">
        
          <span class="site-state-item-count">160</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/en/tags/">
        <span class="site-state-item-count">81</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/leihao0" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;leihao0" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/leihao0" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;leihao0" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.linkedin.com/in/leihao0" title="Linkedin → https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;leihao0" rel="noopener" target="_blank"><i class="fab fa-linkedin-in fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" class="cc-opacity" rel="noopener" target="_blank"><img src="/en/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leihao0.github.io/en/QSearch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/en/images/avatar.gif">
      <meta itemprop="name" content="LeiHao">
      <meta itemprop="description" content="😃😃😃">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeiHao's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          The principle conjecture and realization of Everything
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2012-05-26 22:44:42" itemprop="dateCreated datePublished" datetime="2012-05-26T22:44:42+08:00">2012-05-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-12-21 07:53:07" itemprop="dateModified" datetime="2020-12-21T07:53:07+08:00">2020-12-21</time>
      </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/en/QSearch/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="QSearch/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>23k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>21 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>research content </p>
<ol>
<li>Read NTFS MFT </li>
<li>Construction of the hash table </li>
<li>System path of the file </li>
<li>GUI and worker threads </li>
<li>Multiple search methods </li>
<li>MFC interface </li>
</ol>
<p>research plan </p>
<ul>
<li>Early-April-Mid-April to determine the research direction </li>
<li>From the end of April to the end of April. Preparation for each knowledge point, simple test </li>
<li>At the beginning of May, program design and development debugging and operation </li>
<li>Mid-May-End of May Writing graduation design thesis </li>
</ul>
<p>Features and innovation </p>
<ol>
<li>CPU and memory usage are within a reasonable range </li>
<li>The software is stable and provides different search options </li>
<li>Compared with the search function of windows, the file location speed is super fast </li>
</ol>
<h1 id="Fast-location-of-NTFS-disk-files"><a href="#Fast-location-of-NTFS-disk-files" class="headerlink" title="Fast location of NTFS disk files"></a>Fast location of NTFS disk files</h1><p><strong>Summary</strong> </p>
<blockquote>
<p>This article introduces how to enumerate the names of all files and folders on the hard disk under the Windows NTFS disk format, and use the STL of C++ to construct a hash table, as well as the GUI and worker threads of MFC, and finally realize the implementation based on the keywords entered by the user Search as simple as google keyword search, and then instantly return all matching files/folders and recursively get the system path of the file/folder. </p>
</blockquote>
<p><strong>Keywords</strong>: <strong>NTFS, fast, keyword, search, file path</strong> </p>
<h2 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1 Introduction"></a>1 Introduction</h2><p>The directory structure of Windows. In NTFS volumes, files are<br>Arranged in the form of B+ tree, press when searching for files in the directory<br>The B+ tree search method first searches the root node (starting from the root directory), and then compares the file name to be found with the file name corresponding to the child node in the root node to determine which child node corresponds to the storage area to search, and then Use the child node as the current root node and search again until the file is found. ^[1]^ </p>
<p>Although the search provided by the Microsoft system can search text content, the speed is very unsatisfactory. In most cases, we just want to know which folder on the computer the file is stored in, and this program solves this very well. </p>
<h2 id="2-Brief-introduction-to-NTFS"><a href="#2-Brief-introduction-to-NTFS" class="headerlink" title="2 Brief introduction to NTFS"></a>2 Brief introduction to NTFS</h2><h3 id="2-1-NTFS"><a href="#2-1-NTFS" class="headerlink" title="2.1 NTFS"></a>2.1 NTFS</h3><p>NTFS(New Technology File System)是 Windows<br>The standard file system of NT and later Windows. NTFS replaces the file allocation table (FAT) file system and provides a file system for Microsoft’s Windows series operating systems. NTFS has made several improvements to FAT and HPFS (High-Performance File System), for example, it supports metadata and uses advanced data structures to improve performance, reliability, and disk space utilization. ^[2]^ </p>
<h3 id="2-2-Current-situation"><a href="#2-2-Current-situation" class="headerlink" title="2.2 Current situation"></a>2.2 Current situation</h3><p>With NT-based Windows<br>With the popularity of 2000/XP, many individual users have begun to use NTFS. NTFS also uses clusters as a unit to store data files, but the cluster size in NTFS does not depend on the disk or partition size. Shrinking the cluster size not only reduces the waste of disk space, but also reduces the possibility of disk fragmentation. NTFS supports file encryption management function, which can provide users with a higher level of security assurance. ^[3]^ </p>
<h2 id="3-Preparation"><a href="#3-Preparation" class="headerlink" title="3 Preparation"></a>3 Preparation</h2><h3 id="3-1-Design-ideas"><a href="#3-1-Design-ideas" class="headerlink" title="3.1 Design ideas"></a>3.1 Design ideas</h3><p>Read all file names of the disk as data, and match in the data according to the keywords entered by the user. The correct path is returned to the user together with the path to facilitate opening the file. </p>
<p>The specific design idea is shown in Figure 3-1. </p>
<p><img src="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/QSearch_00.jpg" alt="Figure 3-1 Design Ideas"> </p>
<p>The biggest advantage of a hash table is that it greatly reduces the time consumed for data storage and search, which can almost be regarded as a constant time; the cost is only to consume more memory. However, with more and more available memory, it is worthwhile to trade space for time. In addition, easier coding is also one of its characteristics. </p>
<h3 id="3-2-What-is-USN"><a href="#3-2-What-is-USN" class="headerlink" title="3.2 What is USN"></a>3.2 What is USN</h3><p>The top priority of the program is to read the USN. </p>
<p>USN 是 Update Service Number Journal or Change<br>The abbreviation of Journal, the function of recording the modified information in the NTFS volume, you can set the number of files and directories to be monitored in the partition, and record the modification time and content of the monitored object. </p>
<p>When the USN log is enabled, for each NTFS volume, when there is information about adding, deleting, and modifying files, NTFS uses the USN log to record and store it as<br>The format of USN_RECORD. </p>
<h3 id="3-3-Why-is-it-fast"><a href="#3-3-Why-is-it-fast" class="headerlink" title="3.3 Why is it fast"></a>3.3 Why is it fast</h3><p>The USN log is equivalent to the WORD directory and provides an index. Of course, when the content of the article changes, the USN log will record when the modification is made, but it does not record what is modified in it, so the index file is very small. And when you want to find the specific paragraph of the article, you don’t need to turn the mouse wheel wildly, just look at the table of contents directly, and you only need to hold down ctrl+mouse click to locate. </p>
<p>In the same way, when you want to find a certain file, you can find out whether the file exists directly by searching the USN log (that is, the established index). </p>
<p>PS: Although windows is not “everything is a file” (Unix/Linux<br>One of the basic philosophy of ), but the folder also exists in the form of a file, so you can also find the location through USN. </p>
<h3 id="3-4-Environment"><a href="#3-4-Environment" class="headerlink" title="3.4 Environment"></a>3.4 Environment</h3><p>Since the NTFS format is originally a patent of Microsoft, a series of API functions are provided for our convenient access. </p>
<p>As an old but classic Visual C++ 6.0<br>Programming tool, but there was no NTFS format at that time, so VC2005 was chosen as the integrated development environment, and it can only run on Windows systems after 2000. </p>
<h2 id="4-Implementation-of-the-program"><a href="#4-Implementation-of-the-program" class="headerlink" title="4 Implementation of the program"></a>4 Implementation of the program</h2><h3 id="4-1-Read-USN"><a href="#4-1-Read-USN" class="headerlink" title="4.1 Read USN"></a>4.1 Read USN</h3><p>The following are all API functions provided by Microsoft^[4]^, which are included in the <code>&lt;Winioctl.h&gt;</code> header file. </p>
<h4 id="4-1-1-Determine-the-disk-format"><a href="#4-1-1-Determine-the-disk-format" class="headerlink" title="4.1.1 Determine the disk format"></a>4.1.1 Determine the disk format</h4><p>Call the following function to find out the disk in NTFS format </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GetVolumeInformation(</span><br><span class="line">	lpRootPathName: PChar;               <span class="comment">// 磁盘驱动器代码字符串</span></span><br><span class="line">	lpVolumeNameBuffer: PChar;           <span class="comment">// 磁盘驱动器卷标名称</span></span><br><span class="line">	nVolumeNameSize: DWORD;              <span class="comment">// 磁盘驱动器卷标名称长度</span></span><br><span class="line">	lpVolumeSerialNumber: PDWORD;        <span class="comment">// 磁盘驱动器卷标序列号</span></span><br><span class="line">	var lpMaximumComponentLength: DWORD; <span class="comment">// 系统允许的最大文件名长度</span></span><br><span class="line">    var lpFileSystemFlags: DWORD;        <span class="comment">// 文件系统标识</span></span><br><span class="line">	lpFileSystemNameBuffer: PChar;       <span class="comment">// 格式类型</span></span><br><span class="line">	nFileSystemNameSize: DWORD           <span class="comment">// 文件操作系统名称长度</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>The lpFileSystemNameBuffer, which is what we want, will return strings such as “FAT32” and “NTFS”. </p>
<p>Then use a loop to count A-Z drive letters in NTFS format, and then initialize </p>
<h4 id="4-1-2-Get-drive-disk-handle"><a href="#4-1-2-Get-drive-disk-handle" class="headerlink" title="4.1.2 Get drive disk handle"></a>4.1.2 Get drive disk handle</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HANDLE hVol = CreateFile(</span><br><span class="line">	<span class="string">&quot;盘符字符串&quot;</span>,  <span class="comment">// 必须如\.\C: (A-Z)的形式</span></span><br><span class="line">	GENERIC_READ | GENERIC_WRITE, <span class="comment">// 可以为</span></span><br><span class="line">	FILE_SHARE_READ | FILE_SHARE_WRITE, <span class="comment">// 必须包含有FILE_SHARE_WRITE</span></span><br><span class="line">	<span class="literal">NULL</span>, <span class="comment">// 这里不需要</span></span><br><span class="line">	OPEN_EXISTING, <span class="comment">// 必须包含OPEN_EXISTING, CREATE_ALWAYS可能会导致错误</span></span><br><span class="line">	FILE_ATTRIBUTE_READONLY, <span class="comment">// FILE_ATTRIBUTE_NORMAL可能会导致错误</span></span><br><span class="line">	<span class="literal">NULL</span>); <span class="comment">// 这里不需要</span></span><br></pre></td></tr></table></figure>

<p>Points to note: </p>
<ol>
<li>CreateFile returns a handle, which will be used below; </li>
<li>Since the drive letter must be in the form of <code>\\.\C:</code>, the backslash “//“ in the <code>C++</code> language represents “/“; </li>
<li>Administrator rights are required (vista, UAC will pop up in win7) </li>
</ol>
<p>If <code>hVol != INVALID_HANDLE_VALUE</code>, it means that the handle is successfully obtained and you can continue to the next step. </p>
<h4 id="4-1-3-Initialize-USN-log"><a href="#4-1-3-Initialize-USN-log" class="headerlink" title="4.1.3 Initialize USN log"></a>4.1.3 Initialize USN log</h4><p>Use <code>FSCTL_CREATE_USN_JOURNAL</code> as the control code of <code>DeviceIoControl</code>. </p>
<p><code>Cujd</code> is a pointer to the input buffer, pointing to the <code>CREATE_USN_JOURNAL_DATA</code> structure. </p>
<h4 id="4-1-4-Get-USN-log-information"><a href="#4-1-4-Get-USN-log-information" class="headerlink" title="4.1.4 Get USN log information"></a>4.1.4 Get USN log information</h4><p>Use <code>FSCTL_QUERY_USN_JOURNAL</code> as the control code of <code>DeviceIoControl</code>. </p>
<p><code>lpOutBuffer</code> returns a <code>USN_JOURNAL_DATA</code>, which is a structure </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    DWORDLONG UsnJournalID;</span><br><span class="line">    USN       FirstUsn;</span><br><span class="line">    USN       NextUsn;</span><br><span class="line">    USN       LowestValidUsn;</span><br><span class="line">    USN       MaxUsn;</span><br><span class="line">    DWORDLONG MaximumSize;</span><br><span class="line">    DWORDLONG AllocationDelta;</span><br><span class="line">&#125; USN_JOURNAL_DATA, *PUSN_JOURNAL_DATA;</span><br></pre></td></tr></table></figure>

<p><code>UsnJournalID</code>, <code>FirstUsn</code>, <code>NextUsn</code> will be used in the next step </p>
<h4 id="4-1-5-Obtaining-USN-Journal-file-information"><a href="#4-1-5-Obtaining-USN-Journal-file-information" class="headerlink" title="4.1.5 Obtaining USN Journal file information"></a>4.1.5 Obtaining USN Journal file information</h4><p>Since <code>USN</code> is stored in the form of <code>USN_RECORD</code>, its structure is: </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">	DWORD RecordLength; <span class="comment">// 记录长度</span></span><br><span class="line">	WORD MajorVersion; <span class="comment">// 主版本</span></span><br><span class="line">	WORD MinorVersion; <span class="comment">// 次版本</span></span><br><span class="line">	DWORDLONG FileReferenceNumber; <span class="comment">// 文件引用数</span></span><br><span class="line">	DWORDLONG ParentFileReferenceNumber; <span class="comment">// 父目录引用数</span></span><br><span class="line">	USN Usn; <span class="comment">// USN</span></span><br><span class="line">	LARGE_INTEGER TimeStamp; <span class="comment">// 时间戳</span></span><br><span class="line">	DWORD Reason; <span class="comment">// 原因</span></span><br><span class="line">	DWORD SourceInfo; <span class="comment">// 源信息</span></span><br><span class="line">	DWORD SecurityId; <span class="comment">// 安全</span></span><br><span class="line">	ID DWORD FileAttributes; <span class="comment">// 文件属性</span></span><br><span class="line">	WORD FileNameLength; <span class="comment">// 文件长度</span></span><br><span class="line">	WORD FileNameOffset; <span class="comment">// 文件名偏移</span></span><br><span class="line">	DWORD ExtraInfo1;</span><br><span class="line">	DWORD ExtraInfo2; DWORD ExtraInfo3; <span class="comment">// Hypothetically added in version 2.3</span></span><br><span class="line">	WCHAR FileName[<span class="number">1</span>]; <span class="comment">// 文件名第一位的指针</span></span><br><span class="line">&#125; USN_RECORD, *PUSN_RECORD;</span><br></pre></td></tr></table></figure>

<p>Note the <code>FileReferenceNumber</code>, <code>ParentFileReferenceNumber</code>, <code>FileNameLength</code>, <code>FileName</code> </p>
<p>These variables are very important </p>
<p><code>DeviceIoControl()</code> cooperates with <code>FSCTL_ENUM_USN_DATA</code> </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="number">0</span>!=DeviceIoControl(hVol,</span><br><span class="line">	 	FSCTL_ENUM_USN_DATA,</span><br><span class="line">	 	&amp;med,</span><br><span class="line">	 	<span class="keyword">sizeof</span> (med),</span><br><span class="line">	 	Buffer,</span><br><span class="line">	 	BUF_LEN,</span><br><span class="line">	 	&amp;usnDataSize,</span><br><span class="line">	 	<span class="literal">NULL</span>)) &#123;</span><br><span class="line"></span><br><span class="line">	 	DWORD dwRetBytes = usnDataSize - <span class="keyword">sizeof</span> (USN);</span><br><span class="line">	 	<span class="comment">// 找到第一个 USN 记录</span></span><br><span class="line">	 	UsnRecord = (PUSN_RECORD)(((PCHAR)Buffer)+<span class="keyword">sizeof</span> (USN));</span><br><span class="line"></span><br><span class="line">	 	<span class="keyword">while</span> (dwRetBytes&gt;<span class="number">0</span>)&#123;</span><br><span class="line"></span><br><span class="line">	 		<span class="comment">// 获取到的信息</span></span><br><span class="line">	 		<span class="function">CString <span class="title">CfileName</span><span class="params">(UsnRecord-&gt;FileName, UsnRecord-&gt;FileNameLength/<span class="number">2</span>)</span></span>;</span><br><span class="line">	 		pfrnName.filename = nameCur.filename = CfileName;</span><br><span class="line">	 		pfrnName.pfrn = nameCur.pfrn = UsnRecord-&gt;ParentFileReferenceNumber;</span><br><span class="line"></span><br><span class="line">	 		<span class="comment">// Vector</span></span><br><span class="line">	 		VecNameCur.push_back(nameCur);</span><br><span class="line"></span><br><span class="line">	 		<span class="comment">// 构建hash...</span></span><br><span class="line">	 		frnPfrnNameMap[UsnRecord-&gt;FileReferenceNumber] = pfrnName;</span><br><span class="line">	 		<span class="comment">// 获取下一个记录</span></span><br><span class="line">	 		DWORD recordLen = UsnRecord-&gt;RecordLength;</span><br><span class="line">	 		dwRetBytes -= recordLen;</span><br><span class="line">	 		UsnRecord = (PUSN_RECORD)(((PCHAR)UsnRecord)+recordLen);</span><br><span class="line"></span><br><span class="line">	 	&#125;</span><br><span class="line">	 	<span class="comment">// 获取下一页数据</span></span><br><span class="line">	 	med.StartFileReferenceNumber = \*(USN \*)&amp;Buffer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Among them, <code>Med</code> is: </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MFT_ENUM_DATA med;</span><br><span class="line"></span><br><span class="line">med.StartFileReferenceNumber = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">med.LowUsn = <span class="number">0</span>;<span class="comment">//UsnInfo.FirstUsn;</span></span><br></pre></td></tr></table></figure>

<p>After testing here, it is found that if the use of <code>FirstUsn</code> is sometimes incorrect, resulting in incomplete data being obtained, it is better to write 0 directly. </p>
<p><code>med.HighUsn = UsnInfo.NextUsn;</code> </p>
<p>In this loop, the file name obtained each time is inserted into the vector and hash table respectively (described below). </p>
<h4 id="4-1-6-Delete-USN-log-file"><a href="#4-1-6-Delete-USN-log-file" class="headerlink" title="4.1.6 Delete USN log file"></a>4.1.6 Delete USN log file</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DeviceIoControl(hVol,</span><br><span class="line">	FSCTL_DELETE_USN_JOURNAL,</span><br><span class="line">	&amp;dujd,</span><br><span class="line">	<span class="keyword">sizeof</span> (dujd),</span><br><span class="line">	<span class="literal">NULL</span>,</span><br><span class="line">	<span class="number">0</span>,</span><br><span class="line">	&amp;br,</span><br><span class="line">	<span class="literal">NULL</span>)</span><br></pre></td></tr></table></figure>

<h4 id="4-1-7-Results-of-enumerating-all-files"><a href="#4-1-7-Results-of-enumerating-all-files" class="headerlink" title="4.1.7 Results of enumerating all files"></a>4.1.7 Results of enumerating all files</h4><p>Save the data as Allfile.txt for analysis, as shown in Figure 4-1. </p>
<p><img src="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/QSearch_01.jpg" alt="图 4-1 Allfile.txt"> </p>
<p><img src="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/QSearch_02.jpg" alt="图 4-1 Allfile.txt"> </p>
<p>I used the D drive on my computer as a test and enumerated all the files. As shown in the figure, there are about 40W files, a total of more than 100W data, and the file size is about 20MB. This has a vague estimate of the amount of memory occupied by subsequent programs, which is about 50M. For even only 1G of memory, it is within a reasonable range. With the original data, the analysis is as follows: </p>
<p>For example, Linux programming practice.isz file, its system path is: <code>D:\Ghost\Linux\Linux programming practice.isz</code>, look at the result in the file: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">D:\</span><br><span class="line">Frn: 5000000000005</span><br><span class="line">Pfrn: NULL</span><br><span class="line">……</span><br><span class="line">……</span><br><span class="line">Ghost</span><br><span class="line">Frn: 20000000000fd</span><br><span class="line">Pfrn: 5000000000005</span><br><span class="line">……</span><br><span class="line">……</span><br><span class="line">Linux</span><br><span class="line">Frn: e0000000010d2</span><br><span class="line">Pfrn: 20000000000fd</span><br><span class="line">……</span><br><span class="line">……</span><br><span class="line">Linux编程实践.isz</span><br><span class="line">Frn: 190000000003b2</span><br><span class="line">Pfrn: e0000000010d2</span><br><span class="line">可以得出：</span><br><span class="line">Linux编程实践.isz-&gt;Pfrn &#x3D;&#x3D; Linux-&gt;Frn</span><br><span class="line">Linux-&gt;Pfrn &#x3D;&#x3D; Ghost-&gt;Frn</span><br><span class="line">Ghost-&gt;Pfrn &#x3D;&#x3D; D:\ -&gt; Frn</span><br><span class="line">D:\ -&gt; Pfrn 停止</span><br></pre></td></tr></table></figure>

<p>So using a recursive function (directly or indirectly calling its own function), you can get the complete path. </p>
<h3 id="4-2-Build-search-data"><a href="#4-2-Build-search-data" class="headerlink" title="4.2 Build search data"></a>4.2 Build search data</h3><h4 id="4-2-1-Construct-Vector"><a href="#4-2-1-Construct-Vector" class="headerlink" title="4.2.1 Construct Vector"></a>4.2.1 Construct Vector</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">name_cur</span> &#123;</span></span><br><span class="line">    CString filename;</span><br><span class="line">    DWORDLONG pfrn;</span><br><span class="line">&#125;Name_Cur;</span><br></pre></td></tr></table></figure>

<p>Vector： </p>
<p>A sequential container. The elements in the vector are accessed via their position index. You can call push_back or<br>The insert function adds elements to the vector. In vector<br>Adding elements to the container may cause the re-allocation of memory space for the container, and may also invalidate all iterators. in<br>vector<br>Adding (or deleting) elements in the middle of the container will invalidate all iterators pointing to elements after the insertion (or deletion) point. </p>
<p>Use Vector to store &lt;file name, current directory&gt;. Due to the requirements of fuzzy search, fast search methods such as binary search are not applicable here, and the linear traversal method of Vector from begin to end meets this requirement. . </p>
<h4 id="4-2-2-Building-a-hash-table"><a href="#4-2-2-Building-a-hash-table" class="headerlink" title="4.2.2 Building a hash table"></a>4.2.2 Building a hash table</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">pfrn_name</span> &#123;</span></span><br><span class="line">    DWORDLONG pfrn;</span><br><span class="line">    CString filename;</span><br><span class="line">&#125;Pfrn_Name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">map</span>&lt;DWORDLONG, Pfrn_Name&gt; Frn_Pfrn_Name_Map;</span><br></pre></td></tr></table></figure>

<p>Here we use the map library function ^[5]^ provided by STL, map is a collection of key-value pairs. map<br>The type can usually be understood as an associative array (associative<br>array): You can use the key as a subscript to get a value, just like the built-in array type. The essence of association is that the value of an element is associated with a specific key, rather than obtained by the position of the element in the array. </p>
<ol>
<li>Considering that if you implement the hash function yourself, there may be several bugs that affect the progress, it is better to use the stable map provided by STL to implement it. </li>
<li>“Don’t Reinvent the Wheel” Don’t reinvent the wheel^[6]^ <ol>
<li>For example, Google’s Android, is Google’s inability to develop a system kernel alone, so it uses a very mature Linux kernel? I think it’s impossible for a world giant like Google to be without this ability. Instead, it respects the principle of not reinventing the wheel. </li>
</ol>
</li>
</ol>
<h4 id="4-2-3-Insert-data"><a href="#4-2-3-Insert-data" class="headerlink" title="4.2.3 Insert data:"></a>4.2.3 Insert data:</h4><p>This is used here in Section 4.1.5, Get USN Journal<br>In the loop of file information, the <code>USN_RECORD</code> information obtained each time, the <code>filename</code>,<br><code>pfrn</code>, <code>frn</code> are inserted into the vector and hash table respectively. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pfrnName.filename &#x3D; nameCur.filename &#x3D; CfileName;</span><br><span class="line">pfrnName.pfrn &#x3D; nameCur.pfrn &#x3D; UsnRecord-&gt;ParentFileReferenceNumber;</span><br><span class="line">VecNameCur.push_back(nameCur);</span><br><span class="line">frnPfrnNameMap[UsnRecord-&gt;FileReferenceNumber] &#x3D; pfrnName;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-Interface"><a href="#4-3-Interface" class="headerlink" title="4.3 Interface"></a>4.3 Interface</h3><p>When starting a project, VC2005 provides command line (console) projects and GUI projects. Command line programming is very convenient, fast, practical, and relatively simple. If the console can meet the requirements, the interface is not necessary. Or sometimes the target platform cannot display the graphical user interface. but,<br>GUI has more obvious advantages, such as menu system and better interactivity. In addition, in the process of menu selection and moving data between fields,<br>The mouse is very useful, and the GUI is the way to go. Therefore, when writing the program, I first tested some intermediate data under the console, and then switched to the GUI interface when it was over. </p>
<p>MFC: Microsoft Foundation Classes, also known as MFC<br>, Is Microsoft’s response to “lowering Windows<br>The greatest contribution made by programming is bored, bored and difficult. MFC<br>Makes the generation of dialog boxes extremely simple. It also implements a message delivery system (message<br>dispatching), dealing with the easy mistakes of WPARAM and LP ARAM. MFC<br>It is even the driving force to lure some people into C++.<br>This program is implemented by MFC provided by Microsoft, as shown in Figure 4-2: </p>
<p><img src="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/QSearch_04.jpg" alt="Figure 4-2 MFC interface"> </p>
<h4 id="4-3-1-KISS-principle"><a href="#4-3-1-KISS-principle" class="headerlink" title="4.3.1 KISS principle"></a>4.3.1 KISS principle</h4><p>The KISS principle is “Keep It Sample And<br>The abbreviation of “Stupid”, simplicity and ease of operation are the most important principles of design. </p>
<p>The KISS principle is probably the most respected in design, home improvement design, interface design<br>In terms of operational design, complex things are becoming more and more popular, while simple things are becoming more and more recognized. For example, these UI designs and our Chinese web pages are negative examples. “IKEA” (IKEA) simple and efficient home design and production ideas; “Microsoft” (Microsoft) “what you see is what you get” concept; “Google” (Google) simple and direct business style, without exception, follow The “kiss” principle. ^[7]^ </p>
<h4 id="4-3-2-Function"><a href="#4-3-2-Function" class="headerlink" title="4.3.2 Function"></a>4.3.2 Function</h4><p>Under the kiss principle, be as concise as possible. Add Editbox button listbox<br>menu^[8]^The functions of these controls are as follows: </p>
<ul>
<li>Editbox <ul>
<li>Get the string that needs to be searched by the user </li>
</ul>
</li>
<li>Button <ol>
<li>Get the string in EditBox </li>
<li>The character is too short to pop up a prompt </li>
<li>Add a magnifying glass picture, the function is clear at a glance </li>
</ol>
</li>
<li>Listbox <ol>
<li>Display the matching file name and path, double-click to open the file </li>
<li>Since the path may be relatively long, add a horizontal scroll bar </li>
<li>Double-click the result file path in Listbox to open the file selected by double-click </li>
</ol>
</li>
<li>Menu <ul>
<li>Menu, you can select case, search order </li>
</ul>
</li>
</ul>
<h3 id="4-4-Join-thread"><a href="#4-4-Join-thread" class="headerlink" title="4.4 Join thread"></a>4.4 Join thread</h3><h4 id="4-4-1-Why-join-threads"><a href="#4-4-1-Why-join-threads" class="headerlink" title="4.4.1 Why join threads"></a>4.4.1 Why join threads</h4><p>The benefits of threads: threads are cheap. Thread starts faster, exits faster, and has less impact on system resources. </p>
<p>Also consider: </p>
<ol>
<li>Due to the limitation of io, it doesn’t make much sense to use multiple threads to read MFT at the same time on the same hard disk. </li>
<li>Disk access to MFT located in different partitions of the same hard disk may affect the speed instead. For computers with multiple hard disks, efficiency should be greatly improved. However, users of multiple hard drives may form a RAID array. The best solution should be to read A-Z disks sequentially. </li>
<li>When the MFC was first created, it was executed sequentially. As a result, the interface could not be displayed until all data statistics were completed. During this process, users would easily lose patience. </li>
<li>Finally decide a UI thread, a worker thread background statistics. </li>
</ol>
<h4 id="4-4-2-Start-a-Worker-thread-in-MFC"><a href="#4-4-2-Start-a-Worker-thread-in-MFC" class="headerlink" title="4.4.2 Start a Worker thread in MFC"></a>4.4.2 Start a Worker thread in MFC</h4><p>MFC has long added support for multithreading. In a typical MFC<br>In the program, the support of multithreading is hidden behind a lot of amazing work. MFC<br>Even attempts to strengthen certain Win32 concepts related to multithreading. </p>
<p>Both GUI and worker threads are started with AfxBeginThread(), but MFC uses the overloading nature of C++ functions to provide two different declarations for this function. The compiler will automatically select the correct one to use based on the parameters you provide. ^[9]^ </p>
<p>Use AfxBeginThread to start the thread.<br>pParam Any 4-byte value, used to pass to the new thread. It can be an integer, or a pointer, or just a zero. </p>
<p>Only the first two parameters are used here, the thread function in the object, and the object pointer </p>
<p>You can see two threads in the task manager, as shown in Figure 4-3 </p>
<p><img src="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/QSearch_03.jpg" alt="Figure 4-3 Task Manager displays the number of threads"> </p>
<p>When the worker thread completes its task, it will automatically end and return to a thread. </p>
<h4 id="4-4-3-Minimize-to-the-notification-area"><a href="#4-4-3-Minimize-to-the-notification-area" class="headerlink" title="4.4.3 Minimize to the notification area"></a>4.4.3 Minimize to the notification area</h4><p>Now more and more programs click close in the upper right corner, which is actually minimized to the tray icon. To exit the program, you need to right-click on the tray icon to exit. </p>
<p>Realize minimization without exiting the program, you can find files conveniently. </p>
<p>1) Minimize the display on the taskbar. </p>
<p>2) Click Close to exit to the tray icon without displaying it in the taskbar; double-click to reply to the display window. </p>
<p>3) Add menu to tray icon. </p>
<h3 id="4-5-Find"><a href="#4-5-Find" class="headerlink" title="4.5 Find"></a>4.5 Find</h3><h4 id="4-5-1-Wildcard"><a href="#4-5-1-Wildcard" class="headerlink" title="4.5.1 Wildcard"></a>4.5.1 Wildcard</h4><p>In actual applications, it’s impossible to remember the file name clearly, such as test.2012-5-14.txt, which often means “test<br>.txt”, so fuzzy search is needed. Because under the console, the file name is &lt;filename,<br>pfrn&gt; Create a hash table. If you want to implement fuzzy search, the hash table becomes unnecessary. You can directly use the container vector. </p>
<p>According to the actual situation, no strict wildcard is required, “*?”<br>Can solve most of the search problems, plus users generally may not know the use of wildcards, let alone regular expressions. So start with “space”<br>Instead of “*?”, implement Baidu<br>Google’s search method of separating keywords with spaces is a good solution. **** </p>
<h4 id="4-5-2-Case-order"><a href="#4-5-2-Case-order" class="headerlink" title="4.5.2 Case, order"></a>4.5.2 Case, order</h4><p>There are generally the following two situations: </p>
<ol>
<li>The user may not remember the case of the file name or path </li>
<li>Sometimes there are too many files, and strict capitalization may be required to filter the correct files </li>
<li>Can’t remember the order of keywords </li>
</ol>
<p>So provide the following two options: </p>
<ol>
<li>Strict case </li>
<li>No order </li>
</ol>
<p>According to the general situation, the default is: case-insensitive, sequential search </p>
<h4 id="4-5-3-User-privacy-and-system-path"><a href="#4-5-3-User-privacy-and-system-path" class="headerlink" title="4.5.3 User privacy and system path"></a>4.5.3 User privacy and system path</h4><ol>
<li>Consider that some folders are used to store users’ private files. </li>
<li>System folders, for example: <code>c:\windows\*</code> General users will not use it. The same search will only increase unnecessary files and burden the system. </li>
</ol>
<p>So it is necessary to add an exclude folder option, as shown in Figure 4-4 </p>
<p><img src="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/QSearch_06.jpg" alt="Figure 4-4 Exclude Folder Interface"> </p>
<p>The corresponding function is: </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isIgnore</span><span class="params">( <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;\* pignorelist )</span> </span>&#123;</span><br><span class="line">	<span class="built_in">string</span> tmp = CW2A(path);</span><br><span class="line">	<span class="keyword">for</span> ( <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;::iterator it = pignorelist-&gt;begin();</span><br><span class="line">		it != pignorelist-&gt;end(); ++it ) &#123;</span><br><span class="line">			<span class="keyword">size_t</span> i = it-&gt;length();</span><br><span class="line">			<span class="keyword">if</span> ( !tmp.compare(<span class="number">0</span>, i, \*it,<span class="number">0</span>, i) ) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-5-4-Implementation"><a href="#4-5-4-Implementation" class="headerlink" title="4.5.4 Implementation"></a>4.5.4 Implementation</h4><p>New matching string class </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cmpStrStr</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	cmpStrStr(<span class="keyword">bool</span> uplow, <span class="keyword">bool</span> inorder) &#123;</span><br><span class="line">		<span class="keyword">this</span>-&gt;uplow = uplow;</span><br><span class="line">		<span class="keyword">this</span>-&gt;isOrder = inorder;</span><br><span class="line">	&#125;</span><br><span class="line">	~cmpStrStr() &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">cmpStrFilename</span><span class="params">(CString str, CString filename)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">infilename</span><span class="params">(CString &amp;strtmp, CString &amp;filenametmp)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="keyword">bool</span> uplow;</span><br><span class="line">	<span class="keyword">bool</span> isOrder;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Traverse the VecNameCur in <strong>4.2.1</strong>, pass the cmpStrFilename matching function, and get the matching filename </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( <span class="built_in">vector</span>&lt;Name_Cur&gt;::const_iterator cit = VecNameCur.begin();</span><br><span class="line">	cit != VecNameCur.end(); ++cit) &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ( cmpstrstr.cmpStrFilename(str, cit-&gt;filename) ) &#123;</span><br><span class="line">		path.Empty();</span><br><span class="line">		<span class="comment">// 还原 路径</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// vol:\  path \ cit-&gt;filename</span></span><br><span class="line">		getPath(cit-&gt;pfrn, path);</span><br><span class="line">		path += cit-&gt;filename;</span><br><span class="line">		<span class="comment">// path已是全路径</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ( isIgnore(pignorelist) ) &#123;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		rightFile.push_back(path);</span><br><span class="line">		<span class="comment">//path.Empty();</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cmpStrFilename函数：</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> pos = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> end = str.GetLength();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> ( pos &lt; end ) &#123;</span><br><span class="line">	<span class="comment">// 对于str，取得 每个空格分开为的关键词</span></span><br><span class="line">	pos = str.Find( _T(<span class="string">&#x27; &#x27;</span>) );</span><br><span class="line"></span><br><span class="line">	CString strtmp;</span><br><span class="line">	<span class="keyword">if</span> ( pos == <span class="number">-1</span> ) &#123;</span><br><span class="line">		<span class="comment">// 无空格</span></span><br><span class="line">		strtmp = str;</span><br><span class="line">		pos = end;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		strtmp = str.Mid(<span class="number">0</span>, pos<span class="number">-0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ( !infilename(strtmp, filename) ) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	str.Delete(<span class="number">0</span>, pos);</span><br><span class="line">	str.TrimLeft(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can easily rewrite the string matching algorithm in the infilename function to achieve some extensions </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CString <span class="title">filenametmp</span><span class="params">(filename)</span></span>;</span><br><span class="line"><span class="keyword">int</span> pos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( !uplow ) &#123;</span><br><span class="line">	<span class="comment">// 大小写敏感</span></span><br><span class="line">	filenametmp.MakeLower();</span><br><span class="line">	pos = filenametmp.Find(strtmp.MakeLower());</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	pos = filenametmp.Find(strtmp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( <span class="number">-1</span> == pos ) &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( !isOrder ) &#123;</span><br><span class="line">	<span class="comment">// 无顺序</span></span><br><span class="line">	filename.Delete(<span class="number">0</span>, pos+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-5-5-Path-output"><a href="#4-5-5-Path-output" class="headerlink" title="4.5.5 Path output"></a>4.5.5 Path output</h4><p>After getting the matching file name, the next step is to get the system path of the file. Pass the full name of the matching file name obtained above into the frnPfrnNameMap hash table constructed in <strong>4.2.2</strong>, and get the path recursively. </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CString <span class="title">Volume::getPath</span><span class="params">(DWORDLONG frn, CString &amp;path)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 查找2</span></span><br><span class="line">	Frn_Pfrn_Name_Map::iterator it = frnPfrnNameMap.find(frn);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (it != frnPfrnNameMap.end()) &#123;</span><br><span class="line"></span><br><span class="line">		  <span class="keyword">if</span> ( <span class="number">0</span> != it-&gt;second.pfrn ) &#123;</span><br><span class="line">		 	  getPath(it-&gt;second.pfrn, path);</span><br><span class="line">		  &#125;</span><br><span class="line"></span><br><span class="line">		  path += it-&gt;second.filename;</span><br><span class="line">		  path += ( _T(<span class="string">&quot;\&quot;) );</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	return path;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-Complexity-analysis"><a href="#5-Complexity-analysis" class="headerlink" title="5 Complexity analysis"></a>5 Complexity analysis</h2><h3 id="5-1-Time-complexity"><a href="#5-1-Time-complexity" class="headerlink" title="5.1 Time complexity"></a>5.1 Time complexity</h3><p>In theory, the time complexity is: </p>
<p><img src="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/QSearch_05.jpg" alt="Figure 5-1 Complexity analysis"> </p>
<p>On the AMD Athlon(tm) II X2 245 2.9GHz processor, the result is almost instantaneous. </p>
<h3 id="5-2-Space-complexity"><a href="#5-2-Space-complexity" class="headerlink" title="5.2 Space complexity"></a>5.2 Space complexity</h3><p>Due to the huge number of computer files-usually 10W-100W, the memory usage of the program itself can be ignored. </p>
<p>234,708 files about 43M. </p>
<p>For systems with at least 2G of memory today, it is not a burden. </p>
<h2 id="6-Problems-encountered"><a href="#6-Problems-encountered" class="headerlink" title="6 Problems encountered"></a>6 Problems encountered</h2><h3 id="6-1-Unable-to-initialize-USN-file"><a href="#6-1-Unable-to-initialize-USN-file" class="headerlink" title="6.1 Unable to initialize USN file"></a>6.1 Unable to initialize USN file</h3><p>The O disk on the computer cannot initialize the USN log file. Through debugging, it is found that: </p>
<p>DeviceIoControl returns 0, GetLastError 0x70 </p>
<p>Check msdn, the reason is ERROR_SHARING_PAUSED </p>
<p>It turns out that I forgot to initialize and add the following code, the program can access the O disk normally </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE_USN_JOURNAL_DATA cujd;</span><br><span class="line">cujd.MaximumSize = <span class="number">0</span>; <span class="comment">// 0表示使用默认值</span></span><br><span class="line">cujd.AllocationDelta = <span class="number">0</span>; <span class="comment">// 0表示使用默认值</span></span><br></pre></td></tr></table></figure>

<h3 id="6-2-The-problem-of-wchar-and-char-under-unicode"><a href="#6-2-The-problem-of-wchar-and-char-under-unicode" class="headerlink" title="6.2 The problem of wchar and char under unicode"></a>6.2 The problem of wchar and char under unicode</h3><p>Initially, in terms of string processing, the standard library function string was used as the processing method, but in unicode<br>The following is a double-byte wchar, which has gotten into a lot of trouble in string conversion. Finally, CString is used as the default string, and _T(“”) is used to initialize the string. </p>
<h3 id="6-3-ifdef-position-problem"><a href="#6-3-ifdef-position-problem" class="headerlink" title="6.3 #ifdef position problem"></a>6.3 #ifdef position problem</h3><p>#ifdef, no breakpoints can be set in it, and then I noticed that #define was written in front of include. </p>
<h3 id="6-4-Parameter-transfer"><a href="#6-4-Parameter-transfer" class="headerlink" title="6.4 Parameter transfer"></a>6.4 Parameter transfer</h3><p>I started to design with a process-oriented thinking, and got into the trouble of passing the same handle by passing parameters. Later, I changed to a class method to improve a lot. </p>
<h2 id="7-small-optimizations"><a href="#7-small-optimizations" class="headerlink" title="7 small optimizations"></a>7 small optimizations</h2><h3 id="7-1-Reading-speed"><a href="#7-1-Reading-speed" class="headerlink" title="7.1 Reading speed"></a>7.1 Reading speed</h3><p>When constructing the hash function, three methods were thought of, and experiments were performed respectively, and the time function was used to count the time spent. The results are as follows: </p>
<p>1) After modifying the code, read the usn once, save it in a temporary file, read and build the hash table </p>
<p>Each run, the average time is about 27s </p>
<p>2) Use vector to store data in memory, after release, </p>
<p>The result is gratifying, and the time has been increased by nearly 10 times! ! ! As shown in Figure 7-1: </p>
<p><img src="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/QSearch_06.jpg" alt="7-1 Traverse all disks"> </p>
<p>It is completely within the acceptable range. </p>
<p>The first run was obviously time-consuming, and then the file was pre-read from the disk cache, and the speed soared. The analysis hotspot should lie in the disk seek time and file reading. </p>
<h3 id="7-2-Open-file-method"><a href="#7-2-Open-file-method" class="headerlink" title="7.2 Open file method"></a>7.2 Open file method</h3><p>In <strong>4.3.2</strong>, double-click the file path in the ListBox to open the response file. At the beginning, the system() system function was used, but a black console window will pop up, and the main window will be locked, etc. Execution can only be continued after the file is closed, which is very detrimental to user experience. Call the ShellExecute function instead to open up a new process and the main window can continue to execute. </p>
<h3 id="7-3-Progress-bar"><a href="#7-3-Progress-bar" class="headerlink" title="7.3 Progress bar"></a>7.3 Progress bar</h3><p>After the V1.0 version was released, there was no prompt when some students reported the background statistics file, so I don’t know when it will be completed. So a progress bar is added at the bottom of the main interface to enhance interactivity, as shown in the figure<br>7-2: </p>
<p><img src="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/QSearch_07.jpg" alt="Figure 7-2 Progress bar"> </p>
<p>Of course, the thread function has also made necessary changes: </p>
<h1 id="8-Conclusion"><a href="#8-Conclusion" class="headerlink" title="8 Conclusion"></a>8 Conclusion</h1><p>At this point, the basic functions of the program are completed. Tests on multiple computers and different systems (XP and later windows series) have basically no suspended animations and program hangs. </p>
<p>Due to time and other reasons, there are still many functions that have not been implemented, such as the interface cannot be extended, and the file data cannot be dynamically collected. </p>
<h1 id="references"><a href="#references" class="headerlink" title="references"></a>references</h1><p>[1] Hardware white paper. NTFS file system specification [OL]. Baidu Library, 2011: 30.<br>[2] Beiyu. Research on several technologies of NTFS file system [OL]. 2007: 7.<br>[3] Babies. Interactive Encyclopedia [OL]. <a target="_blank" rel="noopener" href="http://www.hudong.com/wiki/ntfs">http://www.hudong.com/wiki/ntfs</a><br>[4] Microsoft. MSDN Library[OL]. 2012 :<br>[5] Stanley B.Lippman / Josée LaJoie / Barbara E.Moo. C++ Primer[M]. Addison-Wesley Professional , 2006 : 10.3<br>[6] Eric S. Raymond. Translators: Jiang Hong, He Yuan, Cai Xiaojun. The Art of UNIX Programming [m]. Publishing House of Electronics Industry, 2006:<br>[7] Chen Hao. Some principles of software design [OL]. <a target="_blank" rel="noopener" href="http://coolshell.cn/articles/4535.html">http://coolshell.cn/articles/4535.html</a><br>[8] Sun Xin. VC++ in-depth detailed explanation [m]. Electronics Industry, 2006<br>[9] Jim Beveridge / Robert Wiener. Multithreading Applications in Win32: The Complete Guide to Threads<br>[10] Addison-Wesley Professional, 1996: 223-243 </p>
<h1 id="English-summary"><a href="#English-summary" class="headerlink" title="English summary"></a>English summary</h1><p><strong>Rapid positioning of the NTFS disk files</strong> </p>
<p>LE IH Austria </p>
<p>(School of Information &amp; Computer, Anhui Agricultural University, Hefei 230036) </p>
<p><strong>Abstract</strong>：This article describes on windows NTFS disk, the<br>enumeration all the names of the files and folders on the hard disk ,<br>and to build a hash table by using C++ STL, MFC GUI and worker thread.<br>Ultimately the user to enter keywords , as a simple search like google<br>keyword search , and then instantly return all matching files / folders<br>and their system path. </p>
<p><strong>Key words :</strong> NTFS, Fast, Search, Keywords, File Path </p>

    </div>

    
    
    
      
  <div class="popular-posts-header">Related Posts</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/en/Go-Web/" rel="bookmark">Go Web</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/en/Learn-Go-in-20-days/" rel="bookmark">Learn Go in 20 days</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/en/ios-developer-account-and-app-store/" rel="bookmark">iOS developer account and how to list it</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/en/count-lines-of-code/" rel="bookmark">Number of lines of code</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/en/A-simple-VS-between-Sinatra-and-Martini/" rel="bookmark">A simple VS. between Sinatra and Martini</a></div>
    </li>
  </ul>


    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me 👨‍💻 a coffee ☕️</div>
  <button onclick="document.querySelector('.post-reward').classList.toggle('active');">
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/wechat.png" alt="LeiHao WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/alipay.png" alt="LeiHao Alipay">
        <span>Alipay</span>
      </div>
      <div>
        <img src="https://raw.githubusercontent.com/LeiHao0/BlogAssets/assets/bitcoin.png" alt="LeiHao Bitcoin">
        <span>Bitcoin</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/en/tags/programming/" rel="tag"># Programming</a>
              <a href="/en/tags/everything/" rel="tag"># Everything</a>
              <a href="/en/tags/ntfs/" rel="tag"># NTFS</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
            </div>
            <div class="post-nav-item">
                <a href="/en/Before-graduation/" rel="next" title="More than ten days before graduation">
                  More than ten days before graduation <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






      
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 2012 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-laptop-code"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LeiHao</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Symbols count total">537k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">8:08</span>
  </span>
</div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
<script src="/en/js/utils.js"></script><script src="/en/js/next-boot.js"></script>

  




  <script src="/en/js/local-search.js"></script>















  








  

  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://Artwalk.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://leihao0.github.io/en/QSearch/";
    this.page.identifier = "QSearch/";
    this.page.title = "The principle conjecture and realization of Everything";
    };
  NexT.utils.loadComments('#disqus_thread', () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://Artwalk.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
